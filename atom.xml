<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>gcaçš„å­¦ä¹ å½•</title>
  
  
  <link href="https://fireonice.github.io/atom.xml" rel="self"/>
  
  <link href="https://fireonice.github.io/"/>
  <updated>2022-03-30T04:40:02.181Z</updated>
  <id>https://fireonice.github.io/</id>
  
  <author>
    <name>gca</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ç®—æ³•â€”â€”å¹¶æŸ¥é›†ã€å¸ƒéš†è¿‡æ»¤å™¨</title>
    <link href="https://fireonice.github.io/2022/03/29/%E7%AE%97%E6%B3%95-%E5%B9%B6%E6%9F%A5%E9%9B%86%E3%80%81%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/"/>
    <id>https://fireonice.github.io/2022/03/29/%E7%AE%97%E6%B3%95-%E5%B9%B6%E6%9F%A5%E9%9B%86%E3%80%81%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/</id>
    <published>2022-03-29T15:02:52.252Z</published>
    <updated>2022-03-30T04:40:02.181Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å¹¶æŸ¥é›†"><a href="#å¹¶æŸ¥é›†" class="headerlink" title="å¹¶æŸ¥é›†"></a>å¹¶æŸ¥é›†</h1><h2 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h2><p>è®¾è®¡ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œèƒ½å¤Ÿå¿«é€Ÿæ‰§è¡Œ2ä¸ªæ“ä½œ</p><p>1ã€æŸ¥è¯¢</p><p>2ã€è¿æ¥</p><p>æ•°ç»„ã€é“¾è¡¨ã€å¹³è¡¡äºŒå‰æ ‘ã€é›†åˆï¼ˆSetï¼‰ï¼Ÿ</p><p>æŸ¥è¯¢ã€è¿æ¥çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ï¼šO(n) </p><h2 id="å¹¶æŸ¥é›†-1"><a href="#å¹¶æŸ¥é›†-1" class="headerlink" title="å¹¶æŸ¥é›†"></a>å¹¶æŸ¥é›†</h2><p>å¹¶æŸ¥é›†ä¹Ÿå«ä½œä¸ç›¸äº¤é›†åˆï¼ˆDisjoint Setï¼‰</p><p>å¹¶æŸ¥é›†æœ‰2ä¸ªæ ¸å¿ƒæ“ä½œ </p><ul><li><p>æŸ¥æ‰¾ï¼ˆFindï¼‰ï¼šæŸ¥æ‰¾å…ƒç´ æ‰€åœ¨çš„é›†åˆï¼ˆè¿™é‡Œçš„é›†åˆå¹¶ä¸æ˜¯ç‰¹æŒ‡Setè¿™ç§æ•°æ®ç»“æ„ï¼Œæ˜¯æŒ‡å¹¿ä¹‰çš„æ•°æ®é›†åˆï¼‰ </p></li><li><p>åˆå¹¶ï¼ˆUnionï¼‰ï¼šå°†ä¸¤ä¸ªå…ƒç´ æ‰€åœ¨çš„é›†åˆåˆå¹¶ä¸ºä¸€ä¸ªé›†åˆ</p></li></ul><p>æœ‰2ç§å¸¸è§çš„å®ç°æ€è·¯ï¼š</p><p>Quick Find </p><ul><li><p>æŸ¥æ‰¾ï¼ˆFindï¼‰çš„æ—¶é—´å¤æ‚åº¦ï¼šO(1) </p></li><li><p>åˆå¹¶ï¼ˆUnionï¼‰çš„æ—¶é—´å¤æ‚åº¦ï¼šO(n)</p></li></ul><p>Quick Union </p><ul><li><p>æŸ¥æ‰¾ï¼ˆFindï¼‰çš„æ—¶é—´å¤æ‚åº¦ï¼šO(logn)ï¼Œå¯ä»¥ä¼˜åŒ–è‡³ O ï¼ˆğ›¼ ï¼ˆğ‘›ï¼‰ï¼‰ ï¼ŒÎ±(ğ‘›) &lt; 5 </p></li><li><p>åˆå¹¶ï¼ˆUnionï¼‰çš„æ—¶é—´å¤æ‚åº¦ï¼šO(logn)ï¼Œå¯ä»¥ä¼˜åŒ–è‡³ O ï¼ˆğ›¼ ï¼ˆnï¼‰ï¼‰ ï¼ŒÎ±(ğ‘›) &lt; 5</p></li></ul><p>å¦‚ä½•å­˜å‚¨æ•°æ®ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220330121343572.png" alt="image-20220330121343572"></p><p>å¯ä»¥ç”¨æ•°ç»„å®ç°çš„æ ‘å½¢ç»“æ„</p><h2 id="Quick-find"><a href="#Quick-find" class="headerlink" title="Quick find"></a>Quick find</h2><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220330121553568.png" alt="image-20220330121553568"></p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220330121559153.png" alt="image-20220330121559153"></p><p>è¿æ¥èŠ‚ç‚¹</p><ul><li>æ ‘çš„é«˜åº¦æœ€å¤šæ˜¯2</li></ul><p>æŸ¥æ‰¾èŠ‚ç‚¹</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220330121814330.png" alt="image-20220330121814330"></p><p>å®ç°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">+ å‡†å¤‡</span><br><span class="line">    + çˆ¶èŠ‚ç‚¹æ•°ç»„</span><br><span class="line">    + åˆå§‹åŒ–</span><br><span class="line">        + æ¯ä¸ªèŠ‚ç‚¹å•ç‹¬ä¸€ä¸ªé›†åˆï¼ˆçˆ¶èŠ‚ç‚¹ä¸ºæœ¬èº«ï¼ï¼ï¼ï¼‰</span><br><span class="line">+ findæŸ¥æ‰¾æ‰€å±çš„é›†åˆï¼ˆæ ¹èŠ‚ç‚¹ï¼‰</span><br><span class="line">    + å‚æ•°æ ¡éªŒï¼ï¼ï¼</span><br><span class="line">    + ç›´æ¥è¿”å›æŸ¥æ‰¾å…ƒç´ çš„çˆ¶èŠ‚ç‚¹</span><br><span class="line">+ issameï¼ˆæŸ¥æ‰¾æ˜¯å¦åŒä¸€é›†åˆï¼‰</span><br><span class="line">    + åˆ¤æ–­çˆ¶èŠ‚ç‚¹æ˜¯å¦ç›¸ç­‰ï¼ï¼</span><br><span class="line">+ unionï¼ˆåˆå¹¶èŠ‚ç‚¹æ‰€å±çš„é›†åˆï¼ï¼ï¼‰</span><br><span class="line">    + å‚æ•°æ ¡éªŒï¼ˆè‹¥å·²ç»æ˜¯åŒä¸€é›†åˆï¼Œç›´æ¥è¿”å›ï¼‰</span><br><span class="line">    + éå†æ•°ç»„ï¼ˆæŸ¥æ‰¾çˆ¶èŠ‚ç‚¹ï¼‰ï¼ï¼ï¼</span><br><span class="line">        + å°†æ‰€æœ‰çˆ¶èŠ‚ç‚¹ä¸ºp1çš„æ”¹ä¸ºçˆ¶èŠ‚ç‚¹ä¸ºp2ï¼ï¼ï¼ˆåŒ…æ‹¬p1èŠ‚ç‚¹æœ¬èº«ï¼‰</span><br><span class="line">+ æ—¶é—´æ•ˆç‡</span><br><span class="line">Find O(1)</span><br><span class="line">Union O(n)</span><br></pre></td></tr></table></figure><h2 id="Quick-union"><a href="#Quick-union" class="headerlink" title="Quick union"></a>Quick union</h2><p>æ—¶é—´æ•ˆç‡ï¼šéƒ½æ˜¯logn</p><p>è¿æ¥åŸç†ï¼šæ‰¾åˆ°æœ€æ ¹çš„èŠ‚ç‚¹è¿›è¡Œè¿æ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+ Unionï¼ˆnode1ï¼Œnode2ï¼‰</span><br><span class="line">    + ï¼ˆå·¦è¾¹æ ¹èŠ‚ç‚¹ï¼‰è·Ÿéšï¼ˆå³è¾¹æ ¹èŠ‚ç‚¹ï¼‰ï¼ï¼ï¼</span><br><span class="line">        + å°†v1çš„æ ¹èŠ‚ç‚¹å«æ¥åˆ°v2çš„æ ¹èŠ‚ç‚¹ä¸Š</span><br><span class="line">    + æ‰¾åˆ°ä¸¤ä¸ªèŠ‚ç‚¹çš„æ ¹èŠ‚ç‚¹</span><br><span class="line">    + æ ¹èŠ‚ç‚¹1çˆ¶èŠ‚ç‚¹æŒ‡å‘æ ¹èŠ‚ç‚¹2</span><br><span class="line"></span><br><span class="line">+ Findï¼ˆæ‰¾åˆ°é›†åˆæ ¹èŠ‚ç‚¹ï¼‰</span><br><span class="line">    + å‚æ•°æ ¡éªŒ</span><br><span class="line">    + å‘ä¸Šå¾ªç¯æŸ¥æ‰¾å³å¯ï¼ˆwhileï¼‰</span><br></pre></td></tr></table></figure><p>ä¼˜åŒ–ï¼ˆåŸºäºquick unionï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">+ æ ‘ä¸å¹³è¡¡ã€ç”šè‡³é“¾è¡¨æƒ…å†µ</span><br><span class="line"></span><br><span class="line">+ ä¼˜åŒ–æ–¹æ¡ˆ</span><br><span class="line">    + 1ã€åŸºäºsizeçš„ä¼˜åŒ–</span><br><span class="line">        + å…ƒç´ å°‘çš„æ•° å«æ¥åˆ° å…ƒç´ å¤šçš„æ ‘ï¼ï¼ï¼</span><br><span class="line">    + 2ã€åŸºäºrankçš„ä¼˜åŒ–</span><br><span class="line">        + çŸ®çš„æ•° å«æ¥åˆ° é«˜çš„æ ‘ï¼ï¼ï¼</span><br><span class="line"></span><br><span class="line">+ åŸºäºsizeçš„ä¼˜åŒ–</span><br><span class="line">    + åˆå§‹åŒ–</span><br><span class="line">        + sizeä¸º1</span><br><span class="line">    + union</span><br><span class="line">        + è¿æ¥æ—¶åˆ¤æ–­æ ¹èŠ‚ç‚¹size</span><br><span class="line">            + sizeå°çš„è¿æ¥åˆ°sizeå¤§çš„ä¸‹é¢</span><br><span class="line">        + ä¿®æ”¹sizeï¼ï¼ï¼</span><br><span class="line">            + å¤§çš„æ ¹èŠ‚ç‚¹sizeç›¸åº”å¢åŠ </span><br><span class="line">    + é—®é¢˜</span><br><span class="line">        + æ ‘ä¸å¹³è¡¡æ— æ³•è§£å†³</span><br><span class="line"></span><br><span class="line">+ åŸºäºrankçš„ä¼˜åŒ–ï¼ï¼ï¼</span><br><span class="line">    + åˆå§‹åŒ–</span><br><span class="line">        + æ¯ä¸ªé›†åˆrankï¼ˆé«˜åº¦ï¼‰ä¸º1</span><br><span class="line">        + åœ¨unionæ—¶ä¿®æ”¹å³å¯</span><br><span class="line">    + union</span><br><span class="line">        + è¿æ¥æ—¶åˆ¤æ–­æ ¹èŠ‚ç‚¹rank</span><br><span class="line">            + rankå°çš„æ ¹èŠ‚ç‚¹è¿æ¥åˆ°rankå¤§çš„ä¸‹é¢</span><br><span class="line">            + rankç›¸ç­‰æ—¶ï¼ï¼ï¼</span><br><span class="line">                + å·¦è¾¹å«æ¥åˆ°å³è¾¹</span><br><span class="line">                + ä¿®æ”¹rankï¼ˆå…¶ä»–æƒ…å†µä¸‹å«æ¥årankä¸å˜ï¼‰</span><br><span class="line">                    + å³è¾¹çš„rank+1å³å¯ï¼ï¼</span><br></pre></td></tr></table></figure><h2 id="è·¯å¾„å‹ç¼©"><a href="#è·¯å¾„å‹ç¼©" class="headerlink" title="è·¯å¾„å‹ç¼©"></a>è·¯å¾„å‹ç¼©</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+ æ ‘çš„é«˜åº¦è¶Šæ¥è¶Šé«˜</span><br><span class="line">    + findæ•ˆç‡å˜æ…¢</span><br><span class="line"></span><br><span class="line">+ findæ—¶è·¯å¾„ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹éƒ½æŒ‡å‘æ ¹èŠ‚ç‚¹</span><br><span class="line">    + é™ä½æ ‘çš„é«˜åº¦</span><br><span class="line">    + æŸ¥æ‰¾è¶Šå¤šï¼Œè¶Šæ¥è¿‘2å±‚</span><br><span class="line">    + unionã€findæ—¶æ•ˆç‡æå‡</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220330122034632.png" alt="image-20220330122034632"></p><p>findå®ç°ï¼ˆæ¯ä¸ªèŠ‚ç‚¹æŒ‡å‘å…¶ç¥–çˆ¶ï¼‰</p><ul><li>ä¿å­˜çˆ¶èŠ‚ç‚¹ç»§ç»­å¾ªç¯</li></ul><h2 id="è·¯å¾„åˆ†è£‚"><a href="#è·¯å¾„åˆ†è£‚" class="headerlink" title="è·¯å¾„åˆ†è£‚"></a>è·¯å¾„åˆ†è£‚</h2><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220330122107739.png" alt="image-20220330122107739"></p><h2 id="è·¯å¾„å‡åŠ"><a href="#è·¯å¾„å‡åŠ" class="headerlink" title="è·¯å¾„å‡åŠ"></a>è·¯å¾„å‡åŠ</h2><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220330122117242.png" alt="image-20220330122117242"></p><p>findï¼ˆè·¯å¾„å‡åŠï¼‰</p><ul><li>ä¿å­˜ç¥–çˆ¶ï¼Œç»§ç»­å¾ªç¯ï¼ˆè·³è¿‡çˆ¶èŠ‚ç‚¹ï¼‰</li></ul><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220330122131976.png" alt="image-20220330122131976"></p><h2 id="è‡ªå®šä¹‰ç±»å‹"><a href="#è‡ªå®šä¹‰ç±»å‹" class="headerlink" title="è‡ªå®šä¹‰ç±»å‹"></a>è‡ªå®šä¹‰ç±»å‹</h2><p>å®ç°</p><p>1ã€hashè®¡ç®—</p><p>2ã€é“¾è¡¨+æ˜ å°„ï¼ˆmapï¼‰</p><ul><li>node(valueã€parentã€rank)</li></ul><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Quick Union - åŸºäºrankçš„ä¼˜åŒ–</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnionFind_QU_R</span> <span class="keyword">extends</span> <span class="title">UnionFind_QU</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span>[] ranks;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">UnionFind_QU_R</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>(capacity);</span><br><span class="line"></span><br><span class="line">ranks = <span class="keyword">new</span> <span class="keyword">int</span>[capacity];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ranks.length; i++) &#123;</span><br><span class="line">ranks[i] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">union</span><span class="params">(<span class="keyword">int</span> v1, <span class="keyword">int</span> v2)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> p1 = find(v1);</span><br><span class="line"><span class="keyword">int</span> p2 = find(v2);</span><br><span class="line"><span class="keyword">if</span> (p1 == p2) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (ranks[p1] &lt; ranks[p2]) &#123;</span><br><span class="line">parents[p1] = p2;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (ranks[p1] &gt; ranks[p2]) &#123;</span><br><span class="line">parents[p2] = p1;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">parents[p1] = p2;</span><br><span class="line">ranks[p2] += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Quick Union - åŸºäºrankçš„ä¼˜åŒ– - è·¯å¾„å‹ç¼©(Path Compression)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findPC</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123; <span class="comment">// v == 1, parents[v] == 2</span></span><br><span class="line">rangeCheck(v);</span><br><span class="line"><span class="keyword">if</span> (parents[v] != v) &#123;</span><br><span class="line">parents[v] = find(parents[v]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> parents[v];</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Quick Union - åŸºäºrankçš„ä¼˜åŒ– - è·¯å¾„å‡åŠ(Path Halving)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findPH</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123; </span><br><span class="line">rangeCheck(v);</span><br><span class="line"><span class="keyword">while</span> (v != parents[v]) &#123;</span><br><span class="line">parents[v] = parents[parents[v]];</span><br><span class="line">v = parents[v];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> v;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Quick Union - åŸºäºrankçš„ä¼˜åŒ– - è·¯å¾„åˆ†è£‚(Path Spliting)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findPS</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123; </span><br><span class="line">rangeCheck(v);</span><br><span class="line"><span class="keyword">while</span> (v != parents[v]) &#123;</span><br><span class="line"><span class="keyword">int</span> p = parents[v];</span><br><span class="line">parents[v] = parents[parents[v]];</span><br><span class="line">v = p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> v;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">æ­é…å»ºè®®ï¼š</span><br><span class="line"></span><br><span class="line">1ã€Quick Union</span><br><span class="line"></span><br><span class="line">2ã€åŸºäº rank çš„ä¼˜åŒ–</span><br><span class="line"></span><br><span class="line">3ã€Path Halving æˆ– Path Spliting</span><br></pre></td></tr></table></figure><h1 id="å¸ƒéš†è¿‡æ»¤å™¨"><a href="#å¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨"></a>å¸ƒéš†è¿‡æ»¤å™¨</h1><h2 id="éœ€æ±‚åˆ†æ-1"><a href="#éœ€æ±‚åˆ†æ-1" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h2><p>å¦‚æœè¦ç»å¸¸åˆ¤æ–­ 1 ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ</p><p>1ã€å¾ˆå®¹æ˜“æƒ³åˆ°ä½¿ç”¨å“ˆå¸Œè¡¨ï¼ˆHashSetã€HashMapï¼‰ï¼Œå°†å…ƒç´ ä½œä¸º key å»æŸ¥æ‰¾</p><p>æ—¶é—´å¤æ‚åº¦ï¼šO(1)ï¼Œä½†æ˜¯ç©ºé—´åˆ©ç”¨ç‡ä¸é«˜ï¼Œéœ€è¦å ç”¨æ¯”è¾ƒå¤šçš„å†…å­˜èµ„æº</p><p>2ã€æ˜¯å¦å­˜åœ¨æ—¶é—´å¤æ‚åº¦ä½ã€å ç”¨å†…å­˜è¾ƒå°‘çš„æ–¹æ¡ˆï¼Ÿ</p><p>å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰</p><h2 id="å¸ƒéš†è¿‡æ»¤å™¨-1"><a href="#å¸ƒéš†è¿‡æ»¤å™¨-1" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨"></a>å¸ƒéš†è¿‡æ»¤å™¨</h2><p>1970å¹´ç”±å¸ƒéš†æå‡º</p><ul><li>å®ƒæ˜¯ä¸€ä¸ªç©ºé—´æ•ˆç‡é«˜çš„æ¦‚ç‡å‹æ•°æ®ç»“æ„ï¼Œå¯ä»¥ç”¨æ¥å‘Šè¯‰ä½ ï¼šä¸€ä¸ªå…ƒç´ ä¸€å®šä¸å­˜åœ¨æˆ–è€…å¯èƒ½å­˜åœ¨</li><li><strong>äºŒè¿›åˆ¶å‘é‡ + hashå‡½æ•°ç»„æˆ</strong></li></ul><p>ä¼˜ç¼ºç‚¹</p><ul><li><p>ä¼˜ç‚¹ï¼šç©ºé—´æ•ˆç‡å’ŒæŸ¥è¯¢æ—¶é—´éƒ½è¿œè¿œè¶…è¿‡ä¸€èˆ¬çš„ç®—æ³•</p></li><li><p>ç¼ºç‚¹ï¼šæœ‰ä¸€å®šçš„è¯¯åˆ¤ç‡ã€åˆ é™¤å›°éš¾</p></li></ul><p>å®ƒå®è´¨ä¸Šæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶å‘é‡å’Œä¸€ç³»åˆ—éšæœºæ˜ å°„å‡½æ•°ï¼ˆHashå‡½æ•°ï¼‰</p><p>å¸¸è§åº”ç”¨ï¼š</p><p>ç½‘é¡µé»‘åå•ç³»ç»Ÿã€åƒåœ¾é‚®ä»¶è¿‡æ»¤ç³»ç»Ÿã€çˆ¬è™«çš„ç½‘å€åˆ¤é‡ç³»ç»Ÿã€è§£å†³ç¼“å­˜ç©¿é€é—®é¢˜</p><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220330122743580.png" alt="image-20220330122743580"></p><p><strong>äºŒè¿›åˆ¶å‘é‡ + hashå‡½æ•°ç»„æˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ æŸ¥æ‰¾å…ƒç´ æ˜¯å¦å­˜åœ¨</span><br><span class="line">    + å…¨éƒ¨å“ˆå¸Œå‡½æ•°ç´¢å¼•æœ‰ä¸€ä¸ªä¸ä¸º1ï¼Œä¸å­˜åœ¨ âˆš</span><br><span class="line">    + å…¨éƒ¨å“ˆå¸Œå‡½æ•°éƒ½ä¸º1ï¼Œå­˜åœ¨ï¼ˆæœ‰ä¸€å®šæ¦‚ç‡ä¸å­˜åœ¨ï¼‰</span><br><span class="line"></span><br><span class="line">+ ç´¢å¼•ï¼šäºŒè¿›åˆ¶</span><br><span class="line">+ é™ä½è¯¯åˆ¤ç‡ï¼šå‡å°‘å“ˆå¸Œå†²çª</span><br><span class="line">    + æ•°ç»„åŠ é•¿</span><br><span class="line">    + hashå‡½æ•°å¢åŠ </span><br></pre></td></tr></table></figure><p>è¯¯åˆ¤ç‡è®¡ç®—</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220330122812353.png" alt="image-20220330122812353"></p><p>æ ¹æ®è¯¯åˆ¤ç‡ã€æ•°æ®è§„æ¨¡</p><ul><li>æ¨å¯¼äºŒè¿›åˆ¶ä½ã€hashå‡½æ•°ä¸ªæ•°</li></ul><h2 id="å®ç°-1"><a href="#å®ç°-1" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>Guava: Google Core Libraries For Java</p><p><a href="https://mvnrepository.com/artifact/com.google.guava/guava">https://mvnrepository.com/artifact/com.google.guava/guava</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BloomFilter</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * äºŒè¿›åˆ¶å‘é‡çš„é•¿åº¦(ä¸€å…±æœ‰å¤šå°‘ä¸ªäºŒè¿›åˆ¶ä½)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> bitSize;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * äºŒè¿›åˆ¶å‘é‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">long</span>[] bits;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å“ˆå¸Œå‡½æ•°çš„ä¸ªæ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> hashSize;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> n æ•°æ®è§„æ¨¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> p è¯¯åˆ¤ç‡, å–å€¼èŒƒå›´(0, 1)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">BloomFilter</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">double</span> p)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (n &lt;= <span class="number">0</span> || p &lt;= <span class="number">0</span> || p &gt;= <span class="number">1</span>) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;wrong n or p&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">double</span> ln2 = Math.log(<span class="number">2</span>);</span><br><span class="line"><span class="comment">// æ±‚å‡ºäºŒè¿›åˆ¶å‘é‡çš„é•¿åº¦</span></span><br><span class="line">bitSize = (<span class="keyword">int</span>) (- (n * Math.log(p)) / (ln2 * ln2));</span><br><span class="line"><span class="comment">// æ±‚å‡ºå“ˆå¸Œå‡½æ•°çš„ä¸ªæ•°</span></span><br><span class="line">hashSize = (<span class="keyword">int</span>) (bitSize * ln2 / n);</span><br><span class="line"><span class="comment">// bitsæ•°ç»„çš„é•¿åº¦</span></span><br><span class="line">bits = <span class="keyword">new</span> <span class="keyword">long</span>[(bitSize + Long.SIZE - <span class="number">1</span>) / Long.SIZE];</span><br><span class="line"><span class="comment">// æ¯ä¸€é¡µæ˜¾ç¤º100æ¡æ•°æ®, pageSize</span></span><br><span class="line"><span class="comment">// ä¸€å…±æœ‰999999æ¡æ•°æ®, n</span></span><br><span class="line"><span class="comment">// è¯·é—®æœ‰å¤šå°‘é¡µ pageCount = (n + pageSize - 1) / pageSize</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ·»åŠ å…ƒç´ 1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">put</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">nullCheck(value);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ©ç”¨valueç”Ÿæˆ2ä¸ªæ•´æ•°</span></span><br><span class="line"><span class="keyword">int</span> hash1 = value.hashCode();</span><br><span class="line"><span class="keyword">int</span> hash2 = hash1 &gt;&gt;&gt; <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">boolean</span> result = <span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= hashSize; i++) &#123;</span><br><span class="line"><span class="keyword">int</span> combinedHash = hash1 + (i * hash2);</span><br><span class="line"><span class="keyword">if</span> (combinedHash &lt; <span class="number">0</span>) &#123;</span><br><span class="line">combinedHash = ~combinedHash;</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// ç”Ÿæˆä¸€ä¸ªäºŒè¿›ä½çš„ç´¢å¼•</span></span><br><span class="line"><span class="keyword">int</span> index = combinedHash % bitSize;</span><br><span class="line"><span class="comment">// è®¾ç½®indexä½ç½®çš„äºŒè¿›ä½ä¸º1</span></span><br><span class="line"><span class="keyword">if</span> (set(index)) result = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//   101010101010010101</span></span><br><span class="line"><span class="comment">// | 000000000000000100   1 &lt;&lt; index</span></span><br><span class="line"><span class="comment">//   101010111010010101</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">nullCheck(value);</span><br><span class="line"><span class="comment">// åˆ©ç”¨valueç”Ÿæˆ2ä¸ªæ•´æ•°</span></span><br><span class="line"><span class="keyword">int</span> hash1 = value.hashCode();</span><br><span class="line"><span class="keyword">int</span> hash2 = hash1 &gt;&gt;&gt; <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= hashSize; i++) &#123;</span><br><span class="line"><span class="keyword">int</span> combinedHash = hash1 + (i * hash2);</span><br><span class="line"><span class="keyword">if</span> (combinedHash &lt; <span class="number">0</span>) &#123;</span><br><span class="line">combinedHash = ~combinedHash;</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// ç”Ÿæˆä¸€ä¸ªäºŒè¿›ä½çš„ç´¢å¼•</span></span><br><span class="line"><span class="keyword">int</span> index = combinedHash % bitSize;</span><br><span class="line"><span class="comment">// æŸ¥è¯¢indexä½ç½®çš„äºŒè¿›ä½æ˜¯å¦ä¸º0</span></span><br><span class="line"><span class="keyword">if</span> (!get(index)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¾ç½®indexä½ç½®çš„äºŒè¿›ä½ä¸º1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">set</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line"><span class="keyword">long</span> value = bits[index / Long.SIZE];</span><br><span class="line"><span class="keyword">int</span> bitValue = <span class="number">1</span> &lt;&lt; (index % Long.SIZE);</span><br><span class="line">bits[index / Long.SIZE] = value | bitValue;</span><br><span class="line"><span class="keyword">return</span> (value &amp; bitValue) == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŸ¥çœ‹indexä½ç½®çš„äºŒè¿›ä½çš„å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> trueä»£è¡¨1, falseä»£è¡¨0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line"><span class="keyword">long</span> value = bits[index / Long.SIZE];</span><br><span class="line"><span class="keyword">return</span> (value &amp; (<span class="number">1</span> &lt;&lt; (index % Long.SIZE))) != <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">nullCheck</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (value == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Value must not be null.&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">+ ä¸æä¾›åˆ é™¤åŠŸèƒ½ï¼ˆä¿è¯æŸ¥è¯¢é«˜æ•ˆï¼‰</span><br><span class="line"></span><br><span class="line">+ å¸ƒéš†è¿‡æ»¤å™¨</span><br><span class="line">    + æ„é€ </span><br><span class="line">        + åˆ©ç”¨long[]ä½œä¸ºäºŒè¿›åˆ¶å‘é‡</span><br><span class="line">        + æ±‚å‡ºäºŒè¿›åˆ¶ä½æ•°ã€hashå‡½æ•°ä¸ªæ•°</span><br><span class="line">        + æ ¹æ®æ•°æ®è§„æ¨¡ã€è¯¯åˆ¤ç‡</span><br><span class="line">+ æ·»åŠ å…ƒç´ </span><br><span class="line">        + åŸå§‹</span><br><span class="line">            + hashcode()å¾—åˆ°å…ƒç´ çš„hashå€¼</span><br><span class="line">            + hashå‡½æ•°è®¡ç®—ç”Ÿæˆç´¢å¼•</span><br><span class="line">        + é‡‡ç”¨è°·æ­Œçš„å®ç°</span><br><span class="line">            + ç”Ÿæˆå“ˆå¸Œï¼Œå¹¶å°†ç´¢å¼•è®¾ä¸º1</span><br><span class="line">    + åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨</span><br><span class="line">        + æŸ¥è¯¢å“ˆå¸Œçš„indexæ˜¯å¦ä¸º1</span><br><span class="line">            + è‹¥æœ‰0ï¼Œåˆ™è¿”å›false</span><br><span class="line">+ è®¾ç½®æŒ‡å®šç´¢å¼•ä¸º1ï¼ï¼ï¼</span><br><span class="line">    + æ‰¾åˆ°longæ•°ç»„å¯¹åº”çš„ä½ç½®</span><br><span class="line">    + æŒ‰ä½æˆ–</span><br><span class="line">+ æŸ¥çœ‹indexä½ç½®çš„äºŒè¿›åˆ¶å€¼ï¼ï¼ï¼</span><br><span class="line">    + æ‰¾åˆ°longæ•°ç»„å¯¹åº”çš„ä½ç½®</span><br><span class="line">    + æŒ‰ä½ä¸</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">ç®—æ³•</summary>
    
    
    
    <category term="ç®—æ³•" scheme="https://fireonice.github.io/categories/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="ç®—æ³•" scheme="https://fireonice.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘â€”â€”è¯»å†™é”åŸç†&amp;ä¹è§‚è¯»é”&amp;CHMåŸç†&amp;é˜»å¡é˜Ÿåˆ—åŸç†</title>
    <link href="https://fireonice.github.io/2022/03/20/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91-%E8%AF%BB%E5%86%99%E9%94%81%E5%8E%9F%E7%90%86&amp;%E4%B9%90%E8%A7%82%E8%AF%BB%E9%94%81&amp;CHM%E5%8E%9F%E7%90%86&amp;%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97%E5%8E%9F%E7%90%86/"/>
    <id>https://fireonice.github.io/2022/03/20/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91-%E8%AF%BB%E5%86%99%E9%94%81%E5%8E%9F%E7%90%86&amp;%E4%B9%90%E8%A7%82%E8%AF%BB%E9%94%81&amp;CHM%E5%8E%9F%E7%90%86&amp;%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97%E5%8E%9F%E7%90%86/</id>
    <published>2022-03-20T06:37:50.108Z</published>
    <updated>2022-03-20T07:18:43.429Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ReentrantReadWriteLockåŸç†"><a href="#ReentrantReadWriteLockåŸç†" class="headerlink" title="ReentrantReadWriteLockåŸç†"></a>ReentrantReadWriteLockåŸç†</h1><p>t1 w.lock t2 r.lock</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220320145600222.png" alt="image-20220320145600222"></p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220320145619378.png" alt="image-20220320145619378"></p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220320145624167.png" alt="image-20220320145624167"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">+ è¯»å†™é”åŸç†</span><br><span class="line">    + ä½¿ç”¨çš„åŒä¸€ä¸ªsycnåŒæ­¥å™¨</span><br><span class="line">    + t1 w.lock å†™é”</span><br><span class="line">        + ä¸å¯é‡å…¥é”åŸºæœ¬ç›¸åŒ</span><br><span class="line">        + stateä½16ä½å†™é”ï¼Œé«˜16ä½è¯»é”</span><br><span class="line">        + tryacquire</span><br><span class="line">            + è¿™æ®µçœ‹ä¹¦æ²¡æ‡‚ï¼Œç°åœ¨ç»ˆäºæ‡‚äº†</span><br><span class="line">            + åˆ¤æ–­æœ‰æ— ï¼šè¯»é”ã€å†™é”ï¼ˆéæœ¬çº¿ç¨‹ï¼‰</span><br><span class="line">    + t2 r.lock</span><br><span class="line">        + è¯»æºç æœ€å¥½çš„åŠæ³•æ˜¯å†™ä¸ªå°æ —å­ç„¶åé€šè¿‡ideaè°ƒè¯•é˜…è¯»ï¼Œç›´æ¥è¯»å¤ªæ…¢ï¼Œè¿˜å®¹æ˜“ç†è§£é”™äº†</span><br><span class="line">        + åˆ¤æ–­æœ‰æ— å†™é”ã€å½“å‰çº¿ç¨‹çš„å†™é”</span><br><span class="line">        + é˜»å¡ï¼Œå’Œç‹¬å é”å·®ä¸å¤š</span><br><span class="line">            + åªæ˜¯èŠ‚ç‚¹ç±»å‹ä¸åŒï¼šnodeç±»å‹ä¸ºshared</span><br><span class="line">            + åˆ¤æ–­æ˜¯å¦ä¸ºè€äºŒ</span><br><span class="line">                + é‡è¯•å°è¯•è·å–</span><br><span class="line">            + å‰é©±è®¾ä¸º-1ï¼ˆå“¨å…µï¼‰</span><br><span class="line">            + å†æ¬¡è¿›å…¥å¾ªç¯ï¼Œå°è¯•è·å–</span><br><span class="line">                + ä¸€å…±ä¸‰æ¬¡å°è¯•</span><br><span class="line">            + parké˜»å¡</span><br><span class="line">    + t3 r.lock  t4 w.lock</span><br><span class="line">        + è¿›å…¥é˜»å¡é˜Ÿåˆ—</span><br><span class="line">            + è¯»é”ç±»å‹ä¸ºshared</span><br><span class="line">            + å†™é”ä¸ºç‹¬å </span><br><span class="line">            + node state</span><br><span class="line">                + å‰é¢ä¸º-1</span><br><span class="line">                + æœ€åä¸º0</span><br><span class="line">    + t1 w.unlock</span><br><span class="line">        + tryrelease</span><br><span class="line">            + state--</span><br><span class="line">            + æ£€æŸ¥æ˜¯å¦æœ‰è¯»é”</span><br><span class="line">            + å”¤é†’èŠ‚ç‚¹</span><br><span class="line">            + è€äºŒå”¤é†’</span><br><span class="line">                + éå…¬å¹³é”ä½“ç°åœ¨æŒæœ‰é”çš„çº¿ç¨‹é‡Šæ”¾é”åï¼Œå¤–æ¥çº¿ç¨‹ç›´æ¥å»å°è¯•è·å–é”ï¼Œè€Œä¸ä¼šå»åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦æœ‰çº¿ç¨‹ï¼Œè¿™æ—¶é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å’Œå¤–æ¥çº¿ç¨‹äº‰æŠ¢é”ï¼Œå°±æ˜¯éå…¬å¹³çš„</span><br><span class="line">                + å…¬å¹³é”ä½“ç°åœ¨å¤–æ¥çº¿ç¨‹è¦è·å–é”æ—¶ï¼Œä¼šå…ˆåˆ¤æ–­é˜Ÿåˆ—æœ‰æ²¡æœ‰çº¿ç¨‹é˜»å¡ï¼Œæœ‰å°±è‡ªå·±å»é˜Ÿåˆ—æ’é˜Ÿï¼Œä¸ä¼šå»å°è¯•è·å–é”</span><br><span class="line">            + è€äºŒç»§ç»­å¾ªç¯ï¼Œtryacquireè·å–è¯»é”</span><br><span class="line">                + stateé«˜ä½å˜æˆ1</span><br><span class="line">                + è®²åˆ°ä¹Ÿä¸ç»†ï¼Œå¿…é¡»è‡ªå·±è°ƒè¯•æºç </span><br><span class="line">                + å…³é”®æ˜¯æ€è€ƒï¼Œå¤šè¯»æºç </span><br><span class="line">                + setHead(node)ä¹‹åçš„ä»£ç çš„æ„æ€æ˜¯ï¼Œå½“é˜»å¡é˜Ÿåˆ—ä¸­æœ‰å¤šä¸ªè¿ç»­çš„è¯»çº¿ç¨‹æ—¶ï¼Œä¼šä¼ æ’­å¼åœ°é€ä¸€å”¤é†’ï¼Œif(s.isShared())&#123;doReleaseShared()&#125;è¿™æ®µä»£ç æ˜¯å…³é”®</span><br><span class="line">            + æ‹¿åˆ°ä¸‹ä¸ªnodeï¼Œè‹¥ä¸ºshared</span><br><span class="line">                + æŠŠå“¨å…µèŠ‚ç‚¹çŠ¶æ€æ”¹ä¸º0</span><br><span class="line">                    + é¿å…å…¶ä»–çº¿ç¨‹å¹²æ‰°</span><br><span class="line">                + ç»§ç»­å”¤é†’shared node</span><br><span class="line">                    + ç»§ç»­å¾ªç¯ï¼Œè·å–é”tryacquire</span><br><span class="line">                    + è¯»é”è®¡æ•°ï¼ˆé«˜ä½ï¼‰+1</span><br><span class="line">                    + å¾ªç¯å”¤é†’èŠ‚ç‚¹æ–¹æ³•</span><br><span class="line">                        + åˆ¤æ–­ä¸‹ä¸€ä¸ªnodeæ˜¯å¦ä¸ºshared</span><br><span class="line">                        ...</span><br><span class="line">    + t2 r.unlock t3 r.unlock</span><br><span class="line">        + tryreleaseshare</span><br><span class="line">            + çŠ¶æ€-1</span><br><span class="line">                + è‹¥ä¸ä¸º0ï¼Œå…¶ä»–è¯»é”ç»§ç»­-1</span><br><span class="line">            + è¯»stateä¸º0</span><br><span class="line">                + è§£é”æµç¨‹</span><br><span class="line">                    + å“¨å…µèŠ‚ç‚¹çŠ¶æ€-1æ”¹ä¸º0</span><br><span class="line">                    + åç»§èŠ‚ç‚¹å”¤é†’unpark</span><br><span class="line">                        + å¾ªç¯ç»§ç»­ï¼Œå½“å‰æ˜¯è€äºŒï¼Œè·å–é”tryacquire</span><br><span class="line">                        + å½“å‰nodeä½œä¸ºå“¨å…µ</span><br><span class="line">                        + å†™stateçŠ¶æ€ä¿®æ”¹</span><br></pre></td></tr></table></figure><h1 id="StampedLock"><a href="#StampedLock" class="headerlink" title="StampedLock"></a>StampedLock</h1><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220320145720741.png" alt="image-20220320145720741"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">+ StamedLock</span><br><span class="line">    + ä½œç”¨</span><br><span class="line">        + å¢åŠ è¯»çš„æ€§èƒ½</span><br><span class="line">        + é…åˆæˆ³ä½¿ç”¨</span><br><span class="line">            + åŠ é”è¿”å›æˆ³</span><br><span class="line">            + ç”¨æˆ³è§£é”</span><br><span class="line">            + ä¹è§‚è¯»</span><br><span class="line">                + éªŒæˆ³ï¼Œé”å‡çº§</span><br><span class="line">    + æ¼”ç¤º</span><br><span class="line">        + ä¹è§‚è¯»ï¼Œæˆ³ä¸å˜ï¼Œæœªè¢«ä¿®æ”¹è¯»å–æˆåŠŸ</span><br><span class="line">        + æˆ³æ”¹å˜ï¼Œé”å‡çº§</span><br><span class="line">            + çœŸæ­£åŠ è¯»é”ï¼Œä¸å†™é”äº’æ–¥</span><br><span class="line">        + è¯»è¯»</span><br><span class="line">            + ä¹è§‚è¯»ç­‰äºæ— é”è¯»å–</span><br><span class="line">        + è¯»å†™</span><br><span class="line">            + ä¹è§‚è¯»é”éªŒè¯æˆ³å¤±è´¥</span><br><span class="line">            + åŠ è¯»é”ï¼Œè¿›å…¥é˜»å¡</span><br><span class="line">            + å†™é”é‡Šæ”¾åï¼Œè¯»é”åŠ æˆåŠŸ</span><br><span class="line">                + è¯»å–æœ€æ–°å€¼</span><br><span class="line">        + ç¼ºç‚¹ï¼š</span><br><span class="line">            + æ— æ¡ä»¶å˜é‡</span><br><span class="line">            + ä¸æ”¯æŒå¯é‡å…¥</span><br></pre></td></tr></table></figure><h1 id="Semaphore"><a href="#Semaphore" class="headerlink" title="Semaphore"></a>Semaphore</h1><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220320145742093.png" alt="image-20220320145742093"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">+ Semaphore</span><br><span class="line">    + ä½œç”¨</span><br><span class="line">        + ä¿¡å·é‡</span><br><span class="line">            + é™åˆ¶åŒæ—¶è®¿é—®å…±äº«èµ„æºçš„çº¿ç¨‹ä¸Šé™</span><br><span class="line">    + æ¼”ç¤º</span><br><span class="line">        + acquireè·å–ä¿¡å·é‡</span><br><span class="line">    + åº”ç”¨</span><br><span class="line">        + ç®€å•é™æµï¼ˆå•æœºï¼‰</span><br><span class="line">        + é™åˆ¶çº¿ç¨‹æ•°ï¼Œè€Œéèµ„æºæ•°</span><br><span class="line">            + é€‚åˆä¸€ä¸ªçº¿ç¨‹ä¸€ä¸ªè¿æ¥ï¼šæ•°æ®åº“è¿æ¥æ± </span><br><span class="line">        + æ”¹è¿›æ•°æ®åº“è¿æ¥æ± </span><br><span class="line">            + è·å–è¿æ¥</span><br><span class="line">                + è·å–ä¿¡å·é‡</span><br><span class="line">                    + è·å–æˆåŠŸæ‰èƒ½è·å–è¿æ¥</span><br><span class="line">                    + æ²¡æœ‰ä¿¡å·é‡ï¼Œé˜»å¡</span><br><span class="line">            + å½’è¿˜è¿æ¥</span><br><span class="line">                + å½’è¿˜åï¼Œreleaseä¿¡å·é‡</span><br><span class="line">    + åŸç†</span><br><span class="line">        + æ„é€ æ–¹æ³•</span><br><span class="line">            + ä¿¡å·é‡ç»™åŒæ­¥å™¨syncï¼Œèµ‹å€¼ä¿¡å·é‡ç»™state</span><br><span class="line">        + acquire</span><br><span class="line">            + tryacquireshare</span><br><span class="line">                + è·å–state</span><br><span class="line">                + åˆ¤æ–­state--æ˜¯å¦å°äº0</span><br><span class="line">                    + æ— ä¿¡å·é‡ï¼ŒAQSé˜»å¡é˜Ÿåˆ—</span><br><span class="line">                    + è€äºŒtryè·å–ï¼Œcas</span><br><span class="line">                    + å‰é©±æ”¹ä¸º-1</span><br><span class="line">                    + æœ€åparkçº¿ç¨‹</span><br><span class="line">                + casä¿®æ”¹state--</span><br><span class="line">        + release</span><br><span class="line">            + tryreleaseshare</span><br><span class="line">                + è·å–state</span><br><span class="line">                + cas state++</span><br><span class="line">            + doreleaseshare</span><br><span class="line">                + å“¨å…µèŠ‚ç‚¹æ˜¯å¦-1</span><br><span class="line">                    + æ”¹ä¸º0</span><br><span class="line">                + å”¤é†’ååºèŠ‚ç‚¹</span><br><span class="line">                    + è€äºŒ tryacquireï¼ŒæˆåŠŸ</span><br><span class="line">                        + cas state</span><br><span class="line">                    + è‡ªå·±è®¾ä¸ºå“¨å…µ</span><br><span class="line">                    + å”¤é†’ååºå…±äº«èŠ‚ç‚¹</span><br><span class="line">                        + ç”±äºä¿¡å·é‡ä¸å¤Ÿï¼Œåˆè¢«é˜»å¡</span><br><span class="line">                    + è¿™é‡Œæœ‰ä¸ªåŒunparkæœºåˆ¶ï¼Œå°±æ˜¯è¿è¡Œç»“æŸåçš„çº¿ç¨‹ä¼šé‡Šæ”¾é”å»å”¤é†’ï¼Œå¦å¤–ä¸€ä¸ªåˆšè·å¾—é‡Šæ”¾çš„é”çš„çº¿ç¨‹ä¹Ÿä¼šå»å”¤é†’ï¼Œä¸è¿‡è¢«å”¤é†’åçš„çº¿ç¨‹ä¸èƒ½è·å¾—é”è¿˜æ˜¯ä¼šparkä½</span><br></pre></td></tr></table></figure><h1 id="CountDownLatch"><a href="#CountDownLatch" class="headerlink" title="CountDownLatch"></a>CountDownLatch</h1><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220320145822476.png" alt="image-20220320145822476"></p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220320145829350.png" alt="image-20220320145829350"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">+ CountDownLatch</span><br><span class="line">    + ç®€ä»‹</span><br><span class="line">        + å€’è®¡æ—¶é”ï¼Œçº¿ç¨‹é—´åŒæ­¥åä½œ</span><br><span class="line">            + await()ç­‰å¾…è®¡æ•°å½’é›¶ï¼Œcountdown()è®¡æ•°-1</span><br><span class="line">        + aqsåŒæ­¥å™¨</span><br><span class="line">            + acquireï¼šstateä¸º0è·å¾—é”</span><br><span class="line">            + releaseï¼šè®¡æ•°-1</span><br><span class="line">        + ä¸»çº¿ç¨‹ç­‰å¾…ï¼Œå…¶ä»–çº¿ç¨‹è®¡æ•°å‡å®Œï¼Œä¸»çº¿ç¨‹ç»§ç»­è¿è¡Œ</span><br><span class="line">    + æ”¹è¿›</span><br><span class="line">        + çº¿ç¨‹æ± ç­‰ä¸èƒ½ç”¨joinç­‰å¾…çº¿ç¨‹ç»“æŸ</span><br><span class="line">            + å¯ä»¥ç”¨countdownlatch</span><br><span class="line">    + åº”ç”¨</span><br><span class="line">        + ç­‰å¾…å¤šçº¿ç¨‹å‡†å¤‡å®Œæ¯•</span><br><span class="line">            + åŠ è½½å®Œæ¯•è®¡æ•°-1</span><br><span class="line">            + è®¡æ•°ç»“æŸï¼Œä¸»çº¿ç¨‹è¿è¡Œ</span><br><span class="line">        + ç­‰å¾…å¤šä¸ªè¿œç¨‹è°ƒç”¨ç»“æŸ</span><br><span class="line">            + CompletableFutureå¼‚æ­¥ç¼–æ’</span><br><span class="line">            + å€’è®¡æ—¶é”</span><br><span class="line">            + æˆ‘é€‰æ‹©AsyncTool</span><br><span class="line">            + ä½¿ç”¨futureè·å–è¿”å›å€¼</span><br><span class="line">+ Cyclicbarrier</span><br><span class="line">    + é—®é¢˜</span><br><span class="line">        + countdownlatchä¸èƒ½è¢«é‡ç”¨</span><br><span class="line">        + Cyclicbarrier</span><br><span class="line">    + ä½¿ç”¨</span><br><span class="line">        + await</span><br><span class="line">            + state-1 é˜»å¡</span><br><span class="line">            + å½“stateä¸º0ï¼Œå…¨éƒ¨å”¤é†’ç»§ç»­</span><br><span class="line">        + å½“å…¨éƒ¨æ‰§è¡Œå®Œï¼Œè¿è¡Œå‚æ•°ä¸­çš„ä»»åŠ¡</span><br><span class="line">        + è®¡æ•°ä¸º0åï¼Œå†æ¬¡è°ƒç”¨awaitåˆé‡æ–°å¼€å§‹</span><br><span class="line">    + æ³¨æ„</span><br><span class="line">        + çº¿ç¨‹æ•°è¦è·Ÿè®¡æ•°ä¸€æ ·</span><br></pre></td></tr></table></figure><h1 id="JUC-Collection"><a href="#JUC-Collection" class="headerlink" title="JUC-Collection"></a>JUC-Collection</h1><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220320145839640.png" alt="image-20220320145839640"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">+ çº¿ç¨‹å®‰å…¨é›†åˆç±»</span><br><span class="line">    + æ¦‚è¿°</span><br><span class="line">        + é—ç•™çš„</span><br><span class="line">            + hahtableã€vectorï¼šéƒ½ç”¨synchronizeä¿®é¥°</span><br><span class="line">        + ä¿®é¥°çš„å®‰å…¨é›†åˆ</span><br><span class="line">            + collectionsä¸­ç±»çš„åŒ…è£…</span><br><span class="line">            + è£…é¥°å™¨æ¨¡å¼</span><br><span class="line">        + jucå®‰å…¨é›†åˆ</span><br><span class="line">            + blockingç±»</span><br><span class="line">                + å¤§éƒ¨åˆ†åŸºäºé”ï¼ˆå¯é‡ç”¨é”ï¼‰ï¼Œé˜»å¡æ–¹æ³•</span><br><span class="line">            + copyonwriteç±»</span><br><span class="line">                + ä¿®æ”¹æ—¶æ‹·è´çš„æ–¹å¼</span><br><span class="line">                + cowå†™æ—¶å¤åˆ¶</span><br><span class="line">            + concurrentç±»</span><br><span class="line">                + å†…éƒ¨å¾ˆå¤šé‡‡ç”¨casä¼˜åŒ–ï¼Œæé«˜åå</span><br><span class="line">                + å¼±ä¸€è‡´æ€§</span><br><span class="line">                    + éå†æ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¿®æ”¹ï¼Œè¿­ä»£å™¨ç»§ç»­è¿è¡Œï¼ˆæ—§å†…å®¹ï¼‰</span><br><span class="line">                    + æ±‚å¤§å°ã€è¯»å–</span><br><span class="line">                    + è¿™é‡Œçš„å¼±ä¸€è‡´æ€§ï¼Œå…¶å®æ˜¯å®‰å…¨å¤±è´¥æœºåˆ¶ï¼ˆfail-safeï¼‰å®ç°åŸç†ï¼šè·å¾—åŸé›†åˆçš„ä¸€ä»½æ‹·è´ï¼Œåœ¨æ‹·è´è€Œæ¥çš„é›†åˆä¸Šè¿›è¡Œéå†ï¼ŒåŸé›†åˆå‘ç”Ÿçš„æ”¹å˜æ—¶ï¼Œä¸ä¼šæŠ›å‡ºCMEå¼‚å¸¸</span><br></pre></td></tr></table></figure><h1 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h1><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220320145853898.png" alt="image-20220320145853898"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">+ ConcurrentHashMap</span><br><span class="line">    + é¢è¯•çš„ç¥!CHM</span><br><span class="line">    + é”™è¯¯ç”¨æ³•</span><br><span class="line">        + ç»Ÿè®¡å•è¯ä¸ªæ•°</span><br><span class="line">            + çº¿ç¨‹ä¸å®‰å…¨</span><br><span class="line">        + hmæ”¹ä¸ºchm</span><br><span class="line">            + ä»ç„¶ä¸è¡Œ</span><br><span class="line">                + æ¯ä¸ªæ–¹æ³•åŸå­</span><br><span class="line">                + ç»„åˆèµ·æ¥éåŸå­</span><br><span class="line">            + è§£å†³ï¼š</span><br><span class="line">                + ç›´æ¥åŠ synchronizeé‡é‡çº§é”</span><br><span class="line">                + CAS</span><br><span class="line">    + computeIfAbsent</span><br><span class="line">        + è·Ÿæˆ‘åœ¨æå®¢æ—¶é—´å­¦çš„ä¸€æ ·ï¼Œå“ˆå“ˆå“ˆå“ˆ</span><br><span class="line">        + è¿™ä¸ªdemoæ„Ÿè§‰ä¿¡æ¯é‡å¥½å¤§ï¼Œå­¦åˆ°å¾ˆå¤šç¼–ç¨‹æ€è·¯å’Œæ‰‹æ®µ</span><br><span class="line">        + ç¬¬ä¸€æ¬¡è‹¥keyä¸å­˜åœ¨ï¼Œåˆ™ç”Ÿæˆkeyå’Œç´¯åŠ å™¨ï¼ˆåŸå­æ€§ï¼‰</span><br><span class="line">        + åé¢ç›´æ¥è¿”å›ç´¯åŠ å™¨ï¼Œè¿›è¡Œç´¯åŠ ï¼ˆåŸå­æ€§ï¼‰</span><br></pre></td></tr></table></figure><h1 id="ConcurrentHashMapåŸç†"><a href="#ConcurrentHashMapåŸç†" class="headerlink" title="ConcurrentHashMapåŸç†"></a>ConcurrentHashMapåŸç†</h1><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220320150154452.png" alt="image-20220320150154452"></p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220320150213295.png" alt="image-20220320150213295"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line">+ ConcurrentHashMapåŸç†</span><br><span class="line">    + hashmap</span><br><span class="line">        + å›é¡¾</span><br><span class="line">            + æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘</span><br><span class="line">            + hashåœ°å€å†²çªï¼Œé“¾åœ°å€æ³•</span><br><span class="line">                + jdk7æ”¾åˆ°é“¾è¡¨å¤´éƒ¨</span><br><span class="line">                + jdk8æ”¾åˆ°é“¾è¡¨å°¾éƒ¨</span><br><span class="line">            + è¶…è¿‡3/4ï¼Œæ‰©å®¹ï¼Œé‡æ–°è®¡ç®—æ¡¶ä¸‹æ ‡</span><br><span class="line">                + ä½ä½çš„ä¸‹æ ‡ä¸å˜ï¼Œé«˜ä½çš„åŠ ä¸ªoldSizeå°±æ˜¯æ–°ä¸‹æ ‡</span><br><span class="line">                + ä¸ºä»€ä¹ˆæ•°ç»„æ‰©å®¹åï¼Œé“¾è¡¨é•¿åº¦ä¼šå‡åŠï¼Ÿå› ä¸ºæˆ‘ä»¬ç¡®å®šæ¡¶ä½ç½®æ˜¯æ•°ç»„é•¿åº¦ä¸hashè¿›è¡Œ&amp;æ“ä½œï¼Œé•¿åº¦æ‰©ä¸º2å€ï¼Œæ¡¶ä½ç½®æ­£å¥½ä¼šæ”¹ä¸º2å€</span><br><span class="line">            + å¤šçº¿ç¨‹ä¸‹æ‰©å®¹ï¼Œå¹¶å‘æ­»é“¾é—®é¢˜</span><br><span class="line">        + æ­»é“¾</span><br><span class="line">            + ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è§¦å‘æ‰©å®¹</span><br><span class="line">            + å‡ºç°ç¯å½¢é“¾è¡¨</span><br><span class="line">                + ç¬¬ä¸€æ¬¡æ‰©å®¹ç»“æŸåï¼Œçº¿ç¨‹å†è¿›è¡Œæ‰©å®¹çš„æ—¶å€™é“¾è¡¨ä¸Šå‡ºç°äº†ç¯ã€‚å¯¼è‡´ç¨‹åºä¸èƒ½å†å¾€ä¸‹ç»§ç»­è¿è¡Œ</span><br><span class="line">            + jdk8ï¼Œå°¾æ’æ³•</span><br><span class="line">                + ä»æœ‰å…¶ä»–é—®é¢˜ï¼ˆæ‰©å®¹ä¸¢æ•°æ®ï¼‰</span><br><span class="line">+ concurrenthashmap-jdk8</span><br><span class="line">    + åŸç†</span><br><span class="line">        + å±æ€§&amp;å†…éƒ¨ç±»&amp;æ–¹æ³•</span><br><span class="line">            + è¿ç§»</span><br><span class="line">                + ä»åå¾€å‰å¤„ç†</span><br><span class="line">                + å¤„ç†å®ŒåŠ fnodeèŠ‚ç‚¹</span><br><span class="line">            + çº¢é»‘æ ‘</span><br><span class="line">                + æ‰©å®¹åˆ°64</span><br><span class="line">                + é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘</span><br><span class="line">        + æ„é€ </span><br><span class="line">            + åˆå§‹å®¹é‡ã€è´Ÿè½½å› å­ï¼ˆ3/4ï¼‰ã€å¹¶å‘åº¦</span><br><span class="line">                + æœ€å°‘åˆå§‹å®¹é‡ç­‰äºå¹¶å‘åº¦</span><br><span class="line">            + æ‡’æƒ°åˆå§‹åŒ–</span><br><span class="line">            + è®¡ç®—å®¹é‡å¤§å°ï¼ˆå˜æˆä¸º2çš„næ¬¡æ–¹ï¼‰</span><br><span class="line">        + get</span><br><span class="line">            + è¿™ä¸ªåœ°æ–¹è¯´çš„ä¸æ¸…æ¥šï¼Œçœ‹å®Œä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆä¸åŠ é”ï¼Œå®é™…ä¸Šæ˜¯ç”¨äº†volatileå…³é”®å­—</span><br><span class="line">            + ä¸åŠ é”å°±æ˜¯volatileå¸¦æ¥çš„å¥½å¤„ï¼Œå³ä½¿å†™æ“ä½œæ›´æ–°äº†ä¹Ÿå¯è§ä¸ä¼šè„è¯»</span><br><span class="line">            + éå†é“¾è¡¨ï¼Œç”¨equalsæ¯”è¾ƒkeyï¼Œè¿”å›val</span><br><span class="line">        + put</span><br><span class="line">            + é»˜è®¤è¦†ç›–æ—§å€¼</span><br><span class="line">            + ä¸å…è®¸null</span><br><span class="line">            + è‹¥tableä¸ºç©º</span><br><span class="line">                + casåˆ›å»ºtable</span><br><span class="line">            + è‹¥é“¾è¡¨æ— å¤´ç»“ç‚¹ï¼ˆæ¡¶ä¸‹æ ‡ä¸å†²çªï¼‰</span><br><span class="line">                + casæ·»åŠ é“¾è¡¨å¤´</span><br><span class="line">                + å¤´ç»“ç‚¹è¢«å ï¼Œå†å¾ªç¯ä¸€éï¼Œè¿™ä¸ªç»“ç‚¹ä¼šåŠ åœ¨åˆšåˆšé‚£ä¸ªå¤´ç»“ç‚¹çš„åé¢</span><br><span class="line">            + å¸®å¿™æ‰©å®¹</span><br><span class="line">                + é”ä½å½“å‰é“¾è¡¨å¸®å¿™æ‰©å®¹</span><br><span class="line">            + æ¡¶ä¸‹æ ‡å†²çª</span><br><span class="line">                + åŠ é”synchronizeï¼Œé”ä½é“¾è¡¨å¤´ç»“ç‚¹</span><br><span class="line">                + å†æ¬¡æ ¡éªŒé“¾è¡¨å¤´èŠ‚ç‚¹æ˜¯å¦è¢«ç§»åŠ¨</span><br><span class="line">                + èŠ‚ç‚¹hash&gt;0</span><br><span class="line">                    + keyæ‰¾åˆ°ç›¸åŒçš„ï¼Œæ›´æ–°æ“ä½œ</span><br><span class="line">                        + æ›´æ–°value</span><br><span class="line">                    + keyä¸å­˜åœ¨ï¼Œæ·»åŠ æ“ä½œ</span><br><span class="line">                        + å·²ç»æ˜¯æœ€åçš„èŠ‚ç‚¹äº†</span><br><span class="line">                        + æ–°å¢nodeé“¾è¡¨å°¾æ’</span><br><span class="line">                + èŠ‚ç‚¹hash&lt;0ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºçº¢é»‘æ ‘</span><br><span class="line">                    + å¾€çº¢é»‘æ ‘ä¸­æ·»åŠ node</span><br><span class="line">                + é‡Šæ”¾é”ï¼Œåˆ¤æ–­é“¾è¡¨é•¿åº¦æ˜¯å¦å¤§äºæ ‘åŒ–é˜ˆå€¼</span><br><span class="line">            + è®¡æ•°å™¨è®¡æ•°</span><br><span class="line">        + initTable</span><br><span class="line">            + æ‡’æƒ°åˆå§‹åŒ–</span><br><span class="line">            + tableè‹¥æ²¡è¢«åˆ›å»ºï¼Œè¿›å…¥å¾ªç¯</span><br><span class="line">                + åŒé‡æ ¡éªŒæ˜¯å¦è¢«åˆ›å»º</span><br><span class="line">                    + ç¬¬ä¸€æ¬¡å¹¶å‘</span><br><span class="line">                + caså°†sizeCtlè®¾ä¸º-1ï¼ˆæ­£åœ¨åˆ›å»ºhashè¡¨ï¼‰</span><br><span class="line">                + æˆåŠŸcasï¼Œå‡†å¤‡åˆ›å»ºhashè¡¨</span><br><span class="line">                    + æ ¹æ®åˆå§‹å®¹é‡scï¼Œåˆ›å»ºnodeæ•°ç»„</span><br><span class="line">                    + scèµ‹å€¼ç»™sizeCtlï¼Œæ¢å¤åˆ°æ­£æ•°</span><br><span class="line">                + å¹¶å‘çº¿ç¨‹éƒ½åœ¨å¾ªç¯ä¸­é€€å‡º</span><br><span class="line">        + addcount</span><br><span class="line">            + å¢åŠ å…ƒç´ è®¡æ•°</span><br><span class="line">            + å¤šä¸ªç´¯åŠ å•å…ƒï¼Œä¿è¯å¤šçº¿ç¨‹æ•ˆç‡</span><br><span class="line">            + æ²¡æœ‰ç´¯åŠ å•å…ƒï¼Œcaså‘basecountç´¯åŠ </span><br><span class="line">            + æœ‰äº†ç´¯åŠ å•å…ƒï¼Œcasç´¯åŠ ++</span><br><span class="line">                + @Contendedæ³¨è§£é˜²æ­¢æ•°æ®ä¼ªå…±äº«</span><br><span class="line">                + ä¹‹å‰è®²LongAdderåŸç†çš„æ—¶å€™è®²è¿‡ï¼Œè¯´çš„æ˜¯@Contenedæ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£æ˜¯åœ¨å¯¹è±¡æˆ–å˜é‡å‰ååŠ paddingï¼Œå°±æ˜¯å ä½ï¼Œä¸ºäº†é¿å…å¤šCPUç¼“å­˜è¡Œä¼ªå…±äº«é—®é¢˜</span><br><span class="line">                + å…ƒç´ ä¸ªæ•°è‹¥å¤§äºsizeCtlï¼Œè¿›å…¥å¾ªç¯ï¼Œæ‰©å®¹æ“ä½œ</span><br><span class="line">                    + æ ¡éªŒscæ˜¯å¦ä¸ºè´Ÿæ•°</span><br><span class="line">                        + è‹¥newtableå·²åˆ›å»º</span><br><span class="line">                            + å¸®å¿™æ‰©å®¹</span><br><span class="line">                    + caså°†sizeCtlè®¾ä¸ºè´Ÿæ•°</span><br><span class="line">                    + casæˆåŠŸï¼Œè¿›å…¥transferï¼Œä¼ å…¥table</span><br><span class="line">        + size</span><br><span class="line">            + æ²¡æœ‰ç«äº‰å‘ç”Ÿï¼Œbasecountç´¯åŠ </span><br><span class="line">            + æœ‰ç«äº‰å‘ç”Ÿï¼Œç”¨ç´¯åŠ å•å…ƒè®¡æ•°</span><br><span class="line">                + sum ç´¯åŠ å•å…ƒçš„å€¼å’Œbasecount</span><br><span class="line">            + å¾ˆæ˜æ˜¾åœ¨sumCountè®¡ç®—çš„è¿‡ç¨‹ä¸­æ— æ³•é˜²æ­¢åˆ«çš„çº¿ç¨‹è¿›è¡Œä¸€äº›ç´¯åŠ å’Œåˆ é™¤æ“ä½œ</span><br><span class="line">        + transfer</span><br><span class="line">            + è‹¥nexttableä¸ºnullï¼Œåˆ›å»ºnexttable</span><br><span class="line">                + åŸæœ‰å®¹é‡&lt;&lt;1</span><br><span class="line">            + èŠ‚ç‚¹æ¬è¿</span><br><span class="line">                + ä»¥é“¾è¡¨ä¸ºå•ä½ç§»åŠ¨</span><br><span class="line">                + è‹¥é“¾è¡¨å¤„ç†å®Œï¼Œæ›¿æ¢ä¸ºforwardingnode</span><br><span class="line">                + è‹¥å·²ç»ä¸ºfwdï¼Œå¤„ç†ä¸‹ä¸€ä¸ªé“¾è¡¨</span><br><span class="line">                + è‹¥é“¾è¡¨å¤´æœ‰å…ƒç´ </span><br><span class="line">                    + synchronizeé”ä½å½“å‰é“¾è¡¨</span><br><span class="line">                    + èŠ‚ç‚¹hash&gt;0ï¼ˆæ™®é€šèŠ‚ç‚¹ï¼‰</span><br><span class="line">                    + èŠ‚ç‚¹hash&lt;0ä¸”ç±»å‹ä¸ºtreebinï¼Œæ ‘èŠ‚ç‚¹æ¬è¿</span><br><span class="line">+ concurrenthashmap-jdk7</span><br><span class="line">    + ç»“æ„</span><br><span class="line">        + ç»´æŠ¤segmentæ•°ç»„ï¼ˆæ¯ä¸ªç»§æ‰¿å¯é‡ç”¨é”ï¼‰</span><br><span class="line">            + å¤šæŠŠé”</span><br><span class="line">            + jdk8ï¼šé”åŠ åœ¨é“¾è¡¨å¤´</span><br><span class="line">        + ç¼ºç‚¹ï¼š</span><br><span class="line">            + é”æ•°ç»„å¤§å°å›ºå®š</span><br><span class="line">            + éæ‡’æƒ°åˆå§‹åŒ–</span><br><span class="line">        + æ„é€ æ—¶å°±åˆ›å»º</span><br><span class="line">        + æ¯ä¸ªsegmentï¼ˆåˆ†æ®µé”ï¼‰å¯¹åº”å°çš„hashentry</span><br><span class="line">            + ä¸åŒé”ï¼Œé”çš„å†…å®¹ä¸ä¸€æ ·</span><br><span class="line">    + å®šä½segment</span><br><span class="line">        + å¤šçœ‹ä¸¤éï¼ŒJUCçš„ä¸œè¥¿è¿˜æ˜¯è¿ç»­æ€§å¾ˆå¼ºçš„</span><br><span class="line">        + æ ¹æ®hashæ±‚segmentä½ç½®ï¼ˆä½è¿ç®—ï¼‰ï¼Œè·å–segment</span><br><span class="line">    + put</span><br><span class="line">        + è®¡ç®—keyçš„hashï¼Œæ‰¾åˆ°segmentä¸‹æ ‡</span><br><span class="line">        + è·å–segmentï¼Œè¿›å…¥segmentçš„putæ–¹æ³•</span><br><span class="line">            + å¯é‡å…¥é”åŠ é”</span><br><span class="line">            + hashentryï¼Œæ±‚æ¡¶ä¸‹æ ‡</span><br><span class="line">                + é“¾è¡¨ï¼šæ›´æ–°/æ–°å¢</span><br><span class="line">                    + keyæ‰¾åˆ°ç›¸ç­‰ï¼Œæ›´æ–°å€¼</span><br><span class="line">                    + æ‰¾ä¸åˆ°keyï¼Œæ–°å¢</span><br><span class="line">                        + åˆ›å»ºnodeèŠ‚ç‚¹</span><br><span class="line">                        + æ‰©å®¹ç­‰</span><br><span class="line">                        + åšä¸ºé“¾è¡¨å¤´</span><br><span class="line">    + rehashæ‰©å®¹</span><br><span class="line">        + åœ¨å¤–å±‚å·²ç»åŠ é”</span><br><span class="line">        + æ—§å®¹é‡ç§»ä½ï¼Œåˆ›å»ºnewtable</span><br><span class="line">        + éå†æ¬è¿</span><br><span class="line">            + å¦‚æœåªæœ‰å¤´èŠ‚ç‚¹ï¼Œç›´æ¥æ¬è¿</span><br><span class="line">            + é“¾è¡¨å¤šä¸ªèŠ‚ç‚¹ï¼Œéå†é“¾è¡¨</span><br><span class="line">                + è®°å½•nodeæ”¹å˜åä½ç½®</span><br><span class="line">                + æŠŠä¸å˜çš„nodeé‡ç”¨</span><br><span class="line">        + æ–°å¢æ—¶æ‰rehash</span><br><span class="line">            + æ–°çš„nodeåœ¨æ‰©å®¹å®Œæ‰åŠ å…¥new table</span><br><span class="line">    + get</span><br><span class="line">        + unsafeæ–¹æ³•ä¿è¯å¯è§æ€§</span><br><span class="line">        + å®šä½segmentã€æ¡¶ä¸‹æ ‡</span><br><span class="line">        + éå†keyï¼Œæ‰¾åˆ°ç›´æ¥è¿”å›value</span><br><span class="line">    + size</span><br><span class="line">        + å¾ªç¯ï¼Œéå†segment</span><br><span class="line">            + sumç´¯åŠ count</span><br><span class="line">                + æœŸé—´è‹¥è¢«ä¿®æ”¹ï¼ˆä¸ç­‰äºä¸Šæ¬¡è®¡æ•°ï¼‰ï¼Œåˆ™é‡æ–°è®¡æ•°</span><br><span class="line">                + æœ€å¤šå¾ªç¯è®¡æ•°ä¸‰æ¬¡ï¼ŒåŠ é”å¤„ç†ç»Ÿè®¡æ“ä½œ</span><br><span class="line">        + å…ˆä¸åŠ é”è®¡ç®—2æ¬¡ï¼Œè®¤ä¸ºä¸ªæ•°æ­£ç¡®è¿”å›</span><br><span class="line">        + å¦‚æœä¸ä¸€æ ·ï¼Œé‡è¯•ï¼Œè¶…è¿‡3æ¬¡ï¼Œé”ä½æ‰€æœ‰segment</span><br></pre></td></tr></table></figure><h1 id="LinkedBlockingQueueåŸç†"><a href="#LinkedBlockingQueueåŸç†" class="headerlink" title="LinkedBlockingQueueåŸç†"></a>LinkedBlockingQueueåŸç†</h1><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220320150052835.png" alt="image-20220320150052835"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">+ LinkedBlockingQueue</span><br><span class="line">    + å…¥é˜Ÿå‡ºé˜Ÿ</span><br><span class="line">        + é˜»å¡é˜Ÿåˆ—</span><br><span class="line">        + nodeï¼ˆitemã€nextï¼‰</span><br><span class="line">        + åˆå§‹åŒ–é“¾è¡¨</span><br><span class="line">            + æŒ‡å‘å“¨å…µèŠ‚ç‚¹</span><br><span class="line">        + èŠ‚ç‚¹å…¥é˜Ÿ</span><br><span class="line">            + å°¾æ’</span><br><span class="line">        + èŠ‚ç‚¹å‡ºé˜Ÿ</span><br><span class="line">            + å“¨å…µèŠ‚ç‚¹åƒåœ¾å›æ”¶</span><br><span class="line">            + è·å–è€äºŒçš„å€¼ï¼Œè€äºŒå˜æˆå“¨å…µèŠ‚ç‚¹</span><br><span class="line">            + å ä½å“¨å…µåœ¨æ•°æ„è®¾è®¡ä¸­çš„ä½œç”¨æ˜¯ï¼Œä¸€å¼€å§‹å¤´æœ‰æ‰€æŒ‡ï¼Œå°¾æœ‰æ‰€å‘ã€‚è¿›å‡ºé˜Ÿæ—¶æˆ–è€…æŸ¥æ‰¾ï¼Œå°‘å¤§çº¦næ¬¡çš„if else</span><br><span class="line">    + åŠ é”åˆ†æ</span><br><span class="line">        + ç”¨äº†ä¸¤æŠŠé”å’Œå“¨å…µ</span><br><span class="line">            + ä¸¤æŠŠé”å…è®¸ä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œ</span><br><span class="line">                + ç”Ÿäº§è€…ï¼ˆé˜Ÿåˆ—å°¾ï¼‰æ¶ˆè´¹è€…ï¼ˆé˜Ÿåˆ—å¤´ï¼‰</span><br><span class="line">                + å…è®¸åŒæ—¶getå’Œput</span><br><span class="line">        + çº¿ç¨‹å®‰å…¨</span><br><span class="line">            + èŠ‚ç‚¹å¤§äº2</span><br><span class="line">                + é˜Ÿå°¾é˜Ÿå¤´ä¸¤æŠŠé”ï¼ˆä¸€ä¸ªå“¨å…µï¼‰ï¼Œä¿è¯å…¥é˜Ÿå‡ºé˜Ÿæ— ç«äº‰</span><br><span class="line">            + èŠ‚ç‚¹ç­‰äº2</span><br><span class="line">                + ä»ç„¶ä¸¤æŠŠé”ï¼ˆä¸€ä¸ªå“¨å…µï¼‰ï¼Œé”ä¸¤ä¸ªå¯¹è±¡</span><br><span class="line">            + èŠ‚ç‚¹ä¸º1</span><br><span class="line">                + å°±ä¸€ä¸ªå“¨å…µï¼Œé˜Ÿåˆ—ä¸ºç©ºï¼Œtakeä¼šè¢«é˜»å¡</span><br><span class="line">    + put</span><br><span class="line">        + éç©ºåˆ¤æ–­</span><br><span class="line">        + åˆ›å»ºnode</span><br><span class="line">        + æ‹¿åˆ°puté”</span><br><span class="line">            + è‹¥é˜Ÿåˆ—æ»¡å®¹é‡ï¼Œç­‰å¾…</span><br><span class="line">            + è‹¥æœ‰ç©ºä½ï¼Œå…¥é˜Ÿæ–¹æ³•ï¼Œè®¡æ•°++</span><br><span class="line">            + è‹¥é˜Ÿåˆ—å®¹é‡ä»ä¸æ»¡ï¼Œå«é†’putçº¿ç¨‹ï¼ˆsignalä¸€ä¸ªï¼‰</span><br><span class="line">        + è§£é”</span><br><span class="line">        + å¦‚æœé˜Ÿåˆ—åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œé€šçŸ¥æ¶ˆè´¹takeçº¿ç¨‹ï¼ˆsignalä¸€ä¸ªï¼‰</span><br><span class="line">        + æ¶ˆè´¹è€…ä¹Ÿä¼šå”¤é†’ï¼Œåªæ˜¯ä¸æ˜¯å”¤é†’å…¨éƒ¨ï¼Œåªä¼šå”¤é†’ä¸€ä¸ªï¼Œå”¤é†’å®Œä¸€ä¸ªåå†ç”±ç”Ÿäº§è€…è‡ªå·±å”¤é†’ç”Ÿäº§è€…</span><br><span class="line">        + å¦‚æœæœ‰å¤šä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆtakeçº¿ç¨‹è‚¯å®šæ˜¯åœ¨æ‰§è¡Œçš„ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œè¡¨ç¤ºæ˜¯æˆ‘è¿™æ¬¡putè¿›å»çš„ï¼Œéœ€è¦å”¤é†’takeçº¿ç¨‹æ¥å–</span><br><span class="line">        + takeï¼Œtakeé”</span><br><span class="line">            + ä¸ºç©ºï¼Œç­‰å¾…</span><br><span class="line">            + å‡ºé˜Ÿ</span><br><span class="line">            + é˜Ÿåˆ—æœ‰å®¹é‡ï¼Œå«é†’ä¸€ä¸ªæ¶ˆè´¹è€…</span><br><span class="line">        + è§£é”</span><br><span class="line">        + å¦‚æœé˜Ÿåˆ—åªæœ‰ä¸€ä¸ªç©ºä½ï¼Œå«é†’putç”Ÿäº§è€…çº¿ç¨‹ï¼ˆsignalï¼‰</span><br><span class="line">    + vs arrayblockingqueue</span><br><span class="line">        + linkedæ‡’æƒ°çš„ï¼Œåˆå§‹ä¸åˆ›å»º</span><br><span class="line">        + linkedå…¥é˜Ÿæ‰ç”Ÿæˆnodeï¼Œarrayæå‰åˆ›å»ºå¥½çš„</span><br><span class="line">        + linkedä¸¤æŠŠé”ï¼Œarrayä¸€æŠŠé”</span><br></pre></td></tr></table></figure><h1 id="ConcurrentLinkedQueue"><a href="#ConcurrentLinkedQueue" class="headerlink" title="ConcurrentLinkedQueue"></a>ConcurrentLinkedQueue</h1><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220320150125092.png" alt="image-20220320150125092"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">+ ConcurrentLinkedQueue</span><br><span class="line">    + ä¸linkedåƒï¼Œä¸¤æŠŠé”ï¼Œé˜Ÿåˆ—å¤´å°¾ï¼Œå“¨å…µ</span><br><span class="line">    + ä½¿ç”¨caså®ç°é”</span><br><span class="line">        + casä¿è¯çº¿ç¨‹å®‰å…¨</span><br><span class="line">+ CopyOnWriteArrayList</span><br><span class="line">    + copyonwriteï¼šå†™å…¥æ—¶æ‹·è´æ€æƒ³</span><br><span class="line">        + å¢åˆ æ”¹ï¼Œåœ¨æ–°æ•°ç»„ä¸Šæ‰§è¡Œ</span><br><span class="line">            + ä¸å½±å“å…¶ä»–çº¿ç¨‹å¹¶å‘è¯»</span><br><span class="line">            + è¯»å†™åˆ†ç¦»ã€è¯»å†™å¹¶å‘</span><br><span class="line">    + add</span><br><span class="line">        + åŠ é”ï¼ˆå†™å†™äº’æ–¥ï¼‰</span><br><span class="line">            + æ—§æ•°ç»„æ‹·è´ï¼ˆé•¿åº¦+1ï¼‰æ–°æ•°ç»„</span><br><span class="line">            + æ·»åŠ æ–°å…ƒç´ </span><br><span class="line">            + æ›¿æ¢æ—§æ•°ç»„</span><br><span class="line">    + è¯»ä½¿ç”¨æ—§æ•°ç»„ï¼ˆæ–°æ•°ç»„è¿˜æœªæ›¿æ¢å®Œï¼‰</span><br><span class="line">    + è¯»æœªåŠ é”</span><br><span class="line">    + getå¼±ä¸€è‡´æ€§</span><br><span class="line">        + çº¿ç¨‹åŒæ—¶è¯»å’Œremoveï¼Œä»èƒ½è¯»åˆ°</span><br><span class="line">        + è¿­ä»£å™¨å¼±ä¸€è‡´æ€§</span><br><span class="line">            + å³ä½¿removeï¼Œè¿­ä»£å™¨ä»æ‹¿åˆ°æ—§æ•°ç»„å¼•ç”¨</span><br><span class="line">            + ä¼˜ç‚¹</span><br><span class="line">                + æ•°æ®åº“çš„MVCCéƒ½æ˜¯å¼±ä¸€è‡´æ€§è¡¨ç°</span><br><span class="line">                + å¹¶å‘åº¦é«˜</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘</summary>
    
    
    
    <category term="å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘" scheme="https://fireonice.github.io/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91/"/>
    
    
    <category term="å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘" scheme="https://fireonice.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘â€”â€”æ‰‹å†™çº¿ç¨‹æ± &amp;AQSåŸç†&amp;å¯é‡å…¥é”åŸç†&amp;è¯»å†™é”</title>
    <link href="https://fireonice.github.io/2022/03/20/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91-%E6%89%8B%E5%86%99%E7%BA%BF%E7%A8%8B%E6%B1%A0&amp;AQS%E5%8E%9F%E7%90%86&amp;%E5%8F%AF%E9%87%8D%E5%85%A5%E9%94%81%E5%8E%9F%E7%90%86&amp;%E8%AF%BB%E5%86%99%E9%94%81/"/>
    <id>https://fireonice.github.io/2022/03/20/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91-%E6%89%8B%E5%86%99%E7%BA%BF%E7%A8%8B%E6%B1%A0&amp;AQS%E5%8E%9F%E7%90%86&amp;%E5%8F%AF%E9%87%8D%E5%85%A5%E9%94%81%E5%8E%9F%E7%90%86&amp;%E8%AF%BB%E5%86%99%E9%94%81/</id>
    <published>2022-03-20T05:52:55.715Z</published>
    <updated>2022-03-20T07:11:30.220Z</updated>
    
    <content type="html"><![CDATA[<h1 id="è‡ªå®šä¹‰çº¿ç¨‹æ± "><a href="#è‡ªå®šä¹‰çº¿ç¨‹æ± " class="headerlink" title="è‡ªå®šä¹‰çº¿ç¨‹æ± "></a>è‡ªå®šä¹‰çº¿ç¨‹æ± </h1><p>ç»“æ„</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220320135837804.png" alt="image-20220320135837804"></p><h2 id="é˜»å¡é˜Ÿåˆ—"><a href="#é˜»å¡é˜Ÿåˆ—" class="headerlink" title="é˜»å¡é˜Ÿåˆ—"></a>é˜»å¡é˜Ÿåˆ—</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. ä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line"><span class="keyword">private</span> Deque&lt;T&gt; queue = <span class="keyword">new</span> ArrayDeque&lt;&gt;();</span><br><span class="line"><span class="comment">// 2. é”</span></span><br><span class="line"><span class="keyword">private</span> ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"><span class="comment">// 3. ç”Ÿäº§è€…æ¡ä»¶å˜é‡</span></span><br><span class="line"><span class="keyword">private</span> Condition fullWaitSet = lock.newCondition();</span><br><span class="line"><span class="comment">// 4. æ¶ˆè´¹è€…æ¡ä»¶å˜é‡</span></span><br><span class="line"><span class="keyword">private</span> Condition emptyWaitSet = lock.newCondition();</span><br><span class="line"><span class="comment">// 5. å®¹é‡</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> capcity;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">+ blocking queue</span><br><span class="line">    + ä»»åŠ¡é˜Ÿåˆ—-åŒå‘é“¾è¡¨</span><br><span class="line">    + å¯é‡å…¥é”</span><br><span class="line">        + ç”Ÿäº§è€…æ¡ä»¶å˜é‡</span><br><span class="line">            + é˜Ÿåˆ—å®¹é‡é™åˆ¶</span><br><span class="line">        + æ¶ˆè´¹è€…æ¡ä»¶å˜é‡</span><br><span class="line">            + é˜Ÿåˆ—ç©ºé™åˆ¶</span><br><span class="line">    + å®¹é‡ä¸Šé™</span><br><span class="line">    + é˜»å¡è·å–</span><br><span class="line">        + ä¸Šé”</span><br><span class="line">            + é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œè·å–é˜Ÿåˆ—å¤´å…ƒç´ </span><br><span class="line">            + å”¤é†’é˜Ÿåˆ—æ»¡æ¡ä»¶å˜é‡</span><br><span class="line">    + é˜»å¡æ·»åŠ </span><br><span class="line">        + ä¸Šé”</span><br><span class="line">            + é˜Ÿåˆ—ä¸æ»¡ï¼Œè¿›å…¥é˜Ÿåˆ—å°¾éƒ¨</span><br><span class="line">            + å”¤é†’é˜Ÿåˆ—ç©ºæ¡ä»¶å˜é‡</span><br><span class="line">+ pollå¢å¼º</span><br><span class="line">    + å¸¦è¶…æ—¶é˜»å¡è·å–</span><br><span class="line">    + awaitè¿”å›çš„æ˜¯ï¼šè¢«å”¤é†’åå‰©ä½™æ—¶é—´</span><br><span class="line">        + å‰©ä½™æ—¶é—´èµ‹å€¼ç»™ä¸‹ä¸€ä¸ªç­‰å¾…æ—¶é—´</span><br><span class="line">        + å‰©ä½™æ—¶é—´ç”¨å®Œï¼Œé€€å‡º</span><br></pre></td></tr></table></figure><h2 id="çº¿ç¨‹æ± "><a href="#çº¿ç¨‹æ± " class="headerlink" title="çº¿ç¨‹æ± "></a>çº¿ç¨‹æ± </h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">+ å®ç°</span><br><span class="line">    + TheadPool</span><br><span class="line">        + blockqueue</span><br><span class="line">        + hashsetï¼šçº¿ç¨‹worker</span><br><span class="line">            + å¦‚æœä»»åŠ¡æ•°æ²¡è¶…è¿‡æœ€å¤§ï¼Œäº¤ç»™çº¿ç¨‹æ‰§è¡Œ</span><br><span class="line">            + å¦‚æœä»»åŠ¡æ•°è¶…è¿‡æœ€å¤§ï¼Œä»»åŠ¡è¿›å…¥é˜»å¡é˜Ÿåˆ—</span><br><span class="line">        + MAX</span><br><span class="line">        + timeout</span><br><span class="line">+ æ‰§è¡Œä»»åŠ¡</span><br><span class="line">+ workeræ‰§è¡Œ</span><br><span class="line">    + ä»ä¼ è¿‡æ¥çš„taskã€ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„taskä¸æ–­è·å–æ‰§è¡Œ</span><br><span class="line">    + æ‰§è¡Œå®Œæ¯•ï¼Œç§»é™¤çº¿ç¨‹</span><br><span class="line">    + ç°åœ¨è¿™ä¸ªå¥½åƒä¸€æ—¦æ²¡ä»»åŠ¡å°±æ‰”æ‰ï¼Œè¿™ä¸æ˜¯äº«å…ƒæ¨¡å¼å•Š</span><br><span class="line">    + å¹¶ä¸ä¼šç§»é™¤ï¼Œå› ä¸ºtaskQueueçš„takeæ–¹æ³•æ˜¯é˜»å¡çš„ï¼Œä¹Ÿå°±æ˜¯è¯´çº¿ç¨‹ä¼šä¸€ç›´æ´»åœ¨ä¼‘æ¯å®¤</span><br><span class="line">+ takeæ­»ç­‰&amp;pollè¶…æ—¶</span><br><span class="line">    + take()æ­»ç­‰</span><br><span class="line">        + ä¸ä¼šåœæ­¢çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹</span><br><span class="line">+ é‡‡ç”¨pollè¶…æ—¶</span><br><span class="line">        + æ²¡æœ‰ä»»åŠ¡ï¼Œè¶…æ—¶ç»“æŸçº¿ç¨‹</span><br><span class="line">+ å½“ä»»åŠ¡é˜Ÿåˆ—å·²æ»¡</span><br><span class="line">    + é˜»å¡ç­‰å¾…æ·»åŠ ä»»åŠ¡é˜Ÿåˆ—</span><br><span class="line">+ offerå¢å¼º</span><br><span class="line">    + å¸¦è¶…æ—¶æ—¶é—´ï¼Œé˜»å¡æ·»åŠ é˜Ÿåˆ—</span><br><span class="line">+ æ‹’ç»ç­–ç•¥</span><br><span class="line">    + ç­–ç•¥æ¨¡å¼</span><br><span class="line">        + tryput</span><br><span class="line">+ æ‹’ç»ç­–ç•¥æµ‹è¯•</span><br><span class="line">    + é¢è¯•æ‰‹å†™çº¿ç¨‹æ± ä¸æ…Œäº†</span><br><span class="line">    + ç­‰å¾…ã€æ”¾å¼ƒã€è‡ªå·±æ‰§è¡Œ</span><br></pre></td></tr></table></figure><h2 id="ThreadPoolExecutor"><a href="#ThreadPoolExecutor" class="headerlink" title="ThreadPoolExecutor"></a>ThreadPoolExecutor</h2><p>æ„é€ æ–¹æ³•</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220320141145740.png" alt="image-20220320141145740"></p><p>æ‰§è¡Œæµç¨‹</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220320141746086.png" alt="image-20220320141746086"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">+ JDKçš„çº¿ç¨‹æ± </span><br><span class="line">+ çº¿ç¨‹æ± çŠ¶æ€</span><br><span class="line">    + å­˜åœ¨åŸå­å˜é‡ä¸­</span><br><span class="line">        + ä¸€ä¸ªæ•´æ•°åŒæ—¶ä¿å­˜äº†çŠ¶æ€å’Œçº¿ç¨‹ä¸ªæ•°</span><br><span class="line">+ æ„é€ æ–¹æ³•</span><br><span class="line">    + å·¥ä½œæ–¹å¼</span><br><span class="line">        + æ•‘æ€¥çº¿ç¨‹</span><br><span class="line">            + é˜»å¡é˜Ÿåˆ—æ»¡äº†ä¹‹åï¼Œå¼€å¯</span><br><span class="line">            + æ‰§è¡Œå®Œæ¯•é”€æ¯</span><br><span class="line">            + å¯è®¾ç½®ç”Ÿå­˜æ—¶é—´</span><br><span class="line">        + æ ¸å¿ƒçº¿ç¨‹ä¸€ç›´ä¿å­˜</span><br><span class="line">        + æ•‘æ€¥çº¿ç¨‹éƒ½æ»¡äº†</span><br><span class="line">            + æ‰§è¡Œæ‹’ç»ç­–ç•¥</span><br><span class="line">    + æ‰§è¡Œæµç¨‹</span><br><span class="line">        + æ‹’ç»ç­–ç•¥ï¼šå››ç§</span><br><span class="line">            + æŠ›å‡ºå¼‚å¸¸</span><br><span class="line">            + è°ƒç”¨è€…æ‰§è¡Œä»»åŠ¡</span><br><span class="line">            + æ”¾å¼ƒä»»åŠ¡</span><br><span class="line">            + æ”¾å¼ƒé˜Ÿåˆ—ä¸­æœ€æ—©çš„ä»»åŠ¡ï¼Œæœ¬ä»»åŠ¡å–ä»£</span><br><span class="line">        + å…¶ä»–æ¡†æ¶</span><br><span class="line">            + ç«™åœ¨æ¶æ„è§’åº¦æ€è€ƒé—®é¢˜</span><br><span class="line">            + dubbo</span><br><span class="line">                + æŠ›å¼‚å¸¸å‰è®°å½•æ—¥å¿—ï¼Œçº¿ç¨‹æ ˆä¿¡æ¯</span><br><span class="line">            + netty</span><br><span class="line">                + åˆ›å»ºæ–°çº¿ç¨‹</span><br><span class="line">            + activemq</span><br><span class="line">                + å¸¦è¶…æ—¶æ”¾å…¥é˜Ÿåˆ—</span><br><span class="line">            + pinpoint</span><br><span class="line">                + æ‹’ç»ç­–ç•¥é“¾ï¼Œé€ä¸€å°è¯•æ¯ç§ç­–ç•¥</span><br><span class="line">    + å°†æ¡†æ¶æ‹†è§£å¼€ï¼Œä»è‡ªå·±å®ç°åˆ°å¸¦é€ä¸€åˆ†æåˆ«äººæ€ä¹ˆå®ç°ï¼Œæ€è·¯æ¸…æ™°ã€‚</span><br><span class="line">+ å·¥å‚æ–¹æ³•åˆ›å»ºçº¿ç¨‹æ± </span><br><span class="line">    + å›ºå®šå¤§å°çº¿ç¨‹æ± </span><br><span class="line">        + æ²¡æœ‰æ•‘æ€¥çº¿ç¨‹ï¼Œçº¿ç¨‹ä¸ä¼šç»“æŸ</span><br><span class="line">        + æ— ç•Œé˜Ÿåˆ—</span><br><span class="line">        + å‰å®³ï¼Œåº•å±‚ä½¿ç”¨åˆ°äº†è®¸å¤šè®¾è®¡æ¨¡å¼</span><br><span class="line">    + å¸¦ç¼“å†²çº¿ç¨‹æ± </span><br><span class="line">        + å…¨éƒ¨æ•‘æ€¥çº¿ç¨‹ï¼Œ60så›æ”¶</span><br><span class="line">        + é˜Ÿåˆ—ï¼šæ²¡æœ‰å®¹é‡</span><br><span class="line">            + æ²¡æœ‰çº¿ç¨‹å–æ˜¯æ”¾ä¸è¿›å»çš„</span><br><span class="line">            + é˜Ÿåˆ—çš„putåªæœ‰å…¶ä»–çº¿ç¨‹takeæ‰ä¼šè¢«æ‰§è¡Œ</span><br><span class="line">    + å•çº¿ç¨‹çº¿ç¨‹æ± </span><br><span class="line">        + ä¿è¯çº¿ç¨‹æ± å§‹ç»ˆæœ‰ä¸€ä¸ªå¯ç”¨çš„çº¿ç¨‹</span><br><span class="line">        + è£…é¥°å™¨æ¨¡å¼</span><br><span class="line">            + åªèƒ½è°ƒç”¨è¿”å›åŒ…è£…å¯¹è±¡ä¸­çš„æ–¹æ³•</span><br><span class="line">+ submitï¼ˆå¸¦è¿”å›ç»“æœï¼‰</span><br><span class="line">    + executeï¼ˆrunnableï¼‰</span><br><span class="line">    + submitï¼ˆcallableï¼‰</span><br><span class="line">        + è¿”å›ç»“æœ</span><br><span class="line">        + ä¿æŠ¤æ€§æš‚åœæ¨¡å¼</span><br><span class="line">    + TODO å¼‚æ­¥ç¼–æ’å’ŒThreadLocal</span><br><span class="line">    + æµ‹è¯•</span><br><span class="line">+ invokeAllï¼ˆæ‰§è¡Œä»»åŠ¡é›†åˆã€è¶…æ—¶æ—¶é—´ï¼‰</span><br><span class="line">+ invokeAny</span><br><span class="line">    + æ‰§è¡Œå®Œä¸€ä¸ªå³å¯ï¼ˆæœ€å…ˆæ‰§è¡Œå®Œæ¯•ï¼‰</span><br><span class="line">+ åœæ­¢</span><br><span class="line">    + shutdownï¼ˆæ‰§è¡Œå®Œæ¯•æ‰€æœ‰ä»»åŠ¡ï¼ˆé˜Ÿåˆ—ï¼‰åœæ­¢ï¼‰</span><br><span class="line">        + ä¸»çº¿ç¨‹å¼‚æ­¥ï¼Œä¸ä¼šç­‰å¾…</span><br><span class="line">    + showdownnow</span><br><span class="line">        + STOPç«‹å³åœæ­¢</span><br><span class="line">        + è¿”å›é˜Ÿåˆ—</span><br><span class="line">    + åˆ¤æ–­æš‚åœï¼Œç­‰å¾…ç»“æŸç­‰</span><br><span class="line">+ æµ‹è¯•</span><br><span class="line">    + ç»“æŸ</span><br><span class="line">    + ç­‰å¾…</span><br></pre></td></tr></table></figure><h1 id="è®¾è®¡æ¨¡å¼-å·¥ä½œçº¿ç¨‹"><a href="#è®¾è®¡æ¨¡å¼-å·¥ä½œçº¿ç¨‹" class="headerlink" title="è®¾è®¡æ¨¡å¼-å·¥ä½œçº¿ç¨‹"></a>è®¾è®¡æ¨¡å¼-å·¥ä½œçº¿ç¨‹</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">+ å¼‚æ­¥æ¨¡å¼ä¹‹å·¥ä½œçº¿ç¨‹</span><br><span class="line">    + å®šä¹‰</span><br><span class="line">        + å·¥ä½œçº¿ç¨‹ï¼šçº¿ç¨‹æ± ã€äº«å…ƒæ¨¡å¼</span><br><span class="line">            + ä¸åŒä»»åŠ¡ç±»å‹é‡‡ç”¨ä¸åŒçº¿ç¨‹æ± </span><br><span class="line">                + ä¸åŒç±»å‹çš„ä»»åŠ¡ æ‰§è¡Œæ—¶é—´ä¸ä¸€æ · æ‰€ä»¥åŒä¸€ä¸ªçº¿ç¨‹æ± å¯èƒ½å¯¼è‡´æœ‰äº›çº¿ç¨‹å¾ˆéš¾æˆ–è€…å¾ˆè¿Ÿè¢«æ‰§è¡Œ  è€Œä¸”æ¯ä¸ªtaskçš„ä¼˜å…ˆçº§ä¸åŒ</span><br><span class="line">    + é¥¥é¥¿</span><br><span class="line">        + ç°è±¡</span><br><span class="line">            + çº¿ç¨‹æ•°é‡ä¸è¶³å¯¼è‡´é¥¥é¥¿ï¼ˆå›ºå®šå¤§å°çº¿ç¨‹æ± ï¼‰</span><br><span class="line">                + çº¿ç¨‹æ•°ä¸è¶³ï¼Œæ— æ³•å¤„ç†ä»»åŠ¡</span><br><span class="line">        + è§£å†³</span><br><span class="line">            + ä¸åŒä»»åŠ¡ç±»å‹ï¼Œåº”è¯¥ä½¿ç”¨ä¸åŒçº¿ç¨‹æ± </span><br><span class="line">    + æ± å¤§å°</span><br><span class="line">        + è¿‡å°ã€è¿‡å¤§éƒ½ä¸åˆé€‚</span><br><span class="line">        + è¿ç®—ç±»å‹</span><br><span class="line">            + IOå¯†é›†å‹å…¬å¼</span><br></pre></td></tr></table></figure><h1 id="ä»»åŠ¡è°ƒåº¦çº¿ç¨‹æ± "><a href="#ä»»åŠ¡è°ƒåº¦çº¿ç¨‹æ± " class="headerlink" title="ä»»åŠ¡è°ƒåº¦çº¿ç¨‹æ± "></a>ä»»åŠ¡è°ƒåº¦çº¿ç¨‹æ± </h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">+ timerçš„ç¼ºç‚¹</span><br><span class="line">    + timerï¼šä¸€ä¸ªçº¿ç¨‹è°ƒåº¦ï¼Œä¸²è¡Œæ‰§è¡Œ</span><br><span class="line">    + å‰é¢ä»»åŠ¡æ‰§è¡Œæ—¶é—´ä¼šå½±å“ã€ç»ˆæ­¢åé¢çš„ä»»åŠ¡</span><br><span class="line">+ ScheduledThreadPoolExecutor</span><br><span class="line">    + å»¶æ—¶æ‰§è¡Œ</span><br><span class="line">        + æ”¹å˜çº¿ç¨‹æ± å¤§å°</span><br><span class="line">        + å‡ºç°å¼‚å¸¸ï¼Œä¸å½±å“ä¸‹é¢çš„è¿è¡Œ</span><br><span class="line">    + å®šæ—¶æ‰§è¡Œ</span><br><span class="line">        + æŒ‰ç…§é—´éš”ä¸æ–­æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡</span><br><span class="line">            + ä¸€ä¸ªä»»åŠ¡å¼€å§‹ä¸ºèµ·ç‚¹çš„</span><br><span class="line">        + delay</span><br><span class="line">            + ç»“æŸæ—¶é—´ç®—</span><br><span class="line">        + è¿™äº›è¿˜æ˜¯å±äºæ¯”è¾ƒåŸºç¡€çš„</span><br><span class="line">+ æ­£ç¡®å¤„ç†çº¿ç¨‹æ± å¼‚å¸¸</span><br><span class="line">    + trycatch</span><br><span class="line">    + futureå¯¹è±¡ + callable</span><br><span class="line">        + get()</span><br><span class="line">+ çº¿ç¨‹æ± åº”ç”¨</span><br><span class="line">    + å®šæ—¶ä»»åŠ¡</span><br><span class="line">        + è®°å¾—Linuxæˆ–è€…springé‡Œæœ‰ä¸ªcronè¡¨è¾¾å¼ä¸“é—¨åšå®šæ—¶ä»»åŠ¡</span><br><span class="line">        + ç”¨quartzæˆ–springtask</span><br><span class="line">        + å¯ä»¥ç”¨Xxl-job</span><br><span class="line">        + ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´ + é—´éš”æ—¶é—´</span><br><span class="line">+ tomcatçº¿ç¨‹æ± </span><br><span class="line">    + çº¿ç¨‹æ± -åˆ†å·¥</span><br><span class="line">    + æ‹’ç»ç­–ç•¥ï¼šå°è¯•æ”¾å…¥é˜Ÿåˆ—åï¼ŒæŠ›å¼‚å¸¸</span><br><span class="line">    + é…ç½®</span><br><span class="line">        + æœ€å¤§çº¿ç¨‹ä¸å¤Ÿï¼Œå†æ”¾å…¥é˜Ÿåˆ—</span><br><span class="line">+ fork/joinçº¿ç¨‹æ± </span><br><span class="line">    + åˆ†æ²»ã€ä»»åŠ¡æ‹†åˆ†çº¿ç¨‹æ± </span><br><span class="line">    + ä½¿ç”¨</span><br><span class="line">        + ä»»åŠ¡å¯¹è±¡ï¼šrecursivetask</span><br><span class="line">        + æ‹†åˆ†ä»»åŠ¡ï¼šé€’å½’æ€æƒ³</span><br><span class="line">        + æµ‹è¯•</span><br><span class="line">            + è¿™ä¸ªæ–¹æ³•å¤„ç†æ–æ³¢é‚£å¥‘æ•°åˆ—éå¸¸æ…¢ï¼Œè¿˜æ˜¯éœ€è¦åŠ ä¸Šè®°å¿†åŒ–</span><br><span class="line">        + ä»»åŠ¡æ‹†åˆ†ä¼˜åŒ–</span><br><span class="line">            + ä¸ç”¨ä¸€ä¸ªä»»åŠ¡ä¾èµ–å¦ä¸€ä¸ªä»»åŠ¡</span><br><span class="line">            + å’ŒJavaé«˜å¹¶å‘ç¨‹åºè®¾è®¡é‡Œçš„ä¾‹å­ä¸€æ ·ï¼Œå¾ˆå¥½çš„åˆ†ç¦»ä»»åŠ¡ä¹‹é—´çš„è”ç³»</span><br><span class="line">            + åˆ†æ²»</span><br><span class="line">                + æ‹†åˆ†ä¸¤ä¸ªä»»åŠ¡ï¼Œåˆ†æ²»</span><br></pre></td></tr></table></figure><h1 id="AqsåŸç†"><a href="#AqsåŸç†" class="headerlink" title="AqsåŸç†"></a>AqsåŸç†</h1><p>JUCåŒ…åŸç†éƒ¨åˆ†</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220320142555302.png" alt="image-20220320142555302"></p><p>AQSåŒæ­¥å™¨</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220320142530222.png" alt="image-20220320142530222"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">+ AQSåŸç†</span><br><span class="line">    + æ¦‚è¿°</span><br><span class="line">        + é˜»å¡å¼é”å’ŒåŒæ­¥å·¥å…·çš„æ¡†æ¶</span><br><span class="line">            + state</span><br><span class="line">                + æ§åˆ¶è·å–é”é‡Šæ”¾é”</span><br><span class="line">            + ç­‰å¾…é˜Ÿåˆ—ï¼Œentrylist</span><br><span class="line">            + æ¡ä»¶å˜é‡ï¼Œwaitlist</span><br><span class="line">        + reentrantLockå°±æ˜¯ç”¨çš„aqs</span><br><span class="line">    + è‡ªå®šä¹‰é”ï¼ˆä¸å¯é‡å…¥é”ï¼‰</span><br><span class="line">        + åŒæ­¥å™¨ç±»-ç»§æ‰¿aqs</span><br><span class="line">            + tryacquire</span><br><span class="line">                + casä¿®æ”¹status</span><br><span class="line">                + è®¾ç½®ownerä¸ºå½“å‰çº¿ç¨‹</span><br><span class="line">            + tryrelease</span><br><span class="line">                + ownerä¸ºnull</span><br><span class="line">                + ç›´æ¥ä¿®æ”¹status</span><br><span class="line">                    + å‰é¢ä¸ºå†™å±éšœï¼Œä¿è¯nullè¢«å…¶ä»–çº¿ç¨‹å¯è§</span><br><span class="line">            + isHeldexclusively</span><br><span class="line">                + æ˜¯å¦æŒæœ‰ç‹¬å é”</span><br><span class="line">            + newcondition</span><br><span class="line">        + åŠ é”</span><br><span class="line">        + åŠ é”ã€å¯æ‰“æ–­åŠ é”</span><br><span class="line">            + å°è¯•åŠ é”ï¼Œå°è¯•åŠ é”å¸¦è¶…æ—¶</span><br><span class="line">        + è§£é”</span><br><span class="line">            + releaseå”¤é†’</span><br><span class="line">    + æµ‹è¯•</span><br><span class="line">        + ä¸å¯é‡å…¥</span><br></pre></td></tr></table></figure><h1 id="ReentrantLockåŸç†"><a href="#ReentrantLockåŸç†" class="headerlink" title="ReentrantLockåŸç†"></a>ReentrantLockåŸç†</h1><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220320143257653.png" alt="image-20220320143257653"></p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220320143313550.png" alt="image-20220320143313550"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">+ ReentrantLockåŸç†</span><br><span class="line">    + å®ç°lock</span><br><span class="line">    + å†…éƒ¨syncåŒæ­¥å™¨ï¼Œç»§æ‰¿aqsï¼Œå®ç°äº†éå…¬å¹³å’Œå…¬å¹³é”</span><br><span class="line">    + éå…¬å¹³é”å®ç°åŸç†ï¼ˆé»˜è®¤ï¼‰</span><br><span class="line">        + åŠ é”æˆåŠŸæµç¨‹â€”â€”lock()</span><br><span class="line">            + casä¿®æ”¹status</span><br><span class="line">            + ä¿®æ”¹ownerä¸ºå½“å‰çº¿ç¨‹</span><br><span class="line">            + casä¿®æ”¹å¤±è´¥</span><br><span class="line">                + JDK11 å·²ç»æ²¡æœ‰äº†ï¼Œç›´æ¥è°ƒç”¨çš„AQSæŠ½è±¡ç±»çš„acquire</span><br><span class="line">                + JDK11 å¯¹äºå¤±è´¥é‡‡ç”¨çš„æ˜¯çŸ­è·¯ä¸çš„æ–¹å¼</span><br><span class="line">                + tryacquireâ€”â€”casé‡è¯•</span><br><span class="line">                + é‡è¯•å¤±è´¥ï¼ŒacquirequeueåŠ å…¥é˜Ÿåˆ—</span><br><span class="line">                    + ç¬¬1ä¸ªçº¿ç¨‹ç›´æ¥æŠ¢å åŒæ­¥å™¨ï¼Œç¬¬2ä¸ªçº¿ç¨‹åˆå§‹åŒ–é˜Ÿåˆ—ï¼šäº§ç”Ÿå“‘å…ƒå’ŒNode1èŠ‚ç‚¹ï¼Œç¬¬ä¸‰ä¸ªçº¿ç¨‹äº§ç”ŸNode2èŠ‚ç‚¹å¹¶å°†å…¶æ’å…¥åˆ°å“‘å…ƒå’ŒNode1èŠ‚ç‚¹ä¹‹åã€‚å°±æ˜¯è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹</span><br><span class="line">                    + é˜Ÿåˆ—å¤§ä½“æ˜¯è¿™æ ·çš„ï¼šhead-&gt;å“‘å…ƒ-&gt;Node1(Thead-1)-&gt;Node2(Thread-2)-&gt;...-&gt;tail)</span><br><span class="line">                    + è·å–å‰é©±èŠ‚ç‚¹</span><br><span class="line">                        + è‹¥ä¸ºå¤´ç»“ç‚¹ï¼ˆå“¨å…µï¼‰</span><br><span class="line">                        + å†æ¬¡å°è¯•è·å–é”tryacquire</span><br><span class="line">                    + ä»ç„¶è·å–å¤±è´¥</span><br><span class="line">                        + æŠŠå‰é©±èŠ‚ç‚¹waitstatusæ”¹ä¸º-1ï¼ˆæœ‰è´£ä»»å”¤é†’åç»§èŠ‚ç‚¹ï¼‰</span><br><span class="line">                            + è¿”å›false</span><br><span class="line">                        + é‡æ–°è¿›å…¥acquirequeue</span><br><span class="line">                            + å†æ¬¡tryacquire</span><br><span class="line">                            + è¿™æ¬¡å‰é©±nodeä¸º-1</span><br><span class="line">                            + parké˜»å¡å½“å‰çº¿ç¨‹</span><br><span class="line">        + è§£é”ç«äº‰æˆåŠŸæµç¨‹</span><br><span class="line">            + tryrelease</span><br><span class="line">                + statusã€owner</span><br><span class="line">            + unpark</span><br><span class="line">                + æ‰¾åˆ°æœ€è¿‘æ²¡å–æ¶ˆçš„nodeï¼Œunpark</span><br><span class="line">                    + å”¤é†’åï¼Œé‡æ–°è¿›å…¥å¾ªç¯tryacquire</span><br><span class="line">                    + å˜æˆownerçº¿ç¨‹</span><br><span class="line">                        + å½“å‰nodeå˜ä¸ºå¤´ç»“ç‚¹ï¼Œå“¨å…µèŠ‚ç‚¹</span><br><span class="line">        + è§£é”ç«äº‰å¤±è´¥æµç¨‹</span><br><span class="line">            + ä¸åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ï¼Œè§£é”æ—¶æ¥ç«äº‰</span><br><span class="line">                + nodeå°è¯•è·å–é”å¤±è´¥</span><br><span class="line">                + é‡æ–°è¿›å…¥parké˜»å¡</span><br><span class="line">    + å¯é‡å…¥åŸç†ï¼ˆéå…¬å¹³é”ä¸ºä¾‹ï¼‰</span><br><span class="line">        + åŒä¸€çº¿ç¨‹å†æ¬¡è°ƒç”¨tryacquire</span><br><span class="line">            + åˆ¤æ–­çŠ¶æ€ä¸ºä¸Šé”</span><br><span class="line">            + å†æ¬¡åˆ¤æ–­owneræ˜¯å¦ä¸ºå½“å‰çº¿ç¨‹</span><br><span class="line">                + å‘ç”Ÿé”é‡å…¥</span><br><span class="line">                + status++è¡¨ç¤ºé‡å…¥ä¸¤æ¬¡</span><br><span class="line">        + é‡Šæ”¾é”tryrelease</span><br><span class="line">            + status--</span><br><span class="line">                + ä½†æ˜¯statusä¸ä¸º0ï¼Œè¿”å›false</span><br><span class="line">            + å†æ¬¡è°ƒç”¨tryreleaseæ—¶å°†statuså˜ä¸º0ï¼Œè®¾ownerä¸ºnull</span><br><span class="line">                + è¿”å›true</span><br><span class="line">    + å¯æ‰“æ–­åŸç†</span><br><span class="line">        + ä¸å¯æ‰“æ–­æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰</span><br><span class="line">            + å°±æ˜¯åœ¨è·å–åˆ°é”ä¹‹å‰ä¸èƒ½è¢«æ‰“æ–­</span><br><span class="line">            + ä¸å¯æ‰“æ–­å°±æ˜¯ä¼šç”¨interruptedæ ‡è®°è‡ªå·±è¢«æ‰“æ–­è¿‡ï¼Œä½†ä¸ä¼šç«‹å³å“åº”æ‰“æ–­ï¼Œç­‰è·å¾—é”ä¹‹åå†è‡ªå·±æ‰“æ–­è‡ªå·±</span><br><span class="line">        + å¯æ‰“æ–­æ¨¡å¼interruptibly</span><br><span class="line">            + parkæ—¶æ‰“æ–­ï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œåœæ­¢ç­‰å¾…é”</span><br><span class="line">    + å…¬å¹³é”åŸç†</span><br><span class="line">        + éå…¬å¹³é”</span><br><span class="line">            + æ²¡æœ‰é”æ—¶ï¼Œç›´æ¥å»casè·å–é”ï¼Œä¸ä¼šæ£€æµ‹ç­‰å¾…é˜Ÿåˆ—</span><br><span class="line">        + å…¬å¹³é”</span><br><span class="line">            + å…ˆå»æ£€æŸ¥aqsé˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰å‰é©±èŠ‚ç‚¹ï¼Œæ²¡æœ‰æ‰å»è·å–é”</span><br><span class="line">            + å¦‚æœé˜Ÿåˆ—ä¸­æ²¡æœ‰ç¬¬äºŒä¸ªèŠ‚ç‚¹ã€ç¬¬äºŒä¸ªèŠ‚ç‚¹ä¸æ˜¯æ­¤çº¿ç¨‹</span><br><span class="line">                + è¿”å›æ²¡èµ„æ ¼è·å–</span><br><span class="line">    + æ¡ä»¶å˜é‡å®ç°åŸç†</span><br><span class="line">        + æ¯ä¸ªæ¡ä»¶å˜é‡å¯¹åº”ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—</span><br><span class="line">        + await</span><br><span class="line">            + è¿›å…¥addconditionwaiteræµç¨‹</span><br><span class="line">                + æŠŠå½“å‰çº¿ç¨‹åŠ å…¥æ¡ä»¶å˜é‡çš„é“¾è¡¨</span><br><span class="line">                    + åˆ›å»ºæ–°çš„nodeçŠ¶æ€ä¸º-2ï¼ˆæ¯ä¸ªnodeéƒ½æœ‰çŠ¶æ€ï¼‰</span><br><span class="line">                    + åŠ å…¥é“¾è¡¨</span><br><span class="line">            + fullyreleaseæµç¨‹</span><br><span class="line">                + é‡Šæ”¾åŒæ­¥å™¨ä¸Šçš„æ‰€æœ‰é”</span><br><span class="line">                + ownerç©ºå‡ºã€ unparkååºèŠ‚ç‚¹</span><br><span class="line">            + parkå½“å‰çº¿ç¨‹ï¼Œç­‰å¾…è¢«å”¤é†’</span><br><span class="line">        + signal</span><br><span class="line">            + åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ä¸ºé”æŒæœ‰è€…</span><br><span class="line">                + éæŒæœ‰è€…æ— æ³•å”¤é†’æ¡ä»¶å˜é‡çº¿ç¨‹</span><br><span class="line">            + æ¡ä»¶é˜Ÿåˆ—ï¼Œæ‰¾åˆ°é˜Ÿé¦–å…ƒç´ </span><br><span class="line">                + æ–­å¼€node</span><br><span class="line">            + nodeè½¬ç§»åˆ°ç«äº‰é”çš„é˜Ÿåˆ—ä¸­</span><br><span class="line">                + è½¬ç§»æˆåŠŸï¼Œä¿®æ”¹nodeçŠ¶æ€</span><br><span class="line">                    + é˜»å¡é˜Ÿåˆ—é™¤äº†æœ€åä¸€ä¸ªnodeçŠ¶æ€ä¸º0ï¼Œå…¶ä»–éƒ½ä¸º-1</span><br><span class="line">                    + ç„¶åå¦‚æœæ˜¯CASè®¾ç½®waitStatuså‡ºé”™çš„è¯ï¼Œæºç ç¿»è¯‘å¥½åƒè¯´è¿™ä¸ªçŠ¶æ€é”™è¯¯æ˜¯çŸ­æš‚ä¸”æ— å®³çš„ï¼Œä½†æ˜¯ä¸ºäº†æ­£ç¡®ï¼Œå¯èƒ½è¿˜æ˜¯å¾—é‡æ–°è®©ä»–æŠ¢é”ï¼Œç„¶åé‡æ–°å…¥é˜Ÿï¼Œå†æ¬¡CASåˆ°çŠ¶æ€æ­£ç¡®å°±ç»“æŸ</span><br><span class="line">                    + å¦‚æœCASé”™è¯¯ï¼Œå¯èƒ½ä¹Ÿæœ‰ä¸€ç§æƒ…å†µå°±æ˜¯ä»–è¶…æ—¶æ­£åœ¨å–æ¶ˆï¼Œç„¶åè¿˜æ²¡æ”¹waitStatusï¼Œç­‰ä½ è°ƒç”¨CASä»–çš„watiStatuså·²ç»æ”¹æˆå–æ¶ˆäº†</span><br><span class="line">                + è½¬ç§»å¤±è´¥ï¼Œä½¿ç”¨æ¡ä»¶é˜Ÿåˆ—ä¸‹ä¸€ä¸ªnodeå”¤é†’</span><br></pre></td></tr></table></figure><h1 id="è¯»å†™é”"><a href="#è¯»å†™é”" class="headerlink" title="è¯»å†™é”"></a>è¯»å†™é”</h1><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220320143730503.png" alt="image-20220320143730503"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">+ ReentrantReadWriteLock</span><br><span class="line">    + ä½¿ç”¨</span><br><span class="line">        + è¯»è¯»å¹¶å‘ï¼Œè¯»å†™äº’æ–¥</span><br><span class="line">            + åªæ˜¯è¯»å°±å¯ä»¥è¯»ï¼Œè¯»çš„æ—¶å€™å†™äº†å°±é˜»å¡è¯»</span><br><span class="line">        + æµ‹è¯•</span><br><span class="line">            + åŒæ—¶è¯»å–ï¼Œä¸äº’æ–¥</span><br><span class="line">            + è¯»å†™ï¼Œé˜»å¡æ— æ³•å†™ï¼Œç­‰å¾…è¯»é”é‡Šæ”¾</span><br><span class="line">            + å†™å†™äº’æ–¥</span><br><span class="line">    + æ³¨æ„äº‹é¡¹</span><br><span class="line">        + è¯»é”ä¸æ”¯æŒæ¡ä»¶å˜é‡ï¼Œå†™é”æ”¯æŒ</span><br><span class="line">        + é‡å…¥çš„æ—¶å€™ï¼Œä¸èƒ½å‡çº§è·å–</span><br><span class="line">            + è¯»é”æ—¶ä¸èƒ½é‡å…¥è·å–å†™</span><br><span class="line">        + é‡å…¥æ—¶é™çº§æ”¯æŒ</span><br><span class="line">            + å†™é”æ—¶å¯ä»¥å†æ¬¡è·å–è¯»</span><br><span class="line">                + æœ‰ç¼“å­˜æ•°æ®ï¼Œç›´æ¥è¯»å–è¿”å›</span><br><span class="line">                + æ²¡æœ‰ç¼“å­˜</span><br><span class="line">                    + è·å–å†™é”ï¼ˆæå‰é‡Šæ”¾è¯»é”ï¼‰</span><br><span class="line">                    + å†æ¬¡åˆ¤æ–­ç¼“å­˜æ˜¯å¦å·²ç»æ›´æ–°</span><br><span class="line">                        + ç›´æ¥è¿”å›æ•°æ®</span><br><span class="line">                    + ç¼“å­˜ä»ä¸å­˜åœ¨</span><br><span class="line">                        + é‡æ–°è®¡ç®—æ•°æ®</span><br><span class="line">                    + è·å–è¯»é”ï¼Œé˜²æ­¢å†™çº¿ç¨‹å¹²æ‰°</span><br><span class="line">                    + é‡Šæ”¾å†™é”</span><br><span class="line">                + è¯»å–æ•°æ®</span><br><span class="line">        + åº”ç”¨ä¹‹ç¼“å­˜</span><br><span class="line">            + æ·»åŠ ç¼“å­˜</span><br><span class="line">                + ç¼“å­˜mapé›†åˆï¼škeyï¼šæ ‡å¿—ç¼“å­˜ï¼ˆsqlã€å‚æ•°ï¼‰</span><br><span class="line">                + æŸ¥è¯¢ï¼šå…ˆä»ç¼“å­˜ä¸­æ‰¾ï¼Œæ²¡æœ‰æŸ¥è¯¢åæ·»åŠ åˆ°ç¼“å­˜</span><br><span class="line"></span><br><span class="line">                    + æŸ¥è¯¢key</span><br><span class="line">                + æ›´æ–°ï¼šåˆ é™¤ç¼“å­˜ï¼Œæ›´æ–°</span><br><span class="line">            + é—®é¢˜åˆ†æ</span><br><span class="line">                + hashmapä¸å®‰å…¨</span><br><span class="line">                + é«˜å¹¶å‘æŸ¥è¯¢ä¸å®‰å…¨</span><br><span class="line">                + ç¼“å­˜æ›´æ–°ç­–ç•¥</span><br><span class="line">                    + å…ˆæ¸…ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“</span><br><span class="line">                        + æ¸…ç©ºåè¿˜æœªæ›´æ–°ï¼Œå…¶ä»–çº¿ç¨‹æŸ¥è¯¢æ—§æ•°æ®ï¼ŒåŒæ­¥åˆ°ç¼“å­˜ï¼ˆæ—§ï¼‰</span><br><span class="line">                    + å…ˆæ›´æ–°æ•°æ®åº“ âˆš</span><br><span class="line">                        + è¿˜æœªæ¸…ç©ºç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹æŸ¥è¯¢åˆ°æ—§æ•°æ®ï¼Œæ‰æ¸…ç©ºç¼“å­˜ï¼ˆçŸ­æš‚ä¸ä¸€è‡´ï¼‰</span><br><span class="line">                        + å¯ä»¥åŠ åŸå­æ“ä½œ</span><br><span class="line">            + å®ç°</span><br><span class="line">                + åˆ›å»ºè¯»å†™é”</span><br><span class="line">                    + updateï¼ˆæ›´æ–°ã€åˆ ç¼“å­˜ï¼‰æ·»åŠ å†™é”</span><br><span class="line">                        + ä¿è¯åŸå­æ€§</span><br><span class="line">                    + ç›´æ¥æŸ¥è¯¢ç¼“å­˜æ·»åŠ è¯»é”</span><br><span class="line">                    + æŸ¥åº“ï¼ˆæŸ¥è¯¢ã€æ”¾å…¥ç¼“å­˜ï¼‰æ·»åŠ å†™é”</span><br><span class="line">                        + å¯èƒ½å¤šä¸ªçº¿ç¨‹é˜»å¡åœ¨å†™é”</span><br><span class="line">                        + åŒé‡æ£€æŸ¥ï¼Œå†æ¬¡åˆ¤æ–­ç¼“å­˜å­˜åœ¨</span><br><span class="line">                        + ä¿è¯åŸå­æ€§</span><br><span class="line">                + ç¼“å­˜æ„ä¹‰æ˜¯ä¸ºäº†å‡å°‘è¿æ¥æ•°æ®åº“çš„æŸ¥è¯¢ç”¨çš„ï¼Œå¤šçº¿ç¨‹ä¸‹ç¼“å­˜çš„è®¿é—®éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œæ‰€ä»¥åŠ é”</span><br><span class="line">                + è¯»æœ¬æ¥å¯ä»¥ä¸åŠ é”ï¼Œä½†æ˜¯å†™æ“ä½œä¼šå¯¼è‡´è¯»é”™è¯¯ï¼Œæ‰€ä»¥åŠ äº†è¯»é”ï¼Œä¼šå¯¼è‡´å†™é”åŠ äº†ä¸èƒ½å†™ï¼Œè¿˜æœ‰å…¶ä»–åŸå› </span><br><span class="line">            + è¡¥å……</span><br><span class="line">                + é€‚åˆè¯»å¤šå†™å°‘</span><br><span class="line">                + é—®é¢˜</span><br><span class="line">                    + ç¼“å­˜å®¹é‡</span><br><span class="line">                    + ç¼“å­˜è¿‡æœŸ</span><br><span class="line">                    + å•æœº</span><br><span class="line">                    + å¹¶å‘ä½</span><br><span class="line">                        + é”ç»†åˆ†</span><br><span class="line">                        + é’ˆå¯¹ä¸åŒæ“ä½œåˆ†åŒºï¼Œä¸Šä¸åŒé”</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘</summary>
    
    
    
    <category term="å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘" scheme="https://fireonice.github.io/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91/"/>
    
    
    <category term="å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘" scheme="https://fireonice.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘â€”â€”å…±äº«æ¨¡å‹ä¹‹æ— é”ã€ä¸å¯å˜-CAS&amp;äº«å…ƒæ¨¡å¼</title>
    <link href="https://fireonice.github.io/2022/03/15/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91-%E5%85%B1%E4%BA%AB%E6%A8%A1%E5%9E%8B%E4%B9%8B%E6%97%A0%E9%94%81%E3%80%81%E4%B8%8D%E5%8F%AF%E5%8F%98/"/>
    <id>https://fireonice.github.io/2022/03/15/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91-%E5%85%B1%E4%BA%AB%E6%A8%A1%E5%9E%8B%E4%B9%8B%E6%97%A0%E9%94%81%E3%80%81%E4%B8%8D%E5%8F%AF%E5%8F%98/</id>
    <published>2022-03-15T14:22:11.065Z</published>
    <updated>2022-03-15T14:45:29.822Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å…±äº«æ¨¡å‹ä¹‹æ— é”"><a href="#å…±äº«æ¨¡å‹ä¹‹æ— é”" class="headerlink" title="å…±äº«æ¨¡å‹ä¹‹æ— é”"></a>å…±äº«æ¨¡å‹ä¹‹æ— é”</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+ é—®é¢˜æå‡º</span><br><span class="line">    + ä¿æŠ¤å…±äº«èµ„æº</span><br><span class="line">        + åŠ é”å®ç°</span><br><span class="line">            + synchronizeã€reentrantlock</span><br><span class="line">        + æ— é”å®ç°</span><br><span class="line">            + AtomicIntegerï¼šåŸå­æ•´æ•°</span><br><span class="line">                + intå°è£…</span><br><span class="line">            + compareAndSet(prev,next)</span><br><span class="line">                + ä¿®æ”¹æˆåŠŸä¸ºtrue</span><br></pre></td></tr></table></figure><h2 id="CASä¸volatile"><a href="#CASä¸volatile" class="headerlink" title="CASä¸volatile"></a>CASä¸volatile</h2><p>cas</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220315223914515.png" alt="image-20220315223914515"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">+ casä¸volatile</span><br><span class="line">    + å·¥ä½œæ–¹å¼</span><br><span class="line">        + casåŸå­</span><br><span class="line">        + CASå°±æ˜¯JAVAé‡Œå”¯ä¸€çš„ä¹è§‚é”äº†...</span><br><span class="line">        + ä¿è¯äº†CASåŸå­æ€§</span><br><span class="line">    + æ…¢åŠ¨ä½œåˆ†æ</span><br><span class="line">    + volatile</span><br><span class="line">        + ä¿è¯äº†å˜é‡çš„å¯è§æ€§</span><br><span class="line">            + ä¿è¯è·å–æ–°å€¼æ¯”è¾ƒ</span><br><span class="line">    + æ•ˆç‡åˆ†æ</span><br><span class="line">        + æ— é”å§‹ç»ˆè¿è¡Œï¼Œæœ‰é”ä¼šä¸Šä¸‹æ–‡åˆ‡æ¢</span><br><span class="line">            + runnableâ€”â€”&gt;blocked</span><br><span class="line">            + ä»£ä»·æ¯”è¾ƒå¤§</span><br><span class="line">        + æ— é”çº¿ç¨‹ä¿å­˜è¿è¡Œï¼Œéœ€è¦é¢å¤–cpuæ”¯æŒ</span><br><span class="line">            + æ²¡æœ‰åˆ†åˆ°æ—¶é—´ç‰‡ï¼Œå˜æˆå¯è¿è¡ŒçŠ¶æ€ï¼Œè¿˜æ˜¯ä¼šä¸Šä¸‹æ–‡é˜»å¡ </span><br><span class="line">        + å¤šæ ¸cpuæ— é”æ‰æœ‰ä¼˜åŠ¿</span><br><span class="line">    + ç‰¹ç‚¹</span><br><span class="line">        + çº¿ç¨‹å°‘ + å¤šæ ¸cpu</span><br><span class="line">        + ä½“ç°ä¹è§‚é”æ€æƒ³</span><br><span class="line">        + synchronizeä½“ç°æ‚²è§‚é”æ€æƒ³</span><br><span class="line">        + casä½“ç°æ— é”å¼€å‘ã€æ— é˜»å¡å¹¶å‘</span><br></pre></td></tr></table></figure><h2 id="åŸå­æ•´æ•°"><a href="#åŸå­æ•´æ•°" class="headerlink" title="åŸå­æ•´æ•°"></a>åŸå­æ•´æ•°</h2><p>J.U.C å¹¶å‘åŒ…æä¾›äº†ï¼š</p><ul><li><p>AtomicBoolean</p></li><li><p>AtomicInteger</p></li><li><p>AtomicLong</p></li></ul><p>ä»¥ AtomicInteger ä¸ºä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">+ åŸå­æ•´æ•°</span><br><span class="line">    + AtomicInteger åŸå­æ–¹æ³•</span><br><span class="line">        + compareAndSet </span><br><span class="line">            + é…åˆwhile(true)</span><br><span class="line">        + è‡ªå¢</span><br><span class="line">            + incrementAndGet()ï¼š++i</span><br><span class="line">            + getAndIncrementï¼ši++</span><br><span class="line">            + decrementAndGet ...</span><br><span class="line">        + åŠ æ³•</span><br><span class="line">            + getAndAdd() </span><br><span class="line">            + addAndGet()</span><br><span class="line">            + è¿™é‡Œæ²¡æœ‰å°†è¿™äº›æ–¹æ³•åº•å±‚ åº•å±‚è¿˜æ˜¯å¾ªç¯è·å–æœ€æ–°å€¼æ‰èƒ½è¿›è¡ŒåŠ æ³•</span><br><span class="line">        + updateAndGet è¡¨è¾¾å¼</span><br><span class="line">            + å‚æ•°ï¼šå‡½æ•°æ¥å£</span><br><span class="line">            + åŸç†</span><br><span class="line">                + ç”¨do&#123;&#125;while()å§ï¼Œæºç ä¹Ÿæ˜¯ç”¨çš„do&#123;&#125;while()</span><br><span class="line">                + é€šç”¨å°è£…</span><br><span class="line">                + å®˜æ–¹å®ç°</span><br></pre></td></tr></table></figure><h2 id="åŸå­å¼•ç”¨"><a href="#åŸå­å¼•ç”¨" class="headerlink" title="åŸå­å¼•ç”¨"></a>åŸå­å¼•ç”¨</h2><p>ä¸ºä»€ä¹ˆéœ€è¦åŸå­å¼•ç”¨ç±»å‹ï¼Ÿ</p><ul><li><p>AtomicReference</p></li><li><p>AtomicMarkableReference</p></li><li><p>AtomicStampedReference</p></li></ul><p>æœ‰å¦‚ä¸‹æ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">+ åŸå­å¼•ç”¨</span><br><span class="line">    + AtomicReference</span><br><span class="line">        + åŸºæœ¬ç±»å‹çš„èµ‹å€¼ä¹Ÿæ˜¯åŸå­æ“ä½œï¼Œä½†æ˜¯è¦ä¿è¯æˆå‘˜å˜é‡åœ¨çº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ï¼Œå¹¶ä¸”ä¸ä½¿ç”¨synchronizedè¿™ç§é‡é‡çº§çš„äº’æ–¥é”ï¼Œå°±éœ€è¦åˆ°atomicåŒ…ä¸‹é¢çš„æ— é”æ“ä½œ</span><br><span class="line">        + bigdecimal</span><br><span class="line">        + æœ¬æ¥å°±æ²¡å•¥å·®ï¼Œå°±æ˜¯å†…éƒ¨çš„valueæ˜¯å¼•ç”¨ç±»å‹äº†</span><br><span class="line">    + ABAé—®é¢˜</span><br><span class="line">        + é—®åˆ°CASå¿…é—®ABA</span><br><span class="line">        + æ— æ³•åˆ¤æ–­æ˜¯å¦è¢«åˆ«äººä¿®æ”¹è¿‡ï¼Œåªèƒ½åˆ¤æ–­å€¼ç›¸åŒ</span><br><span class="line">        + å…¶ä»–çº¿ç¨‹A-B-A ï¼Œå€¼ä»ä¸å˜ï¼Œä½†æ˜¯ä¿®æ”¹è¿‡äº†</span><br><span class="line">    + AtomicStampedReference</span><br><span class="line">        + æ¯”è¾ƒå€¼ + ç‰ˆæœ¬å·</span><br><span class="line">        + ç»´æŠ¤ç‰ˆæœ¬å·</span><br><span class="line">    + AtomicMarkableReference</span><br><span class="line">        + åªå…³å¿ƒæ˜¯å¦è¢«æ›´æ”¹è¿‡</span><br><span class="line">            + booleanè®°å½•</span><br><span class="line">        + ä½¿ç”¨AtomicStampedReferenceä¹Ÿå¯ä»¥å®ç°ç›¸åŒçš„æ•ˆæœ</span><br><span class="line">        + è¿™å…¶å®è¿˜æ˜¯ä¸ºäº†è§£å†³ABAé—®é¢˜ï¼Œå°±æ˜¯æ‰“äº†ä¸€ä¸ªæ ‡è®°ã€‚</span><br></pre></td></tr></table></figure><h2 id="åŸå­æ•°ç»„"><a href="#åŸå­æ•°ç»„" class="headerlink" title="åŸå­æ•°ç»„"></a>åŸå­æ•°ç»„</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+ åŸå­æ•°ç»„</span><br><span class="line">    + ä¸æƒ³æ”¹å˜å¼•ç”¨æœ¬èº«ï¼Œä¿®æ”¹é‡Œé¢çš„å…ƒç´ ï¼Œå¦‚æ•°ç»„</span><br><span class="line">    + è¿™é‡Œéœ€è¦è¯´ä¸€ä¸‹ï¼ŒcompareAndSet()çš„æ¯”è¾ƒæ˜¯é€šè¿‡å¼•ç”¨åœ°å€æ¯”è¾ƒçš„ï¼Œä¹‹å‰æ˜¯å¯¹Stringä¸¾ä¾‹ï¼ŒStringçš„ä¸å¯å˜æ€§å¯¼è‡´äº†æˆ‘ä»¬æ¯æ¬¡å¯¹Stringçš„æ›´æ”¹ä¹Ÿå¯¼è‡´äº†å¼•ç”¨çš„æ›´æ”¹</span><br><span class="line">    + æµ‹è¯•</span><br><span class="line">        + çº¿ç¨‹ä¸å®‰å…¨</span><br><span class="line">    + æ”¹ä¸ºåŸå­æ•°ç»„AtomicIntegerArray</span><br><span class="line">        + çº¿ç¨‹å®‰å…¨</span><br></pre></td></tr></table></figure><h2 id="åŸå­æ›´æ–°å™¨"><a href="#åŸå­æ›´æ–°å™¨" class="headerlink" title="åŸå­æ›´æ–°å™¨"></a>åŸå­æ›´æ–°å™¨</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+ åŸå­æ›´æ–°å™¨</span><br><span class="line">    + é’ˆå¯¹å¯¹è±¡æŸä¸ªå­—æ®µè¿›è¡ŒåŸå­æ“ä½œ</span><br><span class="line">        + å¿…é¡»volatile</span><br><span class="line">        + integerã€longã€referenceç­‰</span><br></pre></td></tr></table></figure><h2 id="åŸå­ç´¯åŠ å™¨"><a href="#åŸå­ç´¯åŠ å™¨" class="headerlink" title="åŸå­ç´¯åŠ å™¨"></a>åŸå­ç´¯åŠ å™¨</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+ åŸå­ç´¯åŠ å™¨</span><br><span class="line">    + æ€§èƒ½æ¯”åŸå­æ•´æ•°å¥½</span><br><span class="line">    + åŸå­æ•´æ•°æµ‹è¯•</span><br><span class="line">        + 200wæ¬¡ç´¯åŠ  57</span><br><span class="line">    + åŸå­ç´¯åŠ å™¨æµ‹è¯•</span><br><span class="line">        + 200wæ¬¡ç´¯åŠ  24</span><br><span class="line">    + åŸç†</span><br><span class="line">        + è®¾ç½®å¤šä¸ªç´¯åŠ å•å…ƒcellï¼ˆä¸ä¼šè¶…è¿‡cpuæ ¸å¿ƒï¼‰</span><br><span class="line">        + æœ€åå°†ç»“æœæ±‡æ€»</span><br><span class="line">        + æ“ä½œä¸åŒç´¯åŠ å•å…ƒcellï¼Œcasé‡è¯•æ¬¡æ•°å‡å°‘æ•°</span><br></pre></td></tr></table></figure><h2 id="LongAdderåŸç†"><a href="#LongAdderåŸç†" class="headerlink" title="LongAdderåŸç†"></a>LongAdderåŸç†</h2><p>@sun.misc.Contended</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220315224104497.png" alt="image-20220315224104497"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">+ LongAdderï¼ˆåŸå­ç´¯åŠ å™¨ï¼‰åŸç†</span><br><span class="line">    + casé”</span><br><span class="line">        + cellsbusy</span><br><span class="line">            + casåŠ é”ï¼Œé˜²æ­¢æ‰©å®¹æ—¶ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰©å®¹</span><br><span class="line">        + çŠ¶æ€æ ‡è®°ï¼Œç”¨casæ¥ä¿è¯åŸå­æ›´æ”¹çŠ¶æ€</span><br><span class="line">        + åªæœ‰æ›´æ”¹çŠ¶æ€æˆåŠŸâ€”â€”è·å¾—é”</span><br><span class="line">            + å°±æ˜¯ReentransLock ä½¿ç”¨ AQS åŠ é”è¿‡ç¨‹</span><br><span class="line">            + è¿™ä¸ªå°±æ˜¯åŸºæœ¬çš„æ“ä½œç³»ç»Ÿå®ç°é”çš„æ–¹å¼å•Šã€‚ã€‚ã€‚</span><br><span class="line">    + ç¼“å­˜è¡Œä¼ªå…±äº«</span><br><span class="line">        + cellç±»</span><br><span class="line">            + contendedï¼Œé˜²æ­¢ç¼“å­˜è¡Œä¼ªå…±äº« </span><br><span class="line">        + cpuå†…å­˜ç»“æ„</span><br><span class="line">            + ç¼“å­˜ä»¥ç¼“å­˜è¡Œä¸ºå•ä½</span><br><span class="line">            + ç¼“å­˜åŠ å…¥é€ æˆæ•°æ®å‰¯æœ¬äº§ç”Ÿ</span><br><span class="line">            + ä¿è¯æ•°æ®ä¸€è‡´æ€§</span><br><span class="line">                + ä¸€ä¸ªæ ¸å¿ƒå¯¹ç¼“å­˜æ•°æ®æ›´æ”¹ï¼Œå¦ä¸€ä¸ªæ ¸å¿ƒç¼“å­˜è¦å¤±æ•ˆ</span><br><span class="line">            + ä¸¤ä¸ªcellå¯ä»¥æ”¾è¿›ä¸€ä¸ªç¼“å­˜è¡Œ</span><br><span class="line">                + å¯¹cellè¿›è¡Œä¿®æ”¹ï¼Œå¯¼è‡´å…¶ä»–æ ¸å¿ƒçš„ç¼“å­˜è¡Œå¤±æ•ˆ</span><br><span class="line">            + è§£å†³</span><br><span class="line">                + è®©cellå­˜åœ¨äºä¸åŒç¼“å­˜è¡Œ</span><br><span class="line">                + @sun.misc.Contended</span><br><span class="line">                    + å­—æ®µå‰åå„åŠ 128å­—èŠ‚å¤§å°çš„ç©ºéš™</span><br><span class="line">                    + ä¿è¯å°†å¯¹è±¡è¯»åˆ°ç¼“å­˜ï¼Œå ç”¨ä¸åŒç¼“å­˜è¡Œ</span><br><span class="line">                    + ä¸ä¼šé€ æˆå…¶ä»–æ ¸å¿ƒç¼“å­˜è¡Œå¤±æ•ˆ</span><br><span class="line">    + add</span><br><span class="line">        + æºç æœ€é‡è¦</span><br><span class="line">    + LongAccumulate</span><br><span class="line">        + cellsæœªåˆ›å»º</span><br><span class="line">        + cellæœªåˆ›å»º</span><br><span class="line">        + é€»è¾‘æ€§å¤ªå¼ºäº†</span><br><span class="line">        + cellå·²åˆ›å»º</span><br><span class="line">            + é‡è¦çš„æ˜¯è¦èƒ½ä¸²èµ·æ¥</span><br><span class="line">        + sum</span><br><span class="line">            + ç´¯åŠ å•å…ƒæ±‚å’Œ</span><br></pre></td></tr></table></figure><h2 id="Unsafeå¯¹è±¡"><a href="#Unsafeå¯¹è±¡" class="headerlink" title="Unsafeå¯¹è±¡"></a>Unsafeå¯¹è±¡</h2><p>Unsafe å¯¹è±¡æä¾›äº†éå¸¸åº•å±‚çš„ï¼Œæ“ä½œå†…å­˜ã€çº¿ç¨‹çš„æ–¹æ³•ï¼ŒUnsafe å¯¹è±¡ä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œåªèƒ½é€šè¿‡åå°„è·å¾—ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">+ unsafeå¯¹è±¡</span><br><span class="line">    + è·å–</span><br><span class="line">        + casã€parkç­‰éƒ½æ˜¯è°ƒç”¨unsafeä¸­æ–¹æ³•</span><br><span class="line">        + åå°„è·å–å¯¹è±¡</span><br><span class="line">    + casç›¸å…³æ–¹æ³•</span><br><span class="line">        + casæ“ä½œï¼Œä¿®æ”¹åŸŸå€¼</span><br><span class="line">        + æœ‰ç«äº‰ï¼Œéœ€è¦whileé‡è¯•</span><br><span class="line">    + æ¨¡æ‹Ÿå®ç°åŸå­æ•´æ•°</span><br><span class="line">        + AtomicIntegeræ¨¡æ‹Ÿå®ç°</span><br><span class="line">            + åå°„è·å–unsafeå¯¹è±¡</span><br><span class="line">            + intæˆå‘˜å˜é‡ï¼Œvolatile</span><br><span class="line">                + è·å–intåç§»é‡ï¼Œä¿æŠ¤åŸŸå˜é‡</span><br><span class="line">            + get</span><br><span class="line">            + decrement</span><br><span class="line">                + å¾ªç¯</span><br><span class="line">                + casèµ‹å€¼</span><br></pre></td></tr></table></figure><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+ casã€volatile</span><br><span class="line">    + æ— é”å¹¶å‘</span><br><span class="line">+ api</span><br><span class="line">    + åŸå­æ•´æ•°</span><br><span class="line">    + åŸå­å¼•ç”¨</span><br><span class="line">    + åŸå­æ•°ç»„</span><br><span class="line">    + å­—æ®µæ›´æ–°å™¨</span><br><span class="line">    + åŸå­ç´¯åŠ å™¨</span><br><span class="line">+ unsafe</span><br><span class="line">+ åŸç†</span><br><span class="line">    + LongAdder</span><br><span class="line">    + ä¼ªå…±äº« </span><br></pre></td></tr></table></figure><h1 id="å…±äº«æ¨¡å‹ä¹‹ä¸å¯å˜"><a href="#å…±äº«æ¨¡å‹ä¹‹ä¸å¯å˜" class="headerlink" title="å…±äº«æ¨¡å‹ä¹‹ä¸å¯å˜"></a>å…±äº«æ¨¡å‹ä¹‹ä¸å¯å˜</h1><h2 id="ä¸å¯å˜å¯¹è±¡"><a href="#ä¸å¯å˜å¯¹è±¡" class="headerlink" title="ä¸å¯å˜å¯¹è±¡"></a>ä¸å¯å˜å¯¹è±¡</h2><p>string</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220315224233141.png" alt="image-20220315224233141"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ ä¸å¯å˜å¯¹è±¡</span><br><span class="line">    + ä½¿ç”¨</span><br><span class="line">        + ä¸å¯å˜ æ—¥æœŸæ—¶é—´ç±»</span><br><span class="line">    + è®¾è®¡</span><br><span class="line">        + stringç±»</span><br><span class="line">            + finalä¿®é¥°ï¼Œä¸å¯ä¿®æ”¹</span><br><span class="line">            + ä¿æŠ¤æ€§æ‹·è´</span><br><span class="line">                + é€šè¿‡åˆ›å»ºå‰¯æœ¬å¯¹è±¡ï¼Œé¿å…å…±äº«ï¼Œçº¿ç¨‹å®‰å…¨</span><br></pre></td></tr></table></figure><h2 id="äº«å…ƒæ¨¡å¼"><a href="#äº«å…ƒæ¨¡å¼" class="headerlink" title="äº«å…ƒæ¨¡å¼"></a>äº«å…ƒæ¨¡å¼</h2><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220315224255945.png" alt="image-20220315224255945"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">+ äº«å…ƒæ¨¡å¼</span><br><span class="line">    + å®šä¹‰å’Œå®ç°</span><br><span class="line">        + å¯¹ç›¸åŒå–å€¼çš„å¯¹è±¡è¿›è¡Œå…±äº«ï¼Œå‡å°‘å†…å­˜ä½¿ç”¨</span><br><span class="line">        + ä½“ç°</span><br><span class="line">            + äº‹å…ˆåˆ›å»ºå¥½256ä¸ªlongå¯¹è±¡åˆ°ç¼“å­˜æ•°ç»„</span><br><span class="line">                + ä¸è¶…è¿‡èŒƒå›´å°±é‡ç”¨ï¼Œä»æ•°ç»„ä¸­è·å–ï¼Œé¿å…å¯¹è±¡é‡å¤åˆ›å»º</span><br><span class="line">            + byteã€shortã€longã€integerï¼ˆä¸Šé™å¯å˜ï¼‰ï¼š-128-127</span><br><span class="line">            + charï¼š0-127ã€booleanï¼štrue false</span><br><span class="line">            + stringã€bigdecimal</span><br><span class="line">    + ä¸å¯å˜çº¿ç¨‹å®‰å…¨è¾¨æ</span><br><span class="line">        + å°±æ˜¯å› ä¸ºæ˜¯ä¸å¯å˜ç±»æ‰å¯ä»¥ç”¨äº«å…ƒæ¨¡å¼ï¼Œä¸ç„¶ä¸€ä¸ªå¯å˜çš„å¯¹è±¡ä½ å’‹èƒ½å¤šä¸ªçº¿ç¨‹å’Œå˜é‡å…±äº«è€Œç¡®å®šå…¶å€¼ä½ æ˜¯ä½ éœ€è¦çš„ï¼Ÿ</span><br><span class="line">        + å•ä¸ªæ–¹æ³•çº¿ç¨‹å®‰å…¨ï¼Œä½†ç»„åˆä¸ä¸€å®šæ˜¯å®‰å…¨çš„ï¼Œå‰é¢å°±è®²è¿‡ï¼Œè¯´ç‰µå¼ºçš„å¥½å¥½å¬è¯¾</span><br><span class="line">    + è‡ªå®šä¹‰è¿æ¥æ± </span><br><span class="line">        + åˆ†æ</span><br><span class="line">            + è¿æ¥æ± ï¼Œé‡ç”¨</span><br><span class="line">            + å¼€å‘å·¥ç¨‹å¸ˆï¼Ÿæ¬ç –ç å†œï¼Ÿ</span><br><span class="line">        + å®ç°</span><br><span class="line">            + å±æ€§ã€æ„é€ </span><br><span class="line">                + final sizeã€æ•°ç»„ã€æ•°ç»„çŠ¶æ€ï¼ˆåŸå­ï¼‰</span><br><span class="line">                + Integeråªæ˜¯è°ƒç”¨å•ä¸ªæ–¹æ³•çº¿ç¨‹å®‰å…¨,ä¿®æ”¹å€¼ä¹‹å‰éœ€è¦æŸ¥çœ‹çŠ¶æ€æ˜¯å¦ä¸º0ç„¶åç½®ä¸º1,è¿™ä¸ªæ—¶å€™å°±æœ‰å¯èƒ½æœ‰çº¿ç¨‹é—®é¢˜</span><br><span class="line">            + æ–¹æ³•</span><br><span class="line">                + è·å–è¿æ¥</span><br><span class="line">                    + ä¹è§‚é”ï¼Œcasè·å–ç©ºé—²è¿æ¥</span><br><span class="line">                    + æ— ç©ºé—²è¿æ¥ï¼ŒåŠ é”ï¼Œè¿›å…¥waitç­‰å¾…</span><br><span class="line">                + å½’è¿˜è¿æ¥</span><br><span class="line">                    + ç›´æ¥ä¿®æ”¹çŠ¶æ€ï¼ˆå•çº¿ç¨‹ï¼‰</span><br><span class="line">                    + é€šçŸ¥å…¶ä»–çº¿ç¨‹ï¼Œnotifyall</span><br><span class="line">        + æµ‹è¯•</span><br><span class="line">        + æ€»ç»“</span><br><span class="line">            + è·å–ä¸åˆ°è¿æ¥ï¼Œwait</span><br><span class="line">                + é˜²æ­¢cpuç©ºè½¬è·å–</span><br><span class="line">                + éçŸ­æ—¶é—´</span><br><span class="line">            + ä¼˜åŒ–</span><br><span class="line">                + è¿æ¥æ‰©ç¼©å®¹</span><br><span class="line">                + è¿æ¥å¯ç”¨æ€§æ£€æµ‹</span><br><span class="line">                + è¶…æ—¶å¤„ç†</span><br><span class="line">                + åˆ†å¸ƒå¼hash</span><br></pre></td></tr></table></figure><h2 id="finalåŸç†"><a href="#finalåŸç†" class="headerlink" title="finalåŸç†"></a>finalåŸç†</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+ finalåŸç†</span><br><span class="line">    + è®¾ç½®finalå˜é‡çš„åŸç†</span><br><span class="line">        + èµ‹å€¼finalå˜é‡ä¹‹åï¼ŒåŠ å…¥å†™å±éšœ</span><br><span class="line">            + å‰é¢æŒ‡ä»¤ä¸ä¼šé‡æ’åºåˆ°åé¢</span><br><span class="line">            + å‰é¢å˜é‡æ“ä½œåŒæ­¥åˆ°ä¸»å­˜ï¼Œå¯è§æ€§</span><br><span class="line">    + è·å–finalå˜é‡çš„åŸç†</span><br><span class="line">        + ä¸åŠ finalå…±äº«å †ç©ºé—´ï¼Œä»å †ä¸­è·å–</span><br><span class="line">        + åŠ äº†å¤åˆ¶åˆ°æ ˆå†…å­˜ï¼Œæˆ–è€…ä½¿ç”¨å¸¸é‡æ± ä¸­çš„ï¼Œç”¨çš„æ˜¯å¤åˆ¶çš„</span><br><span class="line">            + åŠ å¿«è®¿é—®é€Ÿåº¦</span><br></pre></td></tr></table></figure><h2 id="æ— çŠ¶æ€"><a href="#æ— çŠ¶æ€" class="headerlink" title="æ— çŠ¶æ€"></a>æ— çŠ¶æ€</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">+ ä¸å¯å˜ï¼šæœ‰æˆå‘˜ï¼Œä¸å¯ä»¥æ”¹å˜</span><br><span class="line">+ æ— çŠ¶æ€ï¼šæ²¡æœ‰æˆå‘˜å˜é‡ï¼ˆçŠ¶æ€ä¿¡æ¯ï¼‰ï¼Œæ²¡æœ‰çŠ¶æ€ï¼Œæ›´æ˜¯çº¿ç¨‹å®‰å…¨çš„</span><br></pre></td></tr></table></figure><h2 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ ä¸å¯å˜ç±»ä½¿ç”¨</span><br><span class="line">+ ä¸å¯å˜ç±»è®¾è®¡</span><br><span class="line">    + ä¿æŠ¤æ€§æ‹·è´</span><br><span class="line">+ åŸç†</span><br><span class="line">    + final</span><br><span class="line">+ æ¨¡å¼</span><br><span class="line">    + äº«å…ƒæ¨¡å¼</span><br><span class="line">        + é‡ç”¨å¯¹è±¡ï¼Œå‡å°‘å¯¹å†…å­˜çš„ä½¿ç”¨</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘</summary>
    
    
    
    <category term="å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘" scheme="https://fireonice.github.io/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91/"/>
    
    
    <category term="å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘" scheme="https://fireonice.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘â€”â€”å…±äº«æ¨¡å‹ä¹‹å†…å­˜-JMM&amp;Volatile&amp;DCL</title>
    <link href="https://fireonice.github.io/2022/03/15/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91-%E5%85%B1%E4%BA%AB%E6%A8%A1%E5%9E%8B%E4%B9%8B%E5%86%85%E5%AD%98-JMM&amp;%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92&amp;Volatile&amp;DCL/"/>
    <id>https://fireonice.github.io/2022/03/15/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91-%E5%85%B1%E4%BA%AB%E6%A8%A1%E5%9E%8B%E4%B9%8B%E5%86%85%E5%AD%98-JMM&amp;%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92&amp;Volatile&amp;DCL/</id>
    <published>2022-03-15T04:48:12.927Z</published>
    <updated>2022-03-15T14:45:06.865Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å…±äº«æ¨¡å‹ä¹‹å†…å­˜"><a href="#å…±äº«æ¨¡å‹ä¹‹å†…å­˜" class="headerlink" title="å…±äº«æ¨¡å‹ä¹‹å†…å­˜"></a>å…±äº«æ¨¡å‹ä¹‹å†…å­˜</h1><h2 id="Javaå†…å­˜æ¨¡å‹-JMM"><a href="#Javaå†…å­˜æ¨¡å‹-JMM" class="headerlink" title="Javaå†…å­˜æ¨¡å‹-JMM"></a>Javaå†…å­˜æ¨¡å‹-JMM</h2><p>JMM å³ Java Memory Modelï¼Œå®ƒå®šä¹‰äº†ä¸»å­˜ã€å·¥ä½œå†…å­˜æŠ½è±¡æ¦‚å¿µï¼Œåº•å±‚å¯¹åº”ç€ CPU å¯„å­˜å™¨ã€ç¼“å­˜ã€ç¡¬ä»¶å†…å­˜ã€CPU æŒ‡ä»¤ä¼˜åŒ–ç­‰ã€‚</p><p>JMM ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢</p><ul><li>åŸå­æ€§ - ä¿è¯æŒ‡ä»¤ä¸ä¼šå—åˆ°çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å½±å“</li><li>å¯è§æ€§ - ä¿è¯æŒ‡ä»¤ä¸ä¼šå— cpu ç¼“å­˜çš„å½±å“</li><li>æœ‰åºæ€§ - ä¿è¯æŒ‡ä»¤ä¸ä¼šå— cpu æŒ‡ä»¤å¹¶è¡Œä¼˜åŒ–çš„å½±å“</li></ul><h2 id="å¯è§æ€§"><a href="#å¯è§æ€§" class="headerlink" title="å¯è§æ€§"></a>å¯è§æ€§</h2><ul><li><p>å¯è§æ€§</p></li><li><p>ä¸€ä¸ªçº¿ç¨‹å¯¹ä¸»å­˜æ•°æ®ä¿®æ”¹ï¼Œå¯¹äºå¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¸å¯è§</p></li><li><p>é—®é¢˜</p><ul><li>åˆå§‹çŠ¶æ€ï¼Œtçº¿ç¨‹ä»ä¸»å­˜è¯»å–runåˆ°å·¥ä½œå†…å­˜</li><li>å› ä¸ºtè¦é¢‘ç¹ä»ä¸»å†…å­˜è¯»å–run<ul><li>JITç¼–è¯‘å™¨å°†runçš„å€¼å­˜å‚¨åœ¨å·¥ä½œå†…å­˜ä¸­ï¼Œå‡å°‘å¯¹ä¸»å­˜runçš„è®¿é—®<ul><li>CPUé«˜é€Ÿç¼“å­˜</li></ul></li></ul></li><li>ä¸»çº¿ç¨‹ä¿®æ”¹runçš„å€¼ï¼ŒåŒæ­¥åˆ°ä¸»å­˜<ul><li>tä¸€ç›´ä»é«˜é€Ÿç¼“å­˜ä¸­è¯»</li></ul></li></ul></li><li><p>è§£å†³</p><ul><li><p>åŠ ä¸Švolatileä¿®é¥°ï¼šæ˜“å˜</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220315130021025.png" alt="image-20220315130021025"></p><ul><li>åªèƒ½ä¿®é¥°æˆå‘˜ã€é™æ€æˆå‘˜å˜é‡<ul><li>å¿…é¡»ä»ä¸»å­˜è·å–å€¼</li></ul></li></ul></li><li><p>åŠ ä¸Šsynchronizeè§£å†³</p><ul><li>åœ¨Javaå†…å­˜æ¨¡å‹ä¸­ï¼Œsynchronizedè§„å®šï¼Œçº¿ç¨‹åœ¨åŠ é”æ—¶ï¼Œ å…ˆæ¸…ç©ºå·¥ä½œå†…å­˜â†’åœ¨ä¸»å†…å­˜ä¸­æ‹·è´æœ€æ–°å˜é‡çš„å‰¯æœ¬åˆ°å·¥ä½œå†…å­˜ â†’æ‰§è¡Œå®Œä»£ç â†’å°†æ›´æ”¹åçš„å…±äº«å˜é‡çš„å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­â†’é‡Šæ”¾äº’æ–¥é”ã€‚</li></ul></li></ul></li><li><p>å¯è§æ€§vsåŸå­æ€§</p><ul><li><p>ä¸èƒ½é˜²æ­¢æŒ‡ä»¤äº¤é”™ï¼Œåªèƒ½ä¿è¯è¯»åˆ°æœ€æ–°çš„å€¼</p></li><li><p>synchronizeä¿è¯åŸå­æ€§ã€å¯è§æ€§ï¼Œé‡é‡çº§</p></li><li><p>volatileä¿è¯å¯è§æ€§ï¼Œé€‚åˆä¸€ä¸ªå†™ä¸€ä¸ªè¯»</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220315130104860.png" alt="image-20220315130104860"></p><ul><li>printé‡Œé¢æœ‰synchronizedä¿®é¥°</li></ul></li></ul></li></ul><h2 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h2><ul><li><p>ç»ˆæ­¢æ¨¡å¼ä¹‹ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼</p><ul><li><p>åŸæ¥ç”¨æ‰“æ–­æ ‡è®°</p><ul><li>æ­£å¸¸æ‰§è¡Œè¢«æ‰“æ–­<ul><li>è®¾ç½®æ‰“æ–­æ ‡è®°ä¸ºçœŸ<ul><li>ä¸ä¼šè¿›å…¥catchï¼Œç»§ç»­è¿è¡Œ</li></ul></li></ul></li><li>sleepè¢«æ‰“æ–­<ul><li>è¿›å…¥catchï¼Œä¼šæ¸…é™¤æ‰“æ–­æ ‡è®°<ul><li>é‡æ–°è®¾ç½®æ‰“æ–­æ ‡è®°ä¸ºçœŸ</li></ul></li></ul></li></ul></li><li><p>ç”¨volatileæ”¹è¿›ï¼Œbooleanæ˜¯å¦è¿è¡Œ</p><ul><li><p>vo çš„ä½¿ç”¨ åœºæ™¯ å°±æ˜¯ boolean å˜é‡ å¯è§æ€§</p></li><li><p>ä¸å¸Œæœ›sleepï¼Œç›´æ¥interrupt</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220315130122284.png" alt="image-20220315130122284"></p><ul><li>ä¸éœ€è¦é‡è®¾æ‰“æ–­ç­‰</li></ul></li></ul></li></ul></li><li><p>åŒæ­¥ä¹‹Balkingï¼ˆçŠ¹è±«æ¨¡å¼ï¼‰</p><ul><li><p>ä¿è¯æŸä¸ªçº¿ç¨‹åŒæ—¶åªèƒ½startä¸€æ¬¡ï¼Œç›‘æ§çº¿ç¨‹</p></li><li><p>æ ‡è®°ï¼šbooleanå˜é‡ï¼Œä¸€æ‰§è¡Œæ”¹ä¸ºtrue</p></li><li><p>åŸå­æ€§ã€å¯è§æ€§é—®é¢˜</p><ul><li><p>ç”¨synchronizeåŠ é”ï¼Œå­˜åœ¨è¯»å†™æ“ä½œ</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220315130128605.png" alt="image-20220315130128605"></p></li></ul></li><li><p>åº”ç”¨</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220315130134816.png" alt="image-20220315130134816"></p><ul><li>å®ç°çº¿ç¨‹å®‰å…¨çš„å•ä¾‹</li></ul></li></ul></li></ul><h2 id="æœ‰åºæ€§"><a href="#æœ‰åºæ€§" class="headerlink" title="æœ‰åºæ€§"></a>æœ‰åºæ€§</h2><ul><li><p>æœ‰åºæ€§</p><ul><li><p>æŒ‡ä»¤é‡æ’</p></li><li><p>æŒ‡ä»¤é‡æ’åŸç†</p><ul><li><p>æŒ‡ä»¤å¹¶è¡Œä¼˜åŒ–</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220315130152912.png" alt="image-20220315130152912"></p><ul><li><p>åŒæ—¶æ‰§è¡Œä¸åŒæŒ‡ä»¤</p></li><li><p>å‰æï¼Œä¸å½±å“ç»“æœ</p></li></ul></li></ul></li><li><p>é—®é¢˜</p><ul><li>numåæ‰§è¡Œ</li></ul></li><li><p>éªŒè¯</p><ul><li><p>å‹æµ‹éªŒè¯</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220315130215855.png" alt="image-20220315130215855"></p></li><li><p>åƒä¸‡æ¬¡æµ‹è¯•ï¼Œå­˜åœ¨æŒ‡ä»¤é‡æ’åº</p></li></ul></li><li><p>ç¦ç”¨</p><ul><li>readyåŠ ä¸Švolatileï¼Œç¦æ­¢é‡æ’åº<ul><li>é˜²æ­¢readyä¹‹å‰çš„ä»£ç é‡æ’åº<ul><li>å†™å±éšœ</li></ul></li></ul></li><li>volatileä¿è¯å¯è§æ€§ã€æœ‰åºæ€§</li></ul></li></ul></li></ul><h2 id="VolatileåŸç†"><a href="#VolatileåŸç†" class="headerlink" title="VolatileåŸç†"></a>VolatileåŸç†</h2><ul><li><p>volatileåŸç†</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220315130225821.png" alt="image-20220315130225821"></p><ul><li><p>å†…å­˜å±éšœ</p><ul><li>å˜é‡å†™æŒ‡ä»¤ï¼ŒååŠ å…¥å†™å±éšœ</li><li>å˜é‡è¯»æŒ‡ä»¤ï¼Œå‰åŠ å…¥è¯»å±éšœ</li></ul></li><li><p>ä¿è¯å¯è§æ€§</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220315130549217.png" alt="image-20220315130549217"></p><ul><li>å†™æ“ä½œæ—¶ï¼ŒvolatileåŠä»¥å‰çš„ï¼Œéƒ½åŒæ­¥åˆ°ä¸»å­˜</li><li>è¯»æ“ä½œæ—¶ï¼ŒvolatileåŠä»¥åçš„ï¼Œå¯¹å…±äº«å˜é‡è¯»å–ï¼ŒåŠ è½½ä¸»å­˜</li></ul></li><li><p>ä¿è¯æœ‰åºæ€§</p><ul><li><p>å†™å±éšœç¡®ä¿æŒ‡ä»¤é‡æ’æ—¶ï¼Œå†™å±éšœä¹‹å‰ä»£ç ï¼Œä¸ä¼šé‡æ’åˆ°å†™å±éšœå</p></li><li><p>è¯»å±éšœç¡®ä¿æŒ‡ä»¤é‡æ’æ—¶ï¼Œè¯»å±éšœä¹‹åä»£ç ï¼Œä¸ä¼šé‡æ’åˆ°åº¦å±éšœå‰</p></li><li><p>ä¸èƒ½è§£å†³æŒ‡ä»¤äº¤é”™é—®é¢˜</p><ul><li>åªèƒ½ä¿è¯å¯è§æ€§å’Œæœ‰åºæ€§<ul><li>å†™ï¼Œä¹‹å‰æ›´æ”¹åˆ°ä¸»å­˜ï¼Œä¸èƒ½é‡æ’åˆ°åé¢</li><li>è¯»ï¼Œä¹‹åè¯»åˆ°æœ€æ–°ï¼Œæ— æ³•é‡æ’åˆ°å‰é¢</li></ul></li><li>synchronizeéƒ½èƒ½åšåˆ°ï¼Œå¯è§ã€æœ‰åºã€åŸå­</li></ul></li></ul></li><li><p>dcl</p><ul><li><p>ç®€ä»‹</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220315130257450.png" alt="image-20220315130257450"></p><ul><li><p>æ‡’æ±‰å¼ï¼Œå•ä¾‹ç”¨åˆ°æ‰åˆ›å»º</p><ul><li>balking</li><li>åªæœ‰ç¬¬ä¸€æ¬¡éœ€è¦çº¿ç¨‹ä¿æŠ¤ã€‚åé¢éƒ½æ˜¯è¯»æ“ä½œ</li></ul></li><li><p>ä¸¤æ¬¡æ£€æŸ¥ä¸Šé” </p><ul><li>åªåœ¨ç¬¬ä¸€æ¬¡æ²¡åˆ›å»ºæ—¶ä¸Šé”ï¼ˆå¤–å±‚æ ¡éªŒï¼‰</li><li>é¦–æ¬¡è®¿é—®åŒæ­¥</li></ul></li><li><p>æŒ‡ä»¤é‡æ’ç­‰é—®é¢˜</p><ul><li>å­¦äº†å¤šçº¿ç¨‹ç°åœ¨ä»£ç éƒ½ä¸æ•¢å†™äº†</li></ul></li></ul></li><li><p>é—®é¢˜åˆ†æ</p><ul><li>synchronizedæ— æ³•ç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼Œä½†å¯ä»¥ä¿è¯æœ‰åºæ€§</li><li>synchronizedèƒ½ä¿è¯åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§ï¼Œä½†ä¸èƒ½ç¦æ­¢æŒ‡ä»¤é‡æ’</li><li>æŒ‡ä»¤é‡æ’ï¼Œå…ˆç»™å˜é‡å¤åˆ¶ï¼Œè¿˜æ²¡æ¥å¾—åŠæ„é€ å¯¹è±¡</li><li>å…¶ä»–çº¿ç¨‹åˆ¤æ–­å˜é‡ä¸ä¸ºç©ºï¼Œæ‹¿åˆ°æœªåˆå§‹åŒ–å®Œæ¯•çš„å•ä¾‹</li></ul></li><li><p>é—®é¢˜çº æ­£</p><ul><li>think<ul><li>synchronizedèƒ½ä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸´ç•ŒåŒºï¼Œä¸”ä¿è¯è¿™ä¸ªçº¿ç¨‹åœ¨ä¸´ç•ŒåŒºçš„æœ‰åºæ€§</li><li>synchronizeä¸èƒ½é˜»æ­¢é‡æ’åºï¼Œvolatileæ‰èƒ½</li><li>synchronizedçš„æœ‰åºæ€§æ˜¯å»ºç«‹åœ¨åŸå­æ€§çš„åŸºç¡€ä¸Šï¼Œä¸volatileå®ç°çš„æœ‰åºæ€§åŸç†ä¸åŒ</li><li>å› ä¸ºsynchronizedä¿®é¥°çš„ä»£ç å—æ˜¯å•çº¿ç¨‹è¿è¡Œçš„ï¼Œå› æ­¤å³ä½¿å‘ç”Ÿé‡æ’åºä¹Ÿä¸ä¼šå½±å“æœ€ç»ˆçš„ç»“æœï¼Œå› æ­¤ï¼Œsynchronizedæ˜¯å¯ä»¥ä¿è¯æœ‰åºæ€§çš„ï¼Œä½†æ˜¯ä¿è¯æœ‰åºæ€§çš„æ–¹å¼å’Œvolatileä¸åŒã€‚</li><li>synchronizedä¸èƒ½é˜²æ­¢æŒ‡ä»¤é‡æ’åºï¼Œä½†æ˜¯é‡æ’åºæ˜¯ä¸å½±å“â€å•çº¿ç¨‹â€çš„æ‰§è¡Œç»“æœçš„ï¼ŒåŠ ä¸Šsynchronizedåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è¿›å…¥æ‰§è¡ŒæŒ‡ä»¤ï¼Œæ‰€ä»¥ä¿è¯â€å¤šçº¿ç¨‹ä¸­çš„æœ‰åºæ€§â€.</li><li>å½“å‰dclä¾‹å­ä¸­ï¼Œå¯¹INSTANCEçš„â€œè¯»å–å’Œå†™å…¥â€å¹¶æ²¡æœ‰åœ¨synchronizedåŒæ­¥å—å†…ï¼Œä¸èƒ½ä¿è¯åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œè€Œå†™å…¥çš„æŒ‡ä»¤ä¸­åˆå‡ºç°äº†é‡æ’åº(å†™å…¥å’Œæ„é€ æ–¹æ³•è°ƒç”¨)ï¼Œå› æ­¤å¯¼è‡´äº†è¿™ä¸ªé—®é¢˜ã€‚</li></ul></li><li>å…±äº«å˜é‡è‹¥å®Œå…¨ç»™synchronizeï¼Œå³ä½¿æœ‰é‡æ’åºï¼Œä¹Ÿä¸ä¼šæœ‰æœ‰åºæ€§é—®é¢˜</li><li>æœ¬ä¾‹<strong>å…±äº«å˜é‡æ²¡æœ‰å®Œå…¨è¢«synchronizeä¿æŠ¤</strong>ï¼Œä»£ç å—å¤–é¢è¿˜æœ‰ä½¿ç”¨</li><li>å†…éƒ¨é‡æ’ + å…±äº«å˜é‡å¤–éƒ¨å¼•ç”¨ å¯¼è‡´é—®é¢˜</li></ul></li><li><p>é—®é¢˜è§£å†³</p><ul><li><p>åŠ ä¸Švolatile</p><ul><li><p>é˜»æ­¢æŒ‡ä»¤é‡æ’åº</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220315130316484.png" alt="image-20220315130316484"></p></li><li><p>è°ƒç”¨æ„é€ æ–¹æ³•ç­‰æŒ‡ä»¤ï¼Œä¸èƒ½é‡æ’åˆ°èµ‹å€¼æŒ‡ä»¤ä¹‹å</p><ul><li>ä¿è¯å…ˆæ„é€ å†èµ‹å€¼</li></ul></li><li><p>å…¶ä»–çº¿ç¨‹è¯»å–æŒ‡ä»¤æ—¶å¸¦è¯»å±éšœï¼Œè¯»å–æœ€æ–°ç»“æœ</p><ul><li><p>å…¶å®å°±æ˜¯ä¿è¯äº†æ¯ä¸ªçº¿ç¨‹é‡åˆ°è¢«volatileä¿®é¥°çš„å˜é‡æ—¶éƒ½ä¼šä»ä¸»å­˜ä¸­é‡æ–°è·å–è¯¥å€¼</p></li><li><p>æˆ‘è§‰å¾—è¿™é‡Œè§£å†³çš„æ˜¯å…ˆè°ƒæ„é€ æ–¹æ³•å†èµ‹å€¼çš„æŒ‡ä»¤é¡ºåºï¼Œè€Œä¸æ˜¯å›¾ä¸Šç”»çš„ï¼Œå› ä¸ºè¿™æ˜¯2ä¸ªçº¿ç¨‹çš„å›¾ï¼Œvolatileæ˜¯å•çº¿ç¨‹æŒ‡ä»¤æ’åºï¼Œå¤šçº¿ç¨‹å¯è§æ€§</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220315130324230.png" alt="image-20220315130324230"></p></li></ul></li><li><p>è§£å†³dclå•ä¾‹</p></li></ul></li></ul></li><li><p>happens-beforeè§„åˆ™</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220315130331914.png" alt="image-20220315130331914"></p><ul><li>è¿™å—å’ŒæŒ‡ä»¤é‡æ’é‚£å—æ²¡æœ‰ä¹¦ä¸Šè®²çš„å¥½ï¼Œæœ€å¥½çœ‹ä¹¦</li><li>è§£é”å¯è§</li><li>volatileå¯è§</li><li>startå‰å†™</li><li>çº¿ç¨‹ç»“æŸ</li><li>æ‰“æ–­ä¹‹å‰å¯¹å˜é‡çš„å†™ï¼Œå¯è§</li><li>å˜é‡é»˜è®¤å€¼çš„å†™</li><li>volatileå˜é‡å‰ï¼Œå…¶ä»–å˜é‡çš„å†™ï¼Œéƒ½åŒæ­¥åˆ°ä¸»å­˜ï¼ˆå†™å±éšœï¼‰</li></ul></li><li><p>ä¹ é¢˜</p><ul><li>balkingæ¨¡å¼<ul><li>volatileæƒ…å†µ<ul><li>ä¸€ä¸ªçº¿ç¨‹å†™å…¶ä»–è¯»</li><li>dcl é”å¤–ï¼Œé˜²æ­¢æŒ‡ä»¤é‡æ’</li></ul></li></ul></li><li>çº¿ç¨‹å®‰å…¨å•ä¾‹1<ul><li>final<ul><li>é˜²æ­¢å­ç±»ç»§æ‰¿è¿™ä¸ªå•ä¾‹ç±» ç„¶åé‡å†™æ–¹æ³•</li></ul></li><li>é˜²æ­¢ååºåˆ—åŒ–ç ´åå•ä¾‹<ul><li>å¯¹ï¼Œå½“ç”¨ååºåˆ—åŒ–åˆ›å»ºå¯¹è±¡æ—¶ï¼Œä¼šè°ƒç”¨readResovle()ï¼Œå› æ­¤æˆ‘ä»¬ç›´æ¥ç»™å®ƒé‡å†™ï¼Œè®©å®ƒè¿”å›æˆ‘ä»¬åˆ›å»ºçš„å¯¹è±¡å°±è¡Œäº†ã€‚</li><li>å…‹éš†ã€åå°„ã€ååºåˆ—åŒ–éƒ½ä¼šç ´åå•ä¾‹</li></ul></li><li>ç§æœ‰<ul><li>é˜²æ­¢ç›´æ¥åˆ›å»ºï¼Œä¸èƒ½é˜²æ­¢åå°„</li></ul></li><li>åˆå§‹åŒ–å¯¹è±¡<ul><li>å®‰å…¨</li></ul></li><li>å…¬å…±é™æ€æ–¹æ³•<ul><li>å°è£…ã€æ”¹é€ ã€æ³›å‹ç­‰</li></ul></li></ul></li><li>çº¿ç¨‹å®‰å…¨å•ä¾‹<ul><li>æšä¸¾å•ä¾‹<ul><li>1ã€å®šä¹‰æ—¶æœ‰å‡ ä¸ªå°±æœ‰å‡ ä¸ªï¼Œé™æ€æˆå‘˜å˜é‡</li><li>2ã€æ²¡æœ‰å¹¶å‘é—®é¢˜ï¼Œç±»åŠ è½½å®Œæˆ</li><li>3ã€ä¸èƒ½åå°„ç ´å</li><li>4ã€å¯ä»¥é˜²æ­¢</li><li>5ã€é¥¿æ±‰å¼</li><li>6ã€åŠ åˆ°æ„é€ æ–¹æ³•ä¸­</li></ul></li><li>æ‡’æ±‰å¼<ul><li>çº¿ç¨‹å®‰å…¨ï¼šç±»å¯¹è±¡é”</li><li>æ•ˆç‡ä½</li></ul></li><li>DCLå•ä¾‹<ul><li>åªåœ¨åˆ›å»ºæ—¶åŠ é”ï¼Œæ•ˆç‡æé«˜</li><li>é˜²æ­¢ç¬¬ä¸€å¹¶å‘è®¿é—®ï¼Œå…¶ä»–çº¿ç¨‹è¿›å…¥é”ï¼Œå†æ¬¡åˆ›å»º</li><li>é˜²æ­¢é‡æ’åº</li></ul></li><li>é™æ€å†…éƒ¨ç±»ï¼Œæ‡’æ±‰å¼<ul><li>ç±»åŠ è½½æ˜¯æ‡’æƒ°çš„</li><li>ç”¨getinstanceæ—¶æ‰è§¦å‘ç±»åŠ è½½æ“ä½œï¼Œåˆå§‹åŒ–</li></ul></li><li>ç±»åŠ è½½ç”±JVMä¿è¯çº¿ç¨‹å®‰å…¨</li></ul></li></ul></li></ul></li></ul></li></ul><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><ul><li>JMM<ul><li>å¯è§æ€§<ul><li>JVMç¼“å­˜ä¼˜åŒ–å¼•èµ·</li></ul></li><li>æœ‰åºæ€§<ul><li>JVMæŒ‡ä»¤é‡æ’ä¼˜åŒ–å¼•èµ·</li></ul></li><li>happens-beforeè§„åˆ™<ul><li>å†™è¯»æ˜¯å¦å¯è§</li></ul></li></ul></li><li>åŸç†<ul><li>CPUæŒ‡ä»¤å¹¶è¡Œï¼Œé‡æ’åºé—®é¢˜</li><li>volatile<ul><li>è¯»å†™å±éšœ</li></ul></li></ul></li><li>æ¨¡å¼<ul><li>ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ä¼˜åŒ–<ul><li>volatileæ”¹è¿›</li></ul></li><li>åŒæ­¥æ¨¡å¼ä¹‹balking<ul><li>åªæ‰§è¡Œä¸€æ¬¡æƒ…å†µ<ul><li>ç›‘æ§çº¿ç¨‹å¯åŠ¨</li><li>å•ä¾‹</li></ul></li></ul></li></ul></li></ul>]]></content>
    
    
    <summary type="html">å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘</summary>
    
    
    
    <category term="å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘" scheme="https://fireonice.github.io/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91/"/>
    
    
    <category term="å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘" scheme="https://fireonice.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘â€”â€”å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹-Monitor&amp;ReentrantLock</title>
    <link href="https://fireonice.github.io/2022/03/14/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91-%E5%85%B1%E4%BA%AB%E6%A8%A1%E5%9E%8B%E4%B9%8B%E7%AE%A1%E7%A8%8B-Monitor&amp;ReentrantLock/"/>
    <id>https://fireonice.github.io/2022/03/14/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91-%E5%85%B1%E4%BA%AB%E6%A8%A1%E5%9E%8B%E4%B9%8B%E7%AE%A1%E7%A8%8B-Monitor&amp;ReentrantLock/</id>
    <published>2022-03-14T15:13:13.383Z</published>
    <updated>2022-03-15T04:46:57.005Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹"><a href="#å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹" class="headerlink" title="å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹"></a>å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹</h1><h2 id="å…±äº«å¸¦æ¥çš„é—®é¢˜"><a href="#å…±äº«å¸¦æ¥çš„é—®é¢˜" class="headerlink" title="å…±äº«å¸¦æ¥çš„é—®é¢˜"></a>å…±äº«å¸¦æ¥çš„é—®é¢˜</h2><p>ä¸Šä¸‹æ–‡åˆ‡æ¢é—®é¢˜</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220314234314311.png" alt="image-20220314234314311"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">+ å…±äº«å¸¦æ¥çš„é—®é¢˜</span><br><span class="line">+ ä¸Šä¸‹æ–‡åˆ‡æ¢åˆ†æ</span><br><span class="line">    + å•çº¿ç¨‹</span><br><span class="line">    + å¤šçº¿ç¨‹æƒ…å†µ</span><br><span class="line">        + çº¿ç¨‹çš„ cpu æ—¶é—´ç‰‡ç”¨å®Œ -&gt; çº¿ç¨‹æŒ‚èµ·ï¼Œè¿è¡Œåˆ°å°±ç»ª -&gt; çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ -&gt; å­—èŠ‚ç æŒ‡ä»¤äº¤é”™è¿è¡Œ -&gt; å…±äº«å˜é‡counterè¯»å†™å†²çª</span><br><span class="line">    + æ ¹æºï¼šæŒ‡ä»¤äº¤é”™</span><br><span class="line">+ ä¸´ç•ŒåŒºä¸ç«æ€æ¡ä»¶</span><br><span class="line">    + ä¸´ç•ŒåŒº</span><br><span class="line">        + å­˜åœ¨å¯¹å…±äº«èµ„æºçš„å¤šçº¿ç¨‹è¯»å†™åŒºåŸŸ</span><br><span class="line">    + ç«æ€æ¡ä»¶</span><br><span class="line">        + ç»“æœæ— æ³•é¢„æµ‹</span><br><span class="line">+ é¿å…ç«æ€æ¡ä»¶</span><br><span class="line">    + éé˜»å¡å¼</span><br><span class="line">        + åŸå­å˜é‡</span><br><span class="line">    + é˜»å¡å¼</span><br><span class="line">        + synchronizeã€lock</span><br><span class="line">+ synchronize</span><br><span class="line">    + å¯¹è±¡é”</span><br><span class="line">        + ä¸´ç•ŒåŒºä»£ç å˜æˆä¸²è¡Œ</span><br><span class="line">        + å¯¹è±¡ï¼Œå¤šä¸ªçº¿ç¨‹å…±äº«</span><br><span class="line">    + ç†è§£</span><br><span class="line">        + æ¯”å–»</span><br><span class="line">            + synchronizeä¸­å³ä½¿æ—¶é—´ç‰‡ç”¨å®Œï¼Œä¸‹æ¬¡è·å–æ—¶é—´ç‰‡ä»è¿›å…¥ï¼ˆä¸Šä¸‹æ–‡åˆ‡æ¢ï¼‰</span><br><span class="line">                + åªæœ‰æ‰§è¡Œå®Œå…¶ä¸­ä»£ç ï¼Œä»synchronizeå‡ºæ¥è§£é”</span><br><span class="line">        + æ—¶åºå›¾</span><br><span class="line">            + æ‰§è¡Œä¸­ï¼Œè‹¥æœ¬çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</span><br><span class="line">                + å…¶ä»–çº¿ç¨‹è·å–é”è¢«é˜»å¡blocked</span><br><span class="line">                + å…¶ä»–çº¿ç¨‹ç›´æ¥ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæœ¬çº¿ç¨‹ç»§ç»­æ‰§è¡Œ</span><br><span class="line">            + é‡Šæ”¾é”ï¼Œå”¤é†’é˜»å¡çº¿ç¨‹</span><br><span class="line">        + æ€è€ƒ</span><br><span class="line">            + åˆ©ç”¨å¯¹è±¡é”ä¿è¯ä¸´ç•ŒåŒºä¸­ä»£ç çš„åŸå­æ€§</span><br><span class="line">                + åŸå­æ€§ï¼šåŸå­æ“ä½œï¼Œä¸å¯åˆ†å‰²</span><br><span class="line">    + é¢å‘å¯¹è±¡æ”¹è¿›</span><br><span class="line">        + äº’æ–¥ç­‰é€»è¾‘å°è£…åœ¨roomç±»å†…éƒ¨</span><br><span class="line">            + å¯¹å…±äº«èµ„æºä¿æŠ¤ï¼Œç”±å†…éƒ¨å®ç°</span><br><span class="line">        + å¯¹å¤–è°ƒç”¨å³å¯</span><br><span class="line">    + synchronizeåŠ åœ¨æ–¹æ³•ä¸Š</span><br><span class="line">        + æˆå‘˜æ–¹æ³•ä¸Š</span><br><span class="line">            + ç›¸å½“äºé”thiså¯¹è±¡</span><br><span class="line">        + staticæ–¹æ³•ä¸Š</span><br><span class="line">            + ç›¸å½“äºé”ç±»å¯¹è±¡</span><br><span class="line">            + jvmä¸­åªæœ‰ä¸€ä¸ªç±»å¯¹è±¡ï¼Œä½†æ˜¯æœ‰å¤šä¸ªå®ä¾‹å¯¹è±¡ã€‚è¿™å°±æ˜¯åŒºåˆ«</span><br><span class="line">        + ä¹ é¢˜ï¼šçº¿ç¨‹å…«é”</span><br><span class="line">            + sleepå³æŠ±ç€é”ç¡è§‰</span><br><span class="line">            + é”ç±»å¯¹è±¡åªæœ‰ä¸€ä¸ª</span><br></pre></td></tr></table></figure><h2 id="çº¿ç¨‹å®‰å…¨åˆ†æ"><a href="#çº¿ç¨‹å®‰å…¨åˆ†æ" class="headerlink" title="çº¿ç¨‹å®‰å…¨åˆ†æ"></a>çº¿ç¨‹å®‰å…¨åˆ†æ</h2><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220314234413264.png" alt="image-20220314234413264"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+ å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ</span><br><span class="line">    + æˆå‘˜å˜é‡ã€é™æ€å˜é‡è¢«å…±äº«</span><br><span class="line">        + è¯»æ“ä½œï¼Œçº¿ç¨‹å®‰å…¨</span><br><span class="line">        + è¯»å†™æ“ä½œï¼Œä¸´ç•ŒåŒºï¼Œè€ƒè™‘çº¿ç¨‹å®‰å…¨</span><br><span class="line">    + å±€éƒ¨å˜é‡</span><br><span class="line">        + å±€éƒ¨å˜é‡åœ¨çº¿ç¨‹ä¹‹å†…ï¼Œä¸å…±äº«</span><br><span class="line">            + çº¿ç¨‹å®‰å…¨</span><br><span class="line">        + å±€éƒ¨å˜é‡å¼•ç”¨çš„å¯¹è±¡ï¼Œå¯èƒ½è¢«å…±äº«</span><br><span class="line">            + å¦‚æœå¼•ç”¨å¯¹è±¡é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´ï¼Œè€ƒè™‘çº¿ç¨‹å®‰å…¨</span><br><span class="line">        + æš´éœ²å¼•ç”¨</span><br><span class="line">            + privateã€finalï¼Œé˜²æ­¢å­ç±»å½±å“</span><br></pre></td></tr></table></figure><h2 id="å¸¸è§çº¿ç¨‹å®‰å…¨ç±»"><a href="#å¸¸è§çº¿ç¨‹å®‰å…¨ç±»" class="headerlink" title="å¸¸è§çº¿ç¨‹å®‰å…¨ç±»"></a>å¸¸è§çº¿ç¨‹å®‰å…¨ç±»</h2><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220314234431459.png" alt="image-20220314234431459"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">+ çº¿ç¨‹å®‰å…¨ç±»</span><br><span class="line">    + å¤šä¸ªçº¿ç¨‹è°ƒç”¨ä»–ä»¬åŒä¸€å®ä¾‹æ—¶æ˜¯å®‰å…¨çš„</span><br><span class="line">        + hashtable put</span><br><span class="line">    + å¤šä¸ªæ–¹æ³•ç»„åˆä¸å®‰å…¨ï¼šéåŸå­</span><br><span class="line">        + è¿˜éœ€åœ¨å¤–éƒ¨ä¸Šé”</span><br><span class="line">    + ä¸å¯å˜ç±»</span><br><span class="line">    + ç›´æ¥åˆ›å»ºæ–°çš„å®ä¾‹ï¼Œä¸åœ¨åŸæœ‰å®ä¾‹ä¸Šæ”¹å˜</span><br><span class="line">        + çº¿ç¨‹å®‰å…¨</span><br><span class="line">    + å®ä¾‹åˆ†æ</span><br><span class="line">        + finalï¼šå¯¹è±¡çš„å¼•ç”¨ä¸å¯å˜ä¸ä»£è¡¨å¯¹è±¡çš„çŠ¶æ€ä¸å¯å˜</span><br><span class="line">        + è¿˜å¯ä»¥ä½¿ç”¨ThreadLocalç»™æ¯ä¸ªçº¿ç¨‹å­˜å‚¨ä¸€ä¸ªç§æœ‰startå˜é‡</span><br><span class="line">        + æˆ‘è§‰å¾—ä¸»è¦è¿˜æ˜¯çœ‹å˜é‡æ˜¯å¦1ã€èƒ½é€ƒç¦»ï¼Œ2ã€å…±äº«</span><br><span class="line">        + å…ˆçœ‹æœ‰æœ¨æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å…±äº«å˜é‡ï¼Œå†çœ‹è¯¥å…±äº«å˜é‡æ˜¯å¦å¯è¢«ä¿®æ”¹</span><br><span class="line">        + é€ƒé€¸åˆ†æï¼Œè¦ç¬¦åˆé—­åˆåŸåˆ™</span><br><span class="line">+ ä¹ é¢˜</span><br><span class="line">    + å”®ç¥¨</span><br><span class="line">        + sellè¯»å†™æ“ä½œï¼Œä¸å®‰å…¨</span><br><span class="line">        + addçº¿ç¨‹å®‰å…¨ï¼Œæœ‰synchronize</span><br><span class="line">        + sellå’Œadd</span><br><span class="line">            + å®‰å…¨ï¼Œ ä¸æ˜¯åŒä¸€å…±äº«å˜é‡</span><br><span class="line">            + æ¦‚æ‹¬æ¥è¯´å°±æ˜¯ï¼šä¸‹è¾¹çš„åŸå­æ“ä½œä¸ä¾èµ–ä¸Šè¾¹åŸå­æ“ä½œçš„ç»“æœçš„è¯ï¼Œå°±ä¸ç”¨è€ƒè™‘ä¸¤ä¸ªåŸå­æ“ä½œåˆåœ¨ä¸€èµ·çš„å®‰å…¨æ€§</span><br><span class="line">        + threadlistå®‰å…¨ï¼Œä¸è¢«å¤šä¸ªçº¿ç¨‹å…±äº«</span><br><span class="line">        + sellåŠ é”</span><br><span class="line">            + ä¿è¯åŸå­æ€§</span><br><span class="line">    + è½¬è´¦</span><br><span class="line">        + åŠ é”ï¼šç±»å¯¹è±¡</span><br></pre></td></tr></table></figure><h2 id="Monitor"><a href="#Monitor" class="headerlink" title="Monitor"></a>Monitor</h2><p>åŠ é”å®ç°åŸç†</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220314234449143.png" alt="image-20220314234449143"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">+ å¯¹è±¡å¤´</span><br><span class="line">    + klass word</span><br><span class="line">        + æ‰¾åˆ°çš„ç±»å¯¹è±¡</span><br><span class="line">    + mark word</span><br><span class="line">+ monitorï¼ˆé”ï¼‰</span><br><span class="line">    + åŠ é”å®ç°åŸç†</span><br><span class="line">        + å¯¹è±¡ä¸monitorç›¸å…³è”</span><br><span class="line">        + æ¯ä¸ªsynchronize(obj)å¯¹è±¡å…³è”ä¸€ä¸ªmonitor</span><br><span class="line">            + åªèƒ½æœ‰ä¸€ä¸ªowner</span><br><span class="line">        + å…¶ä»–çº¿ç¨‹æ‰§è¡Œsynchronizeï¼ˆobjï¼‰</span><br><span class="line">            + è¿›å…¥entrylist blocked</span><br><span class="line">        + æ‰§è¡Œå®ŒåŒæ­¥ä»£ç å—å†…å®¹</span><br><span class="line">            + å”¤é†’entrylistä¸­ç­‰å¾…çº¿ç¨‹</span><br><span class="line">            + çº¿ç¨‹ç›¸äº’ç«äº‰owner</span><br><span class="line">    + åŸç†ï¼ˆå­—èŠ‚ç ï¼‰</span><br><span class="line">        + å¦‚æœå‡ºç°å¼‚å¸¸ï¼Œå¸®æˆ‘ä»¬æ­£ç¡®è§£é”</span><br><span class="line">            + é‡ç½®mark wordï¼Œå”¤é†’entrylist</span><br><span class="line">            + æŠ›å‡ºå¼‚å¸¸</span><br></pre></td></tr></table></figure><h2 id="synchronizeä¼˜åŒ–åŸç†"><a href="#synchronizeä¼˜åŒ–åŸç†" class="headerlink" title="synchronizeä¼˜åŒ–åŸç†"></a>synchronizeä¼˜åŒ–åŸç†</h2><p>å¯¹è±¡å¤´æ ¼å¼ï¼šæ­£å¸¸ã€åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ã€GC</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220314234523762.png" alt="image-20220314234523762"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">+ synchronizeä¼˜åŒ–åŸç†</span><br><span class="line">    + å°æ•…äº‹</span><br><span class="line">    + è½»é‡çº§é”</span><br><span class="line">        + åˆ›å»ºé”è®°å½•ï¼ˆLock Recordï¼‰å¯¹è±¡</span><br><span class="line">            + çº¿ç¨‹æ ˆå¸§ä¸­åŒ…å«é”çš„ç»“æ„</span><br><span class="line">        + é”è®°å½•ä¸­object referenceæŒ‡å‘é”å¯¹è±¡</span><br><span class="line">            + ç”¨casæ›¿æ¢lock recordå’Œé”çš„mark word</span><br><span class="line">                + ç”¨äºè§£é”çš„æ¢å¤å’Œé”è®°å½•åœ°å€</span><br><span class="line">        + casæ›¿æ¢æˆåŠŸ</span><br><span class="line">            + é”ä¸­å­˜å‚¨äº†é”è®°å½•åœ°å€ï¼ˆå“ªä¸ªçº¿ç¨‹ï¼‰å’Œè½»é‡çº§é”</span><br><span class="line">            + è¡¨ç¤ºè¯¥çº¿ç¨‹ç»™å¯¹è±¡åŠ é”</span><br><span class="line">        + casæ›¿æ¢å¤±è´¥</span><br><span class="line">            + å¦‚æœå…¶ä»–çº¿ç¨‹æŒæœ‰äº†è¯¥objçš„è½»é‡çº§é”</span><br><span class="line">                + è¿›å…¥é”è†¨èƒ€è¿‡ç¨‹</span><br><span class="line">            + å¦‚æœè‡ªå·±synchronizeé”é‡å…¥</span><br><span class="line">                + æ·»åŠ lock recordï¼ŒçŸ¥é“æ˜¯è‡ªå·±çº¿ç¨‹çš„é”ï¼Œä½œä¸ºé‡å…¥çš„è®¡æ•°</span><br><span class="line">        + è§£é”æ—¶å¦‚æœå–å€¼ä¸ºnullï¼Œè¡¨ç¤ºé”é‡å…¥ï¼Œæ¸…é™¤é”è®°å½•</span><br><span class="line">        + è§£é”æ—¶å¦‚æœå–å€¼ä¸ä¸ºnull</span><br><span class="line">            + caså°†mark wordæ¢å¤ç»™é”å¯¹è±¡å¤´</span><br><span class="line">                + å˜ä¸ºæ— é”çŠ¶æ€</span><br><span class="line">            + æˆåŠŸï¼Œè§£é”æˆåŠŸ</span><br><span class="line">            + å¤±è´¥</span><br><span class="line">                + è¯´æ˜è½»é‡çº§é”è¿›å…¥äº†é”è†¨èƒ€æˆ–ä¸€çº§å‡çº§ä¸ºé‡é‡çº§é”</span><br><span class="line">                + è¿›å…¥é‡é‡çº§é”è§£é”æµç¨‹</span><br><span class="line">    + é”è†¨èƒ€</span><br><span class="line">        + å°†è½»é‡çº§é”å‡çº§ä¸ºé‡é‡çº§é”</span><br><span class="line">        + æµç¨‹</span><br><span class="line">            + ä¸ºobjectå¯¹è±¡ç”³è¯·monitoré”</span><br><span class="line">                + mark wordæŒ‡å‘é‡é‡çº§é”åœ°å€ï¼Œåä¸¤ä½10</span><br><span class="line">            + å…¶ä»–çº¿ç¨‹è¿›å…¥monitorçš„entrylisté˜»å¡</span><br><span class="line">            + çº¿ç¨‹æ‰§è¡Œå®Œï¼Œè§£é”</span><br><span class="line">                + caså°†mark wordæ¢å¤ï¼Œå¤±è´¥</span><br><span class="line">                + è¿›å…¥é‡é‡çº§è§£é”æµç¨‹</span><br><span class="line">                    + æ ¹æ®å¯¹è±¡å¤´æ‰¾åˆ°monitor</span><br><span class="line">                    + è®¾ç½®ownerä¸ºnull</span><br><span class="line">                    + å”¤é†’entrylist</span><br><span class="line">    + è‡ªæ—‹ä¼˜åŒ–</span><br><span class="line">        + é‡é‡çº§é”ç«äº‰æ—¶ï¼Œè‡ªæ—‹ä¼˜åŒ–ï¼ˆé‡è¯•ï¼‰</span><br><span class="line">            + å‡å°‘é˜»å¡å‘ç”Ÿ</span><br><span class="line">                + é˜»å¡è¦è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢</span><br><span class="line">        + è‡ªæ—‹å¤±è´¥ï¼Œè¿›å…¥é˜»å¡</span><br><span class="line">        + è‡ªæ—‹é”æ˜¯è‡ªé€‚åº”çš„ï¼Œæ­£åé¦ˆè°ƒèŠ‚</span><br><span class="line">        + java7ä»¥åæ— æ³•æ§åˆ¶æ˜¯å¦å¼€å¯è‡ªæ—‹</span><br><span class="line">    + åå‘é”</span><br><span class="line">        + è½»é‡çº§é”ï¼Œé”é‡å…¥æ—¶ä»éœ€CASæ“ä½œ</span><br><span class="line">            + æ¯ä¸€æ¬¡éƒ½è¦casæ“ä½œï¼ˆç¿»ä¹¦åŒ…ï¼‰</span><br><span class="line">        + åå‘é”ï¼ˆåˆ»åå­—ï¼‰</span><br><span class="line">            + ç¬¬ä¸€æ¬¡casæ—¶å°†Thread idè®¾ç½®åˆ°é”å¯¹è±¡å¤´</span><br><span class="line">                + é‡å…¥æ—¶åˆ¤æ–­ä¸ºæœ¬çº¿ç¨‹ï¼Œæ— éœ€cas</span><br><span class="line">        + åå‘çŠ¶æ€</span><br><span class="line">            + é»˜è®¤å¼€å¯åå‘é”ï¼Œmark wordä¸­biased_lockä¸º1</span><br><span class="line">                + é»˜è®¤å»¶è¿Ÿå¼€å¯</span><br><span class="line">            + è·å–é”å¯¹è±¡</span><br><span class="line">                + è®¾ç½®çº¿ç¨‹idåˆ°é”çš„mark word</span><br><span class="line">            + synchronizeç»“æŸå</span><br><span class="line">                + é”çš„mark wordä¸å˜</span><br><span class="line">            + å…¶ä»–çº¿ç¨‹è·å–é”å¯¹è±¡</span><br><span class="line">                + æ’¤é”€åå‘é”ï¼Œå˜æˆè½»é‡çº§é”</span><br><span class="line">                    + ç«äº‰</span><br><span class="line">                        + è†¨èƒ€å˜æˆé‡é‡çº§é”</span><br><span class="line">            + ä½¿ç”¨åå‘é”ä¹‹å‰è·å–hashcode</span><br><span class="line">                + ä¼šç¦ç”¨åå‘é”</span><br><span class="line">                + å“ˆå¸Œç ç”¨çš„æ—¶å€™æ‰äº§ç”Ÿï¼Œå¡«åˆ°mark wordä¸­</span><br><span class="line">                    + è½»é‡çº§é”hashcodeå­˜åœ¨çº¿ç¨‹æ ˆå¸§çš„é”è®°å½•é‡Œ</span><br><span class="line">                    + é‡é‡çº§é”hashcodeå­˜åœ¨monitorå¯¹è±¡é‡Œ</span><br><span class="line">                    + è§£é”æ—¶éƒ½ä¼šè¿˜åŸå›æ¥</span><br><span class="line">                + åå‘é”æ²¡æœ‰å­˜å‚¨çš„åœ°æ–¹</span><br><span class="line">        + æ’¤é”€</span><br><span class="line">            + è°ƒç”¨hashcode</span><br><span class="line">            + å…¶ä»–çº¿ç¨‹ä½¿ç”¨å¯¹è±¡</span><br><span class="line">                + åå‘é”å‡çº§ä¸ºè½»é‡çº§é”</span><br><span class="line">                    + æµ‹è¯•</span><br><span class="line">                        + è½»é‡çº§é”ã€åå‘é”å‰æ</span><br><span class="line">                            + çº¿ç¨‹é”™å¼€ï¼Œå¦åˆ™å‡çº§é‡é‡çº§é”</span><br><span class="line">                            + waitä¼šé‡Šæ”¾CPUå’Œé”èµ„æº</span><br><span class="line">                + å¤šä¸ªçº¿ç¨‹è·å–åå‘é”</span><br><span class="line">                    + æ’¤é”€åå‘é”</span><br><span class="line">            + è°ƒç”¨wait/notify</span><br><span class="line">                + wait/notifyåªæœ‰é‡é‡çº§é”æœ‰</span><br><span class="line">                    + è‡ªåŠ¨å‡çº§ä¸ºé‡é‡çº§é”</span><br><span class="line">        + æ‰¹é‡é‡åå‘</span><br><span class="line">            + è™½ç„¶è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®ï¼Œæ²¡æœ‰ç«äº‰</span><br><span class="line">                + è®©åå‘é”é‡æ–°åå‘ï¼Œè€Œä¸å‡çº§è½»é‡çº§é”</span><br><span class="line">            + æ’¤é”€åå‘æ¬¡æ•°è¿‡å¤šï¼šè¶…è¿‡20æ¬¡</span><br><span class="line">                + é‡æ–°åå‘æ–°çº¿ç¨‹</span><br><span class="line">            + æ€»ç»“å°±æ˜¯æ²¡è¶…è¿‡é˜ˆå€¼ï¼Œå…ˆæŠŠåå‘é”å˜æˆè½»é‡é”ï¼Œç„¶åå†åå‘é”</span><br><span class="line">        + æ‰¹é‡æ’¤é”€</span><br><span class="line">            + æ’¤é”€åå‘æ¬¡æ•°è¿‡å¤šï¼šè¶…è¿‡40æ¬¡</span><br><span class="line">                + æ•´ä¸ªç±»æ‰€æœ‰å¯¹è±¡ä¸å¯åå‘</span><br><span class="line">            + æµ‹è¯•</span><br><span class="line">                + t1 </span><br><span class="line">                    + 39ä¸ªåå‘t1ï¼ˆåå‘é”ï¼‰</span><br><span class="line">                +t2 </span><br><span class="line">                    + å‰19ä¸ªæ’¤é”€ï¼Œå˜æˆè½»é‡çº§é”ï¼Œè§£é”ä¸å¯åå‘ï¼Œï¼ˆè½»é‡çº§é”ï¼‰</span><br><span class="line">                    + 19ä»¥åæ‰¹é‡é‡åå‘ä¼˜åŒ–ï¼Œé‡æ–°åå‘äºt2ï¼Œï¼ˆåå‘é”ï¼‰</span><br><span class="line">                + t3</span><br><span class="line">                    + å‰19ä¸ªæ’¤é”€ï¼Œä¸å¯åå‘</span><br><span class="line">                        + t3å‰19ä¸ªå·²è¢«t2è®¾ä¸ºä¸å¯åå‘ï¼Œä¸ºè½»é‡çº§é”</span><br><span class="line">                        + t3å‰åä¹ä¸ªå·²ç»è¢«t2è®¾ç½®ä¸ºä¸å¯åå‘é”ï¼Œæ•…t3åˆå§‹ä¸ºä¸å¯åå‘é”ï¼ŒåŠ é”æˆä¸ºè½»é‡çº§é”</span><br><span class="line">                        + T2å‰åä¹ä¸ªæ²¡æœ‰é‡åå‘ï¼Œè§£é”åå°±å˜ä¸ºä¸å¯åå‘ï¼ŒåäºŒåæ˜¯åå‘t2</span><br><span class="line">                    + 19ä»¥åï¼Œ</span><br><span class="line">                        + åŸæœ¬åå‘t2çº¿ç¨‹</span><br><span class="line">                        + è¢«æ’¤é”€ï¼Œå‡çº§ä¸ºè½»é‡çº§é”</span><br><span class="line">                        + è§£é”ä¹‹åä¸å¯åå‘</span><br><span class="line">                        + é‡åå‘æ˜¯é’ˆå¯¹å•ä¸ªçº¿ç¨‹æ¥è®²çš„ï¼Œä¸€ä¸ªçº¿ç¨‹æ’¤é”€20ä¸ªé”æ‰è¿›è¡Œé‡åå‘ï¼Œè¿™æ—¶å¦ä¸€ä¸ªçº¿ç¨‹è¿˜æ˜¯è¦æ’¤é”€20ä¸ª</span><br><span class="line">                        + t1:å…¨éƒ¨åå‘t1ï¼›t2:ä¸€åŠæ’¤é”€t1çš„åå‘é”ï¼Œä¸€åŠåå‘t2ï¼›t3:ä¸€åŠè½»é‡çº§é”ï¼Œä¸€åŠæ’¤é”€t2çš„åå‘é”ï¼›æ€»å…±æ’¤é”€äº†20æ¬¡t1çš„åå‘é”ï¼Œ20æ¬¡t2çš„åå‘é”</span><br><span class="line">                        + æ‰¹é‡é‡åå‘å’Œæ‰¹é‡æ’¤é”€æ˜¯é’ˆå¯¹ç±»çš„ä¼˜åŒ–ï¼Œå’Œå¯¹è±¡æ— å…³ã€‚åå‘é”é‡åå‘ä¸€æ¬¡ä¹‹åä¸å¯å†æ¬¡é‡åå‘ã€‚å½“æŸä¸ªç±»å·²ç»è§¦å‘æ‰¹é‡æ’¤é”€æœºåˆ¶åï¼ŒJVMä¼šé»˜è®¤å½“å‰ç±»äº§ç”Ÿäº†ä¸¥é‡çš„é—®é¢˜ï¼Œå‰¥å¤ºäº†è¯¥ç±»çš„æ–°å®ä¾‹å¯¹è±¡ä½¿ç”¨åå‘é”çš„æƒåˆ©</span><br><span class="line">        + é”æ¶ˆé™¤</span><br><span class="line">            + JITä¼˜åŒ–</span><br><span class="line">                + åˆ†æå±€éƒ¨å˜é‡ï¼Œsynchronizeä¸­ä¸ä¼šè¢«å…±äº«</span><br><span class="line">                + æŠŠsynchronizeä¼˜åŒ–æ‰</span><br></pre></td></tr></table></figure><h2 id="waitã€notify"><a href="#waitã€notify" class="headerlink" title="waitã€notify"></a>waitã€notify</h2><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220314234608743.png" alt="image-20220314234608743"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">+ waitã€notify</span><br><span class="line">    + ä¸ºä»€ä¹ˆéœ€è¦wait</span><br><span class="line">        + è¿›å…¥ä¼‘æ¯å®¤wait</span><br><span class="line">        + çƒŸåˆ°äº†notifyï¼Œå”¤é†’waitçº¿ç¨‹</span><br><span class="line">    + å·¥ä½œåŸç†</span><br><span class="line">        + ownerçº¿ç¨‹å‘ç°æ¡ä»¶ä¸æ»¡è¶³ï¼Œæ”¾å¼ƒé”</span><br><span class="line">            + è°ƒç”¨waitæ–¹æ³•è¿›å…¥waitset</span><br><span class="line">                + WAITINGï¼šæ²¡æœ‰æ—¶é™</span><br><span class="line">        + blockedå’Œwaitingéƒ½å¤„äºé˜»å¡</span><br><span class="line">            + ä¸å ç”¨cpuæ—¶é—´ç‰‡</span><br><span class="line">        + ownerè°ƒç”¨notifyæˆ–è€…notifyallå”¤é†’</span><br><span class="line">            + è¿›å…¥entrylisté‡æ–°ç«äº‰</span><br><span class="line">    + api</span><br><span class="line">        + éƒ½éœ€è¦è·å¾—é”æˆä¸ºowneræ‰èƒ½è°ƒç”¨</span><br><span class="line">        + åŒæ­¥ä»£ç å—ä¸­</span><br><span class="line">        + notifyæŒ‘ä¸€ä¸ªå”¤é†’</span><br><span class="line">        + æœ‰å‚wait</span><br><span class="line">            + æœ€å¤§æ—¶é™ç­‰å¾…</span><br><span class="line">    + sleep å’Œ wait</span><br><span class="line">        + sleepæ˜¯threadæ–¹æ³•ï¼Œwaitæ˜¯objectæ‰€æœ‰å¯¹è±¡æ–¹æ³•</span><br><span class="line">        + sleepä¸éœ€è¦å’Œsynchronizeä½¿ç”¨ï¼Œwaitéœ€è¦è·å–é”</span><br><span class="line">        + sleepç¡çœ ä¸ä¼šé‡Šæ”¾é”ï¼Œwaitç­‰å¾…æ—¶ä¼šé‡Šæ”¾é”</span><br><span class="line">    + waitå’Œnotifyä½¿ç”¨</span><br><span class="line">        + waitæ—¶å…¶ä»–çº¿ç¨‹å¯ä»¥ç»§ç»­å·¥ä½œ</span><br><span class="line">        + notifyé”™è¯¯å”¤é†’ï¼šè™šå‡å”¤é†’</span><br><span class="line">            + notifyallå…¨éƒ¨å”¤é†’</span><br><span class="line">                + æŒ‡å®šçš„è¯ï¼Œç”¨parkï¼Œunpark</span><br><span class="line">            + notifyall + while</span><br><span class="line">                + ifæ¡ä»¶æ”¹ä¸ºwhileï¼Œ</span><br><span class="line">                + åªæœ‰æ¡ä»¶æ­£ç¡®æ‰èƒ½å”¤é†’å‡ºå¾ªç¯</span><br><span class="line">        + æ­£ç¡®ä½¿ç”¨</span><br></pre></td></tr></table></figure><h2 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h2><p>ä¿æŠ¤æ€§æš‚åœ</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220314234708945.png" alt="image-20220314234708945"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">+ è®¾è®¡æ¨¡å¼ï¼šåŒæ­¥æ¨¡å¼ä¹‹ä¿æŠ¤æ€§æš‚åœ</span><br><span class="line">    + å®šä¹‰</span><br><span class="line">        + ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œç»“æœ</span><br><span class="line">            + ä¸€ä¸ªç»“æœä»ä¸€ä¸ªçº¿ç¨‹ä¼ é€’åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œå…³è”åŒä¸€ä¸ªGuardedObject</span><br><span class="line">            + ç»“æœä¸æ–­ä¼ è¾“ï¼Œéœ€è¦æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆç”Ÿäº§è€…ã€æ¶ˆè´¹è€…ï¼‰</span><br><span class="line">            + joinã€futureå®ç°ï¼Œé‡‡ç”¨ä¿æŠ¤æ€§æš‚åœ</span><br><span class="line">            + ç­‰å¾…ç»“æœï¼ŒåŒæ­¥æ¨¡å¼</span><br><span class="line">    + å®ç°</span><br><span class="line">        + guardedobject</span><br><span class="line">        + ä¼˜ç‚¹</span><br><span class="line">            + ç›¸æ¯”joinï¼Œä¸éœ€è¦ç­‰çº¿ç¨‹ç»“æŸï¼Œçº¿ç¨‹è¿˜å¯ä»¥ç»§ç»­è¿è¡Œ</span><br><span class="line">            + ç­‰å¾…ç»“æœå˜é‡æ— éœ€è®¾ç½®å…¨å±€ï¼Œç›´æ¥è·å–</span><br><span class="line">    + æ‹“å±•-å¢åŠ è¶…æ—¶</span><br><span class="line">        + wait time</span><br><span class="line">        + æµ‹è¯•</span><br><span class="line">    + joinåŸç†</span><br><span class="line">        + è®°å½•ç»å†æ—¶é—´ï¼Œç­‰å¾…</span><br><span class="line">            + ä¿æŠ¤æ€§æš‚åœ</span><br><span class="line">    + æ‹“å±•-è§£è€¦ç­‰å¾…å’Œç”Ÿäº§</span><br><span class="line">        + è§£è€¦ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…</span><br><span class="line">        + ç»´æŠ¤ä¸€ä¸ªé›†åˆï¼Œguardedobjectæœ‰å”¯ä¸€id</span><br><span class="line">        + å®ç°</span><br><span class="line">            + mailbox</span><br><span class="line">                + çº¿ç¨‹å®‰å…¨çš„map hashtable</span><br><span class="line">                + è‡ªå¢idæ–¹æ³•åŠ é”</span><br><span class="line">                + è·å–å®Œé‚®ä»¶ç›´æ¥åˆ é™¤ï¼Œæ‰€ä»¥remove</span><br><span class="line">            + postmanã€people</span><br><span class="line">                + ç»§æ‰¿Thread</span><br><span class="line">                + people</span><br><span class="line">                + postman</span><br><span class="line">        + æµ‹è¯•</span><br><span class="line">            + //ç¡®ä¿ç”Ÿæˆå±…æ°‘å…ˆäºå¿«é€’å‘˜,ä½†æ˜¯å¿«é€’å‘˜å‘ä¿¡è¦æ—©äºå±…æ°‘æ”¶ä¿¡</span><br><span class="line">            + è§£è€¦äº†ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…</span><br><span class="line">            + ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¿…é¡»ä¸€ä¸€å¯¹åº”</span><br></pre></td></tr></table></figure><h2 id="ç”Ÿäº§è€…æ¶ˆè´¹è€…"><a href="#ç”Ÿäº§è€…æ¶ˆè´¹è€…" class="headerlink" title="ç”Ÿäº§è€…æ¶ˆè´¹è€…"></a>ç”Ÿäº§è€…æ¶ˆè´¹è€…</h2><p>ç”Ÿäº§è€…æ¶ˆè´¹è€…-æ¶ˆæ¯é˜Ÿåˆ—</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220314234728830.png" alt="image-20220314234728830"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">+ å¼‚æ­¥æ¨¡å¼ä¹‹ç”Ÿäº§è€…æ¶ˆè´¹è€…</span><br><span class="line">    + å®šä¹‰</span><br><span class="line">        + ä¸éœ€è¦ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¸€ä¸€å¯¹åº”</span><br><span class="line">        + æ¶ˆæ¯é˜Ÿåˆ—</span><br><span class="line">            + æœ‰å®¹é‡é™åˆ¶</span><br><span class="line">            + å„ç§é˜»å¡é˜Ÿåˆ—ï¼Œå°±æ˜¯è¿™ç§æ¨¡å¼</span><br><span class="line">        + å¼‚æ­¥æ¨¡å¼</span><br><span class="line">            + ç­‰å¾…é€šçŸ¥ åŒæ­¥ï¼Œç­‰å¾…éœ€è¦ é€šçŸ¥ ä¹‹åçš„ç»“æœ</span><br><span class="line">    + å®ç°</span><br><span class="line">        + message</span><br><span class="line">        + messageQueue</span><br><span class="line">            + LinkedList åŒå‘é˜Ÿåˆ—</span><br><span class="line">            + è·å–æ¶ˆæ¯</span><br><span class="line">                + é˜Ÿåˆ—ä¸ºç©ºwaitç­‰å¾…</span><br><span class="line">                + ä¸ä¸ºç©ºï¼Œå–å‡ºé˜Ÿåˆ—å¤´éƒ¨æ¶ˆæ¯</span><br><span class="line">                thisçš„è¯é”ç²’åº¦å¤ªå¤§äº†ï¼Œç›´æ¥å°±ç›¸å½“äºå•çº¿ç¨‹æ“ä½œäº†â€¦â€¦</span><br><span class="line">                + å–å®Œæ¶ˆæ¯ï¼Œnotifyå”¤é†’ç”Ÿäº§è€…ï¼Œé˜Ÿåˆ—ä¸æ»¡</span><br><span class="line">            + å­˜å…¥æ¶ˆæ¯</span><br><span class="line">                + åˆ¤æ–­é˜Ÿåˆ—å¦å·²æ»¡</span><br><span class="line">                    + ç”Ÿäº§è€…waitç­‰å¾…</span><br><span class="line">                + å°¾éƒ¨åŠ å…¥æ¶ˆæ¯</span><br><span class="line">                + notifyå”¤é†’æ¶ˆè´¹è€…ï¼Œæ¥æ”¶æ¶ˆæ¯</span><br><span class="line">    + æµ‹è¯•</span><br><span class="line">        + ç”Ÿäº§è€…</span><br><span class="line">        + æ¶ˆè´¹è€…</span><br></pre></td></tr></table></figure><h2 id="Park-amp-unpark"><a href="#Park-amp-unpark" class="headerlink" title="Park&amp;unpark"></a>Park&amp;unpark</h2><p>å…ˆè°ƒç”¨unparkåŸç†</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220314234756570.png" alt="image-20220314234756570"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">+ park&amp;unpark</span><br><span class="line">    + åŸºæœ¬ä½¿ç”¨</span><br><span class="line">        + æš‚åœå½“å‰çº¿ç¨‹</span><br><span class="line">        + waitçŠ¶æ€ï¼Œæ— æ—¶é™ç­‰å¾…</span><br><span class="line">        + è‹¥å…ˆè°ƒç”¨unpark</span><br><span class="line">            + æ— æ³•parkä½</span><br><span class="line">        + ç‰¹ç‚¹</span><br><span class="line">            + æ— éœ€é…ç½®monitor</span><br><span class="line">            + ä»¥çº¿ç¨‹ä¸ºå•ä½é˜»å¡ã€å”¤é†’çº¿ç¨‹ï¼Œç²¾å‡†å”¤é†’</span><br><span class="line">            + å¯ä»¥å…ˆunpark</span><br><span class="line">    + åŸç†</span><br><span class="line">        + æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰parkerå¯¹è±¡ï¼ˆèƒŒåŒ…ï¼‰</span><br><span class="line">            + counterï¼ˆ0ã€1ï¼‰</span><br><span class="line">                + å¹²ç²®</span><br><span class="line">            + cond</span><br><span class="line">                + å¸ç¯·</span><br><span class="line">            + mutex</span><br><span class="line">        + unparkï¼šä»¤å¹²ç²®å……è¶³</span><br><span class="line">        + è°ƒç”¨park</span><br><span class="line">        + è°ƒç”¨unpark</span><br><span class="line">        + å…ˆè°ƒç”¨unpark</span><br><span class="line">        + è¯´ç™½äº†å°±æ˜¯å½“countä¸º0æ—¶è°ƒç”¨parkæ‰ä¼šåœ</span><br><span class="line">        + æ€»ç»“</span><br><span class="line">            + parkæ¶ˆè´¹counter</span><br><span class="line">                + è‹¥æ— counterè¿›å…¥condï¼Œcounterä¸º0</span><br><span class="line">                    + è‹¥unparkï¼Œcounterä¸º1</span><br><span class="line">                        + å”¤é†’condä¸­çº¿ç¨‹ï¼Œæ¶ˆè´¹counterä¸º0ï¼Œç»§ç»­è¿è¡Œ </span><br><span class="line">                + è‹¥æœ‰counterï¼Œcounterä¸º0ï¼Œç»§ç»­è¿è¡Œ</span><br></pre></td></tr></table></figure><h2 id="çº¿ç¨‹çŠ¶æ€è½¬æ¢"><a href="#çº¿ç¨‹çŠ¶æ€è½¬æ¢" class="headerlink" title="çº¿ç¨‹çŠ¶æ€è½¬æ¢"></a>çº¿ç¨‹çŠ¶æ€è½¬æ¢</h2><p>çº¿ç¨‹çŠ¶æ€</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220314234813808.png" alt="image-20220314234813808"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">+ çº¿ç¨‹çŠ¶æ€è½¬æ¢</span><br><span class="line"></span><br><span class="line">    + new</span><br><span class="line">        + åˆ›å»ºjavaå¯¹è±¡ï¼Œè¿˜æ²¡å’Œæ“ä½œç³»ç»Ÿçº¿ç¨‹å¯¹è±¡å…³è”</span><br><span class="line">    + runnable</span><br><span class="line">        + å…³è”æ“ä½œç³»ç»Ÿçº¿ç¨‹ï¼Œcpuè°ƒåº¦æ‰§è¡Œ</span><br><span class="line">        + åŒ…æ‹¬æ˜¯å¦è¢«cpuè°ƒåº¦</span><br><span class="line">        + è°ƒç”¨æ“ä½œç³»ç»Ÿé˜»å¡ioç›¸å…³çš„apiï¼Œjavaå±‚é¢éƒ½æ˜¯runnable</span><br><span class="line">    + runnableå’Œwaiting</span><br><span class="line">        + ä½¿ç”¨synchronizeè·å–å¯¹è±¡é”åï¼Œwait()ï¼Œè¿›å…¥waitset</span><br><span class="line">            + notifyã€interruptï¼Œè¿›å…¥entryset()</span><br><span class="line">                + ç«äº‰é”æˆåŠŸï¼Œrunnable</span><br><span class="line">                + ç«äº‰é”å¤±è´¥ï¼Œblocked</span><br><span class="line">        + è°ƒç”¨tçº¿ç¨‹çš„join()ï¼Œå½“å‰çº¿ç¨‹å˜æˆwaiting</span><br><span class="line">            + tçº¿ç¨‹ç»“æŸã€å½“å‰çº¿ç¨‹interruptï¼Œå˜æˆrunnable</span><br><span class="line">        + park</span><br><span class="line">            + unparkã€interrupt</span><br><span class="line">    + runnableå’Œtimed_waitingï¼ˆæœ‰æ—¶é™waitingï¼‰</span><br><span class="line">        + è·å–äº†synchronizeå¯¹è±¡é”ä¹‹åï¼Œwait(n)</span><br><span class="line">            + ç­‰å¾…è¶…æ—¶ã€notifyã€interruptï¼Œè¿›å…¥entryset</span><br><span class="line">                + ç«äº‰é”æˆåŠŸï¼Œrunnable</span><br><span class="line">                + ç«äº‰é”å¤±è´¥ï¼Œblocked</span><br><span class="line">        + join(n)</span><br><span class="line">            + ç­‰å¾…è¶…æ—¶ã€è¿è¡Œç»“æŸã€interruptï¼Œrunnable</span><br><span class="line">        + parkNacos(n)ã€parkUntil(n)</span><br><span class="line">            + è¶…æ—¶ã€unparkã€interruptï¼Œrunnable</span><br><span class="line">        + sleep(n)</span><br><span class="line">            + è¶…æ—¶ï¼Œrunnable</span><br><span class="line">    + runnableå’Œblocked</span><br><span class="line">        + ç«äº‰é”å¤±è´¥ï¼Œblocked</span><br><span class="line">        + ç«äº‰é”æˆåŠŸï¼Œrunnable</span><br><span class="line">    + terminated</span><br><span class="line">        + å½“å‰çº¿ç¨‹æ‰€æœ‰ä»£ç æ‰§è¡Œå®Œæ¯•</span><br></pre></td></tr></table></figure><h2 id="å¤šæŠŠé”"><a href="#å¤šæŠŠé”" class="headerlink" title="å¤šæŠŠé”"></a>å¤šæŠŠé”</h2><p>JUC-å¯é‡å…¥é”</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220314234844081.png" alt="image-20220314234844081"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">+ å¤šæŠŠé”</span><br><span class="line">    + ä¸€æŠŠé”ï¼Œå¹¶å‘åº¦ä½</span><br><span class="line">        + ç²’åº¦ç»†åˆ†ï¼Œå‡†å¤‡å¤šä¸ªå¯¹è±¡é”</span><br><span class="line">        + ä¸šåŠ¡ä¸èƒ½æœ‰å…³è”</span><br><span class="line">        + å¢åŠ å¹¶å‘åº¦</span><br><span class="line">        + å¯èƒ½é€ æˆæ­»é”</span><br><span class="line">    + æ´»è·ƒæ€§</span><br><span class="line">        + æ­»é”ç°è±¡</span><br><span class="line">            + ä¸€ä¸ªçº¿ç¨‹éœ€è¦åŒæ—¶è·å–å¤šæŠŠé”</span><br><span class="line">                + éƒ½åœ¨ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”</span><br><span class="line">        + å®šä½æ­»é”</span><br><span class="line">            + jconsoleã€jstack</span><br><span class="line">        + å“²å­¦å®¶å°±é¤é—®é¢˜</span><br><span class="line">        + æ´»é”</span><br><span class="line">            + ä¸¤ä¸ªçº¿ç¨‹äº’ç›¸æ”¹å˜ï¼Œæ— æ³•è¾¾åˆ°ç»“æŸæ¡ä»¶</span><br><span class="line">                + æ²¡æœ‰é˜»å¡</span><br><span class="line">            + æ‰§è¡Œæ—¶é—´äº¤é”™å¼€ï¼Œéšæœºç¡çœ æ—¶é—´</span><br><span class="line">        + é¥¥é¥¿</span><br><span class="line">            + çº¿ç¨‹ä¼˜å…ˆçº§å¤ªä½ï¼Œå§‹ç»ˆæ— æ³•å¾—åˆ°cpuè°ƒåº¦</span><br><span class="line">            + é¡ºåºåŠ é”çš„è§£å†³æ–¹æ¡ˆï¼Œéƒ½æŒ‰Aã€Bé¡ºåºåŠ é”</span><br><span class="line">                + äº§ç”Ÿé¥¥é¥¿é—®é¢˜</span><br><span class="line">                + åœ¨äº‰å¤ºå·¦ç­·å­ï¼ˆæœ€å¤–å±‚é”ï¼‰ä¸­ï¼Œè‹å’Œé˜¿åŒæ—¶äº‰å¤ºc1,æ‰€ä»¥æ¦‚ç‡å€’æ•°ï¼Œåœ¨ ç¬¬äºŒè½®äº‰å¤ºå³ç­·å­æ—¶ï¼Œc5æ²¡æœ‰äººè·Ÿèµ«äº‰ï¼Œæ•…èµ«èƒ½åƒåˆ°é¥­çš„æ¦‚ç‡æœ€é«˜</span><br><span class="line">    + ReentrantLock å¯é‡å…¥é”</span><br><span class="line">        + ç‰¹ç‚¹</span><br><span class="line">            + å¯ä¸­æ–­ï¼ˆç ´åé”ï¼‰</span><br><span class="line">            + å¯è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆäº‰æŠ¢é”ï¼‰</span><br><span class="line">            + å¯è®¾ç½®ä¸ºå…¬å¹³é”ï¼ˆblockå…ˆè¿›å…ˆå‡ºï¼‰</span><br><span class="line">            + æ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡ï¼ˆä¸åŒæ¡ä»¶å¯¹åº”å¤šä¸ªwaitsetï¼Œç²¾å‡†å”¤é†’ï¼‰</span><br><span class="line">            + ä¸synchronizeä¸€æ ·ï¼Œæ”¯æŒå¯é‡å…¥ï¼ˆåŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥é‡å¤è·å–é”ï¼‰</span><br><span class="line">        + å¯é‡å…¥</span><br><span class="line">            + åŒä¸€ä¸ªçº¿ç¨‹è·å–é”åï¼Œå¯å†æ¬¡è·å–é”ï¼ˆlockå¤šæ¬¡ï¼‰</span><br><span class="line">        + å¯æ‰“æ–­</span><br><span class="line">            + ç­‰å¾…é”è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥è¢«interruptæ‰“æ–­ç»ˆæ­¢ç­‰å¾…</span><br><span class="line">            + lockInterruptiblyæ–¹æ³•è·å–é”ï¼ˆlockæ— æ³•æ‰“æ–­ç­‰å¾…ï¼‰</span><br><span class="line">                + å…¶ä»–çº¿ç¨‹interrupt()æ‰“æ–­</span><br><span class="line">                + æ•æ‰åˆ°InterruptExceptionå¼‚å¸¸</span><br><span class="line">                + ç›´æ¥è¿”å›</span><br><span class="line">            + è¢«åŠ¨ï¼Œé¿å…æ­»ç­‰</span><br><span class="line">        + é”è¶…æ—¶</span><br><span class="line">            + ä¸»åŠ¨ï¼Œè®¾ç½®è¶…æ—¶é¿å…æ­»ç­‰</span><br><span class="line">            + trylock()ï¼Œå°è¯•è·å¾—é”ï¼Œè¿”å›å¸ƒå°”å€¼</span><br><span class="line">                + è·å–ä¸åˆ°é”ç›´æ¥è¿”å›</span><br><span class="line">                + è¿”å›ä¸ºçœŸï¼Œè·å¾—åˆ°äº†é”ï¼Œå‘ä¸‹æ‰§è¡Œä»£ç </span><br><span class="line">            + trylock()å¸¦å‚æ•°</span><br><span class="line">                + ç­‰å¾…è·å–é”æ—¶é—´ï¼Œè¶…æ—¶è¿”å›false</span><br><span class="line">                + å¯è¢«æ‰“æ–­ï¼Œè¿›å…¥æ‰“æ–­å¼‚å¸¸ï¼Œç›´æ¥è¿”å›</span><br><span class="line">            + è§£å†³å“²å­¦å®¶å°±é¤</span><br><span class="line">                + ç­·å­ç»§æ‰¿å¯é‡å…¥é”</span><br><span class="line">                + trylock()</span><br><span class="line">                + æ‹¿ä¸åˆ°é”å°±ç»“æŸï¼Œé‡Šæ”¾æ‰€æœ‰é”</span><br><span class="line">                    + å·¦æ‰‹æ‹¿ä¸åˆ°ç»§ç»­è·å–ï¼Œå³æ‰‹æ‹¿ä¸åˆ°ï¼Œé‡Šæ”¾å·¦æ‰‹é”</span><br><span class="line">        + å…¬å¹³é”</span><br><span class="line">            + é»˜è®¤ä¸å…¬å¹³</span><br><span class="line">            + å…¬å¹³é”ï¼šå…ˆå…¥å…ˆå¾—é”</span><br><span class="line">                + ä¸ºäº†è§£å†³é¥¥é¥¿é—®é¢˜</span><br><span class="line">                    + trylockä¹Ÿå¯ä»¥è§£å†³</span><br><span class="line">                + æ²¡æœ‰å¿…è¦ï¼Œé™ä½å¹¶å‘åº¦</span><br><span class="line">            + éå…¬å¹³é”ï¼šæ²¡è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ä¹Ÿæœ‰æœºä¼šè·å¾—é”</span><br><span class="line">        + æ¡ä»¶å˜é‡</span><br><span class="line">            + æ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡ï¼ˆä¼‘æ¯å®¤ï¼‰ï¼Œå¯ä»¥ç²¾å‡†å”¤é†’</span><br><span class="line">            + æ“ä½œ</span><br><span class="line">                + åˆ›å»ºæ¡ä»¶å˜é‡ï¼ˆä¼‘æ¯å®¤ï¼‰</span><br><span class="line">                + æŒ‡å®šæ¡ä»¶å˜é‡æ‰§è¡Œawaitï¼Œç­‰å¾…</span><br><span class="line">                    + æ—¶é—´å‚æ•°</span><br><span class="line">                + æŒ‡å®šæ¡ä»¶å˜é‡æ‰§è¡Œsignalï¼Œå”¤é†’</span><br><span class="line">                    + å”¤é†’ä¹‹åé‡æ–°ç«äº‰locké”</span><br><span class="line">            + ä½¿ç”¨</span><br><span class="line">            + ä¸çœ‹æºç ï¼Œè‡ªå·±æŠŠæºç æ•²äº†ä¸€éï¼Œçš„ç¡®æœ‰äº›è‡ªå·±ä¸€ç›´æ²¡æ³¨æ„åˆ°çš„åœ°æ–¹</span><br></pre></td></tr></table></figure><h2 id="è®¾è®¡æ¨¡å¼-1"><a href="#è®¾è®¡æ¨¡å¼-1" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">+ åŒæ­¥æ¨¡å¼ä¹‹é¡ºåºæ§åˆ¶ï¼ˆæ§åˆ¶çº¿ç¨‹çš„è¿è¡Œé¡ºåºï¼‰</span><br><span class="line">    + å›ºå®šè¿è¡Œé¡ºåºï¼ˆå…ˆæ‰§è¡Œ2ï¼Œåæ‰§è¡Œ1ï¼‰</span><br><span class="line">        + wait&amp;notify</span><br><span class="line">            + whileæ¡ä»¶åˆ¤æ–­ + waitã€notify</span><br><span class="line">        + await&amp;signal</span><br><span class="line">        + join()</span><br><span class="line">        + park&amp;unpark</span><br><span class="line">            + ç²¾å‡†æš‚åœï¼Œå”¤é†’</span><br><span class="line">                + èƒŒåŒ…å¹²ç²®</span><br><span class="line">            + è‹¥t2å…ˆè¿è¡Œï¼Œt1å¯æ­£å¸¸ç»§ç»­æ‰§è¡Œ</span><br><span class="line">    + äº¤æ›¿è¾“å‡ºï¼ˆæŒ‰abcé¡ºåºäº¤æ›¿è¾“å‡ºï¼‰</span><br><span class="line">        + wait&amp;notify</span><br><span class="line">            + ç­‰å¾…æ ‡è®°ï¼šç”¨æ•´æ•°1ã€2ã€3æ ‡è®°æ¡ä»¶ï¼Œä»£è¡¨æŸä¸ªæ•°å­—å…è®¸æ‰“å°</span><br><span class="line">                + é¢å‘å¯¹è±¡codeï¼Œå¾ˆå¼º</span><br><span class="line">        + await&amp;signal</span><br><span class="line">            + ä¸‰ä¸ªä¸åŒä¼‘æ¯å®¤ï¼ˆæ¡ä»¶å˜é‡ï¼‰</span><br><span class="line">                + è¿›å…¥å½“å‰ä¼‘æ¯å®¤</span><br><span class="line">                + æ‰“å°</span><br><span class="line">                + å”¤é†’ä¸‹ä¸€é—´ä¼‘æ¯å®¤</span><br><span class="line">            + æ‰§è¡Œæµç¨‹</span><br><span class="line">                + ä¸ç®¡è°æŠ¢åˆ°é”ï¼Œéƒ½è¿›å…¥ä¼‘æ¯å®¤</span><br><span class="line">                + åªæœ‰aä¼‘æ¯å®¤è§£é”ï¼Œaæ‰“å°ï¼Œè§£é”bä¼‘æ¯å®¤</span><br><span class="line">                + åªæœ‰bä¼šç»§ç»­è¿è¡Œï¼Œæ‰“å°ï¼Œè§£é”c</span><br><span class="line">            + ä¹‹å‰å·²ç»è¯´è¿‡äº†ï¼Œå¯ä»¥å…ˆå”¤é†’ï¼Œåç­‰å¾…ï¼Œä¸å­˜åœ¨å…¨éƒ¨ç­‰å¾…çš„é—®é¢˜</span><br><span class="line">        + park&amp;unpark</span><br><span class="line">            + ä»¥çº¿ç¨‹ä¸ºå•ä½åœæ­¢ã€æ¢å¤</span><br><span class="line">                + æˆ‘ä¸€ç›´ä»¥ä¸ºæˆ‘å¾ˆæ‡‚é¢å‘å¯¹è±¡ï¼Œå†™çš„å¤ªçƒ‚äº†</span><br><span class="line">            + é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œç¡®å®ç‰›é€¼</span><br><span class="line">            + æµç¨‹</span><br><span class="line">                + æ— è®ºè°æŠ¢åˆ°æ—¶é—´ç‰‡ï¼Œå…¨éƒ¨çº¿ç¨‹park</span><br><span class="line">                + ä¸»çº¿ç¨‹å”¤é†’t1ï¼Œt1çº¿ç¨‹æ‰“å°ï¼Œå”¤é†’t2</span><br><span class="line">                + t2æ‰“å°ï¼Œå”¤é†’t3</span><br></pre></td></tr></table></figure><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">+ çŸ¥è¯†ç‚¹</span><br><span class="line">    + å…±äº«èµ„æºã€ä¸´ç•ŒåŒº</span><br><span class="line">    + synchronize</span><br><span class="line">        + ä¿è¯ä¸´ç•ŒåŒºä»£ç çº¿ç¨‹å®‰å…¨</span><br><span class="line">            + åŸå­æ€§</span><br><span class="line">            + ä¸è‡³äºä¸Šä¸‹æ–‡åˆ‡æ¢äº§ç”Ÿäº¤é”™</span><br><span class="line">        + é”å¯¹è±¡è¯­æ³•</span><br><span class="line">        + æˆå‘˜ã€é™æ€æ–¹æ³•</span><br><span class="line">        + waitã€notifyåŒæ­¥æ–¹æ³•</span><br><span class="line">            + æ¡ä»¶ä¸æ»¡è¶³ç­‰å¾…ï¼Œæ¡ä»¶æ»¡è¶³æ¢å¤è¿è¡Œ</span><br><span class="line">    + reentrantlock</span><br><span class="line">        + å¯æ‰“æ–­ã€é”è¶…æ—¶trylockã€å…¬å¹³é”ã€æ¡ä»¶å˜é‡</span><br><span class="line">    + åˆ†æå˜é‡çº¿ç¨‹å®‰å…¨æ€§ï¼Œå¸¸è§çº¿ç¨‹å®‰å…¨ç±»</span><br><span class="line">    + çº¿ç¨‹æ´»è·ƒæ€§</span><br><span class="line">        + æ­»é”ã€æ´»é”ã€é¥¥é¥¿</span><br><span class="line">+ åº”ç”¨</span><br><span class="line">    + äº’æ–¥</span><br><span class="line">        + synchronizeå’Œlockå…±äº«èµ„æºäº’æ–¥</span><br><span class="line">    + åŒæ­¥</span><br><span class="line">        + wait/notifyã€await/signalçº¿ç¨‹é—´é€šä¿¡æ•ˆæœ</span><br><span class="line">+ åŸç†</span><br><span class="line">    + monitorã€synchronizeã€wait/notify</span><br><span class="line">    + synchronize</span><br><span class="line">        + è½»é‡çº§é”ã€åå‘é”ã€é‡é‡çº§é”</span><br><span class="line">        + é”è†¨èƒ€ã€é”æ¶ˆé™¤ç­‰</span><br><span class="line">    + park&amp;unpark</span><br><span class="line">    + synchronizeå®ç°monitorï¼ŒJVMå±‚é¢ï¼Œc++</span><br><span class="line">    + lockå®ç°monitorï¼Œjavaçº§åˆ«</span><br><span class="line">+ è®¾è®¡æ¨¡å¼</span><br><span class="line">    + åŒæ­¥æ¨¡å¼ä¹‹ä¿æŠ¤æ€§æš‚åœ</span><br><span class="line">        + çº¿ç¨‹ä¹‹é—´è·å¾—ç»“æœï¼Œä¸€ä¸€å¯¹åº”</span><br><span class="line">    + å¼‚æ­¥æ¨¡å¼ä¹‹ç”Ÿäº§è€…æ¶ˆè´¹è€…</span><br><span class="line">        + ç”Ÿäº§æ¶ˆè´¹ä¸æ˜¯ä¸€ä¸€å¯¹åº”å…³ç³»</span><br><span class="line">    + åŒæ­¥æ¨¡å¼ä¹‹é¡ºåºæ§åˆ¶</span><br><span class="line">        + æ§åˆ¶çº¿ç¨‹æ‰§è¡Œå…ˆåæ¬¡åºã€äº¤æ›¿è¿è¡Œ</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘</summary>
    
    
    
    <category term="å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘" scheme="https://fireonice.github.io/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91/"/>
    
    
    <category term="å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘" scheme="https://fireonice.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘â€”â€”çº¿ç¨‹åŸç†&amp;æ ˆå¸§&amp;ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼</title>
    <link href="https://fireonice.github.io/2022/03/14/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91-%E7%BA%BF%E7%A8%8B%E5%8E%9F%E7%90%86&amp;%E6%A0%88%E5%B8%A7&amp;%E4%B8%A4%E9%98%B6%E6%AE%B5%E7%BB%88%E6%AD%A2%E6%A8%A1%E5%BC%8F/"/>
    <id>https://fireonice.github.io/2022/03/14/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91-%E7%BA%BF%E7%A8%8B%E5%8E%9F%E7%90%86&amp;%E6%A0%88%E5%B8%A7&amp;%E4%B8%A4%E9%98%B6%E6%AE%B5%E7%BB%88%E6%AD%A2%E6%A8%A1%E5%BC%8F/</id>
    <published>2022-03-14T14:24:34.325Z</published>
    <updated>2022-03-15T04:46:30.491Z</updated>
    
    <content type="html"><![CDATA[<h1 id="è¿›ç¨‹ä¸çº¿ç¨‹"><a href="#è¿›ç¨‹ä¸çº¿ç¨‹" class="headerlink" title="è¿›ç¨‹ä¸çº¿ç¨‹"></a>è¿›ç¨‹ä¸çº¿ç¨‹</h1><h2 id="è¿›ç¨‹ä¸çº¿ç¨‹-1"><a href="#è¿›ç¨‹ä¸çº¿ç¨‹-1" class="headerlink" title="è¿›ç¨‹ä¸çº¿ç¨‹"></a>è¿›ç¨‹ä¸çº¿ç¨‹</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">+ è¿›ç¨‹</span><br><span class="line">    + åŠ è½½æŒ‡ä»¤ã€ç®¡ç†å†…å­˜ã€ç®¡ç†io</span><br><span class="line">    + ç¨‹åºçš„ä¸€ä¸ªå®ä¾‹</span><br><span class="line">    + javaä¸­èµ„æºåˆ†é…çš„æœ€å°å•ä½</span><br><span class="line">+ çº¿ç¨‹</span><br><span class="line">    + ä¸€ä¸ªæŒ‡ä»¤æµ</span><br><span class="line">    + ä¸€ä¸ªè¿›ç¨‹å†…å¤šä¸ªçº¿ç¨‹</span><br><span class="line">    + javaä¸­æœ€å°è°ƒåº¦å•ä½</span><br><span class="line">+ å¯¹æ¯”</span><br><span class="line">    + è¿›ç¨‹åŸºæœ¬ç›¸äº’ç‹¬ç«‹ï¼Œçº¿ç¨‹å­˜åœ¨äºè¿›ç¨‹ä¸­</span><br><span class="line">    + è¿›ç¨‹é€šä¿¡å¤æ‚</span><br><span class="line">        + ä¸åŒè®¡ç®—æœºè¿›ç¨‹é€šä¿¡ï¼Œhttpåè®®ç­‰</span><br><span class="line">    + çº¿ç¨‹é€šä¿¡ç®€å•</span><br><span class="line">        + å…±äº«è¿›ç¨‹å†…çš„å†…å­˜ï¼Œæ•°æ®</span><br><span class="line">    + çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬ä½</span><br></pre></td></tr></table></figure><h2 id="å¹¶è¡Œå¹¶å‘çš„æ¦‚å¿µ"><a href="#å¹¶è¡Œå¹¶å‘çš„æ¦‚å¿µ" class="headerlink" title="å¹¶è¡Œå¹¶å‘çš„æ¦‚å¿µ"></a>å¹¶è¡Œå¹¶å‘çš„æ¦‚å¿µ</h2><p>å¹¶å‘</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220314230324615.png" alt="å¹¶å‘"></p><p>å¹¶è¡Œ</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220314230509268.png" alt="å¹¶è¡Œ"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">å¹¶å‘ï¼š åŒä¸€æ—¶é—´æ®µï¼Œå¤šä¸ªä»»åŠ¡éƒ½åœ¨æ‰§è¡Œ (å•ä½æ—¶é—´å†…ä¸ä¸€å®šåŒæ—¶æ‰§è¡Œ)</span><br><span class="line">å¹¶è¡Œï¼š å•ä½æ—¶é—´å†…ï¼Œå¤šä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œ</span><br><span class="line">+ å¹¶å‘</span><br><span class="line">    + åŒä¸€æ—¶é—´çº¿ç¨‹è½®æµä½¿ç”¨cpu</span><br><span class="line">        + concurrent</span><br><span class="line">    + å•æ ¸cpuä¸‹</span><br><span class="line">        + å®é™…ä¸²è¡Œæ‰§è¡Œ</span><br><span class="line">        + cpuæ—¶é—´ç‰‡è½®æµæ‰§è¡Œ</span><br><span class="line">        + å®è§‚ä¸Šå¹¶è¡Œ</span><br><span class="line">+ å¹¶è¡Œ</span><br><span class="line">    + å¤šæ ¸cpuä¸‹</span><br><span class="line">        + æ¯ä¸ªæ ¸åŒæ—¶è°ƒåº¦è¿è¡Œçº¿ç¨‹</span><br><span class="line">+ å¹¶å‘å’Œå¹¶è¡Œéƒ½æœ‰</span><br><span class="line">    + å¹¶å‘ï¼šåŒä¸€æ—¶é—´åº”å¯¹å¤šä»¶äº‹</span><br><span class="line">    + å¹¶è¡Œï¼šåŒä¸€æ—¶é—´åŠ¨æ‰‹åšå¤šä»¶äº‹</span><br></pre></td></tr></table></figure><h2 id="çº¿ç¨‹åº”ç”¨"><a href="#çº¿ç¨‹åº”ç”¨" class="headerlink" title="çº¿ç¨‹åº”ç”¨"></a>çº¿ç¨‹åº”ç”¨</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+ å¼‚æ­¥async</span><br><span class="line">    + ä¸éœ€è¦ç­‰å¾…ç»“æœè¿”å›ï¼Œç»§ç»­è¿è¡Œ</span><br><span class="line">    + ç‰¹ç‚¹</span><br><span class="line">    + çº¿ç¨‹ä¸åŒ</span><br><span class="line">        + é¿å…é˜»å¡ä¸»çº¿ç¨‹</span><br><span class="line">        + æé«˜ååé‡</span><br><span class="line">+ æé«˜æ•ˆç‡</span><br><span class="line">+ åˆ†å¸ƒå¼çš„è¿œç¨‹è°ƒç”¨ä¸€èˆ¬éƒ½æ˜¯å¼‚æ­¥è°ƒï¼ŒèŠ‚çœæ€»å“åº”æ—¶é—´</span><br><span class="line">    + å–å†³æœ€é•¿æ—¶é—´</span><br><span class="line">    + å¤šæ ¸ä¸‹</span><br><span class="line">        + ä»»åŠ¡æ‹†åˆ†ã€å¹¶è¡Œæ‰§è¡Œ</span><br><span class="line">    + éé˜»å¡ioå’Œå¼‚æ­¥ioä¼˜åŒ–</span><br></pre></td></tr></table></figure><h1 id="Javaçº¿ç¨‹"><a href="#Javaçº¿ç¨‹" class="headerlink" title="Javaçº¿ç¨‹"></a>Javaçº¿ç¨‹</h1><h2 id="åˆ›å»ºçº¿ç¨‹"><a href="#åˆ›å»ºçº¿ç¨‹" class="headerlink" title="åˆ›å»ºçº¿ç¨‹"></a>åˆ›å»ºçº¿ç¨‹</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">+ åˆ›å»ºå’Œè¿è¡Œçº¿ç¨‹</span><br><span class="line">+ 1ã€ç›´æ¥ä½¿ç”¨Thread</span><br><span class="line">    + 2ã€ä½¿ç”¨Runnableé…åˆThread</span><br><span class="line">        + æŠŠçº¿ç¨‹å’Œä»»åŠ¡åˆ†</span><br><span class="line">    + lambdaç®€åŒ–</span><br><span class="line">        + ideaæ™ºèƒ½æ›¿æ¢</span><br><span class="line">            + èƒ½ç®€åŒ–çš„ï¼Œideaä¼šæœ‰ç°è‰²æç¤º</span><br><span class="line">    + æ–¹æ³•1ã€2</span><br><span class="line">        + èµ°çš„éƒ½æ˜¯run()æ–¹æ³•</span><br><span class="line">        + runnableä¸çº¿ç¨‹æ± ç­‰é…åˆ</span><br><span class="line">        + è„±ç¦»ä»»åŠ¡å’Œçº¿ç¨‹ç»§æ‰¿ä½“ç³»</span><br><span class="line">    + 3ã€FutureTaské…åˆThread</span><br><span class="line">        + å¯ä»¥è¿”å›ä»»åŠ¡æ‰§è¡Œç»“æœ</span><br><span class="line">            + return + get</span><br><span class="line">        + å‚æ•°ï¼šæ³›å‹ + callableæ¥å£</span><br><span class="line">        + get()</span><br><span class="line">            + é˜»å¡ç­‰å¾…ç»“æœè¿”å›</span><br></pre></td></tr></table></figure><h2 id="çº¿ç¨‹è¿è¡Œ"><a href="#çº¿ç¨‹è¿è¡Œ" class="headerlink" title="çº¿ç¨‹è¿è¡Œ"></a>çº¿ç¨‹è¿è¡Œ</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+ çº¿ç¨‹è¿è¡Œ</span><br><span class="line">    + ç°è±¡</span><br><span class="line">+ æŸ¥çœ‹å’Œæ€æ­»</span><br><span class="line">        + windows</span><br><span class="line">        + linux</span><br><span class="line">        + jconsole</span><br></pre></td></tr></table></figure><h2 id="çº¿ç¨‹è¿è¡ŒåŸç†"><a href="#çº¿ç¨‹è¿è¡ŒåŸç†" class="headerlink" title="çº¿ç¨‹è¿è¡ŒåŸç†"></a>çº¿ç¨‹è¿è¡ŒåŸç†</h2><p>æ ˆå¸§å›¾è§£</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220314230549515.png" alt="æ ˆå¸§åŸç†"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">+ çº¿ç¨‹è¿è¡ŒåŸç†</span><br><span class="line">    + æ ˆä¸æ ˆå¸§</span><br><span class="line">        + æ ˆå¸§Frame</span><br><span class="line">            + çº¿ç¨‹ä¸­æ–¹æ³•çš„è°ƒç”¨</span><br><span class="line">        + æ ˆå¸§å›¾è§£</span><br><span class="line">            + ç¨‹åºè¿è¡Œ</span><br><span class="line">                + ç±»åŠ è½½</span><br><span class="line">                + å¯åŠ¨ä¸»çº¿ç¨‹ï¼Œæ ˆå†…å­˜</span><br><span class="line">                    + æ‰§è¡Œmainæ–¹æ³•ï¼Œåˆ†é…æ ˆå¸§å†…å­˜</span><br><span class="line">                        + å±€éƒ¨å˜é‡è¡¨ï¼ˆargsã€å˜é‡ï¼‰</span><br><span class="line">                        + è¿”å›åœ°å€</span><br><span class="line">                    + æ‰§è¡Œmethod1ï¼Œåˆ†é…æ ˆå¸§å†…å­˜</span><br><span class="line">                    + æ‰§è¡Œmethod2ï¼Œåˆ†é…æ ˆå¸§å†…å­˜ </span><br><span class="line">                        + å †ä¸­åˆ›å»ºå¯¹è±¡</span><br><span class="line">                    + æ‰§è¡Œå®Œæ¯•ï¼Œé‡Šæ”¾æ ˆå¸§å†…å­˜</span><br><span class="line">        + å¤šçº¿ç¨‹æƒ…å†µ</span><br><span class="line">            + æ–­ç‚¹æ¨¡å¼</span><br><span class="line">                + å¯ä»¥æ§åˆ¶æ¯ä¸ªçº¿ç¨‹å‰è¿›</span><br><span class="line">            + çº¿ç¨‹æ ˆä¹‹é—´ç‹¬ç«‹ï¼Œç‹¬ç«‹çš„æ ˆå†…å­˜</span><br><span class="line">    + çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</span><br><span class="line">        + cpuè½¬å»æ‰§è¡Œå¦ä¸€ä¸ªçº¿ç¨‹</span><br><span class="line">        + åˆ‡æ¢äº§ç”ŸåŸå› </span><br><span class="line">            + cpuæ—¶é—´ç‰‡ç”¨å®Œ</span><br><span class="line">            + åƒåœ¾å›æ”¶</span><br><span class="line">            + æ›´é«˜ä¼˜å…ˆçº§çº¿ç¨‹</span><br><span class="line">            + çº¿ç¨‹è°ƒç”¨ä¸€äº›æ–¹æ³•</span><br><span class="line">        + è®°å½•å½“å‰çº¿ç¨‹çŠ¶æ€</span><br><span class="line">            + ç¨‹åºè®¡æ•°å™¨</span><br><span class="line">            + æ ˆå¸§ä¿¡æ¯ã€å±€éƒ¨å˜é‡ã€è¿”å›åœ°å€ç­‰</span><br><span class="line">        + é¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢å½±å“æ€§èƒ½</span><br></pre></td></tr></table></figure><h2 id="å¸¸è§æ–¹æ³•"><a href="#å¸¸è§æ–¹æ³•" class="headerlink" title="å¸¸è§æ–¹æ³•"></a>å¸¸è§æ–¹æ³•</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">+ çº¿ç¨‹å¸¸è§æ–¹æ³•</span><br><span class="line">    + start()</span><br><span class="line">        + çº¿ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€</span><br><span class="line">    + run()</span><br><span class="line">        + çº¿ç¨‹å¯åŠ¨åè°ƒç”¨</span><br><span class="line">    + join()</span><br><span class="line">        + ç­‰å¾…çº¿ç¨‹è¿è¡Œç»“æŸ</span><br><span class="line">        + è¶…æ—¶æ—¶é—´</span><br><span class="line">    ...</span><br><span class="line">+ start å’Œ run</span><br><span class="line">    + è°ƒç”¨run()åªæ˜¯æ™®é€šè°ƒç”¨æ–¹æ³•</span><br><span class="line">    + æœªåˆ›å»ºçº¿ç¨‹</span><br><span class="line">    + è€ŒrunçœŸæ­£çš„æ„ä¹‰æ˜¯å½“çº¿ç¨‹startè¿›å…¥å°±ç»ªæ€åè¢«è°ƒåº¦è·å¾—æ—¶é—´ç‰‡æ—¶æ‰§è¡Œrunæ–¹æ³•ç”±å°±ç»ªæ€è¿›å…¥è¿è¡Œæ€</span><br><span class="line">    + è¿™é‡Œæ„Ÿè§‰t1.start()æ–¹æ³•ååŠ ä¸ªt1.joinï¼ˆï¼‰ä¿è¯t1çº¿ç¨‹æ‰§è¡Œå®Œæ‰æ‰“å°æ›´åˆç†äº›ï¼Œè€Œä¸”çŠ¶æ€æ˜¯TERMINATEDã€‚è€Œè¿è¡Œæ—¶çŠ¶æ€åº”è¯¥åœ¨runï¼ˆï¼‰æ–¹æ³•ä¸­æ‰“å°</span><br><span class="line">    + startä¸èƒ½å¤šæ¬¡è°ƒç”¨</span><br><span class="line">        + å˜æˆrunnableå°±ä¸èƒ½è°ƒç”¨start</span><br><span class="line">+ sleep()ä¸yield</span><br><span class="line">    + sleep()</span><br><span class="line">        + runningçŠ¶æ€å˜æˆTIMED_WAITINGï¼šé˜»å¡</span><br><span class="line">        + interruptæ‰“æ–­ç¡çœ </span><br><span class="line">            + ç¡çœ çº¿ç¨‹æŠ›å‡ºå¼‚å¸¸æ‰§è¡Œcatch</span><br><span class="line">        + ç¡çœ ç»“æŸæœªå¿…ç«‹å³æ‰§è¡Œï¼Œéœ€è¦cpuä½¿ç”¨æƒ</span><br><span class="line">        + å¯è¯»æ€§</span><br><span class="line">            + TimeUnitçš„sleepï¼Œé™„å¸¦æ—¶é—´å•ä½</span><br><span class="line">    + yield()</span><br><span class="line">        + ä»runningå˜æˆrunnableå°±ç»ª</span><br><span class="line">        + è®©å‡ºcpuä½¿ç”¨æƒï¼Œæœ‰æœºä¼šç«‹å³è·å¾—æ—¶é—´ç‰‡</span><br><span class="line">+ çº¿ç¨‹ä¼˜å…ˆçº§</span><br><span class="line">    + setPriority()</span><br><span class="line">+ sleepåº”ç”¨</span><br><span class="line">    + while(true)</span><br><span class="line">    + åŠ ä¸Šsleep</span><br><span class="line">        + é¿å…ç©ºè½¬å æ»¡cpu</span><br><span class="line">+ join()</span><br><span class="line">    + çº¿ç¨‹.join()</span><br><span class="line">        + ç­‰å¾…æŸçº¿ç¨‹è¿è¡Œç»“æŸ</span><br><span class="line">    + åŒæ­¥åº”ç”¨</span><br><span class="line">        + åŒæ­¥ï¼šéœ€è¦ç­‰å¾…è¿”å›ç»“æœ</span><br><span class="line">    + é™æ—¶åŒæ­¥ï¼šå‚æ•°</span><br><span class="line">        + æœ€é•¿ç­‰å¾…æ—¶é—´</span><br><span class="line">+ interrupt()</span><br><span class="line">    + æ‰“æ–­é˜»å¡çº¿ç¨‹ï¼šsleepã€waitã€join</span><br><span class="line">        + æŠ›å‡ºInterruptedå¼‚å¸¸</span><br><span class="line">        + æ‰“æ–­æ ‡è®°è®¾ä¸ºfalse</span><br><span class="line">    + æ‰“æ–­æ­£å¸¸</span><br><span class="line">        + æ‰“æ–­æ ‡è®°ä¸ºtrue</span><br><span class="line">            + ç¨‹åºä¸ç»“æŸ</span><br><span class="line">            + æ ¹æ®æ‰“æ–­æ ‡è®°å¯ä»¥ä¸»åŠ¨ç»“æŸçº¿ç¨‹</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ è¿‡æ—¶æ–¹æ³•</span><br><span class="line">    + é€ æˆæ­»é”</span><br><span class="line">+ å®ˆæŠ¤çº¿ç¨‹</span><br><span class="line">    + å½“éå®ˆæŠ¤çº¿ç¨‹éƒ½ç»“æŸï¼Œå®ˆæŠ¤çº¿ç¨‹å¼ºåˆ¶ç»“æŸ</span><br><span class="line">    + åƒåœ¾å›æ”¶çº¿ç¨‹</span><br></pre></td></tr></table></figure><h2 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h2><p>interruptå®ç°</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220314230843538.png" alt="image-20220314230843538"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">+ ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼</span><br><span class="line">    + é”™è¯¯æ€è·¯</span><br><span class="line">        + stop()</span><br><span class="line">            + å¼ºåˆ¶æ€æ­»ï¼Œé”èµ„æºæ— æ³•é‡Šæ”¾</span><br><span class="line">    + interruptå®ç°</span><br><span class="line">        + sleepä¸­è¢«æ‰“æ–­</span><br><span class="line">            + æŠ›å‡ºå¼‚å¸¸ï¼Œæ‰§è¡Œcatchè¯­å¥ï¼Œç»§ç»­è¿è¡Œ</span><br><span class="line">                + æ‰‹åŠ¨æ‰“æ–­ï¼Œè®¾ç½®æ‰“æ–­æ ‡è®°ä¸ºçœŸ</span><br><span class="line">            + è¿™é‡Œä¸ºä»€ä¹ˆè¿˜èƒ½è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯ï¼Ÿæ˜¯å› ä¸ºcatchè¿™é‡Œä¼šå¤„ç†å¼‚å¸¸ï¼Œè€Œä¸æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼ŒæŠ›å‡ºå¼‚å¸¸æ‰ä¼šå¯¼è‡´çº¿ç¨‹ç»ˆæ­¢ï¼è¿™é‡Œæ‰“å°çº¢è‰²å¼‚å¸¸ä¿¡æ¯ä¸ä¼šå¯¼è‡´çº¿ç¨‹ç»ˆæ­¢</span><br><span class="line">        + ésleepæ—¶è¢«æ‰“æ–­ï¼Œè®¾ç½®æ‰“æ–­æ ‡è®°æœªçœŸ</span><br><span class="line">            + ç»“æŸå¾ªç¯</span><br><span class="line">    + interruptç»†èŠ‚</span><br><span class="line">        + interrupted()ä¼šæ¸…é™¤æ‰“æ–­æ ‡è®°</span><br><span class="line">+ interruptæ‰“æ–­parkçº¿ç¨‹ </span><br><span class="line">    + parkæš‚åœ</span><br><span class="line">        + æ‰“æ–­æ ‡è®°ä¸ºfalseæ—¶æš‚åœ</span><br><span class="line">        + interruptå¯æ‰“æ–­parkçº¿ç¨‹</span><br></pre></td></tr></table></figure><h2 id="çº¿ç¨‹çŠ¶æ€"><a href="#çº¿ç¨‹çŠ¶æ€" class="headerlink" title="çº¿ç¨‹çŠ¶æ€"></a>çº¿ç¨‹çŠ¶æ€</h2><p>çº¿ç¨‹çŠ¶æ€</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220314230908950.png" alt="image-20220314230908950"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">+ äº”ç§çŠ¶æ€</span><br><span class="line">    + åˆå§‹çŠ¶æ€</span><br><span class="line">        + åˆ›å»ºçº¿ç¨‹å¯¹è±¡</span><br><span class="line">+ å¯è¿è¡ŒçŠ¶æ€    </span><br><span class="line">        + çº¿ç¨‹å·²è¢«åˆ›å»ºï¼Œå¯è°ƒåº¦æ‰§è¡Œ</span><br><span class="line">    + è¿è¡ŒçŠ¶æ€</span><br><span class="line">        + è·å–cpuæ—¶é—´ç‰‡</span><br><span class="line">    + é˜»å¡çŠ¶æ€</span><br><span class="line">        + è°ƒç”¨é˜»å¡API</span><br><span class="line">    + ç»ˆæ­¢çŠ¶æ€</span><br><span class="line">        + çº¿ç¨‹æ‰§è¡Œå®Œæ¯•</span><br><span class="line">+ å…­ç§çŠ¶æ€ï¼šæ ¹æ®Thread.State</span><br><span class="line">    + new</span><br><span class="line">        + åˆ›å»ºå¯¹è±¡</span><br><span class="line">    + runnable</span><br><span class="line">        + åŒ…æ‹¬å¯è¿è¡Œã€è¿è¡Œã€é˜»å¡çŠ¶æ€</span><br><span class="line">    + terminated</span><br><span class="line">        + ç»ˆæ­¢çŠ¶æ€</span><br><span class="line">    + java APIå±‚é¢çš„é˜»å¡</span><br><span class="line">        + blocked</span><br><span class="line">            + æ‹¿ä¸åˆ°é”</span><br><span class="line">        + waiting</span><br><span class="line">            + join()</span><br><span class="line">        + timed waiting</span><br><span class="line">            + sleep()</span><br><span class="line">+ å…­ç§çŠ¶æ€æ¼”ç¤º</span><br><span class="line">    + sleepä¸ä¼šé‡Šæ”¾é”ï¼Œåªä¼šé‡Šæ”¾cpuèµ„æºï¼›waitæ—¢ä¼šé‡Šæ”¾CPUåˆä¼šé‡Šæ”¾é”èµ„æº</span><br><span class="line">    + æ‹¿ä¸åˆ°é”ï¼Œblocked</span><br></pre></td></tr></table></figure><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">+ å°ç»“</span><br><span class="line">    + çº¿ç¨‹åˆ›å»º</span><br><span class="line">        + 3ç§</span><br><span class="line">    + api</span><br><span class="line">        + join</span><br><span class="line">        + interrupt</span><br><span class="line">    + çº¿ç¨‹çŠ¶æ€</span><br><span class="line">        + äº”ç§</span><br><span class="line">        + å…­ç§</span><br><span class="line">    + åº”ç”¨</span><br><span class="line">        + å¼‚æ­¥è°ƒç”¨</span><br><span class="line">        + åŒæ­¥ç­‰å¾…join</span><br><span class="line">        + å¼‚æ­¥ç¼–æ’</span><br><span class="line">    + åŸç†</span><br><span class="line">        + è¿è¡Œæµç¨‹</span><br><span class="line">            + æ ˆã€æ ˆå¸§</span><br><span class="line">            + ä¸Šä¸‹æ–‡åˆ‡æ¢</span><br><span class="line">            + ç¨‹åºè®¡æ•°å™¨</span><br><span class="line">        + åˆ›å»ºæºç </span><br><span class="line">    + è®¾è®¡æ¨¡å¼</span><br><span class="line">        + ä¸¤é˜¶æ®µç»ˆæ­¢interrupt</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘</summary>
    
    
    
    <category term="å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘" scheme="https://fireonice.github.io/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91/"/>
    
    
    <category term="å¤šçº¿ç¨‹ä¸é«˜å¹¶å‘" scheme="https://fireonice.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>äº‘åŸç”Ÿå®æˆ˜</title>
    <link href="https://fireonice.github.io/2022/03/12/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AE%9E%E6%88%98/"/>
    <id>https://fireonice.github.io/2022/03/12/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AE%9E%E6%88%98/</id>
    <published>2022-03-12T08:08:12.262Z</published>
    <updated>2022-03-12T09:12:36.921Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312161918939.png" alt="image-20220312161918939"></p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312161936438.png" alt="image-20220312161936438"></p><ul><li><p>å®¹å™¨åŒ–ç›¸æ¯”è™šæ‹ŸåŒ–</p><ul><li><p>åŒä¸€æ ‡å‡†</p><ul><li><p>åº”ç”¨æ— è®ºä»€ä¹ˆè¯­è¨€åŒä¸€æ„å»ºæˆé•œåƒ</p></li><li><p>é•œåƒåˆ†äº«ä»“åº“</p></li><li><p>å®¹å™¨åŒ–æ—¶ä»£</p><ul><li>è™šæ‹ŸåŒ–æŠ€æœ¯</li><li>å®¹å™¨åŒ–æŠ€æœ¯</li></ul></li></ul></li><li><p>èµ„æºéš”ç¦»</p><ul><li>èµ„æºéš”ç¦»</li><li>è®¿é—®è®¾å¤‡éš”ç¦»</li><li>ç½‘ç»œéš”ç¦»</li><li>ç”¨æˆ·éš”ç¦»</li></ul></li></ul></li></ul><ul><li><p>dockeræ¶æ„</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/1624937894925-f437bd98-94e2-4334-9657-afa69bb52179.svg" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/1625373590853-2aaaa76e-d5b5-446b-850a-f6cfa26ac70a.png" alt="image.png"></p></li><li><p>æ“ä½œ</p></li></ul><ul><li><p>é•œåƒæ“ä½œ</p><ul><li>docker hubä»“åº“</li></ul></li><li><p>å®¹å™¨æ“ä½œ</p><ul><li><p>å¤–éƒ¨æ“ä½œ</p></li><li><p>å†…éƒ¨æ“ä½œ</p><ul><li>çœ‹é•œåƒä»“åº“å®˜ç½‘</li></ul></li></ul></li><li><p>æ‰“åŒ…é•œåƒå˜åŒ–</p><ul><li>docker commit</li></ul></li><li><p>é•œåƒä¿å­˜</p><ul><li>docker save</li><li>ä¿å­˜ä¸ºå‹ç¼©åŒ…æ–‡ä»¶</li></ul></li><li><p>é•œåƒåŠ è½½</p><ul><li>docker load</li><li>è¯»å–å‹ç¼©åŒ…ä¸ºé•œåƒ</li></ul></li><li><p>é•œåƒæ¨é€</p><ul><li>loginï¼šç™»å½•ä»“åº“</li><li>tagï¼šæ”¹åï¼Œå¸¦ä¸Šè‡ªå·±çš„ä»“åº“å</li><li>pushï¼šæ¨é€é•œåƒ</li></ul></li><li><p>æŒ‚è½½</p><ul><li>ä¿è¯å¤–éƒ¨æœ‰é…ç½®æ–‡ä»¶</li><li>æå‰cpå‡ºæ¥æ–‡ä»¶</li></ul></li><li><p>å…¶ä»–å‘½ä»¤</p><ul><li><p>docker logs å®¹å™¨</p><ul><li>å®¹å™¨æ—¥å¿—</li></ul></li><li><p>docker cp</p><ul><li>å®¹å™¨å¤åˆ¶åˆ°æœ¬åœ°</li><li>æœ¬åœ°å¤åˆ¶åˆ°å®¹å™¨</li></ul></li></ul></li><li><p>æ„å»ºåº”ç”¨</p></li></ul><ul><li><p>ä»¥å‰</p><ul><li>springbootæ‰“åŒ…</li><li>jaråŒ…ä¸Šä¼ æœåŠ¡å™¨ï¼ˆç¯å¢ƒï¼‰</li><li>è¿è¡ŒjaråŒ…</li></ul></li><li><p>ç°åœ¨</p><ul><li><p>æ‰“åŒ…é•œåƒï¼Œå¯åŠ¨å³ç”¨</p></li><li><p>ç¼–å†™docker fileï¼ˆå¦‚ä½•æ‰“åŒ…ï¼‰</p><ul><li><p>fromï¼šåŸºç¡€é•œåƒ</p><ul><li>è¿è¡Œç¯å¢ƒ</li></ul></li><li><p>labelï¼šä½œè€…</p></li><li><p>copyï¼šæŠŠjaråŒ…å¤åˆ¶åˆ°å®¹å™¨ä¸­ä½ç½®</p></li><li><p>entrypointï¼šå¯åŠ¨å‘½ä»¤</p><ul><li>java -jar xx</li></ul><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312162555498.png" alt="image-20220312162555498"></p></li></ul></li><li><p>ä¸Šä¼ åˆ°linuxè¿è¡Œæ‰“åŒ…</p><ul><li>docker file + jaråŒ…</li><li>docker build<ul><li>tagï¼šé•œåƒå</li><li>å½“å‰ç›®å½•å·¥ä½œ</li></ul></li></ul></li><li><p>å¯åŠ¨å®¹å™¨åº”ç”¨</p></li><li><p>docker logs xx æŸ¥çœ‹æ—¥å¿—</p></li></ul></li><li><p>åº”ç”¨åˆ†äº«ä¸å¯åŠ¨</p><ul><li>tag</li><li>push</li><li>pull</li></ul></li></ul><h1 id="k8s"><a href="#k8s" class="headerlink" title="k8s"></a>k8s</h1><ul><li><p>ç»„ç»‡æ¶æ„</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/1625452728905-e72041a2-cf1b-4b24-a327-7f0c3974a931.png" alt="image.png"></p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312163709410.png" alt="image-20220312163709410"></p></li><li><p>k8sé›†ç¾¤éƒ¨ç½²</p><ul><li>ä¸‰ä¸ªæœåŠ¡å™¨</li><li>å®‰è£…dockerå®¹å™¨ç¯å¢ƒ</li><li>k8s<ul><li>kubeletã€kubeadmã€kubectl</li></ul></li><li>kubeadmå¯åŠ¨é›†ç¾¤<ul><li>master</li><li>worker</li><li>dashboardé¡µé¢</li></ul></li></ul></li><li><p>æ ¸å¿ƒå®æˆ˜</p><ul><li><p>namespace</p><ul><li>éš”ç¦»èµ„æº</li></ul><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312163739852.png" alt="image-20220312163739852"></p></li><li><p>pod</p><ul><li><p>ä¸€ç»„å®¹å™¨</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312163750025.png" alt="image-20220312163750025"></p></li><li><p>åˆ›å»ºpod</p><ul><li>å‘½ä»¤è¡Œ</li><li>é…ç½®æ–‡ä»¶<ul><li>apply -f</li></ul></li></ul></li></ul></li><li><p>podç½‘ç»œip</p><ul><li>é›†ç¾¤å†…å…¬å…±è®¿é—®</li></ul></li><li><p>å¤šå®¹å™¨pod</p><ul><li>å…±äº«podç½‘ç»œ</li><li>ç«¯å£ä¸åŒå³å¯éƒ¨ç½²å¤šä¸ªç›¸åŒåº”ç”¨</li></ul></li><li><p>deploymentéƒ¨ç½²</p><ul><li><p>æ§åˆ¶pod</p><ul><li>è‡ªæ„ˆ</li><li>å¤šå‰¯æœ¬</li></ul></li><li><p>æ‰©ç¼©å®¹</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312163803222.png" alt="image-20220312163803222"></p></li><li><p>è‡ªæ„ˆ&amp;æ•…éšœè½¬ç§»</p></li><li><p>é˜ˆå€¼è®¾ç½®</p></li><li><p>æ»šåŠ¨æ›´æ–°</p><ul><li>setæ–°é•œåƒè‡ªåŠ¨æ»šåŠ¨æ›´æ–°</li><li>ä¸åœæœºæ›´æ–°</li></ul><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312163809935.png" alt="image-20220312163809935"></p></li><li><p>ç‰ˆæœ¬å›é€€</p><ul><li>rollout<ul><li>history<ul><li>æŸ¥çœ‹å†å²éƒ¨ç½²</li></ul></li><li>undo<ul><li>å›é€€</li></ul></li></ul></li></ul></li><li><p>å·¥ä½œè´Ÿè½½ï¼šæ§åˆ¶pod</p><ul><li>æœ‰çŠ¶æ€ã€æ— çŠ¶æ€</li><li>å®ˆæŠ¤è¿›ç¨‹</li><li>ä»»åŠ¡ç­‰</li></ul><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312163840752.png" alt="image-20220312163840752"></p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312163820457.png" alt="image-20220312163820457"></p></li></ul></li></ul></li><li><p>æœåŠ¡ç½‘æ ¼</p><ul><li><p>service</p><ul><li>æš´éœ²ï¼šå°†ä¸€ç»„podå…¬å¼€ä¸ºç½‘ç»œæœåŠ¡</li><li>è‡ªå¸¦è´Ÿè½½å‡è¡¡</li><li>é›†ç¾¤å†…ipã€åŸŸåè®¿é—®</li><li>æœåŠ¡æš´éœ²<ul><li>clusterIP<ul><li>åªèƒ½é›†ç¾¤å†…è®¿é—®</li></ul></li><li>NodePort<ul><li>é›†ç¾¤å¤–ä¹Ÿå¯ä»¥è®¿é—®ï¼ˆæ¯ä¸ªèŠ‚ç‚¹ï¼‰</li><li>éšæœºåˆ†é…ç«¯å£ï¼ˆ3ä¸‡ä»¥ä¸Šï¼‰</li><li>nodeportâ€”â€”targetportâ€”â€”containerport</li></ul></li></ul></li></ul></li><li><p>ingress</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312163902230.png" alt="image-20220312163902230"></p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312163909266.png" alt="image-20220312163909266"></p><ul><li><p>é›†ç¾¤ç»Ÿä¸€ç½‘å…³å…¥å£</p></li><li><p>ingressç½‘ç»œæ¨¡å‹</p><ul><li>åº•å±‚nginx</li><li>ingressæ¥æ”¶è¯·æ±‚è½¬å‘åˆ°ä¸åŒservice<ul><li>æ¯ä¸ªæ¨¡å—æœåŠ¡æŠ½å–ä¸ºservice<ul><li>serviceå±‚ç½‘ç»œ</li></ul></li></ul></li></ul></li><li><p>è·¯å¾„é‡å†™</p></li><li><p>é™æµ</p></li></ul></li><li><p>ç½‘ç»œæ¨¡å‹æ€»ç»“</p><ul><li>podå±‚ï¼Œç»„åˆå®¹å™¨</li><li>serviceå±‚ï¼Œè´Ÿè½½å‡è¡¡pod</li><li>ingresså±‚ï¼Œè·¯ç”±service</li></ul><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312163919837.png" alt="image-20220312163919837"></p></li></ul></li><li><p>å­˜å‚¨æŠ½è±¡</p><ul><li><p>æ•°æ®æŒ‚è½½å±‚åŒä¸€ç®¡ç†ä¸ºå­˜å‚¨å±‚</p><ul><li><p>å¤šç§å­˜å‚¨æ¡†æ¶</p><ul><li><p>NFS</p><ul><li><p>clientèŠ‚ç‚¹åŒæ­¥serverèŠ‚ç‚¹æ•°æ®</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312163928292.png" alt="image-20220312163928292"></p></li></ul></li></ul></li><li><p>æ­å»ºNFSç¯å¢ƒ</p></li><li><p>deployæ•°æ®å·æŒ‚è½½</p><ul><li><p>åŸç”Ÿæ–¹å¼</p><ul><li>åˆ›å»ºæ–‡ä»¶å¤¹</li><li>é…ç½®deployæ–‡ä»¶</li></ul></li><li><p>PVä¸PVC</p><ul><li><p>PVæŒä¹…å·ï¼šæŒ‡å®šä¿å­˜ä½ç½®</p></li><li><p>PVCæŒä¹…å·è§„æ ¼å£°æ˜ï¼šå®¹é‡ç­‰</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312163942434.png" alt="image-20220312163942434"></p></li><li><p>pvcé…ç½®æ–‡ä»¶</p></li></ul></li></ul></li><li><p>configmapæŠ½å–é…ç½®</p><ul><li><p>configmapä¾¿äºé•œåƒå’Œé…ç½®æ–‡ä»¶çš„è§£è€¦</p></li><li><p>ç¼–å†™é…ç½®æ–‡ä»¶ï¼Œåˆ›å»ºä¸ºé…ç½®é›†</p><ul><li>ä¿å­˜åœ¨etcd</li></ul></li><li><p>å¯åŠ¨podï¼Œé…ç½®æ–‡ä»¶æŒ‚è½½configmap</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312163949059.png" alt="image-20220312163949059"></p></li></ul></li><li><p>secretç§˜é’¥ä»¤ç‰Œ</p><ul><li><p>åˆ›å»ºserect</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312163958664.png" alt="image-20220312163958664"></p></li><li><p>base64ç¼–ç </p><ul><li>dockerä»“åº“ç¬¬ä¸‰æ–¹éœ€è§£å¯†</li><li>å¯ç ´è§£</li></ul></li></ul></li></ul></li></ul></li><li><p>å°ç»“</p><ul><li>deployment</li><li>å…¶ä»–å·¥ä½œè´Ÿè½½</li><li>pod</li><li>service</li><li>ingress</li><li>pvc</li><li>configmap</li><li>serect</li></ul></li></ul><h1 id="kubeSphere"><a href="#kubeSphere" class="headerlink" title="kubeSphere"></a>kubeSphere</h1><ul><li><p>kubesphere</p><ul><li><p>ç®€ä»‹</p><ul><li>å¯è§†åŒ–ç•Œé¢</li><li>å¤šç§Ÿæˆ·</li><li>å¤šk8sé›†ç¾¤ç®¡ç†</li><li>CI/CD</li><li>å¾®æœåŠ¡æ²»ç†ï¼šæœåŠ¡ç½‘æ ¼</li><li>åº”ç”¨ç®¡ç†</li></ul></li><li><p>å®‰è£…</p><ul><li><p>k8så®‰è£…</p><ul><li>é»˜è®¤å­˜å‚¨ç±»å‹nfs</li><li>metrics-server</li><li>å…¨åŠŸèƒ½å®‰è£…</li></ul></li><li><p>linuxå®‰è£…</p><ul><li><p>å•èŠ‚ç‚¹ä¸€é”®å®‰è£…</p><ul><li>kubekey</li></ul></li><li><p>å¤šèŠ‚ç‚¹å®‰è£…</p><ul><li>kubekey</li></ul><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312164547433.png" alt="image-20220312164547433"></p></li></ul></li></ul></li><li><p>å¤šç§Ÿæˆ·ç®¡ç†</p></li><li><p>ä¸­é—´ä»¶éƒ¨ç½²</p><ul><li><p>æ‰‹åŠ¨éƒ¨ç½²</p><ul><li>ä¾æ®docker hubæ–‡æ¡£</li><li>configmap</li><li>pvc</li><li>éƒ¨ç½²å·¥ä½œè´Ÿè½½<ul><li>é•œåƒã€èµ„æºã€ç«¯å£</li><li>ç¯å¢ƒå˜é‡ã€é…ç½®ã€æŒ‚è½½æ–‡ä»¶</li></ul></li><li>éƒ¨ç½²æœåŠ¡<ul><li>æš´éœ²<ul><li>é›†ç¾¤å†…éƒ¨é€šè¿‡åŸŸåè®¿é—®ï¼ˆè‡ªåŠ¨ï¼‰</li><li>é›†ç¾¤å¤–éƒ¨<ul><li>æŒ‡å®šå·¥ä½œè´Ÿè½½ï¼Œé›†ç¾¤å¤–è®¿é—®</li></ul></li></ul></li></ul></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312164602153.png" alt="image-20220312164602153"></p></li><li><p>ç›´æ¥éƒ¨ç½²åº”ç”¨ï¼ˆä»åº”ç”¨å•†åº—ï¼‰</p><ul><li>è¦è‡ªå·±æ‰“å¼€clusterConfiguration</li></ul></li><li><p>åº”ç”¨ä»“åº“</p><ul><li>helm-k8såŒ…ç®¡ç†ä»“åº“</li><li>æ·»åŠ åº”ç”¨ä»“åº“</li></ul></li></ul></li><li><p>åº”ç”¨éƒ¨ç½²cloud</p><ul><li><p>æ•°æ®å±‚</p></li><li><p>å¾®æœåŠ¡æ²»ç†å±‚</p></li><li><p>å¾®æœåŠ¡å±‚</p><p>â€‹            <img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312164622245.png" alt="image-20220312164622245"></p><ul><li>åˆ¶ä½œé•œåƒ<ul><li>docker file</li><li>mavenæ‰“åŒ…</li></ul></li><li>æ¨é€é•œåƒ<ul><li>é˜¿é‡Œäº‘é•œåƒä»“åº“</li><li>åº”ç”¨éƒ¨ç½²</li></ul></li></ul></li><li><p>å‰ç«¯å±‚</p><ul><li><p>åŸºç¡€é•œåƒnginx</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312164642652.png" alt="image-20220312164642652"></p></li><li><p>æ„å»ºé•œåƒ</p></li><li><p>éƒ¨ç½²</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312164652308.png" alt="image-20220312164652308"></p></li><li><p>å­˜æ´»æ£€æŸ¥ï¼šæ¢é’ˆ</p></li></ul></li><li><p>devops</p><ul><li><p>æ•æ·å¼€å‘</p></li><li><p>å…¨é“¾è·¯è‡ªåŠ¨åŒ–</p></li><li><p>cloudåº”ç”¨ä¸Šäº‘</p><ul><li><p>ä¸­é—´ä»¶å±‚</p><ul><li>æ‰‹åŠ¨æ„å»ºæœåŠ¡</li></ul><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312164744707.png" alt="image-20220312164744707"></p></li><li><p>å¾®æœåŠ¡å±‚</p><ul><li>ç”Ÿäº§ç¯å¢ƒé…ç½®æŠ½å–</li><li>nacosé…ç½®ä¸­å¿ƒ<ul><li>åŸŸååœ°å€é…ç½®ä¸­é—´ä»¶</li></ul></li></ul></li><li><p>æµæ°´çº¿</p><ul><li><p>æµæ°´çº¿æ¨¡æ¿</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312164758372.png" alt="image-20220312164758372"></p></li><li><p>ç¬¬ä¸€æ­¥-æ‹‰å–ä»£ç </p></li><li><p>ç¬¬äºŒæ­¥-é¡¹ç›®ç¼–è¯‘</p><ul><li>é…ç½®mavené˜¿é‡Œäº‘é•œåƒ<ul><li>ä¿®æ”¹ks-devops-agenté…ç½®</li></ul></li></ul></li><li><p>ç¬¬ä¸‰æ­¥-æ„å»ºé•œåƒ</p><ul><li><p>åŸºç¡€æ“ä½œ</p></li><li><p>å¹¶å‘æ„å»º</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312164807965.png" alt="image-20220312164807965"></p></li></ul></li><li><p>ç¬¬å››æ­¥-æ¨é€é•œåƒ</p><ul><li><p>åŸºç¡€æ“ä½œ</p><ul><li>é•œåƒä»“åº“å‡­è¯</li></ul></li><li><p>å¹¶å‘æ¨é€</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312164813947.png" alt="image-20220312164813947"></p></li></ul></li><li><p>ç¬¬äº”æ­¥-éƒ¨ç½²åˆ°devç¯å¢ƒ</p><ul><li><p>å¾®æœåŠ¡å‡†å¤‡deploy.yamléƒ¨ç½²æ–‡ä»¶</p></li><li><p>é•œåƒå‡­è¯</p><ul><li>é˜¿é‡Œäº‘ä»“åº“å¯†é’¥</li></ul></li><li><p>å¹¶è¡Œéƒ¨ç½²</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312164820639.png" alt="image-20220312164820639"></p></li><li><p>å°±ç»ªæ¢é’ˆ</p></li></ul></li><li><p>ç¬¬å…­æ­¥-ç³»ç»Ÿé‚®ä»¶</p></li></ul></li><li><p>å‰ç«¯é¡¹ç›®</p><ul><li><p>æµæ°´çº¿</p><ul><li>åŸºç¡€ç¯å¢ƒnodejs</li><li>æ‹‰å–ä»£ç </li><li>é¡¹ç›®å®‰è£…ä¾èµ–ã€ç¼–è¯‘</li><li>æ„å»ºé•œåƒ<ul><li>docker file</li></ul></li></ul></li><li><p>æ¨é€é•œåƒ</p></li><li><p>éƒ¨ç½²åˆ°devç¯å¢ƒ</p><ul><li>deploy.yaml</li></ul></li><li><p>å‘é€ç¡®è®¤é‚®ä»¶</p></li></ul></li><li><p>éƒ¨ç½²nust-siteå‰ç«¯é¡¹ç›®</p><ul><li><p>åŸºäºnustæœåŠ¡ç«¯æ¸²æŸ“</p></li><li><p>æ‰“åŒ…é•œåƒ</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312164832626.png" alt="image-20220312164832626"></p></li><li><p>å¯ä»¥è¯·æ±‚ä¸€åˆ‡èµ°é›†ç¾¤å†…ç½‘ï¼ˆæœåŠ¡ç«¯æ¸²æŸ“ï¼‰</p></li></ul></li><li><p>webhookè‡ªåŠ¨å¯åŠ¨æµæ°´çº¿</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312164847450.png" alt="image-20220312164847450"></p><ul><li><p>å†™å®Œä»£ç æäº¤</p></li><li><p>ç»™æŒ‡å®šåœ°æ–¹å‘è¯·æ±‚</p></li><li><p>æµæ°´çº¿è‡ªåŠ¨è¿è¡Œ</p></li><li><p>åˆ›å»ºwebhookï¼šgiteeé…ç½®</p></li></ul></li></ul></li></ul></li></ul></li></ul><h1 id="kubekeyã€devopsæ·±å…¥ã€åº”ç”¨ç®¡ç†ã€æœåŠ¡ç½‘æ ¼istioã€k8så¯è§‚æµ‹æ€§ã€kubevirt"><a href="#kubekeyã€devopsæ·±å…¥ã€åº”ç”¨ç®¡ç†ã€æœåŠ¡ç½‘æ ¼istioã€k8så¯è§‚æµ‹æ€§ã€kubevirt" class="headerlink" title="kubekeyã€devopsæ·±å…¥ã€åº”ç”¨ç®¡ç†ã€æœåŠ¡ç½‘æ ¼istioã€k8så¯è§‚æµ‹æ€§ã€kubevirt"></a>kubekeyã€devopsæ·±å…¥ã€åº”ç”¨ç®¡ç†ã€æœåŠ¡ç½‘æ ¼istioã€k8så¯è§‚æµ‹æ€§ã€kubevirt</h1><ul><li><p>kubekeyè¿ç»´é«˜å¯ç”¨é›†ç¾¤</p><ul><li><p>Kubekeyä»‹ç»</p><ul><li>kubeadmã€kopsã€kubesprayæ–¹å¼<ul><li>å®¹å™¨ç¯å¢ƒã€ç®¡ç†è¯ä¹¦</li><li>apiserverè´Ÿè½½å‡è¡¡å™¨</li><li>etcdç­‰</li></ul></li><li>kubekeyæ–¹å¼<ul><li>éƒ¨ç½²k8sã€k3s</li></ul></li></ul></li><li><p>éƒ¨ç½²é«˜å¯ç”¨k8sé›†ç¾¤</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312165738542.png" alt="image-20220312165738542"></p><ul><li><p>å¤–éƒ¨è´Ÿè½½å‡è¡¡</p></li><li><p>å†…éƒ¨è´Ÿè½½å‡è¡¡</p></li><li><p>kubekeyéƒ¨ç½²é«˜å¯ç”¨é›†ç¾¤</p></li></ul></li><li><p>kubekeyé›†ç¾¤é…ç½®æ–‡ä»¶</p><ul><li>hostsï¼šipã€user</li></ul></li><li><p>k8så¢åˆ é›†ç¾¤èŠ‚ç‚¹</p></li><li><p>é›†ç¾¤è¯ä¹¦ç®¡ç†</p></li><li><p>kubesphereå¯ç”¨å¯æ’æ‹”ç»„ä»¶</p></li><li><p>èŠ‚ç‚¹ç®¡ç†</p></li></ul></li><li><p>devopsæ·±å…¥</p><ul><li><p>devopså…ƒç´ å‘¨æœŸè¡¨</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312165317185.png" alt="image-20220312165317185"></p></li><li><p>devopsæµç¨‹</p></li><li><p>devopsç”Ÿå‘½å‘¨æœŸ</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312165751201.png" alt="image-20220312165751201"></p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312165800148.png" alt="image-20220312165800148"></p></li><li><p>devopsæµæ°´çº¿</p></li><li><p>è´¨é‡æ‰«æ&amp;å•å…ƒæµ‹è¯•&amp;åˆ¶å“ç®¡ç†</p></li><li><p>è‡ªåŠ¨éƒ¨ç½²æ„å»º</p></li><li><p>devopsè‡ªåŠ¨éƒ¨ç½²</p></li><li><p>source to images å‘å¸ƒåº”ç”¨</p><ul><li>æ— éœ€dockerfile</li><li>é€šè¿‡githubä»£ç åœ°å€</li></ul></li><li><p>binary to imageå‘å¸ƒåº”ç”¨</p><ul><li>é€šè¿‡jaråŒ…</li></ul></li><li><p>Jenkinsfileéƒ¨ç½²æµæ°´çº¿</p></li></ul></li><li><p>kubesphereå¤‡ä»½ä¸æ¢å¤</p><ul><li>å¤šèŠ‚ç‚¹æ¨¡å¼</li><li>masterèŠ‚ç‚¹å¯åœ</li><li>wokerèŠ‚ç‚¹å¯åœ</li><li>é›†ç¾¤å¯åœ</li></ul></li><li><p>äº‘åŸç”Ÿåº”ç”¨ç®¡ç†</p><ul><li>è°ƒè¯•åº”ç”¨</li><li>åº”ç”¨è°ƒåº¦</li><li>helm<ul><li>helmåŠåº”ç”¨ä»“åº“</li><li>å¼€å‘helm</li><li>k8såº”ç”¨å£°æ˜å‘¨æœŸ</li><li>åº”ç”¨ä»“åº“ç®¡ç†</li><li>åº”ç”¨ç®¡ç†åœºæ™¯</li></ul></li></ul></li><li><p>kubernetes federation</p></li><li><p>æœåŠ¡ç½‘æ ¼æ¶æ„</p><ul><li><p>å¾®æœåŠ¡</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312165816353.png" alt="image-20220312165816353"></p><ul><li><p>å¾®æœåŠ¡æ¡†æ¶æŒ‘æˆ˜</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312165824002.png" alt="image-20220312165824002"></p><ul><li>è¿‡äºç»‘å®šæŠ€æœ¯æ ˆ</li><li>å¤šè¯­è¨€å—é™</li><li>ä»£ç ä¾µå…¥åº¦è¿‡é«˜</li></ul></li></ul></li><li><p>æ¶æ„</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312165831921.png" alt="image-20220312165831921"></p><ul><li><p>side car</p></li><li><p>æœåŠ¡ç½‘æ ¼</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312165836512.png" alt="image-20220312165836512"></p><ul><li>ä¸€ç»„è½»é‡çº§ç½‘ç»œä»£ç†å®ç°</li></ul></li></ul></li><li><p>istio</p><ul><li><p>æ¶æ„</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312165844680.png" alt="image-20220312165844680"></p></li><li><p>å®‰è£…éƒ¨ç½²</p></li><li><p>æµ‹è¯•é¡¹ç›®éƒ¨ç½²</p></li><li><p>isitoæ ¸å¿ƒæ¦‚å¿µ</p><ul><li>è™šæ‹ŸæœåŠ¡</li><li>ç›®æ ‡è§„åˆ™</li></ul></li><li><p>kubesphereå¯ç”¨æœåŠ¡æ²»ç†</p><ul><li><p>å¯ç”¨istio</p></li><li><p>åˆ›å»ºæœåŠ¡</p></li><li><p>æœåŠ¡æ²»ç†</p><ul><li><p>é“¾è·¯è¿½è¸ª</p></li><li><p>æµé‡ç›‘æ§</p></li><li><p>ç°åº¦å‘å¸ƒ</p><ul><li><p>é‡‘ä¸é›€å‘å¸ƒ</p><ul><li>æµé‡æ‰‹åŠ¨åˆ†é…</li></ul></li><li><p>è¾¾åˆ°è¶³å¤Ÿä¸Šçº¿æ¡ä»¶</p><ul><li>æ¥ç®¡</li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul><ul><li><p>k8så¯è§‚æµ‹æ€§</p><ul><li>æ—¥å¿—ç³»ç»Ÿ</li><li>æ—¥å¿—å®‰è£…<ul><li>kubesphereå¯æ’æ‹”å¼å®‰è£…</li><li>cluster configuration<ul><li>logging<ul><li>é›†åˆfluent bit</li></ul></li></ul></li></ul></li></ul></li><li><p>æ—¥å¿—æŸ¥çœ‹</p><ul><li><p>å®¹å™¨æ—¥å¿—æŸ¥è¯¢</p></li><li><p>æ—¥å¿—æ£€ç´¢ä¸è½ç›˜æ—¥å¿—æ”¶é›†</p><ul><li>å¼€å¯æ—¥å¿—æ”¶é›†</li><li>åˆ›å»ºå·¥ä½œè´Ÿè½½<ul><li>alpineé•œåƒ<ul><li>å¯åŠ¨å‘½ä»¤</li></ul></li><li>æŒ‚è½½pvc</li></ul></li></ul></li><li><p>å¸¸è§é—®é¢˜</p><ul><li>å­˜å‚¨å¤–éƒ¨esï¼Œå…³é—­å†…éƒ¨es</li><li>æ—¥å¿—ä¿ç•™æ—¥æœŸ</li></ul></li></ul></li><li><p>ç›‘æ§ä¸é¢„è­¦</p><ul><li><p>Prometheus</p><ul><li><p>å®‰è£…node explorer</p></li><li><p>promQL</p></li><li><p>å‘Šè­¦å¤„ç†</p><ul><li>å‘Šè­¦è§„åˆ™</li></ul></li><li><p>operator</p><ul><li>æ§åˆ¶ä¸­å¿ƒ</li></ul></li></ul></li><li><p>kubesphereç›‘æ§</p><ul><li>åŸºäºPrometheus</li></ul></li><li><p>è´¹ç‡ç»Ÿè®¡</p></li></ul></li><li><p>kubevirtè™šæ‹Ÿæœºç®¡ç†</p><ul><li><p>è™šæ‹ŸåŒ–æŠ€æœ¯</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312165923874.png" alt="image-20220312165923874"></p></li><li><p>kubevirt</p></li><li><p>KSVå¹³å°</p></li></ul></li><li><p>CKAã€CKS</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220312170342258.png" alt="image-20220312170342258"></p>]]></content>
    
    
    <summary type="html">äº§å“å¼€å‘</summary>
    
    
    
    <category term="äº§å“" scheme="https://fireonice.github.io/categories/%E4%BA%A7%E5%93%81/"/>
    
    
    <category term="äº§å“å¼€å‘" scheme="https://fireonice.github.io/tags/%E4%BA%A7%E5%93%81%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>è°·ç²’å•†åŸâ€”â€”k8s-DevOps-CI/CD&amp;æœ€ç»ˆéƒ¨ç½²</title>
    <link href="https://fireonice.github.io/2022/03/11/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-k8s-%E8%87%AA%E5%8A%A8%E5%8C%96cicd&amp;%E6%9C%80%E7%BB%88%E9%83%A8%E7%BD%B2/"/>
    <id>https://fireonice.github.io/2022/03/11/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-k8s-%E8%87%AA%E5%8A%A8%E5%8C%96cicd&amp;%E6%9C%80%E7%BB%88%E9%83%A8%E7%BD%B2/</id>
    <published>2022-03-11T04:01:57.157Z</published>
    <updated>2022-03-11T07:33:33.370Z</updated>
    
    <content type="html"><![CDATA[<h1 id="DevOps"><a href="#DevOps" class="headerlink" title="DevOps"></a>DevOps</h1><p>DevOps: Development å’Œ Operations çš„ç»„åˆ</p><ul><li>DevOps çœ‹ä½œå¼€å‘ï¼ˆè½¯ä»¶å·¥ç¨‹ï¼‰ã€æŠ€æœ¯è¿è¥å’Œè´¨é‡ä¿éšœï¼ˆQAï¼‰ä¸‰è€…çš„äº¤é›†ã€‚</li><li>çªå‡ºé‡è§†è½¯ä»¶å¼€å‘äººå‘˜å’Œè¿ç»´äººå‘˜çš„æ²Ÿé€šåˆä½œï¼Œé€šè¿‡è‡ªåŠ¨åŒ–æµç¨‹æ¥ä½¿å¾—è½¯ä»¶æ„å»ºã€æµ‹è¯•ã€ å‘å¸ƒæ›´åŠ å¿«æ·ã€é¢‘ç¹å’Œå¯é ã€‚</li><li>DevOps å¸Œæœ›åšåˆ°çš„æ˜¯è½¯ä»¶äº§å“äº¤ä»˜è¿‡ç¨‹ä¸­ <strong>IT å·¥å…·é“¾çš„æ‰“é€š</strong>ï¼Œä½¿å¾—å„ä¸ªå›¢é˜Ÿå‡å°‘æ—¶é—´æŸè€—ï¼Œæ›´åŠ é«˜æ•ˆåœ°ååŒå·¥ä½œã€‚DevOps èƒ½åŠ›å›¾å¦‚ä¸‹ï¼Œè‰¯å¥½çš„é—­ç¯å¯ä»¥å¤§å¤§å¢åŠ æ•´ä½“çš„äº§å‡ºã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220311121142708.png" alt="image-20220311121142708"></p><h2 id="CI-CD"><a href="#CI-CD" class="headerlink" title="CI/CD"></a>CI/CD</h2><p>1ã€æŒç»­é›†æˆï¼ˆContinuous Integrationï¼‰ </p><p>æŒç»­é›†æˆæ˜¯æŒ‡è½¯ä»¶ä¸ªäººç ”å‘çš„éƒ¨åˆ†å‘è½¯ä»¶æ•´ä½“éƒ¨åˆ†äº¤ä»˜ï¼Œé¢‘ç¹è¿›è¡Œé›†æˆä»¥ä¾¿æ›´å¿«åœ°å‘ç° å…¶ä¸­çš„é”™è¯¯ã€‚â€œæŒç»­é›†æˆâ€æºè‡ªäºæé™ç¼–ç¨‹ï¼ˆXPï¼‰ï¼Œæ˜¯ XP æœ€åˆçš„ 12 ç§å®è·µä¹‹ä¸€ã€‚</p><p>CI éœ€è¦å…·å¤‡è¿™äº›ï¼š</p><ul><li><strong>å…¨é¢çš„è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚</strong>è¿™æ˜¯å®è·µæŒç»­é›†æˆ&amp;æŒç»­éƒ¨ç½²çš„åŸºç¡€ï¼ŒåŒæ—¶ï¼Œé€‰æ‹©åˆé€‚çš„è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·ä¹Ÿæå…¶é‡è¦</li><li><strong>çµæ´»çš„åŸºç¡€è®¾æ–½ã€‚å®¹å™¨ï¼Œè™šæ‹Ÿæœº</strong>çš„å­˜åœ¨è®©å¼€å‘äººå‘˜å’Œ QA äººå‘˜ä¸å¿…å†å¤§è´¹å‘¨æŠ˜</li><li><strong>ç‰ˆæœ¬æ§åˆ¶å·¥å…·ã€‚</strong>å¦‚ <strong>Git</strong>ï¼ŒCVSï¼ŒSVN ç­‰</li><li><strong>è‡ªåŠ¨åŒ–çš„æ„å»ºå’Œè½¯ä»¶å‘å¸ƒæµç¨‹çš„å·¥å…·</strong>ï¼Œå¦‚ <strong>Jenkins</strong>ï¼Œflow.ci</li><li><strong>åé¦ˆæœºåˆ¶ã€‚</strong>å¦‚æ„å»º/æµ‹è¯•çš„å¤±è´¥ï¼Œå¯ä»¥å¿«é€Ÿåœ°åé¦ˆåˆ°ç›¸å…³è´Ÿè´£äººï¼Œä»¥å°½å¿«è§£å†³è¾¾åˆ°ä¸€ä¸ªæ›´ç¨³å®šçš„ç‰ˆæœ¬</li></ul><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220311121324347.png" alt="image-20220311121324347"></p><p>2ã€æŒç»­äº¤ä»˜ï¼ˆContinuous Deliveryï¼‰ </p><p>æŒç»­äº¤ä»˜åœ¨æŒç»­é›†æˆçš„åŸºç¡€ä¸Šï¼Œå°†é›†æˆåçš„ä»£ç éƒ¨ç½²åˆ°<strong>æ›´è´´è¿‘çœŸå®è¿è¡Œç¯å¢ƒçš„</strong>ã€Œç±»ç”Ÿäº§ç¯å¢ƒã€ ï¼ˆproduction-like environmentsï¼‰ä¸­ã€‚æŒç»­äº¤ä»˜ä¼˜å…ˆäºæ•´ä¸ªäº§å“ç”Ÿå‘½å‘¨æœŸçš„è½¯ä»¶éƒ¨ç½²ï¼Œå»ºç«‹åœ¨é«˜æ°´å¹³è‡ªåŠ¨åŒ–æŒç»­é›†æˆä¹‹ä¸Šã€‚</p><p>ç°åº¦å‘å¸ƒã€‚ </p><p>æŒç»­äº¤ä»˜å’ŒæŒç»­é›†æˆçš„ä¼˜ç‚¹éå¸¸ç›¸ä¼¼ï¼š</p><ul><li><strong>å¿«é€Ÿå‘å¸ƒã€‚</strong>èƒ½å¤Ÿåº”å¯¹ä¸šåŠ¡éœ€æ±‚ï¼Œå¹¶æ›´å¿«åœ°å®ç°è½¯ä»¶ä»·å€¼</li><li><strong>ç¼–ç -&gt;æµ‹è¯•-&gt;ä¸Šçº¿-&gt;äº¤ä»˜</strong>çš„é¢‘ç¹è¿­ä»£å‘¨æœŸç¼©çŸ­ï¼ŒåŒæ—¶è·å¾—è¿…é€Ÿåé¦ˆ</li><li><strong>é«˜è´¨é‡çš„è½¯ä»¶å‘å¸ƒæ ‡å‡†</strong>ã€‚æ•´ä¸ªäº¤ä»˜è¿‡ç¨‹æ ‡å‡†åŒ–ã€å¯é‡å¤ã€å¯é </li><li><strong>æ•´ä¸ªäº¤ä»˜è¿‡ç¨‹è¿›åº¦å¯è§†åŒ–ï¼Œ</strong>æ–¹ä¾¿å›¢é˜Ÿäººå‘˜äº†è§£é¡¹ç›®æˆç†Ÿåº¦</li><li><strong>æ›´å…ˆè¿›çš„å›¢é˜Ÿåä½œæ–¹å¼ã€‚</strong>ä»éœ€æ±‚åˆ†æã€äº§å“çš„ç”¨æˆ·ä½“éªŒåˆ°äº¤äº’ è®¾è®¡ã€å¼€å‘ã€æµ‹è¯•ã€è¿ç»´ç­‰è§’è‰²å¯†åˆ‡åä½œï¼Œç›¸æ¯”äºä¼ ç»Ÿçš„ç€‘å¸ƒå¼è½¯ä»¶å›¢é˜Ÿï¼Œæ›´å°‘æµªè´¹</li></ul><p>3ã€æŒç»­éƒ¨ç½²ï¼ˆContinuous Deploymentï¼‰</p><p><strong>æŒç»­éƒ¨ç½²</strong>æ˜¯æŒ‡å½“äº¤ä»˜çš„ä»£ç é€šè¿‡è¯„å®¡ä¹‹åï¼Œ<strong>è‡ªåŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­</strong>ã€‚æŒç»­éƒ¨ç½²æ˜¯æŒç»­äº¤ä»˜çš„æœ€é«˜é˜¶æ®µã€‚è¿™æ„å‘³ç€ï¼Œæ‰€æœ‰é€šè¿‡äº†ä¸€ç³»åˆ—çš„è‡ªåŠ¨åŒ–æµ‹è¯•çš„æ”¹åŠ¨éƒ½å°†è‡ªåŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚å®ƒä¹Ÿå¯ä»¥è¢«ç§°ä¸ºâ€œContinuous Releaseâ€ã€‚</p><p>â€œå¼€å‘äººå‘˜æäº¤ä»£ç ï¼ŒæŒç»­é›†æˆæœåŠ¡å™¨è·å–ä»£ç ï¼Œæ‰§è¡Œå•å…ƒæµ‹è¯•ï¼Œæ ¹æ®æµ‹è¯•ç»“æœå†³å®šæ˜¯å¦éƒ¨ç½²åˆ°é¢„æ¼”ç¯å¢ƒï¼Œå¦‚æœæˆåŠŸéƒ¨ç½²åˆ°é¢„æ¼”ç¯å¢ƒï¼Œè¿›è¡Œæ•´ä½“éªŒæ”¶æµ‹è¯•ï¼Œå¦‚æœæµ‹è¯•é€šè¿‡ï¼Œè‡ªåŠ¨éƒ¨ç½²åˆ°äº§å“ç¯å¢ƒï¼Œå…¨ç¨‹è‡ªåŠ¨åŒ–é«˜æ•ˆè¿è½¬ã€‚â€</p><p>æŒç»­éƒ¨ç½²ä¸»è¦å¥½å¤„æ˜¯ï¼Œå¯ä»¥ç›¸å¯¹ç‹¬ç«‹åœ°éƒ¨ç½²æ–°çš„åŠŸèƒ½ï¼Œå¹¶èƒ½å¿«é€Ÿåœ°æ”¶é›†çœŸå®ç”¨æˆ·çš„åé¦ˆã€‚ </p><p>ä¸‹å›¾æ˜¯ç”± Jams Bowman ç»˜åˆ¶çš„æŒç»­äº¤ä»˜å·¥å…·é“¾å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/cicd-tools-fullsize.jpeg" alt="cicd-tools-fullsize"></p><h1 id="æœ€ç»ˆéƒ¨ç½²"><a href="#æœ€ç»ˆéƒ¨ç½²" class="headerlink" title="æœ€ç»ˆéƒ¨ç½²"></a>æœ€ç»ˆéƒ¨ç½²</h1><p>kubesphereæ¶æ„</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/architecture.png" alt="architecture"></p><h2 id="æœ‰çŠ¶æ€æœåŠ¡éƒ¨ç½²"><a href="#æœ‰çŠ¶æ€æœåŠ¡éƒ¨ç½²" class="headerlink" title="æœ‰çŠ¶æ€æœåŠ¡éƒ¨ç½²"></a>æœ‰çŠ¶æ€æœåŠ¡éƒ¨ç½²</h2><p>1ã€æœ‰çŠ¶æ€æœåŠ¡æŠ½å–é…ç½®ä¸º ConfigMap</p><p>2ã€æœ‰çŠ¶æ€æœåŠ¡å¿…é¡»ä½¿ç”¨ pvc æŒä¹…åŒ–æ•°æ®</p><p>3ã€æœåŠ¡é›†ç¾¤å†…è®¿é—®ä½¿ç”¨ DNS æä¾›çš„ç¨³å®šåŸŸå</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220311125735647.png" alt="image-20220311125735647"></p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220311131906123.png" alt="image-20220311131906123"></p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220311131257276.png" alt="image-20220311131257276"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ éƒ¨ç½²æµç¨‹</span><br><span class="line">    + configMap</span><br><span class="line">    + pvc</span><br><span class="line">    + é•œåƒ</span><br><span class="line">    + èµ„æºé™åˆ¶</span><br><span class="line">    + ç¯å¢ƒå˜é‡</span><br><span class="line">    + æŒ‚è½½pvc</span><br><span class="line">    + å¤–ç½‘è®¿é—®ã€é›†ç¾¤å†…è®¿é—®ç­‰</span><br></pre></td></tr></table></figure><p>ä¾æ¬¡éƒ¨ç½²é›†ç¾¤ï¼š</p><p>MySQLã€Redisã€RabbitMQã€Elasticsearchã€Kibana</p><p>Nacosã€Zipkinã€Nginxã€Sentinel</p><h2 id="å¾®æœåŠ¡éƒ¨ç½²"><a href="#å¾®æœåŠ¡éƒ¨ç½²" class="headerlink" title="å¾®æœåŠ¡éƒ¨ç½²"></a>å¾®æœåŠ¡éƒ¨ç½²</h2><h3 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h3><p>1ã€dockerfile</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220311132713759.png" alt="image-20220311132713759"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">+ åˆ›å»ºé¡¹ç›® dockerfile2ã€ä¸Šä¼ é¡¹ç›®åˆ°æœåŠ¡å™¨ã€‚ </span><br><span class="line">+ è¿›å…¥é¡¹ç›®ï¼Œæ„å»ºé•œåƒåˆ°æœ¬åœ°ä»“åº“ï¼› </span><br><span class="line">+ docker build -t nginx:GA-1.0 -f ./Dockerfile . </span><br><span class="line">+ docker images </span><br><span class="line">+ docker exec -it å®¹å™¨ id /bin/bashï¼›è¿›å…¥å®¹å™¨ï¼Œä¿®æ”¹å®¹å™¨ </span><br><span class="line">+ docker commit -a â€œleifengyangâ€ -m â€œnginxxxâ€ å®¹å™¨ id </span><br><span class="line">+  docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]] </span><br><span class="line">+  OPTIONS è¯´æ˜ï¼š </span><br><span class="line">+ -a :æäº¤çš„é•œåƒä½œè€…ï¼› </span><br><span class="line">+ -c :ä½¿ç”¨ Dockerfile æŒ‡ä»¤æ¥åˆ›å»ºé•œåƒï¼› </span><br><span class="line">+ -m :æäº¤æ—¶çš„è¯´æ˜æ–‡å­—ï¼› </span><br><span class="line">+ -p :åœ¨ commit æ—¶ï¼Œå°†å®¹å™¨æš‚åœã€‚ </span><br><span class="line">+ docker login : ç™»é™†åˆ°ä¸€ä¸ª Docker é•œåƒä»“åº“ï¼Œå¦‚æœæœªæŒ‡å®šé•œåƒä»“åº“åœ°å€ï¼Œé»˜è®¤ä¸ºå®˜æ–¹ä»“åº“ Docker Hub </span><br><span class="line">+ docker login -u ç”¨æˆ·å -p å¯†ç  </span><br><span class="line">+ docker logout : ç™»å‡ºä¸€ä¸ª Docker é•œåƒä»“åº“ï¼Œå¦‚æœæœªæŒ‡å®šé•œåƒä»“åº“åœ°å€ï¼Œé»˜è®¤ä¸ºå®˜æ–¹ä»“åº“ Docker Hub </span><br><span class="line">+ æ¨é€é•œåƒåˆ° docker hub </span><br><span class="line">+ æ ‡è®°é•œåƒï¼Œdocker tag local-image:tagname username/new-repo:tagname </span><br><span class="line">+ ä¸Šä¼ é•œåƒï¼Œdocker push username/new-repo:tagname </span><br><span class="line">+ ä¿å­˜é•œåƒï¼ŒåŠ è½½é•œåƒ </span><br><span class="line">+ å¯ä»¥ä¿å­˜é•œåƒä¸º tarï¼Œä½¿ç”¨ u ç›˜ç­‰è®¾å¤‡å¤åˆ¶åˆ°ä»»æ„ docker ä¸»æœºï¼Œå†æ¬¡åŠ è½½é•œåƒ </span><br><span class="line">+ ä¿å­˜ï¼šdocker save spring-boot-docker -o /home/spring-boot-docker.tar </span><br><span class="line">+ åŠ è½½ï¼šdocker load -i spring-boot-docker.tar </span><br><span class="line">+ é˜¿é‡Œäº‘æ“ä½œ </span><br><span class="line">+ ç™»å½•é˜¿é‡Œäº‘ï¼Œå¯†ç å°±æ˜¯å¼€é€šé•œåƒä»“åº“æ—¶çš„å¯†ç  docker login --username=qwertyuiopasdf_aa registry.cn-hangzhou.aliyuncs.com </span><br><span class="line">+ æ‹‰å–é•œåƒ docker pull registry.cn-hangzhou.aliyuncs.com/atguigumall/gulimall-nginx:v1.0 </span><br><span class="line">+ æ¨é€é•œåƒ docker tag [ImageId] registry.cn-hangzhou.aliyuncs.com/atguigumall/gulimall-nginx:v1 </span><br><span class="line">docker push registry.cn-hangzhou.aliyuncs.com/atguigumall/gulimall-nginx:v1</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FROM java:openjdk-8-jre-alpine</span><br><span class="line">WORKDIR /home</span><br><span class="line">COPY target/*.jar /home</span><br><span class="line">ENTRYPOINT java -jar *.jar</span><br></pre></td></tr></table></figure><p>2ã€k8séƒ¨ç½²æè¿°æ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">kubesphere</span></span><br><span class="line">    <span class="attr">component:</span> <span class="string">ks-sample</span></span><br><span class="line">    <span class="attr">tier:</span> <span class="string">backend</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ks-sample</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubesphere-sample-prod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">progressDeadlineSeconds:</span> <span class="number">600</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">kubesphere</span></span><br><span class="line">      <span class="attr">component:</span> <span class="string">ks-sample</span></span><br><span class="line">      <span class="attr">tier:</span> <span class="string">backend</span></span><br><span class="line">  <span class="attr">strategy:</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span></span><br><span class="line">      <span class="attr">maxSurge:</span> <span class="number">100</span><span class="string">%</span></span><br><span class="line">      <span class="attr">maxUnavailable:</span> <span class="number">100</span><span class="string">%</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">kubesphere</span></span><br><span class="line">        <span class="attr">component:</span> <span class="string">ks-sample</span></span><br><span class="line">        <span class="attr">tier:</span> <span class="string">backend</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CACHE_IGNORE</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">js|html</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CACHE_PUBLIC_EXPIRATION</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">3d</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">$REGISTRY/$HARBOR_NAMESPACE/$APP_NAME:$TAG_NAME</span></span><br><span class="line">          <span class="attr">readinessProbe:</span></span><br><span class="line">            <span class="attr">httpGet:</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">              <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">30</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">5</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">Always</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">ks</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">limits:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">300m</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">600Mi</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">100m</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">100Mi</span></span><br><span class="line">          <span class="attr">terminationMessagePath:</span> <span class="string">/dev/termination-log</span></span><br><span class="line">          <span class="attr">terminationMessagePolicy:</span> <span class="string">File</span></span><br><span class="line">      <span class="attr">dnsPolicy:</span> <span class="string">ClusterFirst</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">30</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220311150912792.png" alt="image-20220311150912792"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+ Containerportï¼šå®¹å™¨å†…æœåŠ¡ç«¯å£</span><br><span class="line">+ TargetPort</span><br><span class="line">+ podè®¿é—®container</span><br><span class="line">+ Portï¼šé›†ç¾¤å†…serviceç«¯å£ï¼ŒåŸŸåã€ipç«¯å£å·</span><br><span class="line">+ Nodeportï¼šå¤–éƒ¨è®¿é—®é›†ç¾¤service</span><br><span class="line">+ ç‰¹ç‚¹</span><br><span class="line">+ Targetportã€serviceportç«¯å£å¯ä»¥ä¸€æ ·</span><br><span class="line">+ æ¯ä¸ªserviceã€podåœ°å€éƒ½ä¸ä¸€æ ·ï¼Œéƒ½æ˜¯é›†ç¾¤å†…è™šæ‹Ÿçš„</span><br><span class="line">+ Nodeportä¸èƒ½ä¸€æ ·ï¼Œæš´éœ²å¤–éƒ¨ç«¯å£</span><br></pre></td></tr></table></figure><p>3ã€Jenkinsfileæµæ°´çº¿æ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">pipeline</span> &#123;</span><br><span class="line">  <span class="string">agent</span> &#123;</span><br><span class="line">    <span class="string">node</span> &#123;</span><br><span class="line">      <span class="string">label</span> <span class="string">&#x27;maven&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">    <span class="string">parameters</span> &#123;</span><br><span class="line">        <span class="string">string(name:&#x27;TAG_NAME&#x27;</span>,<span class="attr">defaultValue:</span> <span class="string">&#x27;&#x27;</span>,<span class="string">description:&#x27;&#x27;)</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="string">environment</span> &#123;</span><br><span class="line">        <span class="string">DOCKER_CREDENTIAL_ID</span> <span class="string">=</span> <span class="string">&#x27;dockerhub-id&#x27;</span></span><br><span class="line">        <span class="string">GITHUB_CREDENTIAL_ID</span> <span class="string">=</span> <span class="string">&#x27;github-id&#x27;</span></span><br><span class="line">        <span class="string">KUBECONFIG_CREDENTIAL_ID</span> <span class="string">=</span> <span class="string">&#x27;demo-kubeconfig&#x27;</span></span><br><span class="line">        <span class="string">REGISTRY</span> <span class="string">=</span> <span class="string">&#x27;docker.io&#x27;</span></span><br><span class="line">        <span class="string">DOCKERHUB_NAMESPACE</span> <span class="string">=</span> <span class="string">&#x27;1637872839&#x27;</span></span><br><span class="line">        <span class="string">GITHUB_ACCOUNT</span> <span class="string">=</span> <span class="string">&#x27;1637872839&#x27;</span></span><br><span class="line">        <span class="string">APP_NAME</span> <span class="string">=</span> <span class="string">&#x27;devops-java-sample&#x27;</span></span><br><span class="line">        <span class="string">SONAR_CREDENTIAL_ID</span> <span class="string">=</span> <span class="string">&#x27;sonar-qube&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="string">stages</span> &#123;</span><br><span class="line">        <span class="string">stage</span> <span class="string">(&#x27;checkout</span> <span class="string">scm&#x27;)</span> &#123;</span><br><span class="line">            <span class="string">steps</span> &#123;</span><br><span class="line">                <span class="string">checkout(scm)</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="string">stage</span> <span class="string">(&#x27;unit</span> <span class="string">test&#x27;)</span> &#123;</span><br><span class="line">            <span class="string">steps</span> &#123;</span><br><span class="line">                <span class="string">container</span> <span class="string">(&#x27;maven&#x27;)</span> &#123;</span><br><span class="line">                    <span class="string">sh</span> <span class="string">&#x27;mvn clean  -gs `pwd`/configuration/settings.xml test&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="string">stage</span> <span class="string">(&#x27;build</span> <span class="string">&amp;</span> <span class="string">push&#x27;)</span> &#123;</span><br><span class="line">            <span class="string">steps</span> &#123;</span><br><span class="line">                <span class="string">container</span> <span class="string">(&#x27;maven&#x27;)</span> &#123;</span><br><span class="line">                    <span class="string">sh</span> <span class="string">&#x27;mvn  -Dmaven.test.skip=true -gs `pwd`/configuration/settings.xml clean package&#x27;</span></span><br><span class="line">                    <span class="string">sh</span> <span class="string">&#x27;docker build -f Dockerfile-online -t $REGISTRY/$DOCKERHUB_NAMESPACE/$APP_NAME:SNAPSHOT-$BRANCH_NAME-$BUILD_NUMBER .&#x27;</span></span><br><span class="line">                    <span class="string">withCredentials(</span>[<span class="string">usernamePassword(passwordVariable</span> <span class="string">:</span> <span class="string">&#x27;DOCKER_PASSWORD&#x27;</span> ,<span class="attr">usernameVariable :</span> <span class="string">&#x27;DOCKER_USERNAME&#x27;</span> ,<span class="attr">credentialsId :</span> <span class="string">&quot;$DOCKER_CREDENTIAL_ID&quot;</span> ,<span class="string">)</span>]<span class="string">)</span> &#123;</span><br><span class="line">                        <span class="string">sh</span> <span class="string">&#x27;echo &quot;$DOCKER_PASSWORD&quot; | docker login $REGISTRY -u &quot;$DOCKER_USERNAME&quot; --password-stdin&#x27;</span></span><br><span class="line">                        <span class="string">sh</span> <span class="string">&#x27;docker push  $REGISTRY/$DOCKERHUB_NAMESPACE/$APP_NAME:SNAPSHOT-$BRANCH_NAME-$BUILD_NUMBER&#x27;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="string">stage(&#x27;push</span> <span class="string">latest&#x27;)</span>&#123;</span><br><span class="line">           <span class="string">when</span>&#123;</span><br><span class="line">             <span class="string">branch</span> <span class="string">&#x27;master&#x27;</span></span><br><span class="line">           &#125;</span><br><span class="line">           <span class="string">steps</span>&#123;</span><br><span class="line">                <span class="string">container</span> <span class="string">(&#x27;maven&#x27;)</span> &#123;</span><br><span class="line">                  <span class="string">sh</span> <span class="string">&#x27;docker tag  $REGISTRY/$DOCKERHUB_NAMESPACE/$APP_NAME:SNAPSHOT-$BRANCH_NAME-$BUILD_NUMBER $REGISTRY/$DOCKERHUB_NAMESPACE/$APP_NAME:latest &#x27;</span></span><br><span class="line">                  <span class="string">sh</span> <span class="string">&#x27;docker push  $REGISTRY/$DOCKERHUB_NAMESPACE/$APP_NAME:latest &#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="string">stage(&#x27;deploy</span> <span class="string">to</span> <span class="string">dev&#x27;)</span> &#123;</span><br><span class="line">          <span class="string">when</span>&#123;</span><br><span class="line">            <span class="string">branch</span> <span class="string">&#x27;master&#x27;</span></span><br><span class="line">          &#125;</span><br><span class="line">          <span class="string">steps</span> &#123;</span><br><span class="line">            <span class="string">input(id:</span> <span class="string">&#x27;deploy-to-dev&#x27;</span>, <span class="attr">message:</span> <span class="string">&#x27;deploy to dev?&#x27;</span><span class="string">)</span></span><br><span class="line">            <span class="string">kubernetesDeploy(configs:</span> <span class="string">&#x27;deploy/dev-ol/**&#x27;</span>, <span class="attr">enableConfigSubstitution:</span> <span class="literal">true</span>, <span class="attr">kubeconfigId:</span> <span class="string">&quot;$KUBECONFIG_CREDENTIAL_ID&quot;</span><span class="string">)</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">stage(&#x27;push</span> <span class="string">with</span> <span class="string">tag&#x27;)</span>&#123;</span><br><span class="line">          <span class="string">when</span>&#123;</span><br><span class="line">            <span class="string">expression</span>&#123;</span><br><span class="line">              <span class="string">return</span> <span class="string">params.TAG_NAME</span> <span class="string">=~</span> <span class="string">/v.*/</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="string">steps</span> &#123;</span><br><span class="line">              <span class="string">container</span> <span class="string">(&#x27;maven&#x27;)</span> &#123;</span><br><span class="line">                <span class="string">input(id:</span> <span class="string">&#x27;release-image-with-tag&#x27;</span>, <span class="attr">message:</span> <span class="string">&#x27;release image with tag?&#x27;</span><span class="string">)</span></span><br><span class="line">                  <span class="string">withCredentials(</span>[<span class="string">usernamePassword(credentialsId:</span> <span class="string">&quot;$GITHUB_CREDENTIAL_ID&quot;</span>, <span class="attr">passwordVariable:</span> <span class="string">&#x27;GIT_PASSWORD&#x27;</span>, <span class="attr">usernameVariable:</span> <span class="string">&#x27;GIT_USERNAME&#x27;</span><span class="string">)</span>]<span class="string">)</span> &#123;</span><br><span class="line">                    <span class="string">sh</span> <span class="string">&#x27;git config --global user.email &quot;kubesphere@yunify.com&quot; &#x27;</span></span><br><span class="line">                    <span class="string">sh</span> <span class="string">&#x27;git config --global user.name &quot;kubesphere&quot; &#x27;</span></span><br><span class="line">                    <span class="string">sh</span> <span class="string">&#x27;git tag -a $TAG_NAME -m &quot;$TAG_NAME&quot; &#x27;</span></span><br><span class="line">                    <span class="string">sh</span> <span class="string">&#x27;git push http://$GIT_USERNAME:$GIT_PASSWORD@github.com/$GITHUB_ACCOUNT/devops-java-sample.git --tags --ipv4&#x27;</span></span><br><span class="line">                  &#125;</span><br><span class="line">                <span class="string">sh</span> <span class="string">&#x27;docker tag  $REGISTRY/$DOCKERHUB_NAMESPACE/$APP_NAME:SNAPSHOT-$BRANCH_NAME-$BUILD_NUMBER $REGISTRY/$DOCKERHUB_NAMESPACE/$APP_NAME:$TAG_NAME &#x27;</span></span><br><span class="line">                <span class="string">sh</span> <span class="string">&#x27;docker push  $REGISTRY/$DOCKERHUB_NAMESPACE/$APP_NAME:$TAG_NAME &#x27;</span></span><br><span class="line">          &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">stage(&#x27;deploy</span> <span class="string">to</span> <span class="string">production&#x27;)</span> &#123;</span><br><span class="line">          <span class="string">when</span>&#123;</span><br><span class="line">            <span class="string">expression</span>&#123;</span><br><span class="line">              <span class="string">return</span> <span class="string">params.TAG_NAME</span> <span class="string">=~</span> <span class="string">/v.*/</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="string">steps</span> &#123;</span><br><span class="line">            <span class="string">input(id:</span> <span class="string">&#x27;deploy-to-production&#x27;</span>, <span class="attr">message:</span> <span class="string">&#x27;deploy to production?&#x27;</span><span class="string">)</span></span><br><span class="line">            <span class="string">kubernetesDeploy(configs:</span> <span class="string">&#x27;deploy/prod-ol/**&#x27;</span>, <span class="attr">enableConfigSubstitution:</span> <span class="literal">true</span>, <span class="attr">kubeconfigId:</span> <span class="string">&quot;$KUBECONFIG_CREDENTIAL_ID&quot;</span><span class="string">)</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4ã€é˜¿é‡Œäº‘é•œåƒä»“åº“</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220311152111010.png" alt="image-20220311152111010"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+ åˆ›å»ºé•œåƒä»“åº“</span><br><span class="line">    + ç™»å½•ä»“åº“</span><br><span class="line">    + æ‹‰å–é•œåƒ</span><br><span class="line">    + æ¨é€é•œåƒ</span><br></pre></td></tr></table></figure><h3 id="DevOpséƒ¨ç½²æµæ°´çº¿"><a href="#DevOpséƒ¨ç½²æµæ°´çº¿" class="headerlink" title="DevOpséƒ¨ç½²æµæ°´çº¿"></a>DevOpséƒ¨ç½²æµæ°´çº¿</h3><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220311150756780.png" alt="image-20220311150756780"></p><p>1ã€æ‹‰å–giteeä»£ç &amp;å‚æ•°åŒ–æ„å»º&amp;ç¯å¢ƒå˜é‡</p><ul><li>é…ç½®å‡­è¯</li><li>é…ç½®æ„å»ºå¾®æœåŠ¡å‚æ•°</li><li>é…ç½®è¿è¡Œå‚æ•°ç­‰</li></ul><p>2ã€Sonarä»£ç è´¨é‡åˆ†æ</p><ul><li>é…ç½®é˜¿é‡Œäº‘é•œåƒ</li><li>è¿›å…¥sonaræŸ¥çœ‹åˆ†ææŠ¥å‘Š</li><li>bugä¿®æ”¹ç­‰</li></ul><p>3ã€æ„å»º&amp;æ¨é€é•œåƒ</p><ul><li>é…ç½®é˜¿é‡Œäº‘ç§æœ‰é•œåƒä»“åº“</li><li>æ ¹æ®dockerfile æ‰“åŒ…é•œåƒ</li><li>æ¨é€é•œåƒ</li></ul><p>4ã€éƒ¨ç½²åˆ°k8sç”Ÿäº§ç¯å¢ƒ</p><p>5ã€å‘å¸ƒ</p><ul><li><p>giteeä»“åº“åœ°å€</p></li><li><p>tagä¿¡æ¯</p></li></ul><h2 id="å…¨é“¾è·¯æœ€ç»ˆéƒ¨ç½²"><a href="#å…¨é“¾è·¯æœ€ç»ˆéƒ¨ç½²" class="headerlink" title="å…¨é“¾è·¯æœ€ç»ˆéƒ¨ç½²"></a>å…¨é“¾è·¯æœ€ç»ˆéƒ¨ç½²</h2><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220311151019195.png" alt="image-20220311151019195"></p><p>1ã€æ•°æ®æœåŠ¡é›†ç¾¤</p><p>2ã€å¾®æœåŠ¡é›†ç¾¤</p><p>3ã€gatewayç½‘å…³é›†ç¾¤</p><p>4ã€nginxé›†ç¾¤</p><p>5ã€vueåå°</p><p>6ã€ingress controllerç½‘å…³è·¯ç”±</p><p>åœ°å€â€”â€”&gt;ingress controllerâ€”â€”&gt;åŠ¨é™åˆ†ç¦»nginxâ€”â€”&gt;gatewayâ€”â€”&gt;å¾®æœåŠ¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ éƒ¨ç½²æ–¹å¼</span><br><span class="line">+ Jenkinsæµæ°´çº¿</span><br><span class="line">+ è‡ªå·±æ‰“åŒ…éƒ¨ç½²k8sæœåŠ¡</span><br><span class="line">+ æ‹‰å–é•œåƒè‡ªå·±è¿è¡Œ</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="é›†ç¾¤ç›‘æ§"><a href="#é›†ç¾¤ç›‘æ§" class="headerlink" title="é›†ç¾¤ç›‘æ§"></a>é›†ç¾¤ç›‘æ§</h2><p>åŠ¨æ€æ‰©å®¹èŠ‚ç‚¹</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220311132218996.png" alt="image-20220311132142809"></p><p>é¢„è­¦ä¿¡æ¯</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220311152935372.png" alt="image-20220311152935372"></p><p>ç›‘æ§ä¿¡æ¯</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220311132353545.png" alt="image-20220311132353545"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">+ k8sæ¦‚å¿µ</span><br><span class="line">    + podã€server</span><br><span class="line">    + nodeportç­‰</span><br><span class="line">+ åº”ç”¨è·¯ç”±</span><br><span class="line">    + ingress controller</span><br><span class="line">+ é…ç½®ä¸­å¿ƒ</span><br><span class="line">    + configMap</span><br><span class="line">+ Devops</span><br><span class="line">    + è‡ªåŠ¨åŒ–æµæ°´çº¿</span><br><span class="line">        + ä¿®æ”¹æ¨é€ä»£ç </span><br><span class="line">        + è¿è¡Œæµæ°´çº¿æ„å»º</span><br><span class="line">+ ç›‘æ§èµ„æº</span><br><span class="line">+ é›†ç¾¤æŠ€æœ¯</span><br><span class="line">    + ä¸»ä»ã€åˆ†ç‰‡ã€é€‰é¢†å¯¼</span><br><span class="line">    + å„ç§é›†ç¾¤</span><br><span class="line">+ Jenkins file</span><br><span class="line">+ Docker file</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">äº§å“å¼€å‘</summary>
    
    
    
    <category term="äº§å“" scheme="https://fireonice.github.io/categories/%E4%BA%A7%E5%93%81/"/>
    
    
    <category term="äº§å“å¼€å‘" scheme="https://fireonice.github.io/tags/%E4%BA%A7%E5%93%81%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>è°·ç²’å•†åŸâ€”â€”äº‘åŸç”ŸPass-Kubesphere&amp;é›†ç¾¤æ­å»º</title>
    <link href="https://fireonice.github.io/2022/03/08/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-%E4%BA%91%E5%8E%9F%E7%94%9FPaaS%E5%B9%B3%E5%8F%B0Kubesphere/"/>
    <id>https://fireonice.github.io/2022/03/08/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-%E4%BA%91%E5%8E%9F%E7%94%9FPaaS%E5%B9%B3%E5%8F%B0Kubesphere/</id>
    <published>2022-03-08T06:30:22.132Z</published>
    <updated>2022-03-11T03:04:27.724Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Kubesphere"><a href="#Kubesphere" class="headerlink" title="Kubesphere"></a>Kubesphere</h1><p>Kubesphereå®˜ç½‘ï¼š<a href="https://kubesphere.io/zh/">https://kubesphere.io/zh/</a></p><p>KubeSphere æ˜¯ä¸€æ¬¾é¢å‘äº‘åŸç”Ÿè®¾è®¡çš„å¼€æºé¡¹ç›®ï¼Œåœ¨ç›®å‰ä¸»æµå®¹å™¨è°ƒåº¦å¹³å° Kubernetes ä¹‹ä¸Šæ„å»ºçš„åˆ†å¸ƒå¼å¤šç§Ÿæˆ·å®¹å™¨ç®¡ç†å¹³å°ï¼Œæä¾›ç®€å•æ˜“ç”¨çš„æ“ä½œç•Œé¢ä»¥åŠå‘å¯¼å¼æ“ä½œæ–¹å¼ï¼Œåœ¨é™ä½ç”¨æˆ·ä½¿ç”¨å®¹å™¨è°ƒåº¦å¹³å°å­¦ä¹ æˆæœ¬çš„åŒæ—¶ï¼Œæå¤§é™ä½å¼€å‘ã€æµ‹è¯•ã€è¿ç»´çš„æ—¥å¸¸å·¥ä½œçš„å¤æ‚åº¦ã€‚</p><h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><p>1ã€å®‰è£…helmï¼ˆmasterèŠ‚ç‚¹ï¼‰</p><p>2ã€å®‰è£… Tillerï¼ˆmaster æ‰§è¡Œï¼‰ </p><p>3ã€å®‰è£… OpenEBSï¼ˆmaster æ‰§è¡Œï¼‰</p><p>4ã€æœ€å°åŒ–ã€å®Œæ•´åŒ–å®‰è£…Kubesphere</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220308144343351.png" alt="image-20220308144343351"></p><h2 id="å¤šç§Ÿæˆ·ç®¡ç†"><a href="#å¤šç§Ÿæˆ·ç®¡ç†" class="headerlink" title="å¤šç§Ÿæˆ·ç®¡ç†"></a>å¤šç§Ÿæˆ·ç®¡ç†</h2><p>åŒ…æ‹¬é›†ç¾¤(Cluster)ã€ä¼ä¸šç©ºé—´(Workspace)ã€é¡¹ç›®(Project)å’ŒDevOps Project(DevOps å·¥ç¨‹)çš„å±‚çº§å…³ç³»</p><p><img src="https://www.icode9.com/i/ll/?i=20210712161032787.png?,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zMjE5Njg5Mw==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220311104750797.png" alt="image-20220311104750797"></p><h2 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h2><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/1776090-20210826172258323-530376724.png" alt="img"></p><h1 id="é›†ç¾¤"><a href="#é›†ç¾¤" class="headerlink" title="é›†ç¾¤"></a>é›†ç¾¤</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>é›†ç¾¤çš„ç›®æ ‡</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220309074801138.png" alt="image-20220309074801138"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+ é›†ç¾¤ç›®æ ‡</span><br><span class="line">    + é«˜å¯ç”¨HA</span><br><span class="line">    + çªç ´æ•°æ®é‡é™åˆ¶</span><br><span class="line">    + å¤šèŠ‚ç‚¹å­˜å‚¨</span><br><span class="line">    + å¤šèŠ‚ç‚¹å¤‡ä»½</span><br><span class="line">    + æ•°æ®å¤‡ä»½å®¹ç¾</span><br><span class="line">    + å‹åŠ›åˆ†æ‹…</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220309074812891.png" alt="image-20220309074812891"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+ åŸºç¡€å½¢å¼</span><br><span class="line">+ ä¸»ä»</span><br><span class="line">+ åŒæ­¥ï¼šä¸»ä»å¤åˆ¶</span><br><span class="line">        + ä¸»ä»è°ƒåº¦</span><br><span class="line">    + åˆ†ç‰‡</span><br><span class="line">    + åˆ†ç‰‡å­˜å‚¨</span><br><span class="line">    + åˆ†ç‰‡å¤‡ä»½</span><br><span class="line">   + é€‰ä¸»</span><br><span class="line">   + é€‰ä¸»å®¹ç¾</span><br><span class="line">   + é€‰ä¸»è°ƒåº¦</span><br></pre></td></tr></table></figure><h2 id="MySQLé›†ç¾¤"><a href="#MySQLé›†ç¾¤" class="headerlink" title="MySQLé›†ç¾¤"></a>MySQLé›†ç¾¤</h2><p>é›†ç¾¤åŸç†</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220308233055567.png" alt="image-20220308233055567"></p><p>ä¼ä¸šä¸­å¸¸ç”¨çš„æ•°æ®åº“è§£å†³æ–¹æ¡ˆ</p><h3 id="é›†ç¾¤æ–¹å¼"><a href="#é›†ç¾¤æ–¹å¼" class="headerlink" title="é›†ç¾¤æ–¹å¼"></a>é›†ç¾¤æ–¹å¼</h3><p>1ã€MMM</p><p>MySQL-MMM æ˜¯ Master-Master Replication Manager for MySQLï¼ˆmysql ä¸»ä¸»å¤åˆ¶ç®¡ç†å™¨ï¼‰çš„ç®€ç§°ï¼Œæ˜¯ Google çš„å¼€æºé¡¹ç›®ï¼ˆPerl è„šæœ¬ï¼‰ã€‚MMM åŸºäº MySQLReplication åšçš„æ‰©å±•æ¶æ„ï¼Œä¸»è¦ç”¨æ¥ç›‘æ§ mysql ä¸»ä¸»å¤åˆ¶å¹¶åšå¤±è´¥è½¬ç§»ã€‚å…¶åŸç†æ˜¯å°†çœŸå®æ•°æ®åº“èŠ‚ç‚¹çš„IPï¼ˆRIPï¼‰æ˜ å°„ä¸ºè™šæ‹Ÿ IPï¼ˆVIPï¼‰é›†ã€‚mysql-mmm çš„ç›‘ç®¡ç«¯ä¼šæä¾›å¤šä¸ªè™šæ‹Ÿ IPï¼ˆVIPï¼‰ï¼ŒåŒ…æ‹¬ä¸€ä¸ªå¯å†™ VIPï¼Œå¤šä¸ªå¯è¯» VIPï¼Œé€šè¿‡ç›‘ç®¡çš„ç®¡ç†ï¼Œè¿™äº› IP ä¼šç»‘å®šåœ¨å¯ç”¨ mysql ä¹‹ä¸Šï¼Œå½“æŸä¸€å° mysql å®•æœºæ—¶ï¼Œç›‘ç®¡ä¼šå°† VIPè¿ç§»è‡³å…¶ä»– mysqlã€‚åœ¨æ•´ä¸ªç›‘ç®¡è¿‡ç¨‹ä¸­ï¼Œéœ€è¦åœ¨ mysql ä¸­æ·»åŠ ç›¸å…³æˆæƒç”¨æˆ·ï¼Œä»¥ä¾¿è®© mysql å¯ä»¥æ”¯æŒç›‘ç†æœºçš„ç»´æŠ¤ã€‚æˆæƒçš„ç”¨æˆ·åŒ…æ‹¬ä¸€ä¸ªmmm_monitor ç”¨æˆ·å’Œä¸€ä¸ª mmm_agent ç”¨æˆ·ï¼Œå¦‚æœæƒ³ä½¿ç”¨ mmm çš„å¤‡ä»½å·¥å…·åˆ™è¿˜è¦æ·»åŠ ä¸€ä¸ª mmm_tools ç”¨æˆ·ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220308233254614.png" alt="image-20220308233254614"></p><p>2ã€MHA</p><p>MHAï¼ˆMaster High Availabilityï¼‰ç›®å‰åœ¨ MySQL é«˜å¯ç”¨æ–¹é¢æ˜¯ä¸€ä¸ªç›¸å¯¹æˆç†Ÿçš„è§£å†³æ–¹æ¡ˆ, ç”±æ—¥æœ¬ DeNA å…¬å¸ youshimatonï¼ˆç°å°±èŒäº Facebook å…¬å¸ï¼‰å¼€å‘ï¼Œæ˜¯ä¸€å¥—ä¼˜ç§€çš„ä½œä¸º MySQLé«˜å¯ç”¨æ€§ç¯å¢ƒä¸‹æ•…éšœåˆ‡æ¢å’Œä¸»ä»æå‡çš„é«˜å¯ç”¨è½¯ä»¶ã€‚åœ¨MySQLæ•…éšœåˆ‡æ¢è¿‡ç¨‹ä¸­ï¼Œ MHA èƒ½åšåˆ°åœ¨ 0~30 ç§’ä¹‹å†…è‡ªåŠ¨å®Œæˆæ•°æ®åº“çš„æ•…éšœåˆ‡æ¢æ“ä½œï¼ˆä»¥ 2019 å¹´çš„çœ¼å…‰æ¥è¯´å¤ª æ…¢äº†ï¼‰ï¼Œå¹¶ä¸”åœ¨è¿›è¡Œæ•…éšœåˆ‡æ¢çš„è¿‡ç¨‹ä¸­ï¼ŒMHA èƒ½åœ¨æœ€å¤§ç¨‹åº¦ä¸Šä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä»¥ è¾¾åˆ°çœŸæ­£æ„ä¹‰ä¸Šçš„é«˜å¯ç”¨ã€‚</p><p>3ã€InnoDB Cluster</p><p>InnoDB Cluster æ”¯æŒè‡ªåŠ¨ Failoverã€å¼ºä¸€è‡´æ€§ã€è¯»å†™åˆ†ç¦»ã€è¯»åº“é«˜å¯ç”¨ã€è¯»è¯·æ±‚è´Ÿè½½å‡è¡¡ï¼Œæ¨ªå‘æ‰©å±•çš„ç‰¹æ€§ï¼Œæ˜¯æ¯”è¾ƒå®Œå¤‡çš„ä¸€å¥—æ–¹æ¡ˆã€‚ä½†æ˜¯éƒ¨ç½²èµ·æ¥å¤æ‚ï¼Œæƒ³è¦è§£å†³ routerå•ç‚¹é—®é¢˜å¥½éœ€è¦æ–°å¢ç»„ä»¶ï¼Œå¦‚æ²¡æœ‰å…¶ä»–æ›´å¥½çš„æ–¹æ¡ˆå¯è€ƒè™‘è¯¥æ–¹æ¡ˆã€‚ InnoDB Cluster ä¸»è¦ç”± MySQL Shellã€MySQL Router å’Œ MySQL æœåŠ¡å™¨é›†ç¾¤ç»„æˆï¼Œä¸‰è€…ååŒå·¥ä½œï¼Œå…±åŒä¸ºMySQL æä¾›å®Œæ•´çš„é«˜å¯ç”¨æ€§è§£å†³æ–¹æ¡ˆã€‚MySQL Shell å¯¹ç®¡ç†äººå‘˜æä¾›ç®¡ç†æ¥å£ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„å¯¹é›†ç¾¤è¿›è¡Œé…ç½®å’Œç®¡ç†,MySQL Router å¯ä»¥æ ¹æ®éƒ¨ç½²çš„é›†ç¾¤çŠ¶å†µè‡ªåŠ¨çš„åˆå§‹åŒ–ï¼Œæ˜¯å®¢æˆ·ç«¯è¿æ¥å®ä¾‹ã€‚å¦‚æœæœ‰èŠ‚ç‚¹ down æœºï¼Œé›†ç¾¤ä¼šè‡ªåŠ¨æ›´æ–°é…ç½®ã€‚é›†ç¾¤åŒ…å«å•ç‚¹å†™å…¥å’Œå¤šç‚¹å†™å…¥ä¸¤ç§æ¨¡å¼ã€‚åœ¨å•ä¸»æ¨¡å¼ä¸‹ï¼Œå¦‚æœä¸»èŠ‚ç‚¹ down æ‰ï¼Œä»èŠ‚ç‚¹è‡ªåŠ¨æ›¿æ¢ä¸Šæ¥ï¼ŒMySQL Router ä¼šè‡ªåŠ¨æ¢æµ‹ï¼Œå¹¶å°†å®¢æˆ·ç«¯è¿æ¥åˆ°æ–°èŠ‚ç‚¹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220308233434429.png" alt="image-20220308233434429"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+ MMM</span><br><span class="line">+ MHA</span><br><span class="line">+ InnoDB Cluster</span><br><span class="line">+ è‡ªåŠ¨æ•…éšœè½¬ç§»</span><br><span class="line">+ å¼ºä¸€è‡´æ€§</span><br><span class="line">+ è¯»å†™åˆ†ç¦»</span><br><span class="line">+ é«˜å¯ç”¨</span><br><span class="line">+ è´Ÿè½½å‡è¡¡</span><br><span class="line">+ æ¨ªå‘æ‹“å±•</span><br></pre></td></tr></table></figure><h3 id="Cluster-é›†ç¾¤"><a href="#Cluster-é›†ç¾¤" class="headerlink" title="Cluster é›†ç¾¤"></a>Cluster é›†ç¾¤</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">masterï¼š</span><br><span class="line">docker run -p 3307:3306 --name mysql-master \ </span><br><span class="line">-v /mydata/mysql/master/log:/var/log/mysql \ </span><br><span class="line">-v /mydata/mysql/master/data:/var/lib/mysql \ </span><br><span class="line">-v /mydata/mysql/master/conf:/etc/mysql \ </span><br><span class="line">-e MYSQL_ROOT_PASSWORD=root \ -d mysql:5.7 </span><br><span class="line">å‚æ•°è¯´æ˜</span><br><span class="line">-p 3307:3306ï¼šå°†å®¹å™¨çš„ 3306 ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„ 3307 ç«¯å£ </span><br><span class="line">-v /mydata/mysql/master/conf:/etc/mysqlï¼šå°†é…ç½®æ–‡ä»¶å¤¹æŒ‚åœ¨åˆ°ä¸»æœº -v /mydata/mysql/master/log:/var/log/mysqlï¼šå°†æ—¥å¿—æ–‡ä»¶å¤¹æŒ‚è½½åˆ°ä¸»æœº </span><br><span class="line">-v /mydata/mysql/master/data:/var/lib/mysql/ï¼šå°†é…ç½®æ–‡ä»¶å¤¹æŒ‚è½½åˆ°ä¸»æœº </span><br><span class="line">-e MYSQL_ROOT_PASSWORD=rootï¼šåˆå§‹åŒ– root ç”¨æˆ·çš„å¯†ç </span><br><span class="line">slaverï¼š</span><br><span class="line">docker run -p 3317:3306 --name mysql-slaver-01 \ </span><br><span class="line">-v /mydata/mysql/slaver/log:/var/log/mysql \ </span><br><span class="line">-v /mydata/mysql/slaver/data:/var/lib/mysql \ </span><br><span class="line">-v /mydata/mysql/slaver/conf:/etc/mysql \ </span><br><span class="line">-e MYSQL_ROOT_PASSWORD=root \ -d mysql:5.7</span><br><span class="line"></span><br><span class="line">ä¿®æ”¹é…ç½®Masterã€slaver</span><br><span class="line">[client] </span><br><span class="line">default-character-set=utf8 </span><br><span class="line"></span><br><span class="line">[mysql] </span><br><span class="line">default-character-set=utf8</span><br><span class="line"></span><br><span class="line">[mysqld] </span><br><span class="line">init_connect=&#x27;SET collation_connection = utf8_unicode_ci&#x27; </span><br><span class="line">init_connect=&#x27;SET NAMES utf8&#x27; </span><br><span class="line">character-set-server=utf8 </span><br><span class="line">collation-server=utf8_unicode_ci </span><br><span class="line">skip-character-set-client-handshake </span><br><span class="line">skip-name-resolve</span><br><span class="line"></span><br><span class="line">æ·»åŠ  master ä¸»ä»å¤åˆ¶éƒ¨åˆ†é…ç½® </span><br><span class="line">server_id=1 </span><br><span class="line">log-bin=mysql-bin </span><br><span class="line">read-only=0 </span><br><span class="line">binlog-do-db=gulimall_ums </span><br><span class="line">binlog-do-db=gulimall_pms</span><br><span class="line">binlog-do-db=gulimall_oms </span><br><span class="line">binlog-do-db=gulimall_sms </span><br><span class="line">binlog-do-db=gulimall_wms </span><br><span class="line">binlog-do-db=gulimall_admin </span><br><span class="line">replicate-ignore-db=mysql </span><br><span class="line">replicate-ignore-db=sys </span><br><span class="line">replicate-ignore-db=information_schema </span><br><span class="line">replicate-ignore-db=performance_schema</span><br><span class="line"></span><br><span class="line">æ·»åŠ  slaverä¸»ä»å¤åˆ¶éƒ¨åˆ†é…ç½® </span><br><span class="line">server_id=2 </span><br><span class="line">log-bin=mysql-bin </span><br><span class="line">read-only=1binlog-do-db=gulimall_ums </span><br><span class="line">binlog-do-db=gulimall_pms </span><br><span class="line">binlog-do-db=gulimall_oms </span><br><span class="line">binlog-do-db=gulimall_sms </span><br><span class="line">binlog-do-db=gulimall_wms </span><br><span class="line">binlog-do-db=gulimall_admin </span><br><span class="line">replicate-ignore-db=mysql </span><br><span class="line">replicate-ignore-db=sys </span><br><span class="line">replicate-ignore-db=information_schema </span><br><span class="line">replicate-ignore-db=performance_schema</span><br><span class="line"></span><br><span class="line">Masteræˆæƒç”¨æˆ·</span><br><span class="line">GRANT REPLICATION SLAVE ON *.* to &#x27;backup&#x27;@&#x27;%&#x27; identified by &#x27;123456&#x27;; </span><br><span class="line"></span><br><span class="line">Masteræˆæƒç”¨æˆ·</span><br><span class="line">GRANT REPLICATION SLAVE ON *.* to &#x27;backup&#x27;@&#x27;%&#x27; identified by &#x27;123456&#x27;; </span><br><span class="line"></span><br><span class="line">Slaverè®¾ç½®ä¸»åº“è¿æ¥</span><br><span class="line">change master to </span><br><span class="line">master_host=&#x27;192.168.124.135&#x27;,master_user=&#x27;backup&#x27;,master_password=&#x27;123456&#x27;,mas </span><br><span class="line">ter_log_file=&#x27;mysql-bin.000001&#x27;,master_log_pos=0,master_port=3307;</span><br></pre></td></tr></table></figure><p>1ï¼‰ã€ä¸»ä»æ•°æ®åº“åœ¨è‡ªå·±é…ç½®æ–‡ä»¶ä¸­å£°æ˜éœ€è¦åŒæ­¥å“ªä¸ªæ•°æ®åº“ï¼Œå¿½ç•¥å“ªä¸ªæ•°æ®åº“ç­‰ä¿¡æ¯ã€‚å¹¶ä¸” server-id ä¸èƒ½ä¸€æ · </p><p>2ï¼‰ã€ä¸»åº“æˆæƒæŸä¸ªè´¦å·å¯†ç æ¥åŒæ­¥è‡ªå·±çš„æ•°æ® </p><p>3ï¼‰ã€ä»åº“ä½¿ç”¨è¿™ä¸ªè´¦å·å¯†ç è¿æ¥ä¸»åº“æ¥åŒæ­¥æ•°æ®</p><h2 id="ShardingSphere"><a href="#ShardingSphere" class="headerlink" title="ShardingSphere"></a>ShardingSphere</h2><p>ShardingSphere-Proxy</p><p><img src="https://shardingsphere.apache.org/document/current/img/shardingsphere-proxy_v2.png" alt="ShardingSphere-Proxy Architecture"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">dockerï¼š</span><br><span class="line">docker run -d </span><br><span class="line">-v /mydata/sharding-proxy/conf:/opt/sharding-proxy/conf </span><br><span class="line">-v /mydata/sharding-proxy/lib:/opt/sharding-proxy/lib </span><br><span class="line">--env PORT=3308 </span><br><span class="line">-p13308:3308 apache/sharding-proxy:latest</span><br><span class="line">é…ç½®æ•°æ®åˆ†ç‰‡+è¯»å†™åˆ†ç¦»:</span><br><span class="line">schemaName: sharding_db_0</span><br><span class="line">dataSources:</span><br><span class="line">  write_0_ds:</span><br><span class="line">    url: jdbc:mysql://192.168.124.135:3307/demo_ds_0?serverTimezone=UTC&amp;useSSL=false</span><br><span class="line">    username: root</span><br><span class="line">    password: root</span><br><span class="line">    connectionTimeoutMilliseconds: 30000</span><br><span class="line">    idleTimeoutMilliseconds: 60000</span><br><span class="line">    maxLifetimeMilliseconds: 1800000</span><br><span class="line">    maxPoolSize: 50</span><br><span class="line">    minPoolSize: 1</span><br><span class="line">  read_ds_0:</span><br><span class="line">    url: jdbc:mysql://192.168.124.135:3317/demo_ds_0?serverTimezone=UTC&amp;useSSL=false</span><br><span class="line">    username: root</span><br><span class="line">    password: root</span><br><span class="line">    connectionTimeoutMilliseconds: 30000</span><br><span class="line">    idleTimeoutMilliseconds: 60000</span><br><span class="line">    maxLifetimeMilliseconds: 1800000</span><br><span class="line">    maxPoolSize: 50</span><br><span class="line">    minPoolSize: 1</span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="bash">schemaName: sharding_db_1</span></span><br><span class="line">dataSources:</span><br><span class="line">  write_1_ds:</span><br><span class="line">    url: jdbc:mysql://192.168.124.135:3307/demo_ds_1?serverTimezone=UTC&amp;useSSL=false</span><br><span class="line">    username: root</span><br><span class="line">    password: root</span><br><span class="line">    connectionTimeoutMilliseconds: 30000</span><br><span class="line">    idleTimeoutMilliseconds: 60000</span><br><span class="line">    maxLifetimeMilliseconds: 1800000</span><br><span class="line">    maxPoolSize: 50</span><br><span class="line">    minPoolSize: 1</span><br><span class="line">  read_ds_1:</span><br><span class="line">    url: jdbc:mysql://192.168.124.135:3317/demo_ds_1?serverTimezone=UTC&amp;useSSL=false</span><br><span class="line">    username: root</span><br><span class="line">    password: root</span><br><span class="line">    connectionTimeoutMilliseconds: 30000</span><br><span class="line">    idleTimeoutMilliseconds: 60000</span><br><span class="line">    maxLifetimeMilliseconds: 1800000</span><br><span class="line">    maxPoolSize: 50</span><br><span class="line">    minPoolSize: 1</span><br></pre></td></tr></table></figure><p>åˆ†åº“åˆ†è¡¨</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220309075942273.png" alt="image-20220309075942273"></p><h2 id="Redisé›†ç¾¤"><a href="#Redisé›†ç¾¤" class="headerlink" title="Redisé›†ç¾¤"></a>Redisé›†ç¾¤</h2><h3 id="æ•°æ®åˆ†åŒºæ–¹æ¡ˆ"><a href="#æ•°æ®åˆ†åŒºæ–¹æ¡ˆ" class="headerlink" title="æ•°æ®åˆ†åŒºæ–¹æ¡ˆ"></a>æ•°æ®åˆ†åŒºæ–¹æ¡ˆ</h3><p>1ã€å®¢æˆ·ç«¯åˆ†åŒº</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220309131147587.png" alt="image-20220309131147587"></p><p>å®¢æˆ·ç«¯åˆ†åŒºæ–¹æ¡ˆ çš„ä»£è¡¨ä¸º Redis Shardingï¼ŒRedis Sharding æ˜¯ Redis Cluster å‡ºæ¥ä¹‹å‰ï¼Œä¸šç•Œæ™®éä½¿ç”¨çš„ Redis å¤šå®ä¾‹é›†ç¾¤ æ–¹æ³•ã€‚Java çš„ Redis å®¢æˆ·ç«¯é©±åŠ¨åº“ Jedisï¼Œæ”¯æŒ Redis Sharding åŠŸèƒ½ï¼Œå³ ShardedJedis ä»¥åŠ ç»“åˆç¼“å­˜æ±  çš„ ShardedJedisPoolã€‚ </p><p>ä¼˜ç‚¹ï¼šä¸ä½¿ç”¨ ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶ï¼Œåˆ†åŒºé€»è¾‘å¯æ§ï¼Œé…ç½® ç®€å•ï¼ŒèŠ‚ç‚¹ä¹‹é—´æ— å…³è”ï¼Œå®¹æ˜“ çº¿æ€§æ‰©å±•ï¼Œçµæ´»æ€§å¼ºã€‚ </p><p>ç¼ºç‚¹ï¼šå®¢æˆ·ç«¯æ— æ³•åŠ¨æ€å¢åˆ æœåŠ¡èŠ‚ç‚¹ï¼Œå®¢æˆ·ç«¯éœ€è¦è‡ªè¡Œç»´æŠ¤åˆ†å‘é€»è¾‘ï¼Œå®¢æˆ·ç«¯ä¹‹é—´ æ— è¿æ¥å…±äº«ï¼Œä¼šé€ æˆè¿æ¥æµªè´¹ã€‚</p><p>2ã€ä»£ç†åˆ†åŒº</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220309131230974.png" alt="image-20220309131230974"></p><p>ä»£ç†åˆ†åŒºå¸¸ç”¨æ–¹æ¡ˆæœ‰ Twemproxy å’Œ Codisã€‚</p><p>3ã€redis-cluster</p><p>rediså®˜æ–¹æ¨è</p><h3 id="é«˜å¯ç”¨æ–¹å¼"><a href="#é«˜å¯ç”¨æ–¹å¼" class="headerlink" title="é«˜å¯ç”¨æ–¹å¼"></a>é«˜å¯ç”¨æ–¹å¼</h3><p>1ã€Sentinelï¼ˆ å“¨å…µæœºåˆ¶ï¼‰æ”¯æŒé«˜å¯ç”¨</p><p>å‰é¢ä»‹ç»äº†ä¸»ä»æœºåˆ¶ï¼Œä½†æ˜¯ä»è¿ç»´è§’åº¦æ¥çœ‹ï¼Œä¸»èŠ‚ç‚¹å‡ºç°äº†é—®é¢˜æˆ‘ä»¬è¿˜éœ€è¦é€šè¿‡äººå·¥å¹²é¢„çš„æ–¹å¼æŠŠä»èŠ‚ç‚¹è®¾ä¸ºä¸»èŠ‚ç‚¹ï¼Œè¿˜è¦é€šçŸ¥åº”ç”¨ç¨‹åºæ›´æ–°ä¸»èŠ‚ç‚¹åœ°å€ï¼Œè¿™ç§æ–¹å¼éå¸¸ç¹çç¬¨é‡ï¼Œ è€Œ ä¸”ä¸»èŠ‚ç‚¹çš„è¯»å†™èƒ½åŠ›éƒ½ååˆ†æœ‰é™ï¼Œæœ‰æ²¡æœ‰è¾ƒå¥½çš„åŠæ³•è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œå“¨å…µæœºåˆ¶å°±æ˜¯é’ˆå¯¹ç¬¬ ä¸€ä¸ªé—®é¢˜çš„æœ‰æ•ˆè§£å†³æ–¹æ¡ˆï¼Œç¬¬äºŒä¸ªé—®é¢˜åˆ™æœ‰èµ–äºé›†ç¾¤ï¼å“¨å…µçš„ä½œç”¨å°±æ˜¯ç›‘æ§ Redis ç³»ç»Ÿçš„è¿è¡ŒçŠ¶å†µï¼Œå…¶åŠŸèƒ½ä¸»è¦æ˜¯åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªï¼š</p><ul><li><p>ç›‘æ§(Monitoring): å“¨å…µ(sentinel) ä¼šä¸æ–­åœ°æ£€æŸ¥ä½ çš„ Master å’Œ Slave æ˜¯å¦è¿ä½œå¸¸ã€‚ </p></li><li><p>æé†’(Notification): å½“è¢«ç›‘æ§çš„æŸä¸ª Redis å‡ºç°é—®é¢˜æ—¶, å“¨å…µ(sentinel) å¯ä»¥é€šè¿‡ API å‘ç®¡ç†å‘˜æˆ–è€…å…¶ä»–åº”ç”¨ç¨‹åºå‘é€é€šçŸ¥ã€‚ </p></li><li><p>è‡ªåŠ¨æ•…éšœè¿ç§»(Automatic failover): å½“ä¸»æ•°æ®åº“å‡ºç°æ•…éšœæ—¶è‡ªåŠ¨å°†ä»æ•°æ®åº“è½¬æ¢ä¸ºä¸»æ•° æ®åº“ã€‚</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220309131342915.png" alt="image-20220309131342915"></p><p><strong>å“¨å…µçš„åŸç†</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+ Redis Sentinel</span><br><span class="line">+ ä¸‰ä¸ªå®šæ—¶ç›‘æ§ä»»åŠ¡</span><br><span class="line">+ å‘ä¸»èŠ‚ç‚¹å‘é€è¯·æ±‚è·å–æœ€æ–°æ‹“æ‰‘ç»“æ„</span><br><span class="line">+ å‘redisèŠ‚ç‚¹çš„å“¨å…µé¢‘é“å‘é€æ•…éšœåˆ¤æ–­åŠè‡ªèº«èŠ‚ç‚¹ä¿¡æ¯</span><br><span class="line">+ å“¨å…µä¹‹é—´è®¢é˜…å“¨å…µé¢‘é“ï¼Œäº†è§£é›†ç¾¤ä¿¡æ¯</span><br><span class="line">+ å‘å…¨éƒ¨èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬å“¨å…µï¼‰å‘é€å¿ƒè·³æ£€æµ‹</span><br><span class="line">+ å¿ƒè·³æ£€æµ‹å¼‚å¸¸ï¼Œåˆ¤æ–­ä¸‹çº¿</span><br><span class="line">+ ä¸»èŠ‚ç‚¹åˆ¤æ–­ä¸‹çº¿</span><br><span class="line">+ éœ€è¦å¤šä¸ªå“¨å…µæ£€æµ‹ä¸‹çº¿ç¥¨æ•°</span><br><span class="line">+ æ•…éšœæ£€æµ‹å’Œleaderé€‰ä¸¾</span><br><span class="line">+ ä¸»èŠ‚ç‚¹åˆ¤æ–­ä¸‹çº¿</span><br><span class="line">+ é‡‡ç”¨Raftç®—æ³•é€‰ä¸¾leaderï¼ˆè¯¦è§å‰å‡ æ¬¡åšå®¢ï¼šRaftåŸç†ï¼‰</span><br></pre></td></tr></table></figure><p>2ã€redis-cluster</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+ Redis Cluster</span><br><span class="line">+ 3ä¸»3ä»</span><br><span class="line">+ æ•…éšœè½¬ç§»</span><br><span class="line">+ é€‰ä¸¾ä»èŠ‚ç‚¹ä¸Šä½</span><br><span class="line">+ keyè·¯ç”±</span><br><span class="line">+ å“ˆå¸Œæ§½åˆ†åŒºï¼š16384æ§½ä½</span><br><span class="line">+ æ•°æ®è¿ç§»</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220309131556005.png" alt="image-20220309131556005"></p><h3 id="åˆ†åŒºç®—æ³•"><a href="#åˆ†åŒºç®—æ³•" class="headerlink" title="åˆ†åŒºç®—æ³•"></a>åˆ†åŒºç®—æ³•</h3><p>1ã€å“ˆå¸Œæ§½åˆ†åŒºï¼ˆCRC16æ ¡éªŒç®—æ³•ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220309131813090.png" alt="image-20220309131813090"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">+ å“ˆå¸Œæ§½åˆ†åŒº</span><br><span class="line">+ é—®é¢˜é™åˆ¶</span><br><span class="line">+ keyæ‰¹é‡æ“ä½œ</span><br><span class="line">+ msetã€mgetåªæ”¯æŒç›¸åŒslotå€¼çš„keyæ‰¹é‡æ“ä½œ</span><br><span class="line">+ æ˜ å°„ä¸ºä¸åŒslotåˆ†å¸ƒåœ¨ä¸åŒèŠ‚ç‚¹</span><br><span class="line">+ keyäº‹åŠ¡æ“ä½œ</span><br><span class="line">+ åªæ”¯æŒkeyåœ¨åŒä¸€èŠ‚ç‚¹äº‹åŠ¡</span><br><span class="line">+ keyä½œä¸ºåˆ†åŒºæœ€å°ç²’åº¦</span><br><span class="line">+ ä¸èƒ½å°†å¤§çš„é”®å€¼å¯¹è±¡ï¼Œå¦‚hashã€listæ˜ å°„ä¸åŒèŠ‚ç‚¹</span><br><span class="line">+ ä¸æ”¯æŒå¤šæ•°æ®åº“ç©ºé—´</span><br><span class="line">+ é›†ç¾¤æ¨¡å¼åªæœ‰ä¸€ä¸ªæ•°æ®åº“db0</span><br><span class="line">+ å¤åˆ¶ç»“æ„åªæ”¯æŒä¸€å±‚</span><br><span class="line">+ ä»èŠ‚ç‚¹ åªèƒ½å¤åˆ¶ ä¸»èŠ‚ç‚¹ï¼Œä¸æ”¯æŒ åµŒå¥—æ ‘çŠ¶å¤åˆ¶ ç»“æ„</span><br><span class="line">+ å‘½ä»¤å¤§å¤šä¼šé‡å®šå‘ï¼Œè€—æ—¶å¤š</span><br><span class="line">+ éæœ¬èŠ‚ç‚¹æ•°æ®</span><br></pre></td></tr></table></figure><p>2ã€ä¸€è‡´æ€§å“ˆå¸Œ</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220309132413181.png" alt="image-20220309132413181"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ ä¸€è‡´æ€§å“ˆå¸Œ</span><br><span class="line">+ ç¨³å®šæ€§</span><br><span class="line">+ å“ˆå¸Œå€¾æ–œé—®é¢˜</span><br><span class="line">+ å¼•å…¥è™šæ‹ŸèŠ‚ç‚¹</span><br><span class="line">+ å°†è™šæ‹ŸèŠ‚ç‚¹æ•°æ®åˆ’åˆ†åˆ°å…¶çœŸå®æ•°æ®èŠ‚ç‚¹ï¼Œä¿è¯è´Ÿè½½å‡è¡¡</span><br></pre></td></tr></table></figure><h3 id="éƒ¨ç½²-1"><a href="#éƒ¨ç½²-1" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">for port in $(seq 7001 7006); \ </span><br><span class="line">do \ </span><br><span class="line">mkdir -p /mydata/redis/node-$&#123;port&#125;/conf </span><br><span class="line">touch /mydata/redis/node-$&#123;port&#125;/conf/redis.conf </span><br><span class="line">cat &lt;&lt; EOF &gt;/mydata/redis/node-$&#123;port&#125;/conf/redis.conf </span><br><span class="line">port $&#123;port&#125; </span><br><span class="line">cluster-enabled yes </span><br><span class="line">cluster-config-file nodes.conf </span><br><span class="line">cluster-node-timeout 5000 </span><br><span class="line">cluster-announce-ip 192.168.56.10cluster-announce-port $&#123;port&#125; </span><br><span class="line">cluster-announce-bus-port 1$&#123;port&#125; </span><br><span class="line">appendonly yes </span><br><span class="line">EOF </span><br><span class="line">docker run -p $&#123;port&#125;:$&#123;port&#125; -p 1$&#123;port&#125;:1$&#123;port&#125; --name redis-$&#123;port&#125; \ </span><br><span class="line">-v /mydata/redis/node-$&#123;port&#125;/data:/data \ </span><br><span class="line">-v /mydata/redis/node-$&#123;port&#125;/conf/redis.conf:/etc/redis/redis.conf \ </span><br><span class="line">-d redis:5.0.7 redis-server /etc/redis/redis.conf; \ </span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">docker exec -it redis-7001 bash redis-cli --cluster create 192.168.56.10:7001 192.168.56.10:7002 192.168.56.10:7003 192.168.56.10:7004 192.168.56.10:7005 192.168.56.10:7006 --cluster-replicas 1</span><br></pre></td></tr></table></figure><h2 id="Elasticsearché›†ç¾¤"><a href="#Elasticsearché›†ç¾¤" class="headerlink" title="Elasticsearché›†ç¾¤"></a>Elasticsearché›†ç¾¤</h2><p>elasticsearch æ˜¯<strong>å¤©ç”Ÿæ”¯æŒé›†ç¾¤</strong>çš„ï¼Œä»–ä¸éœ€è¦ä¾èµ–å…¶ä»–çš„æœåŠ¡å‘ç°å’Œæ³¨å†Œçš„ç»„ä»¶ï¼Œå¦‚ zookeeper è¿™äº›ï¼Œå› ä¸ºä»–å†…ç½®äº†ä¸€ä¸ªåå­—å« ZenDiscovery çš„æ¨¡å—ï¼Œæ˜¯ elasticsearch è‡ªå·±å®ç°çš„ä¸€å¥—ç”¨äºèŠ‚ç‚¹å‘ç°å’Œé€‰ä¸»ç­‰åŠŸèƒ½çš„ç»„ä»¶ï¼Œæ‰€ä»¥ elasticsearch åšèµ·é›†ç¾¤æ¥éå¸¸ç®€å•ï¼Œä¸éœ€è¦å¤ªå¤šé¢å¤–çš„é…ç½®å’Œå®‰è£…é¢å¤–çš„ç¬¬ä¸‰æ–¹ç»„ä»¶ã€‚</p><h3 id="é›†ç¾¤åŸç†"><a href="#é›†ç¾¤åŸç†" class="headerlink" title="é›†ç¾¤åŸç†"></a>é›†ç¾¤åŸç†</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">+ èŠ‚ç‚¹</span><br><span class="line">+ ä¸»èŠ‚ç‚¹</span><br><span class="line">+ ç®¡ç†é›†ç¾¤å˜æ›´</span><br><span class="line">+ ä»»æ„èŠ‚ç‚¹çŸ¥é“ä»»æ„æ–‡æ¡£ä½ç½®</span><br><span class="line">+ è¯·æ±‚è½¬å‘åˆ°å­˜å‚¨æ–‡æ¡£çš„èŠ‚ç‚¹</span><br><span class="line">+ é›†ç¾¤å¥åº·</span><br><span class="line">+ yellow</span><br><span class="line">+ ä¸»åˆ†ç‰‡æ­£å¸¸è¿è¡Œï¼Œå‰¯æœ¬åˆ†ç‰‡ä¸æ­£å¸¸</span><br><span class="line">+ green</span><br><span class="line">+ red</span><br><span class="line">+ åˆ†ç‰‡</span><br><span class="line">+ å…¨éƒ¨æ•°æ®çš„ä¸€éƒ¨åˆ†</span><br><span class="line">+ ä¸»åˆ†ç‰‡</span><br><span class="line">+ å†³å®šç´¢å¼•ä¿å­˜çš„æœ€å¤§æ•°æ®é‡</span><br><span class="line">+ å‰¯æœ¬åˆ†ç‰‡</span><br><span class="line">+ éšæ—¶å¯ä»¥ä¿®æ”¹</span><br><span class="line">+ ç´¢å¼•å»ºç«‹æ—¶ç¡®å®šä¸»åˆ†ç‰‡ã€å‰¯æœ¬åˆ†ç‰‡æ•°é‡</span><br><span class="line">+ æ–°å¢èŠ‚ç‚¹</span><br><span class="line">+ è‡ªåŠ¨å‘ç°ã€åŠ å…¥é›†ç¾¤</span><br><span class="line">        + èŠ‚ç‚¹ç›¸åŒclustre.name</span><br><span class="line">        + é…ç½®å¯è¿æ¥åˆ°çš„ä¸»æœºåˆ—è¡¨</span><br><span class="line">+ æ°´å¹³æ‰©å®¹</span><br><span class="line">+ è‡ªåŠ¨è¿ç§»åˆ†ç‰‡</span><br><span class="line">+ åŠ¨æ€æ‰©å¤§å‰¯æœ¬æ•°é‡</span><br><span class="line">+ æé«˜é›†ç¾¤æœç´¢æ€§èƒ½</span><br><span class="line">+ åº”å¯¹æ•…éšœ</span><br><span class="line">+ èŠ‚ç‚¹å®•æœº</span><br><span class="line">+ é›†ç¾¤é€‰ä¸»</span><br><span class="line">+ å‰¯æœ¬åˆ†ç‰‡æå‡ä¸ºä¸»åˆ†ç‰‡</span><br><span class="line">+ èŠ‚ç‚¹æ¢å¤</span><br><span class="line">+ ç¼ºå¤±å‰¯æœ¬åˆ†ç‰‡é‡æ–°åˆ†é…</span><br><span class="line">+ é—®é¢˜ä¸è§£å†³</span><br><span class="line">+ ä¸»èŠ‚ç‚¹</span><br><span class="line">+ åˆ›å»ºç´¢å¼•ã€åˆ é™¤ç´¢å¼•ã€åˆ†é…åˆ†ç‰‡ã€è¿½è¸ªé›†ç¾¤çŠ¶æ€</span><br><span class="line">+ è´Ÿè´£åˆ†å‘å’Œè¿”å›ç»“æœ</span><br><span class="line">+ é¦–å…ˆæˆä¸ºå€™é€‰ä¸»èŠ‚ç‚¹</span><br><span class="line">+ å€™é€‰ä¸»èŠ‚ç‚¹</span><br><span class="line">+ é€‰ä¸¾å…¶ä¸­ä¸€ä¸ªä½œä¸ºä¸»èŠ‚ç‚¹</span><br><span class="line">+ é—®é¢˜</span><br><span class="line">+ masteré€‰æ‹©åˆ†æ­§ï¼Œå¯¼è‡´ä¸»åˆ†ç‰‡ã€å‰¯æœ¬åˆ†æ­§</span><br><span class="line">+ æ•°æ®èŠ‚ç‚¹</span><br><span class="line">+ è´Ÿè´£æ•°æ®å­˜å‚¨ã€èšåˆç­‰</span><br><span class="line">+ é›†ç¾¤éœ€è¦è®¾ç½®ä¸“ç”¨å€™é€‰ä¸»èŠ‚ç‚¹å’Œæ•°æ®èŠ‚ç‚¹</span><br><span class="line">+ é¿å…å› æ•°æ®èŠ‚ç‚¹è´Ÿè½½é‡å¯¼ è‡´ä¸»èŠ‚ç‚¹ä¸å“åº”</span><br><span class="line">+ å®¢æˆ·ç«¯èŠ‚ç‚¹</span><br><span class="line">+ éä¸»èŠ‚ç‚¹ã€æ•°æ®èŠ‚ç‚¹</span><br><span class="line">+ åªè´Ÿè´£è¯·æ±‚çš„åˆ†å‘ã€æ±‡æ€»</span><br><span class="line">+ ä¸ºäº†è´Ÿè½½å‡è¡¡</span><br><span class="line">+ è„‘è£‚é—®é¢˜å¯èƒ½çš„åŸå› </span><br><span class="line">+ ç½‘ç»œé—®é¢˜</span><br><span class="line">+ ä¸€äº›èŠ‚ç‚¹è®¿é—®ä¸åˆ°master</span><br><span class="line">+ é€‰ä¸¾æ–°master</span><br><span class="line">+ èŠ‚ç‚¹è´Ÿè½½</span><br><span class="line">+ ä¸»èŠ‚ç‚¹æ—¢ä¸ºmasteråˆä¸ºdata</span><br><span class="line">+ è®¿é—®è¿‡å¤§ï¼Œeså»¶è¿Ÿå“åº”ç­‰</span><br><span class="line">+ å…¶ä»–èŠ‚ç‚¹é€‰ä¸¾æ–°master</span><br><span class="line">+ å†…å­˜å›æ”¶</span><br><span class="line">+ dataèŠ‚ç‚¹å ç”¨å†…å­˜è¾ƒå¤§</span><br><span class="line">+ JVMå¤§è§„æ¨¡å†…å­˜å›æ”¶</span><br><span class="line">+ eså¤±å»å“åº”</span><br><span class="line">+ è„‘è£‚é—®é¢˜è§£å†³æ–¹æ¡ˆ</span><br><span class="line">+ è§’è‰²åˆ†ç¦»</span><br><span class="line">+ masterèŠ‚ç‚¹ä¸dataèŠ‚ç‚¹åˆ†ç¦»ï¼Œé™åˆ¶è§’è‰²</span><br><span class="line">+ å‡å°‘masterèŠ‚ç‚¹å·¥ä½œå‹åŠ›</span><br><span class="line">+ å‡å°‘è¯¯åˆ¤</span><br><span class="line">+ é…ç½®ä¸»èŠ‚ç‚¹å“åº”æ—¶é—´å»¶é•¿</span><br><span class="line">+ å‡å°‘å®•æœºè¯¯åˆ¤</span><br><span class="line">+ é€‰ä¸¾è§¦å‘</span><br><span class="line">+ è®¾ç½®é€‰ä¸¾è§¦å‘èµ„æ ¼</span><br><span class="line">+ é›†ç¾¤å¤§äºä¸€åŠçš„èŠ‚ç‚¹ç›¸äº’è¿æ¥æ‰èƒ½è¿›è¡Œé€‰ä¸¾</span><br><span class="line">+ é˜²æ­¢å°‘éƒ¨åˆ†èŠ‚ç‚¹å¤±è”ç‹¬è‡ªé€‰ä¸¾</span><br></pre></td></tr></table></figure><h3 id="é›†ç¾¤ç»“æ„"><a href="#é›†ç¾¤ç»“æ„" class="headerlink" title="é›†ç¾¤ç»“æ„"></a>é›†ç¾¤ç»“æ„</h3><p>  ä»¥ä¸‰å°ç‰©ç†æœºä¸ºä¾‹ã€‚åœ¨è¿™ä¸‰å°ç‰©ç†æœºä¸Šï¼Œæ­å»ºäº† 6 ä¸ª ES çš„èŠ‚ç‚¹ï¼Œä¸‰ä¸ª data èŠ‚ç‚¹ï¼Œä¸‰ä¸ª master èŠ‚ç‚¹ï¼ˆæ¯å°ç‰©ç†æœºåˆ†åˆ«èµ·äº†ä¸€ä¸ª data å’Œä¸€ä¸ª masterï¼‰ï¼Œ3 ä¸ª master èŠ‚ç‚¹ï¼Œç›®çš„æ˜¯è¾¾åˆ°ï¼ˆn/2ï¼‰ +1 ç­‰äº 2 çš„è¦æ±‚ï¼Œè¿™æ ·æŒ‚æ‰ä¸€å° master åï¼ˆä¸è€ƒè™‘ dataï¼‰ï¼Œn ç­‰äº 2ï¼Œæ»¡è¶³å‚æ•°ï¼Œå…¶ä»–ä¸¤ä¸ª master èŠ‚ç‚¹éƒ½è®¤ä¸º master æŒ‚æ‰ä¹‹åå¼€å§‹é‡æ–°é€‰ä¸¾</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220310232611812.png" alt="image-20220310232611812"></p><h3 id="é›†ç¾¤æ­å»º"><a href="#é›†ç¾¤æ­å»º" class="headerlink" title="é›†ç¾¤æ­å»º"></a>é›†ç¾¤æ­å»º</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">1ã€é˜²æ­¢ JVM æŠ¥é”™</span><br><span class="line">echo vm.max_map_count=262144 &gt;&gt; /etc/sysctl.conf</span><br><span class="line">sysctl -p</span><br><span class="line">2ã€å‡†å¤‡dockerç½‘ç»œï¼ˆåˆ›å»ºè‡ªå·±çš„ bridge ç½‘ç»œï¼‰</span><br><span class="line">docker network create --driver bridge --subnet=172.18.12.0/16 --gateway=172.18.1.1 mynet</span><br><span class="line">3ã€master*3èŠ‚ç‚¹åˆ›å»º</span><br><span class="line">for port in $(seq 1 3); \ </span><br><span class="line">do \ </span><br><span class="line">mkdir -p /mydata/elasticsearch/master-$&#123;port&#125;/config </span><br><span class="line">mkdir -p /mydata/elasticsearch/master-$&#123;port&#125;/data </span><br><span class="line">chmod -R 777 /mydata/elasticsearch/master-$&#123;port&#125; </span><br><span class="line">cat &lt;&lt; EOF &gt;/mydata/elasticsearch/master-$&#123;port&#125;/config/elasticsearch.yml </span><br><span class="line">cluster.name: my-es #é›†ç¾¤çš„åç§°ï¼ŒåŒä¸€ä¸ªé›†ç¾¤è¯¥å€¼å¿…é¡»è®¾ç½®æˆç›¸åŒçš„ </span><br><span class="line">node.name: es-master-$&#123;port&#125; #è¯¥èŠ‚ç‚¹çš„åå­— </span><br><span class="line">node.master: true #è¯¥èŠ‚ç‚¹æœ‰æœºä¼šæˆä¸º master èŠ‚ç‚¹ </span><br><span class="line">node.data: false #è¯¥èŠ‚ç‚¹å¯ä»¥å­˜å‚¨æ•°æ® </span><br><span class="line">network.host: 0.0.0.0 </span><br><span class="line">http.host: 0.0.0.0 #æ‰€æœ‰ http å‡å¯è®¿é—® </span><br><span class="line">http.port: 920$&#123;port&#125; </span><br><span class="line">transport.tcp.port: 930$&#123;port&#125; </span><br><span class="line"><span class="meta">#</span><span class="bash">discovery.zen.minimum_master_nodes: 2 <span class="comment">#è®¾ç½®è¿™ä¸ªå‚æ•°æ¥ä¿è¯é›†ç¾¤ä¸­çš„èŠ‚ç‚¹å¯ä»¥çŸ¥é“å…¶</span></span> </span><br><span class="line">å®ƒ N ä¸ªæœ‰ master èµ„æ ¼çš„èŠ‚ç‚¹ã€‚å®˜æ–¹æ¨èï¼ˆN/2ï¼‰+1 </span><br><span class="line">discovery.zen.ping_timeout: 10s #è®¾ç½®é›†ç¾¤ä¸­è‡ªåŠ¨å‘ç°å…¶ä»–èŠ‚ç‚¹æ—¶ ping è¿æ¥çš„è¶…æ—¶æ—¶é—´ </span><br><span class="line">discovery.seed_hosts: [&quot;172.18.12.21:9301&quot;, &quot;172.18.12.22:9302&quot;, &quot;172.18.12.23:9303&quot;] #è®¾ç½®é›† </span><br><span class="line">ç¾¤ä¸­çš„ Master èŠ‚ç‚¹çš„åˆå§‹åˆ—è¡¨ï¼Œå¯ä»¥é€šè¿‡è¿™äº›èŠ‚ç‚¹æ¥è‡ªåŠ¨å‘ç°å…¶ä»–æ–°åŠ å…¥é›†ç¾¤çš„èŠ‚ç‚¹ï¼Œes7 </span><br><span class="line">çš„æ–°å¢é…ç½® </span><br><span class="line">cluster.initial_master_nodes: [&quot;172.18.12.21&quot;] #æ–°é›†ç¾¤åˆå§‹æ—¶çš„å€™é€‰ä¸»èŠ‚ç‚¹ï¼Œes7 çš„æ–°å¢é…ç½® </span><br><span class="line">EOF </span><br><span class="line">docker run --name elasticsearch-node-$&#123;port&#125; \ </span><br><span class="line">-p 920$&#123;port&#125;:920$&#123;port&#125; -p 930$&#123;port&#125;:930$&#123;port&#125; \ </span><br><span class="line">--network=mynet --ip 172.18.12.2$&#123;port&#125; \-e ES_JAVA_OPTS=&quot;-Xms300m -Xmx300m&quot; \ </span><br><span class="line">-v</span><br><span class="line"><span class="meta">/mydata/elasticsearch/master-$</span><span class="bash">&#123;port&#125;/config/elasticsearch.yml:/usr/share/elasticsearch/config/el</span> </span><br><span class="line">asticsearch.yml \ </span><br><span class="line">-v /mydata/elasticsearch/master-$&#123;port&#125;/data:/usr/share/elasticsearch/data \ </span><br><span class="line">-v /mydata/elasticsearch/master-$&#123;port&#125;/plugins:/usr/share/elasticsearch/plugins \ </span><br><span class="line">-d elasticsearch:7.4.2 </span><br><span class="line">done </span><br><span class="line">4ã€data-node*3èŠ‚ç‚¹åˆ›å»º</span><br><span class="line">for port in $(seq 4 6); \ </span><br><span class="line">do \ </span><br><span class="line">mkdir -p /mydata/elasticsearch/node-$&#123;port&#125;/config </span><br><span class="line">mkdir -p /mydata/elasticsearch/node-$&#123;port&#125;/data </span><br><span class="line">chmod -R 777 /mydata/elasticsearch/node-$&#123;port&#125; </span><br><span class="line">cat &lt;&lt; EOF &gt;/mydata/elasticsearch/node-$&#123;port&#125;/config/elasticsearch.yml </span><br><span class="line">cluster.name: my-es #é›†ç¾¤çš„åç§°ï¼ŒåŒä¸€ä¸ªé›†ç¾¤è¯¥å€¼å¿…é¡»è®¾ç½®æˆç›¸åŒçš„ </span><br><span class="line">node.name: es-node-$&#123;port&#125; #è¯¥èŠ‚ç‚¹çš„åå­— </span><br><span class="line">node.master: false #è¯¥èŠ‚ç‚¹æœ‰æœºä¼šæˆä¸º master èŠ‚ç‚¹ </span><br><span class="line">node.data: true #è¯¥èŠ‚ç‚¹å¯ä»¥å­˜å‚¨æ•°æ® </span><br><span class="line">network.host: 0.0.0.0 </span><br><span class="line"><span class="meta">#</span><span class="bash">network.publish_host: 192.168.56.10 <span class="comment">#äº’ç›¸é€šä¿¡ ipï¼Œè¦è®¾ç½®ä¸ºæœ¬æœºå¯è¢«å¤–ç•Œè®¿é—®çš„ ipï¼Œå¦åˆ™</span></span> </span><br><span class="line">æ— æ³•é€šä¿¡ </span><br><span class="line">http.host: 0.0.0.0 #æ‰€æœ‰ http å‡å¯è®¿é—® </span><br><span class="line">http.port: 920$&#123;port&#125; </span><br><span class="line">transport.tcp.port: 930$&#123;port&#125; </span><br><span class="line"><span class="meta">#</span><span class="bash">discovery.zen.minimum_master_nodes: 2 <span class="comment">#è®¾ç½®è¿™ä¸ªå‚æ•°æ¥ä¿è¯é›†ç¾¤ä¸­çš„èŠ‚ç‚¹å¯ä»¥çŸ¥é“å…¶</span></span> </span><br><span class="line">å®ƒ N ä¸ªæœ‰ master èµ„æ ¼çš„èŠ‚ç‚¹ã€‚å®˜æ–¹æ¨èï¼ˆN/2ï¼‰+1 </span><br><span class="line">discovery.zen.ping_timeout: 10s #è®¾ç½®é›†ç¾¤ä¸­è‡ªåŠ¨å‘ç°å…¶ä»–èŠ‚ç‚¹æ—¶ ping è¿æ¥çš„è¶…æ—¶æ—¶é—´ </span><br><span class="line">discovery.seed_hosts: [&quot;172.18.12.21:9301&quot;, &quot;172.18.12.22:9302&quot;, &quot;172.18.12.23:9303&quot;] #è®¾ç½®é›† </span><br><span class="line">ç¾¤ä¸­çš„ Master èŠ‚ç‚¹çš„åˆå§‹åˆ—è¡¨ï¼Œå¯ä»¥é€šè¿‡è¿™äº›èŠ‚ç‚¹æ¥è‡ªåŠ¨å‘ç°å…¶ä»–æ–°åŠ å…¥é›†ç¾¤çš„èŠ‚ç‚¹ï¼Œes7 </span><br><span class="line">çš„æ–°å¢é…ç½® </span><br><span class="line">cluster.initial_master_nodes: [&quot;172.18.12.21&quot;] #æ–°é›†ç¾¤åˆå§‹æ—¶çš„å€™é€‰ä¸»èŠ‚ç‚¹ï¼Œes7 çš„æ–°å¢é…ç½® </span><br><span class="line">EOF </span><br><span class="line">docker run --name elasticsearch-node-$&#123;port&#125; \ </span><br><span class="line">-p 920$&#123;port&#125;:920$&#123;port&#125; -p 930$&#123;port&#125;:930$&#123;port&#125; \ </span><br><span class="line">--network=mynet --ip 172.18.12.2$&#123;port&#125; \ </span><br><span class="line">-e ES_JAVA_OPTS=&quot;-Xms300m -Xmx300m&quot; \ </span><br><span class="line"><span class="meta">-v/mydata/elasticsearch/node-$</span><span class="bash">&#123;port&#125;/config/elasticsearch.yml:/usr/share/elasticsearch/config/ela</span> </span><br><span class="line">sticsearch.yml \ </span><br><span class="line">-v /mydata/elasticsearch/node-$&#123;port&#125;/data:/usr/share/elasticsearch/data \ </span><br><span class="line">-v /mydata/elasticsearch/node-$&#123;port&#125;/plugins:/usr/share/elasticsearch/plugins \ </span><br><span class="line">-d elasticsearch:7.4.2 </span><br><span class="line">done </span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220310234921706.png" alt="image-20220310234921706"></p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220310234912741.png" alt="image-20220310234912741"></p><h2 id="RabbitMQé›†ç¾¤"><a href="#RabbitMQé›†ç¾¤" class="headerlink" title="RabbitMQé›†ç¾¤"></a>RabbitMQé›†ç¾¤</h2><p>RabbiMQ æ˜¯ç”¨ Erlang å¼€å‘çš„ï¼Œé›†ç¾¤éå¸¸æ–¹ä¾¿ï¼Œå› ä¸º Erlang å¤©ç”Ÿå°±æ˜¯ä¸€é—¨åˆ†å¸ƒå¼è¯­è¨€ï¼Œä½†å…¶æœ¬èº«å¹¶ä¸æ”¯æŒè´Ÿè½½å‡è¡¡ã€‚ </p><p>RabbitMQ é›†ç¾¤ä¸­èŠ‚ç‚¹åŒ…æ‹¬**å†…å­˜èŠ‚ç‚¹(RAM)<strong>ã€</strong>ç£ç›˜èŠ‚ç‚¹(Diskï¼Œæ¶ˆæ¯æŒä¹…åŒ–)**ï¼Œé›†ç¾¤ä¸­è‡³å°‘æœ‰ ä¸€ä¸ª Disk èŠ‚ç‚¹ã€‚</p><h3 id="é›†ç¾¤åŸç†-1"><a href="#é›†ç¾¤åŸç†-1" class="headerlink" title="é›†ç¾¤åŸç†"></a>é›†ç¾¤åŸç†</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">+ é›†ç¾¤å½¢å¼</span><br><span class="line">+ æ™®é€šæ¨¡å¼</span><br><span class="line">+ é›†ç¾¤ç‰¹ç‚¹</span><br><span class="line">            + å„èŠ‚ç‚¹ç›¸åŒé˜Ÿåˆ—ç»“æ„</span><br><span class="line">            + æ¶ˆæ¯åªå­˜åœ¨äºä¸€ä¸ªèŠ‚ç‚¹</span><br><span class="line">            + æ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œéœ€è¦é€šè¿‡èŠ‚ç‚¹ç›´æ¥è½¬å‘</span><br><span class="line">+ åº”ç”¨åœºæ™¯</span><br><span class="line">+ é€‚åˆæ¶ˆæ¯æ— éœ€æŒä¹…åŒ–åœºæ™¯ï¼Œæ—¥å¿—é˜Ÿåˆ—ç­‰</span><br><span class="line">+ å®•æœºæ—¶å¯ç›´æ¥è¿æ¥å…¶ä»–èŠ‚ç‚¹ï¼Œåªéœ€é‡æ–°åˆ›å»ºé˜Ÿåˆ—</span><br><span class="line">+ é•œåƒæ¨¡å¼</span><br><span class="line">+ é›†ç¾¤ç‰¹ç‚¹</span><br><span class="line">            + æ¶ˆæ¯å®ä½“ä¼šä¸»åŠ¨åœ¨é•œåƒèŠ‚ç‚¹é—´åŒæ­¥ï¼ˆæ¶ˆæ¯åˆ°é˜Ÿåˆ—æ—¶ï¼‰</span><br><span class="line">            + mirror queueé€‰ä¸¾ç®—æ³•</span><br><span class="line">                + 1ä¸ªmasterï¼Œnä¸ªslaver</span><br><span class="line">                + ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…è¯·æ±‚è½¬è‡³master</span><br><span class="line">+ é•œåƒé›†ç¾¤åŸºäºæ™®é€šé›†ç¾¤</span><br><span class="line">+ å…ˆæ­å»ºæ™®é€šé›†ç¾¤ï¼Œå†è®¾ç½®é•œåƒé˜Ÿåˆ—</span><br><span class="line">+ ç¼ºç‚¹</span><br><span class="line">+ é•œåƒé˜Ÿåˆ—è¿‡å¤šï¼Œä¸”æ¶ˆæ¯ä½“é‡å¤§</span><br><span class="line">+ é›†ç¾¤å†…éƒ¨ç½‘ç»œå¸¦å®½å°†ä¼šè¢«æ­¤ç§åŒæ­¥é€šè®¯æ‰€æ¶ˆè€—</span><br><span class="line">+ åº”ç”¨åœºæ™¯</span><br><span class="line">+ å¯é æ€§è¦æ±‚è¾ƒé«˜åœºåˆï¼Œå¦‚ä¸‹å•ã€åº“å­˜é˜Ÿåˆ—</span><br><span class="line">        + è‹¥æ¶ˆè´¹è¿‡ç¨‹ä¸­ï¼Œmaster æŒ‚æ‰ï¼Œåˆ™é€‰ä¸¾æ–° master</span><br><span class="line">           + è‹¥æœªæ¥å¾—åŠç¡®è®¤ï¼Œåˆ™å¯èƒ½ä¼šé‡å¤æ¶ˆè´¹</span><br></pre></td></tr></table></figure><h3 id="é›†ç¾¤æ­å»º-1"><a href="#é›†ç¾¤æ­å»º-1" class="headerlink" title="é›†ç¾¤æ­å»º"></a>é›†ç¾¤æ­å»º</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">1ã€å¯åŠ¨å®¹å™¨</span><br><span class="line">mkdir /mydata/rabbitmq </span><br><span class="line">cd rabbitmq/ </span><br><span class="line">mkdir rabbitmq01 rabbitmq02 rabbitmq03</span><br><span class="line">docker run -d --hostname rabbitmq01 --name rabbitmq01 -v /mydata/rabbitmq/rabbitmq01:/var/lib/rabbitmq -p 15673:15672 -p 5673:5672 -e RABBITMQ_ERLANG_COOKIE=&#x27;atguigu&#x27; rabbitmq:management</span><br><span class="line">docker run -d --hostname rabbitmq02 --name rabbitmq02 -v</span><br><span class="line">/mydata/rabbitmq/rabbitmq02:/var/lib/rabbitmq -p 15674:15672 -p 5674:5672 -e RABBITMQ_ERLANG_COOKIE=&#x27;atguigu&#x27; --link rabbitmq01:rabbitmq01 rabbitmq:management</span><br><span class="line">docker run -d --hostname rabbitmq03 --name rabbitmq03 -v /mydata/rabbitmq/rabbitmq03:/var/lib/rabbitmq -p 15675:15672 -p 5675:5672 -e RABBITMQ_ERLANG_COOKIE=&#x27;atguigu&#x27; --link rabbitmq01:rabbitmq01 --link rabbitmq02:rabbitmq02 rabbitmq:management</span><br><span class="line">--hostname è®¾ç½®å®¹å™¨çš„ä¸»æœºå </span><br><span class="line">RABBITMQ_ERLANG_COOKIE èŠ‚ç‚¹è®¤è¯ä½œç”¨ï¼Œéƒ¨ç½²é›†æˆæ—¶ éœ€è¦åŒæ­¥è¯¥å€¼</span><br><span class="line">2ã€èŠ‚ç‚¹åŠ å…¥é›†ç¾¤</span><br><span class="line">docker exec -it rabbitmq01 /bin/bash </span><br><span class="line">rabbitmqctl stop_app </span><br><span class="line">rabbitmqctl reset </span><br><span class="line">rabbitmqctl start_app </span><br><span class="line">è¿›å…¥ç¬¬äºŒä¸ªèŠ‚ç‚¹ </span><br><span class="line">docker exec -it rabbitmq02 /bin/bash rabbitmqctl stop_app rabbitmqctl reset rabbitmqctl join_cluster --ram rabbit@rabbitmq01 rabbitmqctl start_app exit </span><br><span class="line">è¿›å…¥ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹ docker exec -it rabbitmq03 bash rabbitmqctl stop_app rabbitmqctl reset rabbitmqctl join_cluster --ram rabbit@rabbitmq01 rabbitmqctl start_app exit</span><br><span class="line">3ã€å®ç°é•œåƒé›†ç¾¤</span><br><span class="line">docker exec -it rabbitmq01 bash</span><br><span class="line">rabbitmqctl set_policy -p / ha &quot;^&quot; &#x27;&#123;&quot;ha-mode&quot;:&quot;all&quot;,&quot;ha-sync-mode&quot;:&quot;automatic&quot;&#125;&#x27; </span><br><span class="line">å¯ä»¥ä½¿ç”¨ rabbitmqctl list_policies -p /ï¼›æŸ¥çœ‹ vhost/ä¸‹é¢çš„æ‰€æœ‰ policy</span><br><span class="line">åœ¨ cluster ä¸­ä»»æ„èŠ‚ç‚¹å¯ç”¨ç­–ç•¥ï¼Œç­–ç•¥ä¼šè‡ªåŠ¨åŒæ­¥åˆ°é›†ç¾¤èŠ‚ç‚¹</span><br><span class="line">rabbitmqctl set_policy-p/ha-all&quot;^&quot;â€™&#123;â€œha-modeâ€:â€œallâ€&#125;â€™</span><br><span class="line">ç­–ç•¥æ¨¡å¼ all å³å¤åˆ¶åˆ°æ‰€æœ‰èŠ‚ç‚¹ï¼ŒåŒ…å«æ–°å¢èŠ‚ç‚¹ï¼Œç­–ç•¥æ­£åˆ™è¡¨è¾¾å¼ä¸º â€œ^â€ è¡¨ç¤ºæ‰€æœ‰åŒ¹é…æ‰€æœ‰é˜Ÿåˆ—åç§°ã€‚â€œ^helloâ€è¡¨ç¤ºåªåŒ¹é…åä¸º hello å¼€å§‹çš„é˜Ÿåˆ—</span><br></pre></td></tr></table></figure><p>æ”¹ä¸ºé•œåƒé›†ç¾¤ï¼šåŒæ­¥</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220310234800034.png" alt="image-20220310234800034"></p>]]></content>
    
    
    <summary type="html">äº§å“å¼€å‘</summary>
    
    
    
    <category term="äº§å“" scheme="https://fireonice.github.io/categories/%E4%BA%A7%E5%93%81/"/>
    
    
    <category term="äº§å“å¼€å‘" scheme="https://fireonice.github.io/tags/%E4%BA%A7%E5%93%81%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>è°·ç²’å•†åŸâ€”â€”äº‘åŸç”Ÿæ ¸å¿ƒ-Kubernetes</title>
    <link href="https://fireonice.github.io/2022/03/06/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-%E4%BA%91%E5%8E%9F%E7%94%9F%E6%A0%B8%E5%BF%83-Kubernetes/"/>
    <id>https://fireonice.github.io/2022/03/06/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-%E4%BA%91%E5%8E%9F%E7%94%9F%E6%A0%B8%E5%BF%83-Kubernetes/</id>
    <published>2022-03-06T14:49:41.462Z</published>
    <updated>2022-03-06T15:28:24.559Z</updated>
    
    <content type="html"><![CDATA[<h1 id="k8s"><a href="#k8s" class="headerlink" title="k8s"></a>k8s</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>Dockeråªæ˜¯è§£å†³æœåŠ¡ä¸‹å±‚çš„é—®é¢˜ï¼ŒæœåŠ¡ä¸Šå±‚å»ºç­‘å¦‚å®¹å™¨ç¼–æ’ï¼ŒæœåŠ¡å‘ç°ç­‰é—®é¢˜å·²ç»è¶…è¶Šäº†Dockerçš„ç®¡è¾–ã€‚</p><p>Kubernetesæä¾›çš„ç¼–æ’å’Œç®¡ç†åŠŸèƒ½ï¼Œè½»æ¾å®Œæˆå¤§è§„æ¨¡å®¹å™¨éƒ¨ç½²ï¼Œå€ŸåŠ©k8sçš„ç¼–æ’åŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥æ„å»ºè·¨å¤šä¸ªå®¹å™¨çš„åº”ç”¨æœåŠ¡ï¼Œå®ç°è·¨é›†ç¾¤è°ƒåº¦ï¼Œæ‰©å±•å®¹å™¨ï¼Œä»¥åŠé•¿æœŸæŒç»­ç®¡ç†è¿™äº›å®¹å™¨çš„å¥åº·çŠ¶å†µç­‰ï¼Œå¹¶æ•´åˆç½‘ç»œï¼Œå­˜å‚¨ï¼Œå®‰å…¨æ€§ï¼Œç›‘æ§åŠå…¶ä»–æœåŠ¡ï¼Œæä¾›å…¨é¢çš„å®¹å™¨åŸºç¡€æ¶æ„ã€‚</p><p>Kubernetes æ»¡è¶³äº†ä¸€ç³»åˆ—äº§å“å†…è¿è¡Œç¨‹åºçš„æ™®é€šéœ€æ±‚ï¼Œå…¼å…·å¹³å°å³æœåŠ¡ï¼ˆPaaSï¼‰çš„ç®€åŒ–å’ŒåŸºç¡€æ¶æ„å³æœåŠ¡ï¼ˆIaaSï¼‰çš„çµæ´»ï¼Œå¹¶ä¿ƒè¿›äº†åœ¨å¹³å°æœåŠ¡æä¾›å•†ä¹‹é—´çš„è¿ç§»ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220306225820940.png" alt="image-20220306225820940"></p><p><strong>å¾®æœåŠ¡</strong><br>å¾®æœåŠ¡è§£å†³çš„æ˜¯æˆ‘ä»¬è½¯ä»¶å¼€å‘ä¸­ä¸€ç›´è¿½æ±‚çš„ä½è€¦åˆ+é«˜å†…èšï¼Œå¾®æœåŠ¡å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¾®æœåŠ¡çš„æœ¬è´¨æ˜¯æŠŠä¸€å—å¤§é¥¼åˆ†æˆè‹¥å¹²å—ä½è€¦åˆçš„å°é¥¼ï¼Œæ¯”å¦‚ä¸€å—å°é¥¼ä¸“é—¨è´Ÿè´£æ¥æ”¶å¤–éƒ¨çš„æ•°æ®ï¼Œä¸€å—å°é¥¼ä¸“é—¨è´Ÿè´£å“åº”å‰å°çš„æ“ä½œï¼Œå°é¥¼å¯ä»¥è¿›ä¸€æ­¥æ‹†åˆ†ï¼Œæ¯”å¦‚è´Ÿè´£æ¥æ”¶å¤–éƒ¨æ•°æ®çš„å°é¥¼å¯ä»¥ç»§ç»­åˆ†æˆå¤šå—è´Ÿè´£æ¥æ”¶ä¸åŒç±»å‹æ•°æ®çš„å°é¥¼ï¼Œè¿™æ ·æ¯ä¸ªå°é¥¼å‡ºé—®é¢˜äº†ï¼Œå…¶å®ƒå°é¥¼è¿˜èƒ½æ­£å¸¸å¯¹å¤–æä¾›æœåŠ¡ã€‚</p><p><strong>DevOps</strong><br>DevOpsçš„æ„æ€å°±æ˜¯å¼€å‘å’Œè¿ç»´ä¸å†æ˜¯åˆ†å¼€çš„ä¸¤ä¸ªå›¢é˜Ÿï¼Œè€Œæ˜¯ä½ ä¸­æœ‰æˆ‘ï¼Œæˆ‘ä¸­æœ‰ä½ çš„ä¸€ä¸ªå›¢é˜Ÿã€‚æˆ‘ä»¬ç°åœ¨å¼€å‘å’Œè¿ç»´å·²ç»æ˜¯ä¸€ä¸ªå›¢é˜Ÿäº†ï¼Œä½†æ˜¯è¿ç»´æ–¹é¢çš„çŸ¥è¯†å’Œç»éªŒè¿˜éœ€è¦æŒç»­æé«˜ã€‚</p><p><strong>æŒç»­äº¤ä»˜</strong><br>æŒç»­äº¤ä»˜çš„æ„æ€å°±æ˜¯åœ¨ä¸å½±å“ç”¨æˆ·ä½¿ç”¨æœåŠ¡çš„å‰æä¸‹é¢‘ç¹æŠŠæ–°åŠŸèƒ½å‘å¸ƒç»™ç”¨æˆ·ä½¿ç”¨ï¼Œè¦åšåˆ°è¿™ç‚¹éå¸¸éå¸¸éš¾ã€‚æˆ‘ä»¬ç°åœ¨ä¸¤å‘¨ä¸€ä¸ªç‰ˆæœ¬ï¼Œæ¯æ¬¡ä¸Šçº¿ä¹‹åéƒ½ä¼šç»™ä¸åŒçš„ç”¨æˆ·é€ æˆä¸åŒç¨‹åº¦çš„å½±å“ã€‚</p><p><strong>å®¹å™¨åŒ–</strong><br>å®¹å™¨åŒ–çš„å¥½å¤„åœ¨äºè¿ç»´çš„æ—¶å€™ä¸éœ€è¦å†å…³å¿ƒæ¯ä¸ªæœåŠ¡æ‰€ä½¿ç”¨çš„æŠ€æœ¯æ ˆäº†ï¼Œæ¯ä¸ªæœåŠ¡éƒ½è¢«æ— å·®åˆ«åœ°å°è£…åœ¨å®¹å™¨é‡Œï¼Œå¯ä»¥è¢«æ— å·®åˆ«åœ°ç®¡ç†å’Œç»´æŠ¤ï¼Œç°åœ¨æ¯”è¾ƒæµè¡Œçš„å·¥å…·æ˜¯dockerå’Œk8sã€‚</p><p>ç®€å•åœ°æŠŠäº‘åŸç”Ÿç†è§£ä¸ºï¼šäº‘åŸç”Ÿ = å¾®æœåŠ¡ + DevOps + æŒç»­äº¤ä»˜ + å®¹å™¨åŒ–</p><p>k8så®˜ç½‘ï¼š<a href="https://kubernetes.io/">https://kubernetes.io/</a></p><h2 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h2><p>æ•´ä½“ä¸»ä»æ–¹å¼</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220306230018184.png" alt="image-20220306230018184"></p><ul><li><p>ç»„ä»¶</p><ul><li><p>master</p><ul><li>kube-apiserver<ul><li>å¤–ç•Œè¿›è¡Œèµ„æºæ“ä½œçš„å…¥å£</li><li>è®¤è¯ã€æˆæƒã€è®¿é—®æ§åˆ¶ã€apiæ³¨å†Œã€å‘ç°</li></ul></li><li>etcd<ul><li>nosqlæ•°æ®åº“</li><li>é›†ç¾¤æ•°æ®</li></ul></li><li>kube-schedule<ul><li>ä»etcdä¸­è·å–ä»»åŠ¡è¿›è¡Œè°ƒåº¦ï¼Œé€‰æ‹©èŠ‚ç‚¹è¿è¡Œ</li><li>æ‰€æœ‰å¯¹k8sé›†ç¾¤çš„æ“ä½œï¼Œéƒ½å¿…é¡»ç»è¿‡ä¸»èŠ‚ç‚¹</li></ul></li><li>kube-controller-manager<ul><li>node controllerï¼ˆèŠ‚ç‚¹æ§åˆ¶å™¨ï¼‰<ul><li>åœ¨èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶è¿›è¡Œé€šçŸ¥å’Œå“åº”</li></ul></li><li>replication controllerï¼ˆå‰¯æœ¬æ§åˆ¶å™¨ï¼‰<ul><li>éƒ¨ç½²</li></ul></li><li>endpoints controllerï¼ˆç«¯ç‚¹æ§åˆ¶å™¨ï¼‰<ul><li>æš´éœ²ç«¯å£ä¹‹ç±»çš„</li></ul></li><li>service account &amp; token controllers<ul><li>æ§åˆ¶å®‰å…¨</li></ul></li></ul></li></ul></li><li><p>node</p><ul><li>container runtime<ul><li>å®¹å™¨è¿è¡Œç¯å¢ƒï¼Œå¦‚docker</li></ul></li><li>kubelet<ul><li>æ¯ä¸ªèŠ‚ç‚¹çš„ä»£ç†ï¼Œä¿è¯å®¹å™¨éƒ½è¿è¡Œåœ¨Podä¸­<ul><li>podï¼šä¸€ç»„å®¹å™¨ï¼Œæœ€å°éƒ¨ç½²å•å…ƒ</li></ul></li><li>ç»´æŠ¤å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ•°æ®å·ã€ç½‘ç»œ</li></ul></li><li>kube-proxy<ul><li>æ¯ä¸ªèŠ‚ç‚¹çš„ç½‘ç»œä»£ç†ï¼Œå¸®åŠ©è¯·æ±‚è·¯ç”±å’Œè®¿é—®å…·ä½“å®¹å™¨</li></ul></li><li>fluentd<ul><li>èŠ‚ç‚¹æ—¥å¿—æ”¶é›†</li></ul></li></ul></li></ul></li></ul><p>master</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220306230319472.png" alt="image-20220306230319472"></p><p>node</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220306230348661.png" alt="image-20220306230348661"></p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220306230401741.png" alt="image-20220306230401741"></p><ul><li><p>Containerï¼šå®¹å™¨ï¼Œå¯ä»¥æ˜¯ docker å¯åŠ¨çš„ä¸€ä¸ªå®¹å™¨ </p></li><li><p>Podï¼š </p><ul><li>k8s ä½¿ç”¨ Pod æ¥ç»„ç»‡ä¸€ç»„å®¹å™¨ </li><li>ä¸€ä¸ª Pod ä¸­çš„æ‰€æœ‰å®¹å™¨å…±äº«åŒä¸€ç½‘ç»œã€‚ </li><li>Pod æ˜¯ k8s ä¸­çš„æœ€å°éƒ¨ç½²å•å…ƒ </li></ul></li><li><p>Volume </p><ul><li>å£°æ˜åœ¨ Pod å®¹å™¨ä¸­å¯è®¿é—®çš„æ–‡ä»¶ç›®å½• </li><li>å¯ä»¥è¢«æŒ‚è½½åœ¨ Pod ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨æŒ‡å®šè·¯å¾„ä¸‹ </li><li>æ”¯æŒå¤šç§åç«¯å­˜å‚¨æŠ½è±¡(æœ¬åœ°å­˜å‚¨ï¼Œåˆ†å¸ƒå¼å­˜å‚¨ï¼Œäº‘å­˜å‚¨â€¦) </li></ul></li><li><p>Controllersï¼šæ›´é«˜å±‚æ¬¡å¯¹è±¡ï¼Œéƒ¨ç½²å’Œç®¡ç† Podï¼›</p><ul><li>ReplicaSetï¼šç¡®ä¿é¢„æœŸçš„ Pod å‰¯æœ¬æ•°é‡ </li><li>Deplotmentï¼šæ— çŠ¶æ€åº”ç”¨éƒ¨ç½² </li><li>StatefulSetï¼šæœ‰çŠ¶æ€åº”ç”¨éƒ¨ç½² </li><li>DaemonSetï¼šç¡®ä¿æ‰€æœ‰ Node éƒ½è¿è¡Œä¸€ä¸ªæŒ‡å®š Pod </li><li>Jobï¼šä¸€æ¬¡æ€§ä»»åŠ¡ </li><li>Cronjobï¼šå®šæ—¶ä»»åŠ¡ </li></ul></li><li><p>Deploymentï¼š </p><ul><li>å®šä¹‰ä¸€ç»„ Pod çš„å‰¯æœ¬æ•°ç›®ã€ç‰ˆæœ¬ç­‰ </li><li>é€šè¿‡æ§åˆ¶å™¨ï¼ˆControllerï¼‰ç»´æŒ Pod æ•°ç›®(è‡ªåŠ¨å›å¤å¤±è´¥çš„ Pod) </li><li>é€šè¿‡æ§åˆ¶å™¨ä»¥æŒ‡å®šçš„ç­–ç•¥æ§åˆ¶ç‰ˆæœ¬ï¼ˆæ»šåŠ¨å‡çº§ï¼Œå›æ»šç­‰ï¼‰ </li></ul></li><li><p>Service </p><ul><li>å®šä¹‰ä¸€ç»„ Pod çš„è®¿é—®ç­–ç•¥ </li><li>Pod çš„è´Ÿè½½å‡è¡¡ï¼Œæä¾›ä¸€ä¸ªæˆ–è€…å¤šä¸ª Pod çš„ç¨³å®šè®¿é—®åœ°å€ </li><li>æ”¯æŒå¤šç§æ–¹å¼ï¼ˆClusterIPã€NodePortã€LoadBalanceï¼‰ </li></ul></li><li><p>Labelï¼šæ ‡ç­¾ï¼Œç”¨äºå¯¹è±¡èµ„æºçš„æŸ¥è¯¢ï¼Œç­›é€‰ </p></li><li><p>Namespaceï¼šå‘½åç©ºé—´ï¼Œé€»è¾‘éš”ç¦»</p><ul><li>ä¸€ä¸ªé›†ç¾¤å†…éƒ¨çš„é€»è¾‘éš”ç¦»æœºåˆ¶ï¼ˆé‰´æƒï¼Œèµ„æºï¼‰ </li><li>æ¯ä¸ªèµ„æºéƒ½å±äºä¸€ä¸ª namespace </li><li>åŒä¸€ä¸ª namespace æ‰€æœ‰èµ„æºåä¸èƒ½é‡å¤ </li></ul></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220306230837907.png" alt="image-20220306230837907"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+ æµç¨‹</span><br><span class="line">    + kubectlâ€”â€”apiserverâ€”â€”etcd</span><br><span class="line">    + controller managerâ€”â€”ç›‘å¬â€”â€”apiserver</span><br><span class="line">    + å‘ç°podæœªåˆ›å»º</span><br><span class="line">    + æ ¹æ®podæ¨¡æ¿ç”Ÿæˆpodå¯¹è±¡ï¼Œapiserverâ€”â€”etcd</span><br><span class="line">    + schedulerâ€”â€”ç›‘å¬â€”â€”é€‰å®šnodeï¼Œapiserverâ€”â€”etcd</span><br><span class="line">    + kubeletâ€”â€”ç›‘å¬â€”â€”å¯åŠ¨pod</span><br></pre></td></tr></table></figure><h2 id="å®¹å™¨ç®¡ç†"><a href="#å®¹å™¨ç®¡ç†" class="headerlink" title="å®¹å™¨ç®¡ç†"></a>å®¹å™¨ç®¡ç†</h2><p>è°ƒåº¦</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220306225909169.png" alt="image-20220306225909169"></p><p>è‡ªåŠ¨æ¢å¤</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220306225921697.png" alt="image-20220306225921697"></p><p>æ°´å¹³ä¼¸ç¼©</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220306225940799.png" alt="image-20220306225940799"></p><h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220306231026852.png" alt="image-20220306231026852"></p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220306231116495.png" alt="image-20220306231116495"></p><p>1ã€è®¾ç½® linux ç¯å¢ƒ</p><p>2ã€æ‰€æœ‰èŠ‚ç‚¹å®‰è£… Dockerã€kubeadmã€kubeletã€kubectl</p><p>3ã€å®‰è£… Pod ç½‘ç»œæ’ä»¶ï¼ˆCNIï¼‰</p><p>4ã€åŠ å…¥ Kubernetes Node </p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220306231924323.png" alt="image-20220306231924323"></p><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p>podã€controller</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220306232549267.png" alt="image-20220306232549267"></p><p>deploymentã€service</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220306232559381.png" alt="image-20220306232559381"></p><p>labelsã€selectors</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220306232631265.png" alt="image-20220306232631265"></p><p>ingress</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220306232639695.png" alt="image-20220306232639695"></p><p>ingressâ€”â€”&gt;serviceâ€”â€”&gt;podâ€”â€”&gt;container</p><p>ç½‘ç»œæ¨¡å‹</p><p>Kubernetesçš„ç½‘ç»œæ¨¡å‹ä»å†…è‡³å¤–ç”±å››ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p><p>1ã€Podå†…éƒ¨å®¹å™¨æ‰€åœ¨çš„ç½‘ç»œ </p><p>2ã€Podæ‰€åœ¨çš„ç½‘ç»œ </p><p>3ã€Podå’ŒServiceä¹‹é—´é€šä¿¡çš„ç½‘ç»œ</p><p>4ã€å¤–ç•Œä¸Serviceä¹‹é—´é€šä¿¡çš„ç½‘ç»œ</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220306232717133.png" alt="image-20220306232717133"></p>]]></content>
    
    
    <summary type="html">äº§å“å¼€å‘</summary>
    
    
    
    <category term="äº§å“" scheme="https://fireonice.github.io/categories/%E4%BA%A7%E5%93%81/"/>
    
    
    <category term="äº§å“å¼€å‘" scheme="https://fireonice.github.io/tags/%E4%BA%A7%E5%93%81%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>è°·ç²’å•†åŸâ€”â€”é«˜å¹¶å‘ï¼ˆç§’æ€ï¼‰ç³»ç»Ÿ&amp;Sentinel&amp;é“¾è·¯è¿½è¸ª</title>
    <link href="https://fireonice.github.io/2022/03/04/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-%E9%AB%98%E5%B9%B6%E5%8F%91%EF%BC%88%E7%A7%92%E6%9D%80%EF%BC%89%E7%B3%BB%E7%BB%9F&amp;Sentinel&amp;%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA/"/>
    <id>https://fireonice.github.io/2022/03/04/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-%E9%AB%98%E5%B9%B6%E5%8F%91%EF%BC%88%E7%A7%92%E6%9D%80%EF%BC%89%E7%B3%BB%E7%BB%9F&amp;Sentinel&amp;%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA/</id>
    <published>2022-03-04T14:07:06.689Z</published>
    <updated>2022-03-20T07:18:45.854Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1ã€ç§’æ€ä¸šåŠ¡"><a href="#1ã€ç§’æ€ä¸šåŠ¡" class="headerlink" title="1ã€ç§’æ€ä¸šåŠ¡"></a>1ã€ç§’æ€ä¸šåŠ¡</h1><p>ç§’æ€å…·æœ‰ç¬é—´é«˜å¹¶å‘çš„ç‰¹ç‚¹ï¼Œé’ˆå¯¹è¿™ä¸€ç‰¹ç‚¹ï¼Œå¿…é¡»è¦åšé™æµ + å¼‚æ­¥ + ç¼“å­˜ï¼ˆé¡µé¢é™æ€åŒ–ï¼‰+ ç‹¬ç«‹éƒ¨ç½²ã€‚ </p><h2 id="ç§’æ€ç³»ç»Ÿè®¾è®¡"><a href="#ç§’æ€ç³»ç»Ÿè®¾è®¡" class="headerlink" title="ç§’æ€ç³»ç»Ÿè®¾è®¡"></a>ç§’æ€ç³»ç»Ÿè®¾è®¡</h2><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220304221850788.png" alt="image-20220304221850788"></p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220304221910750.png" alt="image-20220304221910750"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">+ ç§’æ€ï¼ˆé«˜å¹¶å‘ï¼‰ç³»ç»Ÿå…³æ³¨çš„é—®é¢˜</span><br><span class="line">    + ç‹¬ç«‹éƒ¨ç½²</span><br><span class="line">    + é˜²æ­¢å½±å“å…¶ä»–æœåŠ¡</span><br><span class="line">    + é“¾æ¥åŠ å¯†</span><br><span class="line">    + é˜²æ­¢è¯·æ±‚æš´éœ²ï¼Œæ¶æ„æ”»å‡»</span><br><span class="line">    + åº“å­˜é¢„çƒ­</span><br><span class="line">        + redisä¿¡å·é‡</span><br><span class="line">        + redisé«˜å¯ç”¨</span><br><span class="line">    + åŠ¨é™åˆ†ç¦»</span><br><span class="line">        + nginx</span><br><span class="line">        + cdn</span><br><span class="line">    + æ¶æ„è¯·æ±‚æ‹¦æˆª</span><br><span class="line">    + ç½‘å…³å±‚</span><br><span class="line">    + æµé‡é”™å³°</span><br><span class="line">        + å°ç±³ï¼šéªŒè¯ç </span><br><span class="line">        + éªŒè¯æ­£å¸¸è¯·æ±‚</span><br><span class="line">    + æµé‡é”™å³°</span><br><span class="line">   + åŠ å…¥è´­ç‰©è½¦</span><br><span class="line">    + ç»“ç®—æ—¶é—´ä¸åŒï¼Œæµé‡é”™å³°</span><br><span class="line">    + é™æµ&amp;ç†”æ–­&amp;é™çº§</span><br><span class="line">        + é™æµ</span><br><span class="line">            + å‰ç«¯é™æµ</span><br><span class="line">            + ç‚¹å‡»æ¬¡æ•°ã€é—´éš”é™åˆ¶</span><br><span class="line">            + åç«¯é™æµ</span><br><span class="line">                + ç­›é€‰éç”¨æˆ·è¡Œä¸º</span><br><span class="line">                + é™åˆ¶è¯·æ±‚æ¬¡æ•°ã€æ€»é‡            </span><br><span class="line">            + nginxé™æµ</span><br><span class="line">            + ç›´æ¥è´Ÿè½½éƒ¨åˆ†è¯·æ±‚åˆ°é”™è¯¯çš„é™æ€é¡µé¢</span><br><span class="line">            + ä»¤ç‰Œç®—æ³• æ¼æ–—ç®—æ³•</span><br><span class="line">            + ç½‘å…³é™æµ</span><br><span class="line">            + é™æµçš„è¿‡æ»¤å™¨</span><br><span class="line">        + ç†”æ–­ã€é™çº§</span><br><span class="line">            + è°ƒç”¨é“¾è·¯å¼‚å¸¸ï¼Œå¿«é€Ÿå¤±è´¥ç†”æ–­</span><br><span class="line">            + æµé‡å¤ªå¤§ï¼Œå¼•å¯¼éƒ¨åˆ†è¯·æ±‚é™çº§</span><br><span class="line">    + é˜Ÿåˆ—å‰Šå³°ï¼ˆæ€æ‰‹é”ï¼‰</span><br><span class="line">        + æŠ¢åˆ°ä¿¡å·é‡çš„æ”¾è¡Œåå°</span><br><span class="line">        + åå°å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ï¼Œè¿”å›ç§’æ€æˆåŠŸå›è°ƒ</span><br><span class="line">        + è®¢å•æœåŠ¡ç­‰ç›‘å¬é˜Ÿåˆ—ï¼Œæ…¢æ…¢åˆ›å»ºè®¢å•å¤„ç†æˆåŠŸç§’æ€çš„æ¶ˆæ¯</span><br></pre></td></tr></table></figure><h2 id="ç§’æ€å•†å“ä¸Šæ¶ï¼ˆå®šæ—¶ã€å¼‚æ­¥ã€å¹‚ç­‰æ€§ï¼‰ã€å±•ç¤ºã€æ¸²æŸ“"><a href="#ç§’æ€å•†å“ä¸Šæ¶ï¼ˆå®šæ—¶ã€å¼‚æ­¥ã€å¹‚ç­‰æ€§ï¼‰ã€å±•ç¤ºã€æ¸²æŸ“" class="headerlink" title="ç§’æ€å•†å“ä¸Šæ¶ï¼ˆå®šæ—¶ã€å¼‚æ­¥ã€å¹‚ç­‰æ€§ï¼‰ã€å±•ç¤ºã€æ¸²æŸ“"></a>ç§’æ€å•†å“ä¸Šæ¶ï¼ˆå®šæ—¶ã€å¼‚æ­¥ã€å¹‚ç­‰æ€§ï¼‰ã€å±•ç¤ºã€æ¸²æŸ“</h2><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220304222418396.png" alt="image-20220304222418396"></p><p>å®šæ—¶ä»»åŠ¡&amp;å¼‚æ­¥ä»»åŠ¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">+ å¼€å¯å®šæ—¶ä»»åŠ¡@EnableScheduling</span><br><span class="line">+ å®šæ—¶æ–¹æ³•æ³¨è§£@Scheduled</span><br><span class="line">+ springä¸­åŒºåˆ«</span><br><span class="line">        + cronè¯­æ³•</span><br><span class="line">        + é»˜è®¤é˜»å¡</span><br><span class="line">+ è§£å†³é˜»å¡</span><br><span class="line">        + å¼‚æ­¥ç¼–æ’è¿è¡Œï¼Œè‡ªå·±æäº¤åˆ°çº¿ç¨‹æ± </span><br><span class="line">        + æ”¯æŒå®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± ï¼ˆçº¿ç¨‹æ± é»˜è®¤å¤§å°ä¸ºä¸€ï¼‰</span><br><span class="line">            + é…ç½®æ–‡ä»¶è®¾ç½®çº¿ç¨‹æ± å¤§å°</span><br><span class="line">            + ä¸å¤ªå¥½ä½¿</span><br><span class="line">        + è®©å®šæ—¶ä»»åŠ¡å¼‚æ­¥æ‰§è¡Œï¼ˆå¼‚æ­¥ä»»åŠ¡ï¼‰</span><br><span class="line"></span><br><span class="line">+ å¼‚æ­¥ä»»åŠ¡</span><br><span class="line">    + å¼€å¯å¼‚æ­¥ä»»åŠ¡@EnableAsync</span><br><span class="line">    + å¼‚æ­¥æ–¹æ³•æ³¨è§£@Async</span><br><span class="line">        + é»˜è®¤ä½¿ç”¨çº¿ç¨‹æ± ï¼Œå¤§å°ä¸º8</span><br><span class="line">        + å¯é…ç½®çº¿ç¨‹æ± å±æ€§</span><br><span class="line"></span><br><span class="line">+ åœ¨Springä¸­è¡¨è¾¾å¼æ˜¯6ä½ç»„æˆï¼Œä¸å…è®¸ç¬¬ä¸ƒä½çš„å¹´ä»½</span><br><span class="line">+ åœ¨å‘¨å‡ çš„çš„ä½ç½®,1-7ä»£è¡¨å‘¨ä¸€åˆ°å‘¨æ—¥</span><br><span class="line">+ å®šæ—¶ä»»åŠ¡ä¸è¯¥é˜»å¡ã€‚é»˜è®¤æ˜¯é˜»å¡çš„</span><br><span class="line">+ å¯ä»¥è®©ä¸šåŠ¡ä»¥å¼‚æ­¥çš„æ–¹å¼ï¼Œè‡ªå·±æäº¤åˆ°çº¿ç¨‹æ± </span><br><span class="line">+ CompletableFuture.runAsync(() -&gt; &#123;&#125;,execute);</span><br><span class="line">+ æ”¯æŒå®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± ï¼›è®¾ç½® TaskSchedulingProperties</span><br><span class="line">+ spring.task.scheduling.pool.size: 5</span><br><span class="line">+ è®©å®šæ—¶ä»»åŠ¡å¼‚æ­¥æ‰§è¡Œ</span><br><span class="line">+ å¼‚æ­¥ä»»åŠ¡</span><br><span class="line">+ è§£å†³ï¼šä½¿ç”¨å¼‚æ­¥ä»»åŠ¡ + å®šæ—¶ä»»åŠ¡æ¥å®Œæˆå®šæ—¶ä»»åŠ¡ä¸é˜»å¡çš„åŠŸèƒ½</span><br></pre></td></tr></table></figure><p>ä¸Šæ¶å•†å“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">+ ä¸Šæ¶service</span><br><span class="line">    + è¿œç¨‹è°ƒç”¨ä¼˜æƒ ç³»ç»Ÿï¼Œæ‰«ææœ€è¿‘ä¸‰å¤©éœ€è¦ç§’æ€çš„å•†å“</span><br><span class="line">    + æŸ¥è¯¢æœ€è¿‘ä¸‰å¤©ç§’æ€æ´»åŠ¨</span><br><span class="line">    + å¾—åˆ°æœ€è¿‘ä¸‰å¤©æ ¼å¼åŒ–æ—¥æœŸ </span><br><span class="line">+ æŸ¥è¯¢èµ·å§‹æ—¶é—´betweenèµ·å§‹å’Œç»“æŸä¹‹é—´çš„æ´»åŠ¨</span><br><span class="line">+ éå†æ¯ä¸€ä¸ªæ´»åŠ¨ï¼ŒæŸ¥è¯¢å…³è”å•†å“list</span><br><span class="line">+ æ ¹æ®æ´»åŠ¨idæŸ¥è¯¢å…³è”è¡¨</span><br><span class="line">    + å°è£…è¿”å›æ•°æ®Vo</span><br><span class="line">    + ä¸Šæ¶å•†å“</span><br><span class="line">+ ç¼“å­˜åˆ°reids</span><br><span class="line">            + ç¼“å­˜æ´»åŠ¨ä¿¡æ¯</span><br><span class="line">                + éå†æ´»åŠ¨ï¼Œè·å–å¼€å§‹ç»“æŸæ—¶é—´ä½œä¸ºkey</span><br><span class="line">                + æ”¶é›†æ´»åŠ¨æ‰€æœ‰å•†å“id listä½œä¸ºvalue</span><br><span class="line">            + ç¼“å­˜æ´»åŠ¨çš„å…³è”å•†å“ä¿¡æ¯</span><br><span class="line">                + å‡†å¤‡hashæ“ä½œ</span><br><span class="line">                + éå†æ¯ä¸ªå•†å“ï¼Œå•†å“skuidä½œä¸ºkey</span><br><span class="line">                + å•†å“Toï¼ˆskuç§’æ€ä¿¡æ¯ã€è¯¦ç»†ä¿¡æ¯ã€éšæœºç ã€å¼€å§‹ç»“æŸæ—¶é—´ï¼‰ä½œä¸ºvalueï¼ˆè½¬ä¸ºjsonï¼‰</span><br><span class="line">                + è¿œç¨‹è°ƒç”¨å•†å“æœåŠ¡ï¼ˆæŸ¥è¯¢è¯¦ç»†ä¿¡æ¯ï¼‰</span><br><span class="line">+ æ ¹æ®sku idæŸ¥è¯¢å•†å“è¯¦ç»†ä¿¡æ¯</span><br><span class="line">                    + éšæœºç ï¼ˆUUIDï¼‰</span><br><span class="line">                    + é˜²æ­¢æå‰è„šæœ¬å‘è¯·æ±‚ç§’æ€</span><br><span class="line">                    + ç§’æ€å¼€å§‹æ‰æš´éœ²</span><br><span class="line">+ ç§’æ€å•†å“è®¾ç½®åˆ†å¸ƒå¼ä¿¡å·é‡ï¼ˆé™æµï¼‰ï¼Œä½œä¸ºåº“å­˜æ‰£å‡ä¿¡æ¯</span><br><span class="line">                    + å¼•å…¥redisson</span><br><span class="line">                    + é…ç½®redissonå®¢æˆ·ç«¯</span><br><span class="line">                    + keyï¼šå•†å“éšæœºç </span><br><span class="line">                    + valueï¼šå•†å“ç§’æ€æ•°é‡</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220304223213629.png" alt="image-20220304223213629"></p><p>å¹‚ç­‰æ€§ä¿è¯</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220304223954144.png" alt="image-20220304223954144"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ åŠ å…¥åˆ†å¸ƒå¼é”</span><br><span class="line">    + é˜²æ­¢å¤šå°æœºå™¨åŒä¸€æ—¶é—´ä¸Šæ¶</span><br><span class="line">    + åŒæ—¶åˆ¤æ–­keyä¸å­˜åœ¨ï¼Œå¯¼è‡´åŒæ—¶è¿½åŠ ï¼Œæ‰€ä»¥å¿…é¡»æœ‰é”</span><br><span class="line">+ å¹‚ç­‰æ€§ä¿è¯</span><br><span class="line">    + ç¼“å­˜æ´»åŠ¨ä¿¡æ¯ï¼Œåˆ¤æ–­key sessionidæ˜¯å¦å­˜åœ¨</span><br><span class="line">    + ç¼“å­˜skuä¿¡æ¯ï¼Œkeyï¼šåœºæ¬¡ + å•†å“idï¼Œåˆ¤æ–­key sessionid_skuidæ˜¯å¦å­˜åœ¨</span><br><span class="line">    + è§£å†³å¤šåœºæ¬¡åŒä¸€å•†å“é—®é¢˜</span><br><span class="line">    + ç¼“å­˜ä¿¡å·é‡ï¼Œè·Ÿå•†å“æ˜¯å¦ä¸Šæ¶ä¸€èµ·æ‰§è¡Œ</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢ç§’æ€å•†å“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ å±•ç¤ºé¦–é¡µç§’æ€å•†å“</span><br><span class="line">    + controllerï¼šåˆ¤æ–­ç¬¦åˆå½“å‰æ—¶é—´ç§’æ€åœºæ¬¡çš„å•†å“ï¼ˆè·å–å½“å‰æ—¶é—´å¯ä»¥å‚ä¸çš„ç§’æ€å•†å“ä¿¡æ¯ï¼‰</span><br><span class="line">        + ç¡®å®šå½“å‰æ—¶é—´å±äºå“ªä¸ªç§’æ€åœºæ¬¡</span><br><span class="line">        + éå†æ‰€æœ‰keysï¼Œæˆªå–å­—ç¬¦ä¸²ï¼Œåˆ¤æ–­æ—¶é—´</span><br><span class="line">        + è·å–ç§’æ€åœºæ¬¡çš„æ‰€æœ‰å•†å“ä¿¡æ¯</span><br><span class="line">            + è·å–åœºæ¬¡æ‰€æœ‰å•†å“id</span><br><span class="line">            + æ ¹æ®idè·å–hashä¸­çš„å•†å“è¯¦æƒ…</span><br><span class="line">            + å°è£…Vo</span><br></pre></td></tr></table></figure><p>ç§’æ€é¡µé¢æ¸²æŸ“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+ ç§’æ€é¢„å‘Š</span><br><span class="line">+ å•†å“é¡µé¢ï¼ŒæŸ¥è¯¢å½“å‰skuæ˜¯å¦å‚ä¸ç§’æ€ä¼˜æƒ </span><br><span class="line">    + è¿œç¨‹è°ƒç”¨ç§’æ€æœåŠ¡ï¼Œæ ¹æ®skuid æŸ¥è¯¢rediså•†å“è¯¦æƒ…hash</span><br><span class="line">        + æ‰¾åˆ°æ‰€æœ‰ç§’æ€å•†å“çš„key</span><br><span class="line">        + éå†keyæ­£åˆ™åŒ¹é…ï¼Œæ‰¾åˆ°å•†å“</span><br><span class="line">    + åˆ¤æ–­ç§’æ€æ˜¯å¦å¼€å§‹ï¼Œæœªå¼€å§‹åˆ™ä¸æš´éœ²éšæœºç </span><br><span class="line">    + feignè°ƒç”¨ã€å°è£…</span><br><span class="line">    + å¼‚æ­¥ç¼–æ’</span><br><span class="line">+ å‰ç«¯å–å€¼ï¼Œæ ¼å¼åŒ–æ—¥æœŸï¼Œä¸‰ä¸ªæ—¶é—´åŒºé—´åˆ¤æ–­</span><br><span class="line">        + æœªåˆ°</span><br><span class="line">        + æ­£åœ¨ç§’æ€</span><br><span class="line">        + å·²è¿‡ï¼Œä¸æ˜¾ç¤º</span><br><span class="line">+ é¦–é¡µè·³è½¬</span><br></pre></td></tr></table></figure><h2 id="ç§’æ€ä¸šåŠ¡ï¼ˆç™»å½•æ£€æŸ¥ã€ï¼‰"><a href="#ç§’æ€ä¸šåŠ¡ï¼ˆç™»å½•æ£€æŸ¥ã€ï¼‰" class="headerlink" title="ç§’æ€ä¸šåŠ¡ï¼ˆç™»å½•æ£€æŸ¥ã€ï¼‰"></a>ç§’æ€ä¸šåŠ¡ï¼ˆç™»å½•æ£€æŸ¥ã€ï¼‰</h2><p>ç™»å½•æ£€æŸ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">+ å¤„äºç§’æ€é˜¶æ®µå•†å“ï¼ŒåŠ å…¥è´­ç‰©è½¦æ”¹ä¸ºç«‹å³æŠ¢è´­</span><br><span class="line">+ ç§’æ€å‰ç«¯è·³è½¬è¯·æ±‚</span><br><span class="line">    + ç™»å½•åˆ¤æ–­</span><br><span class="line">    + å‚æ•°</span><br><span class="line">        + åœºæ¬¡_å•†å“id</span><br><span class="line">        + éšæœºç ï¼ˆä»¤ç‰Œï¼‰</span><br><span class="line">        + ä»¶æ•°</span><br><span class="line">+ å¤„ç†ç§’æ€è¯·æ±‚</span><br><span class="line">    + controller</span><br><span class="line">        + ç™»å½•æ‹¦æˆª</span><br><span class="line">        + å¼•å…¥spring-session</span><br><span class="line">                + åºåˆ—åŒ–å™¨ç­‰é…ç½®</span><br><span class="line">                + å­˜å‚¨ç±»å‹ä¸ºredis</span><br><span class="line">            + å¼•å…¥ç™»å½•æ‹¦æˆªå™¨</span><br><span class="line">            + æ³¨å†Œæ‹¦æˆªå™¨</span><br></pre></td></tr></table></figure><p><strong>ç§’æ€æµç¨‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬ä¸€å¥—æµç¨‹ï¼š</span><br><span class="line">+ è´­ç‰©è½¦â€”â€”è®¢å•ç¡®è®¤é¡µâ€”â€”æäº¤è®¢å•ç»“ç®—</span><br><span class="line">+ å¤šä¸ªæœåŠ¡éƒ½æ”¶åˆ°é«˜å¹¶å‘æµé‡</span><br><span class="line">+ åŒæ—¶ä¹Ÿé”™å³°äº†ä¸€éƒ¨åˆ†æµé‡</span><br><span class="line">+ èåˆå’Œå…¼å®¹ç§’æ€è´­ä¹°ä¸æ­£å¸¸è´­ä¹°æµç¨‹</span><br><span class="line"></span><br><span class="line">ç¬¬äºŒå¥—æµç¨‹ï¼š</span><br><span class="line">+ ç‚¹å‡»ç§’æ€ï¼Œåˆæ³•æ ¡éªŒé€šè¿‡ç›´æ¥è·å–ä¿¡å·é‡</span><br><span class="line">+ å‘é€æ¶ˆæ¯ç»™MQï¼Œç›´æ¥è¿”å›ç§’æ€æˆåŠŸ</span><br><span class="line">+ è®¢å•ç­‰å…¶ä»–æœåŠ¡æ…¢æ…¢å¤„ç†MQè¯·æ±‚</span><br><span class="line">+ è®¢å•åˆ›å»ºå®Œæˆï¼Œç”¨æˆ·ç¡®è®¤ç»“ç®—å³å¯</span><br><span class="line">+ ä¼˜ç‚¹</span><br><span class="line">    + æµç¨‹å¿«é€Ÿï¼Œé™¤äº†åˆ›å»ºè®¢å•æ— éœ€æ“ä½œæ•°æ®åº“ã€è¿œç¨‹è°ƒç”¨ç­‰</span><br><span class="line">    + è®¢å•æœåŠ¡éœ€è¦é«˜å¯ç”¨</span><br><span class="line">    + æ•´ä¸ªä¸šåŠ¡ç‹¬ç«‹</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220304224859675.png" alt="image-20220304224859675"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SeckillServiceImpl</span> <span class="keyword">implements</span> <span class="title">SeckillService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CouponFeignService couponFeignService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProductFeignService productFeignService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedissonClient redissonClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String SESSION__CACHE_PREFIX = <span class="string">&quot;seckill:sessions:&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String SECKILL_CHARE_PREFIX = <span class="string">&quot;seckill:skus&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String SKU_STOCK_SEMAPHORE = <span class="string">&quot;seckill:stock:&quot;</span>;    <span class="comment">//+å•†å“éšæœºç </span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">uploadSeckillSkuLatest3Days</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1ã€æ‰«ææœ€è¿‘ä¸‰å¤©çš„å•†å“éœ€è¦å‚åŠ ç§’æ€çš„æ´»åŠ¨</span></span><br><span class="line">        R lates3DaySession = couponFeignService.getLates3DaySession();</span><br><span class="line">        <span class="keyword">if</span> (lates3DaySession.getCode() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//ä¸Šæ¶å•†å“</span></span><br><span class="line">            List&lt;SeckillSessionWithSkusVo&gt; sessionData = lates3DaySession.getData(<span class="string">&quot;data&quot;</span>, <span class="keyword">new</span> TypeReference&lt;List&lt;SeckillSessionWithSkusVo&gt;&gt;() &#123;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">//ç¼“å­˜åˆ°Redis</span></span><br><span class="line">            <span class="comment">//1ã€ç¼“å­˜æ´»åŠ¨ä¿¡æ¯</span></span><br><span class="line">            saveSessionInfos(sessionData);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//2ã€ç¼“å­˜æ´»åŠ¨çš„å…³è”å•†å“ä¿¡æ¯</span></span><br><span class="line">            saveSessionSkuInfo(sessionData);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¼“å­˜ç§’æ€æ´»åŠ¨ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sessions</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">saveSessionInfos</span><span class="params">(List&lt;SeckillSessionWithSkusVo&gt; sessions)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        sessions.stream().forEach(session -&gt; &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//è·å–å½“å‰æ´»åŠ¨çš„å¼€å§‹å’Œç»“æŸæ—¶é—´çš„æ—¶é—´æˆ³</span></span><br><span class="line">            <span class="keyword">long</span> startTime = session.getStartTime().getTime();</span><br><span class="line">            <span class="keyword">long</span> endTime = session.getEndTime().getTime();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//å­˜å…¥åˆ°Redisä¸­çš„key</span></span><br><span class="line">            String key = SESSION__CACHE_PREFIX + startTime + <span class="string">&quot;_&quot;</span> + endTime;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//åˆ¤æ–­Redisä¸­æ˜¯å¦æœ‰è¯¥ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰æ‰è¿›è¡Œæ·»åŠ </span></span><br><span class="line">            Boolean hasKey = redisTemplate.hasKey(key);</span><br><span class="line">            <span class="comment">//ç¼“å­˜æ´»åŠ¨ä¿¡æ¯</span></span><br><span class="line">            <span class="keyword">if</span> (!hasKey) &#123;</span><br><span class="line">                <span class="comment">//è·å–åˆ°æ´»åŠ¨ä¸­æ‰€æœ‰å•†å“çš„skuId</span></span><br><span class="line">                List&lt;String&gt; skuIds = session.getRelationSkus().stream()</span><br><span class="line">                        .map(item -&gt; item.getPromotionSessionId() + <span class="string">&quot;-&quot;</span> + item.getSkuId().toString()).collect(Collectors.toList());</span><br><span class="line">                redisTemplate.opsForList().leftPushAll(key,skuIds);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¼“å­˜ç§’æ€æ´»åŠ¨æ‰€å…³è”çš„å•†å“ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sessions</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">saveSessionSkuInfo</span><span class="params">(List&lt;SeckillSessionWithSkusVo&gt; sessions)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        sessions.stream().forEach(session -&gt; &#123;</span><br><span class="line">            <span class="comment">//å‡†å¤‡hashæ“ä½œï¼Œç»‘å®šhash</span></span><br><span class="line">            BoundHashOperations&lt;String, Object, Object&gt; operations = redisTemplate.boundHashOps(SECKILL_CHARE_PREFIX);</span><br><span class="line">            session.getRelationSkus().stream().forEach(seckillSkuVo -&gt; &#123;</span><br><span class="line">                <span class="comment">//ç”Ÿæˆéšæœºç </span></span><br><span class="line">                String token = UUID.randomUUID().toString().replace(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">                String redisKey = seckillSkuVo.getPromotionSessionId().toString() + <span class="string">&quot;-&quot;</span> + seckillSkuVo.getSkuId().toString();</span><br><span class="line">                <span class="keyword">if</span> (!operations.hasKey(redisKey)) &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//ç¼“å­˜æˆ‘ä»¬å•†å“ä¿¡æ¯</span></span><br><span class="line">                    SeckillSkuRedisTo redisTo = <span class="keyword">new</span> SeckillSkuRedisTo();</span><br><span class="line">                    Long skuId = seckillSkuVo.getSkuId();</span><br><span class="line">                    <span class="comment">//1ã€å…ˆæŸ¥è¯¢skuçš„åŸºæœ¬ä¿¡æ¯ï¼Œè°ƒç”¨è¿œç¨‹æœåŠ¡</span></span><br><span class="line">                    R info = productFeignService.getSkuInfo(skuId);</span><br><span class="line">                    <span class="keyword">if</span> (info.getCode() == <span class="number">0</span>) &#123;</span><br><span class="line">                        SkuInfoVo skuInfo = info.getData(<span class="string">&quot;skuInfo&quot;</span>,<span class="keyword">new</span> TypeReference&lt;SkuInfoVo&gt;()&#123;&#125;);</span><br><span class="line">                        redisTo.setSkuInfo(skuInfo);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//2ã€skuçš„ç§’æ€ä¿¡æ¯</span></span><br><span class="line">                    BeanUtils.copyProperties(seckillSkuVo,redisTo);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//3ã€è®¾ç½®å½“å‰å•†å“çš„ç§’æ€æ—¶é—´ä¿¡æ¯</span></span><br><span class="line">                    redisTo.setStartTime(session.getStartTime().getTime());</span><br><span class="line">                    redisTo.setEndTime(session.getEndTime().getTime());</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//4ã€è®¾ç½®å•†å“çš„éšæœºç ï¼ˆé˜²æ­¢æ¶æ„æ”»å‡»ï¼‰</span></span><br><span class="line">                    redisTo.setRandomCode(token);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//åºåˆ—åŒ–jsonæ ¼å¼å­˜å…¥Redisä¸­</span></span><br><span class="line">                    String seckillValue = JSON.toJSONString(redisTo);</span><br><span class="line">                    operations.put(seckillSkuVo.getPromotionSessionId().toString() + <span class="string">&quot;-&quot;</span> + seckillSkuVo.getSkuId().toString(),seckillValue);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//å¦‚æœå½“å‰è¿™ä¸ªåœºæ¬¡çš„å•†å“åº“å­˜ä¿¡æ¯å·²ç»ä¸Šæ¶å°±ä¸éœ€è¦ä¸Šæ¶</span></span><br><span class="line">                    <span class="comment">//5ã€ä½¿ç”¨åº“å­˜ä½œä¸ºåˆ†å¸ƒå¼Redissonä¿¡å·é‡ï¼ˆé™æµï¼‰</span></span><br><span class="line">                    <span class="comment">// ä½¿ç”¨åº“å­˜ä½œä¸ºåˆ†å¸ƒå¼ä¿¡å·é‡</span></span><br><span class="line">                    RSemaphore semaphore = redissonClient.getSemaphore(SKU_STOCK_SEMAPHORE + token);</span><br><span class="line">                    <span class="comment">// å•†å“å¯ä»¥ç§’æ€çš„æ•°é‡ä½œä¸ºä¿¡å·é‡</span></span><br><span class="line">                    semaphore.trySetPermits(seckillSkuVo.getSeckillCount());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–åˆ°å½“å‰å¯ä»¥å‚åŠ ç§’æ€å•†å“çš„ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SentinelResource(value = &quot;getCurrentSeckillSkusResource&quot;,blockHandler = &quot;blockHandler&quot;)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;SeckillSkuRedisTo&gt; <span class="title">getCurrentSeckillSkus</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> (Entry entry = SphU.entry(<span class="string">&quot;seckillSkus&quot;</span>)) &#123;</span><br><span class="line">            <span class="comment">//1ã€ç¡®å®šå½“å‰å±äºå“ªä¸ªç§’æ€åœºæ¬¡</span></span><br><span class="line">            <span class="keyword">long</span> currentTime = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//ä»Redisä¸­æŸ¥è¯¢åˆ°æ‰€æœ‰keyä»¥seckill:sessionså¼€å¤´çš„æ‰€æœ‰æ•°æ®</span></span><br><span class="line">            Set&lt;String&gt; keys = redisTemplate.keys(SESSION__CACHE_PREFIX + <span class="string">&quot;*&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (String key : keys) &#123;</span><br><span class="line">                <span class="comment">//seckill:sessions:1594396764000_1594453242000</span></span><br><span class="line">                String replace = key.replace(SESSION__CACHE_PREFIX, <span class="string">&quot;&quot;</span>);</span><br><span class="line">                String[] s = replace.split(<span class="string">&quot;_&quot;</span>);</span><br><span class="line">                <span class="comment">//è·å–å­˜å…¥Rediså•†å“çš„å¼€å§‹æ—¶é—´</span></span><br><span class="line">                <span class="keyword">long</span> startTime = Long.parseLong(s[<span class="number">0</span>]);</span><br><span class="line">                <span class="comment">//è·å–å­˜å…¥Rediså•†å“çš„ç»“æŸæ—¶é—´</span></span><br><span class="line">                <span class="keyword">long</span> endTime = Long.parseLong(s[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//åˆ¤æ–­æ˜¯å¦æ˜¯å½“å‰ç§’æ€åœºæ¬¡</span></span><br><span class="line">                <span class="keyword">if</span> (currentTime &gt;= startTime &amp;&amp; currentTime &lt;= endTime) &#123;</span><br><span class="line">                    <span class="comment">//2ã€è·å–è¿™ä¸ªç§’æ€åœºæ¬¡éœ€è¦çš„æ‰€æœ‰å•†å“ä¿¡æ¯</span></span><br><span class="line">                    List&lt;String&gt; range = redisTemplate.opsForList().range(key, -<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">                    BoundHashOperations&lt;String, String, String&gt; hasOps = redisTemplate.boundHashOps(SECKILL_CHARE_PREFIX);</span><br><span class="line">                    <span class="keyword">assert</span> range != <span class="keyword">null</span>;</span><br><span class="line">                    List&lt;String&gt; listValue = hasOps.multiGet(range);</span><br><span class="line">                    <span class="keyword">if</span> (listValue != <span class="keyword">null</span> &amp;&amp; listValue.size() &gt;= <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">                        List&lt;SeckillSkuRedisTo&gt; collect = listValue.stream().map(item -&gt; &#123;</span><br><span class="line">                            String items = (String) item;</span><br><span class="line">                            SeckillSkuRedisTo redisTo = JSON.parseObject(items, SeckillSkuRedisTo.class);</span><br><span class="line">                            <span class="comment">// redisTo.setRandomCode(null);å½“å‰ç§’æ€å¼€å§‹éœ€è¦éšæœºç </span></span><br><span class="line">                            <span class="keyword">return</span> redisTo;</span><br><span class="line">                        &#125;).collect(Collectors.toList());</span><br><span class="line">                        <span class="keyword">return</span> collect;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (BlockException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;èµ„æºè¢«é™æµ&#123;&#125;&quot;</span>,e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;SeckillSkuRedisTo&gt; <span class="title">blockHandler</span><span class="params">(BlockException e)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        log.error(<span class="string">&quot;getCurrentSeckillSkusResourceè¢«é™æµäº†,&#123;&#125;&quot;</span>,e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®skuIdæŸ¥è¯¢å•†å“æ˜¯å¦å‚åŠ ç§’æ€æ´»åŠ¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> skuId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SeckillSkuRedisTo <span class="title">getSkuSeckilInfo</span><span class="params">(Long skuId)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1ã€æ‰¾åˆ°æ‰€æœ‰éœ€è¦ç§’æ€çš„å•†å“çš„keyä¿¡æ¯---seckill:skus</span></span><br><span class="line">        BoundHashOperations&lt;String, String, String&gt; hashOps = redisTemplate.boundHashOps(SECKILL_CHARE_PREFIX);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ‹¿åˆ°æ‰€æœ‰çš„key</span></span><br><span class="line">        Set&lt;String&gt; keys = hashOps.keys();</span><br><span class="line">        <span class="keyword">if</span> (keys != <span class="keyword">null</span> &amp;&amp; keys.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//4-45 æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…</span></span><br><span class="line">            String reg = <span class="string">&quot;\\d-&quot;</span> + skuId;</span><br><span class="line">            <span class="keyword">for</span> (String key : keys) &#123;</span><br><span class="line">                <span class="comment">//å¦‚æœåŒ¹é…ä¸Šäº†</span></span><br><span class="line">                <span class="keyword">if</span> (Pattern.matches(reg,key)) &#123;</span><br><span class="line">                    <span class="comment">//ä»Redisä¸­å–å‡ºæ•°æ®æ¥</span></span><br><span class="line">                    String redisValue = hashOps.get(key);</span><br><span class="line">                    <span class="comment">//è¿›è¡Œåºåˆ—åŒ–</span></span><br><span class="line">                    SeckillSkuRedisTo redisTo = JSON.parseObject(redisValue, SeckillSkuRedisTo.class);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//éšæœºç </span></span><br><span class="line">                    Long currentTime = System.currentTimeMillis();</span><br><span class="line">                    Long startTime = redisTo.getStartTime();</span><br><span class="line">                    Long endTime = redisTo.getEndTime();</span><br><span class="line">                    <span class="comment">//å¦‚æœå½“å‰æ—¶é—´å¤§äºç­‰äºç§’æ€æ´»åŠ¨å¼€å§‹æ—¶é—´å¹¶ä¸”è¦å°äºæ´»åŠ¨ç»“æŸæ—¶é—´</span></span><br><span class="line">                    <span class="keyword">if</span> (currentTime &gt;= startTime &amp;&amp; currentTime &lt;= endTime) &#123;</span><br><span class="line">                        <span class="keyword">return</span> redisTo;</span><br><span class="line">                    &#125;</span><br><span class="line">                    redisTo.setRandomCode(<span class="keyword">null</span>);</span><br><span class="line">                    <span class="keyword">return</span> redisTo;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½“å‰å•†å“è¿›è¡Œç§’æ€ï¼ˆç§’æ€å¼€å§‹ï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> killId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> num</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">kill</span><span class="params">(String killId, String key, Integer num)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> s1 = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">//è·å–å½“å‰ç”¨æˆ·çš„ä¿¡æ¯</span></span><br><span class="line">        MemberResponseVo user = LoginUserInterceptor.loginUser.get();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1ã€è·å–å½“å‰ç§’æ€å•†å“çš„è¯¦ç»†ä¿¡æ¯ä»Redisä¸­è·å–</span></span><br><span class="line">        BoundHashOperations&lt;String, String, String&gt; hashOps = redisTemplate.boundHashOps(SECKILL_CHARE_PREFIX);</span><br><span class="line">        String skuInfoValue = hashOps.get(killId);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(skuInfoValue)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//(åˆæ³•æ€§æ•ˆéªŒ)</span></span><br><span class="line">        SeckillSkuRedisTo redisTo = JSON.parseObject(skuInfoValue, SeckillSkuRedisTo.class);</span><br><span class="line">        Long startTime = redisTo.getStartTime();</span><br><span class="line">        Long endTime = redisTo.getEndTime();</span><br><span class="line">        <span class="keyword">long</span> currentTime = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">//åˆ¤æ–­å½“å‰è¿™ä¸ªç§’æ€è¯·æ±‚æ˜¯å¦åœ¨æ´»åŠ¨æ—¶é—´åŒºé—´å†…(æ•ˆéªŒæ—¶é—´çš„åˆæ³•æ€§)</span></span><br><span class="line">        <span class="keyword">if</span> (currentTime &gt;= startTime &amp;&amp; currentTime &lt;= endTime) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//2ã€æ•ˆéªŒéšæœºç å’Œå•†å“id</span></span><br><span class="line">            String randomCode = redisTo.getRandomCode();</span><br><span class="line">            String skuId = redisTo.getPromotionSessionId() + <span class="string">&quot;-&quot;</span> +redisTo.getSkuId();</span><br><span class="line">            <span class="keyword">if</span> (randomCode.equals(key) &amp;&amp; killId.equals(skuId)) &#123;</span><br><span class="line">                <span class="comment">//3ã€éªŒè¯è´­ç‰©æ•°é‡æ˜¯å¦åˆç†å’Œåº“å­˜é‡æ˜¯å¦å……è¶³</span></span><br><span class="line">                Integer seckillLimit = redisTo.getSeckillLimit();</span><br><span class="line"></span><br><span class="line">                <span class="comment">//è·å–ä¿¡å·é‡</span></span><br><span class="line">                String seckillCount = redisTemplate.opsForValue().get(SKU_STOCK_SEMAPHORE + randomCode);</span><br><span class="line">                Integer count = Integer.valueOf(seckillCount);</span><br><span class="line">                <span class="comment">//åˆ¤æ–­ä¿¡å·é‡æ˜¯å¦å¤§äº0,å¹¶ä¸”ä¹°çš„æ•°é‡ä¸èƒ½è¶…è¿‡åº“å­˜</span></span><br><span class="line">                <span class="keyword">if</span> (count &gt; <span class="number">0</span> &amp;&amp; num &lt;= seckillLimit &amp;&amp; count &gt; num ) &#123;</span><br><span class="line">                    <span class="comment">//4ã€éªŒè¯è¿™ä¸ªäººæ˜¯å¦å·²ç»ä¹°è¿‡äº†ï¼ˆå¹‚ç­‰æ€§å¤„ç†ï¼‰,å¦‚æœç§’æ€æˆåŠŸï¼Œå°±å»å ä½ã€‚userId-sessionId-skuId</span></span><br><span class="line">                    <span class="comment">//SETNX åŸå­æ€§å¤„ç†</span></span><br><span class="line">                    String redisKey = user.getId() + <span class="string">&quot;-&quot;</span> + skuId;</span><br><span class="line">                    <span class="comment">//è®¾ç½®è‡ªåŠ¨è¿‡æœŸ(æ´»åŠ¨ç»“æŸæ—¶é—´-å½“å‰æ—¶é—´)</span></span><br><span class="line">                    Long ttl = endTime - currentTime;</span><br><span class="line">                    Boolean aBoolean = redisTemplate.opsForValue().setIfAbsent(redisKey, num.toString(), ttl, TimeUnit.MILLISECONDS);</span><br><span class="line">                    <span class="keyword">if</span> (aBoolean) &#123;</span><br><span class="line">                        <span class="comment">//å ä½æˆåŠŸè¯´æ˜ä»æ¥æ²¡æœ‰ä¹°è¿‡,åˆ†å¸ƒå¼é”(è·å–ä¿¡å·é‡-1)</span></span><br><span class="line">                        RSemaphore semaphore = redissonClient.getSemaphore(SKU_STOCK_SEMAPHORE + randomCode);</span><br><span class="line">                        <span class="comment">//TODO ç§’æ€æˆåŠŸï¼Œå¿«é€Ÿä¸‹å•</span></span><br><span class="line">                        <span class="keyword">boolean</span> semaphoreCount = semaphore.tryAcquire(num, <span class="number">100</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">                        <span class="comment">//ä¿è¯Redisä¸­è¿˜æœ‰å•†å“åº“å­˜</span></span><br><span class="line">                        <span class="keyword">if</span> (semaphoreCount) &#123;</span><br><span class="line">                            <span class="comment">//åˆ›å»ºè®¢å•å·å’Œè®¢å•ä¿¡æ¯å‘é€ç»™MQ</span></span><br><span class="line">                            <span class="comment">// ç§’æ€æˆåŠŸ å¿«é€Ÿä¸‹å• å‘é€æ¶ˆæ¯åˆ° MQ æ•´ä¸ªæ“ä½œæ—¶é—´åœ¨ 10ms å·¦å³</span></span><br><span class="line">                            String timeId = IdWorker.getTimeId();</span><br><span class="line">                            SeckillOrderTo orderTo = <span class="keyword">new</span> SeckillOrderTo();</span><br><span class="line">                            orderTo.setOrderSn(timeId);</span><br><span class="line">                            orderTo.setMemberId(user.getId());</span><br><span class="line">                            orderTo.setNum(num);</span><br><span class="line">                            orderTo.setPromotionSessionId(redisTo.getPromotionSessionId());</span><br><span class="line">                            orderTo.setSkuId(redisTo.getSkuId());</span><br><span class="line">                            orderTo.setSeckillPrice(redisTo.getSeckillPrice());</span><br><span class="line">                            rabbitTemplate.convertAndSend(<span class="string">&quot;order-event-exchange&quot;</span>,<span class="string">&quot;order.seckill.order&quot;</span>,orderTo);</span><br><span class="line">                            <span class="keyword">long</span> s2 = System.currentTimeMillis();</span><br><span class="line">                            log.info(<span class="string">&quot;è€—æ—¶...&quot;</span> + (s2 - s1));</span><br><span class="line">                            <span class="keyword">return</span> timeId;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> s3 = System.currentTimeMillis();</span><br><span class="line">        log.info(<span class="string">&quot;è€—æ—¶...&quot;</span> + (s3 - s1));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">+ Service kill</span><br><span class="line">    + ç™»å½•åˆ¤æ–­ âˆš</span><br><span class="line">    + åˆæ³•æ€§æ ¡éªŒ</span><br><span class="line">        + è·å–å½“å‰ç§’æ€å•†å“çš„è¯¦ç»†ä¿¡æ¯</span><br><span class="line">        + redisæ ¹æ®killid è·å–skuä¿¡æ¯</span><br><span class="line">        + jsonè½¬ä¸ºToæ•°æ®</span><br><span class="line">        + åˆ¤æ–­å½“å‰æ—¶é—´æ˜¯å¦ä¸ºç§’æ€æ—¶é—´</span><br><span class="line">        + æ¯”è¾ƒå¼€å§‹ç»“æŸæ—¶é—´</span><br><span class="line">        + åˆ¤æ–­éšæœºç æ˜¯å¦æ­£ç¡®</span><br><span class="line">        + åˆ¤æ–­è´­ç‰©æ•°é‡æ˜¯å¦åˆé€‚</span><br><span class="line">    + åˆ¤æ–­æ˜¯å¦é‡å¤ç§’æ€ï¼ˆå¹‚ç­‰æ€§ï¼‰</span><br><span class="line">    + åˆ°redisç«™ä½ï¼Œsetnx</span><br><span class="line">            + æŒ‡å®škeyï¼šuserid_sessionid_skuid</span><br><span class="line">            + æ‹¦æˆªå™¨è·å–userä¿¡æ¯</span><br><span class="line">            + è®¾ç½®è‡ªåŠ¨è¿‡æœŸæ—¶é—´ï¼ˆå½“å‰åœºæ¬¡ç»“æŸæ—¶é—´ï¼‰</span><br><span class="line">            + ç»“æŸæ—¶é—´å‡å»å½“å‰æ—¶é—´ä½œä¸ºttl</span><br><span class="line">            + ç«™ä½æˆåŠŸåˆ™è¯´æ˜æœªç§’æ€</span><br><span class="line">    + è·å–åˆ†å¸ƒå¼ä¿¡å·é‡</span><br><span class="line">    + æ ¹æ®è´­ä¹°ä»¶æ•°æ‰£å‡ä¿¡å·é‡</span><br><span class="line">    + è°ƒç”¨tryAcquireï¼ˆå°è¯•æ€§è·å–ï¼Œéé˜»å¡ï¼‰</span><br><span class="line">    //+ 100æ¯«ç§’å°è¯•æ—¶é—´</span><br><span class="line">    + æ— éœ€ç­‰å¾…</span><br><span class="line">    + æ‹¿åˆ°ä¿¡å·é‡åˆ™æˆåŠŸç§’æ€</span><br><span class="line">    + å¿«é€Ÿä¸‹å•</span><br><span class="line">        + åˆ›å»ºè®¢å•å·</span><br><span class="line">        + å‘é€æ¶ˆæ¯ç»™mq</span><br><span class="line">            + å¼•å…¥rabbitmq</span><br><span class="line">            + åºåˆ—åŒ–ã€å¯é æ¶ˆæ¯ç­‰é…ç½®</span><br><span class="line">+ ç§’æ€è®¢å•To</span><br><span class="line">+ å‘é€æ¶ˆæ¯</span><br><span class="line">    + ç›´æ¥è¿”å›è®¢å•å·</span><br><span class="line">    + è®¢å•æœåŠ¡</span><br><span class="line">+ é˜Ÿåˆ—ã€binding</span><br><span class="line">+ ç›‘å¬ç§’æ€é˜Ÿåˆ—</span><br><span class="line">+ åˆ›å»ºç§’æ€å•ï¼Œä¿å­˜è®¢å•ä¿¡æ¯</span><br><span class="line">            + ä¿å­˜è®¢å•é¡¹ä¿¡æ¯ï¼ˆè®¢å•å…³è”skuè¡¨ï¼‰</span><br><span class="line">            + TODO å…¶ä»–</span><br></pre></td></tr></table></figure><h1 id="2ã€Sentinelã€Sleuth-Zipkin"><a href="#2ã€Sentinelã€Sleuth-Zipkin" class="headerlink" title="2ã€Sentinelã€Sleuth + Zipkin"></a>2ã€Sentinelã€Sleuth + Zipkin</h1><h2 id="Sentinelï¼šæµæ§ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤"><a href="#Sentinelï¼šæµæ§ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤" class="headerlink" title="Sentinelï¼šæµæ§ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤"></a>Sentinelï¼šæµæ§ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤</h2><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220304230038114.png" alt="image-20220304230038114"><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220304230504257.png" alt="image-20220304230504257"></p><p>ç†”æ–­ï¼š</p><p>  A æœåŠ¡è°ƒç”¨ B æœåŠ¡çš„æŸä¸ªåŠŸèƒ½ï¼Œç”±äºç½‘ç»œä¸ç¨³å®šé—®é¢˜ï¼Œæˆ–è€… B æœåŠ¡å¡æœºï¼Œå¯¼è‡´åŠŸèƒ½æ—¶ é—´è¶…é•¿ã€‚å¦‚æœè¿™æ ·å­çš„æ¬¡æ•°å¤ªå¤šã€‚æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥å°† B æ–­è·¯äº†ï¼ˆA ä¸å†è¯·æ±‚ B æ¥å£ï¼‰ï¼Œå‡¡æ˜¯ è°ƒç”¨ B çš„ç›´æ¥è¿”å›é™çº§æ•°æ®ï¼Œä¸å¿…ç­‰å¾… B çš„è¶…é•¿æ‰§è¡Œã€‚ è¿™æ · B çš„æ•…éšœé—®é¢˜ï¼Œå°±ä¸ä¼šçº§è”å½±å“åˆ° Aã€‚ ç†”æ–­æ˜¯è¢«è°ƒæ–¹å¤šæ¬¡æ•…éšœï¼Œè§¦å‘ç³»ç»Ÿçš„ä¸»åŠ¨ä¿æŠ¤è§„åˆ™ã€‚</p><p>é™çº§ï¼š</p><p>  æ•´ä¸ªç½‘ç«™å¤„äºæµé‡é«˜å³°æœŸï¼ŒæœåŠ¡å™¨å‹åŠ›å‰§å¢ï¼Œæ ¹æ®å½“å‰ä¸šåŠ¡æƒ…å†µåŠæµé‡ï¼Œå¯¹ä¸€äº›æœåŠ¡å’Œ é¡µé¢è¿›è¡Œæœ‰ç­–ç•¥çš„é™çº§[åœæ­¢æœåŠ¡ï¼Œæ‰€æœ‰çš„è°ƒç”¨ç›´æ¥è¿”å›é™çº§æ•°æ®]ã€‚ä»¥æ­¤ç¼“è§£æœåŠ¡å™¨èµ„æºçš„ çš„å‹åŠ›ï¼Œä»¥ä¿è¯æ ¸å¿ƒä¸šåŠ¡çš„æ­£å¸¸è¿è¡Œï¼ŒåŒæ—¶ä¹Ÿä¿æŒäº†å®¢æˆ·å’Œå¤§éƒ¨åˆ†å®¢æˆ·çš„å¾—åˆ°æ­£ç¡®çš„ç›¸åº”ã€‚</p><p>æµé‡æ§åˆ¶å‡ ä¸ªè§’åº¦ï¼š</p><p>èµ„æºçš„è°ƒç”¨å…³ç³»ï¼Œä¾‹å¦‚èµ„æºçš„è°ƒç”¨é“¾è·¯ï¼Œèµ„æºå’Œèµ„æºä¹‹é—´çš„å…³ç³»ï¼› </p><p>è¿è¡ŒæŒ‡æ ‡ï¼Œä¾‹å¦‚ QPSã€çº¿ç¨‹æ± ã€ç³»ç»Ÿè´Ÿè½½ç­‰ï¼› </p><p>æ§åˆ¶çš„æ•ˆæœï¼Œä¾‹å¦‚ç›´æ¥é™æµã€å†·å¯åŠ¨ã€æ’é˜Ÿç­‰ã€‚</p><p>Sentinelç›¸æ¯”Hystrixï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ Sentinelç›¸æ¯”Hystrixï¼š</span><br><span class="line">+ éš”ç¦»ç­–ç•¥</span><br><span class="line">        + çº¿ç¨‹æ± éš”ç¦»</span><br><span class="line">            + ä¸ºè¯·æ±‚åˆ†é…è‡ªå¸¦çº¿ç¨‹æ± </span><br><span class="line">            + ä¼˜ç‚¹</span><br><span class="line">                + çº¿ç¨‹æ± ä¹‹é—´éš”ç¦»ï¼Œæ± å­ç‚¸äº†ä¸å…¶ä»–è¯·æ±‚æ— å…³</span><br><span class="line">        + ä¿¡å·é‡éš”ç¦»</span><br><span class="line">            + ä¸ºè¯·æ±‚åˆ†é…ä¿¡å·é‡</span><br></pre></td></tr></table></figure><p>sentinel-å®šä¹‰èµ„æº</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+ å®šä¹‰resource</span><br><span class="line">    + ä¸»æµæ¡†æ¶é»˜è®¤é€‚é…</span><br><span class="line">    + æŠ›å‡ºå¼‚å¸¸æ–¹å¼å®šä¹‰èµ„æº</span><br><span class="line">    + è¿”å›å¸ƒå°”å€¼æ–¹å¼å®šä¹‰èµ„æº</span><br><span class="line">    + æ³¨è§£æ–¹å¼å®šä¹‰èµ„æºï¼ˆå¯é…ç½®å›è°ƒï¼‰</span><br><span class="line">    + å¼‚æ­¥è°ƒç”¨æ”¯æŒ</span><br><span class="line">+ è‡ªå®šä¹‰å®šä¹‰èµ„æº</span><br><span class="line">+ try-catch</span><br><span class="line">+ åŸºäºæ³¨è§£ </span><br><span class="line">+ è°ƒç”¨é“¾è·¯</span><br><span class="line">        + è‡ªå®šä¹‰blockhandlerï¼šé™æµã€é™çº§ã€ç³»ç»Ÿä¿æŠ¤æ—¶è°ƒç”¨</span><br><span class="line">        + fallbackï¼šå¤„ç†å¼‚å¸¸</span><br></pre></td></tr></table></figure><p>sentinel-é™æµæ¨¡å¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+ é™æµæ¨¡å¼</span><br><span class="line">    + é“¾è·¯é™æµæ¨¡å¼</span><br><span class="line">        + åªç»Ÿè®¡æŸä¸ªå…¥å£è¿›å…¥çš„æµé‡</span><br><span class="line">    + å…³è”æ¨¡å¼</span><br><span class="line">        + å…¶ä»–äººæµé‡å¤§é™åˆ¶è‡ªå·±</span><br><span class="line">    + ç›´æ¥æ‹’ç»</span><br><span class="line">    + warm up</span><br><span class="line">        + é¢„çƒ­ï¼šæŒ‡å®šæ—¶é—´å†…å°†æµé‡æ…¢æ…¢å¢åŠ åˆ°é™æµé˜ˆå€¼</span><br><span class="line">    + æ’é˜Ÿç­‰å¾…</span><br></pre></td></tr></table></figure><p>Sentinel-ç†”æ–­é™çº§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+ ç†”æ–­é™çº§</span><br><span class="line">+ é™æµæ˜¯å¯¹è¯·æ±‚è¿›è¡Œæµæ§</span><br><span class="line">    + è¿œç¨‹è°ƒç”¨éœ€è¦ç”¨ç†”æ–­é™çº§è¿›è¡Œä¿æŠ¤</span><br><span class="line">    + è°ƒç”¨æ–¹ç†”æ–­ä¿æŠ¤</span><br><span class="line">        + å¼€å¯feign-sentinel</span><br><span class="line">        + å¯¹è°ƒç”¨æ–¹æ¥å£åŠ å…¥fallback</span><br><span class="line">        + å®ç°feignæ¥å£</span><br><span class="line">            + å®ç°fallbackæ–¹æ³•</span><br><span class="line">    + æŒ‡å®šé™çº§ç­–ç•¥</span><br><span class="line">    + è¿œç¨‹æœåŠ¡ï¼ˆæœåŠ¡æä¾›æ–¹ï¼‰é™çº§ä¿æŠ¤</span><br><span class="line">        + æµé‡è¿‡å¤§æ—¶å…¨å±€è€ƒè™‘ï¼Œå°†æŸäº›æœåŠ¡æä¾›æ–¹é™çº§å¤„ç†</span><br></pre></td></tr></table></figure><p>Sentinel-ç½‘å…³æµæ§</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220304231223789.png" alt="image-20220304231223789"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+ ç½‘å…³é™æµåŠŸèƒ½</span><br><span class="line">+ å¼•å…¥sentinelä¸gatewayé€‚é…æ•´åˆ</span><br><span class="line">+ ç½‘å…³é¡µé¢</span><br><span class="line">        + æµæ§</span><br><span class="line">        + apiåˆ†ç»„ï¼ˆå¯¹æ•´ä¸ªç»„è¿›è¡Œæµæ§è®¾ç½®ï¼‰</span><br><span class="line">    + å®šåˆ¶ç½‘å…³æµæ§è¿”å›</span><br><span class="line">    + Mono Webflux</span><br><span class="line">        + å“åº”å¼ç¼–ç¨‹</span><br><span class="line">        + å¤©ç„¶æ”¯æŒé«˜å¹¶å‘ç³»ç»Ÿ</span><br></pre></td></tr></table></figure><h2 id="Sleuth-Zipkinï¼šé“¾è·¯è¿½è¸ª"><a href="#Sleuth-Zipkinï¼šé“¾è·¯è¿½è¸ª" class="headerlink" title="Sleuth + Zipkinï¼šé“¾è·¯è¿½è¸ª"></a>Sleuth + Zipkinï¼šé“¾è·¯è¿½è¸ª</h2><p><strong>ä¸ºä»€ä¹ˆç”¨</strong></p><p>  å¾®æœåŠ¡æ¶æ„æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ¶æ„ï¼Œå®ƒæŒ‰ä¸šåŠ¡åˆ’åˆ†æœåŠ¡å•å…ƒï¼Œä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿå¾€å¾€æœ‰å¾ˆå¤šä¸ªæœåŠ¡ å•å…ƒã€‚ç”±äºæœåŠ¡å•å…ƒæ•°é‡ä¼—å¤šï¼Œä¸šåŠ¡çš„å¤æ‚æ€§ï¼Œå¦‚æœ<strong>å‡ºç°äº†é”™è¯¯å’Œå¼‚å¸¸ï¼Œå¾ˆéš¾å»å®šä½</strong>ã€‚ä¸»è¦ ä½“ç°åœ¨ï¼Œ<strong>ä¸€ä¸ªè¯·æ±‚å¯èƒ½éœ€è¦è°ƒç”¨å¾ˆå¤šä¸ªæœåŠ¡</strong>ï¼Œè€Œå†…éƒ¨æœåŠ¡çš„è°ƒç”¨å¤æ‚æ€§ï¼Œå†³å®šäº†é—®é¢˜éš¾ä»¥ å®šä½ã€‚æ‰€ä»¥å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå¿…é¡»å®ç°åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªï¼Œå»è·Ÿè¿›ä¸€ä¸ªè¯·æ±‚åˆ°åº•æœ‰å“ªäº›æœåŠ¡å‚ä¸ï¼Œ å‚ä¸çš„é¡ºåºåˆæ˜¯æ€æ ·çš„ï¼Œä»è€Œ<strong>è¾¾åˆ°æ¯ä¸ªè¯·æ±‚çš„æ­¥éª¤æ¸…æ™°å¯è§ï¼Œå‡ºäº†é—®é¢˜ï¼Œå¾ˆå¿«å®šä½</strong>ã€‚ </p><p>é“¾è·¯è¿½è¸ªç»„ä»¶æœ‰ Google çš„ Dapperï¼ŒTwitter çš„ Zipkinï¼Œä»¥åŠé˜¿é‡Œçš„ Eagleeye ï¼ˆé¹°çœ¼ï¼‰ç­‰ï¼Œå®ƒä»¬éƒ½æ˜¯éå¸¸ä¼˜ç§€çš„é“¾è·¯è¿½è¸ªå¼€æºç»„ä»¶ã€‚ </p><p><strong>åŸºæœ¬æœ¯è¯­</strong></p><p>Spanï¼ˆè·¨åº¦ï¼‰ï¼šåŸºæœ¬å·¥ä½œå•å…ƒï¼Œå‘é€ä¸€ä¸ªè¿œç¨‹è°ƒåº¦ä»»åŠ¡ å°±ä¼šäº§ç”Ÿä¸€ä¸ª Spanï¼ŒSpan æ˜¯ä¸€ ä¸ª 64 ä½ ID å”¯ä¸€æ ‡è¯†çš„ï¼ŒTrace æ˜¯ç”¨å¦ä¸€ä¸ª 64 ä½ ID å”¯ä¸€æ ‡è¯†çš„ï¼ŒSpan è¿˜æœ‰å…¶ä»–æ•°æ®ä¿¡æ¯ï¼Œæ¯”å¦‚æ‘˜è¦ã€æ—¶é—´æˆ³äº‹ä»¶ã€Span çš„ IDã€ä»¥åŠè¿›åº¦ IDã€‚ </p><p>Traceï¼ˆè·Ÿè¸ªï¼‰ï¼šä¸€ç³»åˆ— Span ç»„æˆçš„ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ã€‚è¯·æ±‚ä¸€ä¸ªå¾®æœåŠ¡ç³»ç»Ÿçš„ API æ¥å£ï¼Œ è¿™ä¸ª API æ¥å£ï¼Œéœ€è¦è°ƒç”¨å¤šä¸ªå¾®æœåŠ¡ï¼Œè°ƒç”¨æ¯ä¸ªå¾®æœåŠ¡éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ Spanï¼Œæ‰€æœ‰ ç”±è¿™ä¸ªè¯·æ±‚äº§ç”Ÿçš„ Span ç»„æˆäº†è¿™ä¸ª Traceã€‚ </p><p>Annotationï¼ˆæ ‡æ³¨ï¼‰ï¼šç”¨æ¥åŠæ—¶è®°å½•ä¸€ä¸ªäº‹ä»¶çš„ï¼Œä¸€äº›æ ¸å¿ƒæ³¨è§£ç”¨æ¥å®šä¹‰ä¸€ä¸ªè¯·æ±‚çš„å¼€ å§‹å’Œç»“æŸ ã€‚è¿™äº›æ³¨è§£åŒ…æ‹¬ä»¥ä¸‹ï¼š  </p><ul><li><p>cs - Client Sent -å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œè¿™ä¸ªæ³¨è§£æè¿°äº†è¿™ä¸ª Span çš„å¼€å§‹  </p></li><li><p>sr - Server Received -æœåŠ¡ç«¯è·å¾—è¯·æ±‚å¹¶å‡†å¤‡å¼€å§‹å¤„ç†å®ƒï¼Œå¦‚æœå°†å…¶ sr å‡å» cs æ—¶é—´æˆ³ ä¾¿å¯å¾—åˆ°ç½‘ç»œä¼ è¾“çš„æ—¶é—´ã€‚ </p></li><li><p>ss - Server Sent ï¼ˆæœåŠ¡ç«¯å‘é€å“åº”ï¼‰â€“è¯¥æ³¨è§£è¡¨æ˜è¯·æ±‚å¤„ç†çš„å®Œæˆ(å½“è¯·æ±‚è¿”å›å®¢æˆ· ç«¯)ï¼Œå¦‚æœ ss çš„æ—¶é—´æˆ³å‡å» sr æ—¶é—´æˆ³ï¼Œå°±å¯ä»¥å¾—åˆ°æœåŠ¡å™¨è¯·æ±‚çš„æ—¶é—´ã€‚  </p></li><li><p>cr - Client Received ï¼ˆå®¢æˆ·ç«¯æ¥æ”¶å“åº”ï¼‰-æ­¤æ—¶ Span çš„ç»“æŸï¼Œå¦‚æœ cr çš„æ—¶é—´æˆ³å‡å» cs æ—¶é—´æˆ³ä¾¿å¯ä»¥å¾—åˆ°æ•´ä¸ªè¯·æ±‚æ‰€æ¶ˆè€—çš„æ—¶é—´ã€‚ </p></li></ul><p>SleuthåŸç†</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220304231626939.png" alt="image-20220304231626939"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ æ¯ä¸€ä¸ªæœåŠ¡ä¸€ä¸ªspan</span><br><span class="line">    + trace id</span><br><span class="line">    + span id</span><br><span class="line">    + annotationæ ‡æ³¨</span><br><span class="line">    + ç”¨æ¥è®¡ç®—æ—¶é—´</span><br></pre></td></tr></table></figure><p>Sleuth + Zipkin</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220304231702938.png" alt="image-20220304231702938"></p><p>é“¾è·¯è¿½è¸ª</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220304231828856.png" alt="image-20220304231828856"></p>]]></content>
    
    
    <summary type="html">äº§å“å¼€å‘</summary>
    
    
    
    <category term="äº§å“" scheme="https://fireonice.github.io/categories/%E4%BA%A7%E5%93%81/"/>
    
    
    <category term="äº§å“å¼€å‘" scheme="https://fireonice.github.io/tags/%E4%BA%A7%E5%93%81%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>è°·ç²’å•†åŸâ€”â€”æ”¯ä»˜å®æ”¯ä»˜&amp;RSAåŠ å¯†&amp;å†…ç½‘ç©¿é€</title>
    <link href="https://fireonice.github.io/2022/02/28/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-%E6%94%AF%E4%BB%98%E5%AE%9D%E6%94%AF%E4%BB%98&amp;RSA%E5%8A%A0%E5%AF%86&amp;%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"/>
    <id>https://fireonice.github.io/2022/02/28/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-%E6%94%AF%E4%BB%98%E5%AE%9D%E6%94%AF%E4%BB%98&amp;RSA%E5%8A%A0%E5%AF%86&amp;%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/</id>
    <published>2022-02-28T14:59:05.494Z</published>
    <updated>2022-02-28T15:32:20.078Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1ã€æ”¯ä»˜"><a href="#1ã€æ”¯ä»˜" class="headerlink" title="1ã€æ”¯ä»˜"></a>1ã€æ”¯ä»˜</h1><p>æ”¯ä»˜å®&amp;èš‚èšé‡‘æœå¼€å‘è€…å¹³å°ï¼š</p><p><a href="https://gitee.com/link?target=https://open.alipay.com/platform/home.htm">https://open.alipay.com/platform/home.htm</a></p><p>æ–‡æ¡£åœ°å€ï¼š</p><p>åˆ›å»ºåº”ç”¨å¯¹åº”æ–‡æ¡£ <a href="https://gitee.com/link?target=https://openhome.alipay.com/docCenter/docCenter.htm">https://openhome.alipay.com/docCenter/docCenter.htm</a></p><p>ç½‘é¡µç§»åŠ¨åº”ç”¨æ–‡æ¡£ <a href="https://gitee.com/link?target=https://opendocs.alipay.com/open/200/105304">https://opendocs.alipay.com/open/200/105304</a></p><h2 id="æ”¯ä»˜å®æ”¯ä»˜æµç¨‹"><a href="#æ”¯ä»˜å®æ”¯ä»˜æµç¨‹" class="headerlink" title="æ”¯ä»˜å®æ”¯ä»˜æµç¨‹"></a>æ”¯ä»˜å®æ”¯ä»˜æµç¨‹</h2><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220228230726942.png" alt="image-20220228230726942"></p><p>è·³è½¬çš„é¡µé¢æ˜¯æ ¹æ®AlipayTemplateå®šä¹‰çš„å›è°ƒåœ°å€æ¥è¿›è¡Œè·³è½¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// æœåŠ¡å™¨[å¼‚æ­¥é€šçŸ¥]é¡µé¢è·¯å¾„  éœ€http://æ ¼å¼çš„å®Œæ•´è·¯å¾„ï¼Œä¸èƒ½åŠ ?id=123è¿™ç±»è‡ªå®šä¹‰å‚æ•°ï¼Œå¿…é¡»å¤–ç½‘å¯ä»¥æ­£å¸¸è®¿é—®</span></span><br><span class="line">    <span class="comment">// æ”¯ä»˜å®ä¼šæ‚„æ‚„çš„ç»™æˆ‘ä»¬å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œå‘Šè¯‰æˆ‘ä»¬æ”¯ä»˜æˆåŠŸçš„ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">private</span>  String notify_url = <span class="string">&quot;http://member.gulimall.com/memberOrder.html&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¡µé¢è·³è½¬åŒæ­¥é€šçŸ¥é¡µé¢è·¯å¾„ éœ€http://æ ¼å¼çš„å®Œæ•´è·¯å¾„ï¼Œä¸èƒ½åŠ ?id=123è¿™ç±»è‡ªå®šä¹‰å‚æ•°ï¼Œå¿…é¡»å¤–ç½‘å¯ä»¥æ­£å¸¸è®¿é—®</span></span><br><span class="line">    <span class="comment">//åŒæ­¥é€šçŸ¥ï¼Œæ”¯ä»˜æˆåŠŸï¼Œä¸€èˆ¬è·³è½¬åˆ°æˆåŠŸé¡µ</span></span><br><span class="line">    <span class="keyword">private</span>  String return_url = <span class="string">&quot;http://member.gulimall.com/memberOrder.html&quot;</span>;</span><br></pre></td></tr></table></figure><p>æ”¯ä»˜æˆåŠŸåå¼‚æ­¥å›è°ƒæ¥å£å¤„ç†ï¼Œéœ€è¦æœ‰æœåŠ¡å™¨æˆ–é…ç½®äº†å†…ç½‘ç©¿é€æ‰èƒ½æ¥æ”¶åˆ°è¯¥æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ”¯ä»˜å®å¼‚æ­¥é€šçŸ¥å›è°ƒæ¥å£,éœ€è¦æ‹¥æœ‰å†…ç½‘ç©¿é€æˆ–æœåŠ¡å™¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/payed/notify&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">handleAlipayed</span><span class="params">(PayAsyncVo vo, HttpServletRequest request)</span> <span class="keyword">throws</span> UnsupportedEncodingException, AlipayApiException </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * é‡è¦ä¸€æ­¥éªŒç­¾å</span></span><br><span class="line"><span class="comment">         *  é˜²æ­¢åˆ«äººé€šè¿‡postmanç»™æˆ‘ä»¬å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œå‘Šè¯‰æˆ‘ä»¬è¯·æ±‚æˆåŠŸï¼Œä¸ºäº†é˜²æ­¢è¿™ç§æ•ˆæœé€šè¿‡éªŒç­¾</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Map&lt;String,String&gt; params = <span class="keyword">new</span> HashMap&lt;String,String&gt;();</span><br><span class="line">        Map&lt;String,String[]&gt; requestParams = request.getParameterMap();</span><br><span class="line">        <span class="keyword">for</span> (Iterator&lt;String&gt; iter = requestParams.keySet().iterator(); iter.hasNext();) &#123;</span><br><span class="line">            String name = (String) iter.next();</span><br><span class="line">            String[] values = (String[]) requestParams.get(name);</span><br><span class="line">            String valueStr = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; values.length; i++) &#123;</span><br><span class="line">                valueStr = (i == values.length - <span class="number">1</span>) ? valueStr + values[i]</span><br><span class="line">                        : valueStr + values[i] + <span class="string">&quot;,&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//ä¹±ç è§£å†³ï¼Œè¿™æ®µä»£ç åœ¨å‡ºç°ä¹±ç æ—¶ä½¿ç”¨</span></span><br><span class="line">            valueStr = <span class="keyword">new</span> String(valueStr.getBytes(<span class="string">&quot;ISO-8859-1&quot;</span>), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">            params.put(name, valueStr);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ”¯ä»˜å®éªŒç­¾ é˜²æ­¢æ¶æ„æäº¤</span></span><br><span class="line">        <span class="keyword">boolean</span> signVerified = AlipaySignature.rsaCheckV1(params</span><br><span class="line">                , alipayTemplate.getAlipay_public_key()</span><br><span class="line">                , alipayTemplate.getCharset()</span><br><span class="line">                , alipayTemplate.getSign_type());</span><br><span class="line">        <span class="keyword">if</span> (signVerified) &#123;</span><br><span class="line">            String result = orderService.handleAlipayed(vo);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ”¶å•é—®é¢˜</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220228233211250.png" alt="image-20220228233211250"></p><h2 id="æ”¯ä»˜æµç¨‹"><a href="#æ”¯ä»˜æµç¨‹" class="headerlink" title="æ”¯ä»˜æµç¨‹"></a>æ”¯ä»˜æµç¨‹</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">+ æ”¯ä»˜è·³è½¬</span><br><span class="line">    + controller</span><br><span class="line">        + æ ¹æ®è®¢å•å·æŸ¥è¯¢å°è£…è®¢å•Vo</span><br><span class="line">        + è°ƒç”¨æ”¯ä»˜æ–¹æ³•</span><br><span class="line">+ å“åº”è¿”å›ä¸€ä¸ªé¡µé¢ï¼ˆæ”¯ä»˜å®æ”¶é“¶å°ï¼‰</span><br><span class="line">+ ç›´æ¥äº¤ç»™æµè§ˆå™¨å³å¯</span><br><span class="line">+ è·³è½¬åˆ°ä¼šå‘˜è®¢å•åˆ—è¡¨é¡µ</span><br><span class="line">    + æ”¯ä»˜æˆåŠŸè·³è½¬controller</span><br><span class="line">    + ä¼šå‘˜æœåŠ¡feignè¿œç¨‹è°ƒç”¨è®¢å•æœåŠ¡</span><br><span class="line">            + æŸ¥è¯¢ç”¨æˆ·è®¢å•è¯¦æƒ…controller</span><br><span class="line">                + æ ¹æ®idæŸ¥è¯¢è®¢å•</span><br><span class="line">                + éå†è®¢å•</span><br><span class="line">                    + æ ¹æ®è®¢å•idæŸ¥è¯¢è®¢å•é¡¹</span><br><span class="line">                    + å°è£…è®¢å•é¡¹è¯¦æƒ…</span><br><span class="line">    + é…ç½®feign cookieåŒæ­¥æ‹¦æˆªå™¨ï¼ˆè¯·æ±‚å¸¦ä¸Šcookieï¼‰</span><br><span class="line">+ å¼‚æ­¥é€šçŸ¥ï¼ˆæ”¯ä»˜å®æ¨èï¼‰</span><br><span class="line">+ ä¸æ–­é€šçŸ¥ï¼Œç›´åˆ°å•†æˆ·è¿”å›æ”¶åˆ°ï¼ˆæœ€å¤§åŠªåŠ›é€šçŸ¥å‹æ–¹æ¡ˆï¼‰</span><br><span class="line">+ ä¿è¯å¤–ç½‘èƒ½å¤Ÿè®¿é—®åˆ°</span><br><span class="line">            + å†…ç½‘ç©¿é€</span><br><span class="line">            + server_name åŠ ä¸Šå¤–ç½‘çš„åœ°å€ï¼Œä¿è¯å¯ä»¥è¿›è¡Œserverçš„è·³è½¬</span><br><span class="line">+ å¼‚æ­¥é€šçŸ¥è·å–å‚æ•°æ¥å£</span><br><span class="line">+ æŠ½å–å¼‚æ­¥å‚æ•°çš„Vo</span><br><span class="line">+ ä¿®æ”¹çŠ¶æ€ä¹‹å‰ï¼Œéœ€è¦éªŒç­¾ï¼ˆæ˜¯å¦æ”¯ä»˜å®çš„æ•°æ®ï¼‰</span><br><span class="line">+ éªŒç­¾ä»£ç ï¼Œä»demoä¸­å¤åˆ¶</span><br><span class="line">+ æ”¯ä»˜æˆåŠŸå¤„ç†ï¼ˆä¿®æ”¹çŠ¶æ€ï¼‰</span><br><span class="line">+ ä¿å­˜äº¤æ˜“æµæ°´</span><br><span class="line">+ æ•°æ®åº“ä¿è¯è®¢å•å·ã€äº¤æ˜“å·ç­‰å”¯ä¸€</span><br><span class="line">+ ä¿®æ”¹è®¢å•çŠ¶æ€</span><br><span class="line">+ æŸ¥è¯¢è®¢å•ï¼Œæ”¹ä¸ºå·²æ”¯ä»˜</span><br><span class="line">+ æ”¶å•</span><br><span class="line">+ é—®é¢˜</span><br><span class="line">        + åœ¨æ”¯ä»˜é¡µé¢è¿‡ä¹…ï¼Œå…³å•åæ‰æ”¯ä»˜</span><br><span class="line">        + åº“å­˜å…³å•åè§£é”ï¼Œè®¢å•æ”¯ä»˜åå˜ä¸ºå·²æ”¯ä»˜</span><br><span class="line">+ æ”¯ä»˜å®è‡ªåŠ¨æ”¶å•åŠŸèƒ½ï¼ˆè‡ªåŠ¨å…³é—­æ”¶é“¶å°ï¼‰</span><br><span class="line">    + è§£é”åº“å­˜å®Œï¼Œæ”¯ä»˜å®Œçš„å¼‚æ­¥é€šçŸ¥æ‰åˆ°</span><br><span class="line">    + è®¢å•è§£é”ï¼Œæ‰‹åŠ¨æ”¶å•</span><br></pre></td></tr></table></figure><h1 id="2ã€RSAã€åŠ å¯†åŠ ç­¾ã€å¯†é’¥"><a href="#2ã€RSAã€åŠ å¯†åŠ ç­¾ã€å¯†é’¥" class="headerlink" title="2ã€RSAã€åŠ å¯†åŠ ç­¾ã€å¯†é’¥"></a>2ã€RSAã€åŠ å¯†åŠ ç­¾ã€å¯†é’¥</h1><p>å¯¹ç§°åŠ å¯†ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220228230515319.png" alt="image-20220228230515319"></p><p>å¯¹ç§°åŠ å¯†</p><ul><li>åŠ å¯†è§£å¯†ç”¨åŒä¸€æŠŠé’¥åŒ™</li><li>ä¸€æŠŠé’¥åŒ™ä¸å®‰å…¨</li></ul><p>éå¯¹ç§°åŠ å¯† ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220228230534327.png" alt="image-20220228230534327"></p><p>éå¯¹ç§°åŠ å¯†</p><ul><li>åŠ å¯†è§£å¯†ä½¿ç”¨ä¸åŒé’¥åŒ™</li></ul><p>å…¬é’¥ç§é’¥ï¼š</p><p>å…¬é’¥å’Œç§é’¥æ˜¯ä¸€ä¸ªç›¸å¯¹æ¦‚å¿µï¼Œå®ƒä»¬çš„å…¬ç§æ€§æ˜¯ç›¸å¯¹äºç”Ÿæˆè€…æ¥è¯´çš„ã€‚ </p><p>ä¸€å¯¹å¯†é’¥ç”Ÿæˆåï¼Œä¿å­˜åœ¨ç”Ÿæˆè€…æ‰‹é‡Œçš„å°±æ˜¯ç§é’¥ï¼Œ ç”Ÿæˆè€…å‘å¸ƒå‡ºå»å¤§å®¶ç”¨çš„å°±æ˜¯å…¬é’¥</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220228231813227.png" alt="image-20220228231813227"></p><h1 id="3ã€å†…ç½‘ç©¿é€"><a href="#3ã€å†…ç½‘ç©¿é€" class="headerlink" title="3ã€å†…ç½‘ç©¿é€"></a>3ã€å†…ç½‘ç©¿é€</h1><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220228231656684.png" alt="image-20220228231656684"></p><h2 id="1ã€ç®€ä»‹"><a href="#1ã€ç®€ä»‹" class="headerlink" title="1ã€ç®€ä»‹"></a>1ã€ç®€ä»‹</h2><p>å†…ç½‘ç©¿é€åŠŸèƒ½å¯ä»¥å…è®¸æˆ‘ä»¬ä½¿ç”¨å¤–ç½‘çš„ç½‘å€æ¥è®¿é—®ä¸»æœº æ­£å¸¸çš„å¤–ç½‘éœ€è¦è®¿é—®æˆ‘ä»¬é¡¹ç›®çš„æµç¨‹æ˜¯:</p><p>1ã€ä¹°æœåŠ¡å™¨å¹¶ä¸”æœ‰å…¬ç½‘å›ºå®šIP</p><p>2ã€ä¹°åŸŸåæ˜ å°„åˆ°æœåŠ¡å™¨çš„IP</p><p>3ã€åŸŸåéœ€è¦è¿›è¡Œå¤‡æ¡ˆå’Œå®¡æ ¸</p><h2 id="2ã€ä½¿ç”¨åœºæ™¯"><a href="#2ã€ä½¿ç”¨åœºæ™¯" class="headerlink" title="2ã€ä½¿ç”¨åœºæ™¯"></a>2ã€ä½¿ç”¨åœºæ™¯</h2><p>1ã€å¼€å‘æµ‹è¯•(å¾®ä¿¡ã€æ”¯ä»˜å®)</p><p>2ã€æ™ºæ…§äº’è”</p><p>3ã€è¿œç¨‹æ§åˆ¶</p><p>4ã€ç§æœ‰äº‘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">+ ä¼˜ç‚¹</span><br><span class="line">+ å…æœåŠ¡å™¨éƒ¨ç½²ï¼Œç›´æ¥åœ¨æœ¬åœ°å¯åŠ¨é¡¹ç›®æŒ‡å®šç«¯å£è¿›è¡Œå†…ç½‘ç©¿é€å³å¯</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">äº§å“å¼€å‘</summary>
    
    
    
    <category term="äº§å“" scheme="https://fireonice.github.io/categories/%E4%BA%A7%E5%93%81/"/>
    
    
    <category term="äº§å“å¼€å‘" scheme="https://fireonice.github.io/tags/%E4%BA%A7%E5%93%81%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>è°·ç²’å•†åŸâ€”â€”æŸ”æ€§äº‹åŠ¡-å¯é æ¶ˆæ¯+æœ€ç»ˆä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆï¼ˆå¼‚æ­¥ç¡®ä¿å‹ï¼‰</title>
    <link href="https://fireonice.github.io/2022/02/28/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1-%E5%8F%AF%E9%9D%A0%E6%B6%88%E6%81%AF+%E6%9C%80%E7%BB%88%E4%B8%80%E8%87%B4%E6%80%A7%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <id>https://fireonice.github.io/2022/02/28/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1-%E5%8F%AF%E9%9D%A0%E6%B6%88%E6%81%AF+%E6%9C%80%E7%BB%88%E4%B8%80%E8%87%B4%E6%80%A7%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</id>
    <published>2022-02-28T05:57:31.284Z</published>
    <updated>2022-03-04T15:32:16.866Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æŸ”æ€§äº‹åŠ¡-å¯é æ¶ˆæ¯-æœ€ç»ˆä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆï¼ˆå¼‚æ­¥ç¡®ä¿å‹ï¼‰"><a href="#æŸ”æ€§äº‹åŠ¡-å¯é æ¶ˆæ¯-æœ€ç»ˆä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆï¼ˆå¼‚æ­¥ç¡®ä¿å‹ï¼‰" class="headerlink" title="æŸ”æ€§äº‹åŠ¡-å¯é æ¶ˆæ¯+æœ€ç»ˆä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆï¼ˆå¼‚æ­¥ç¡®ä¿å‹ï¼‰"></a>æŸ”æ€§äº‹åŠ¡-å¯é æ¶ˆæ¯+æœ€ç»ˆä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆï¼ˆå¼‚æ­¥ç¡®ä¿å‹ï¼‰</h1><h2 id="RabbitMQå»¶æ—¶é˜Ÿåˆ—ï¼ˆå®ç°å®šæ—¶ä»»åŠ¡ï¼‰"><a href="#RabbitMQå»¶æ—¶é˜Ÿåˆ—ï¼ˆå®ç°å®šæ—¶ä»»åŠ¡ï¼‰" class="headerlink" title="RabbitMQå»¶æ—¶é˜Ÿåˆ—ï¼ˆå®ç°å®šæ—¶ä»»åŠ¡ï¼‰"></a>RabbitMQå»¶æ—¶é˜Ÿåˆ—ï¼ˆå®ç°å®šæ—¶ä»»åŠ¡ï¼‰</h2><p>åœºæ™¯ï¼š </p><p>æ¯”å¦‚æœªä»˜æ¬¾è®¢å•ï¼Œè¶…è¿‡ä¸€å®šæ—¶é—´åï¼Œç³»ç»Ÿè‡ªåŠ¨å–æ¶ˆè®¢å•å¹¶é‡Šæ”¾å æœ‰ç‰©å“ã€‚ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+ å¸¸ç”¨è§£å†³æ–¹æ¡ˆ </span><br><span class="line">+ springçš„ schedule å®šæ—¶ä»»åŠ¡è½®è¯¢æ•°æ®åº“ </span><br><span class="line">+ ç¼ºç‚¹ </span><br><span class="line">+ æ¶ˆè€—ç³»ç»Ÿå†…å­˜ã€å¢åŠ äº†æ•°æ®åº“çš„å‹åŠ›ã€å­˜åœ¨è¾ƒå¤§çš„æ—¶é—´è¯¯å·® </span><br><span class="line">+ è§£å†³</span><br><span class="line">+ rabbitmqçš„æ¶ˆæ¯TTLå’Œæ­»ä¿¡Exchangeç»“åˆ</span><br></pre></td></tr></table></figure><p>TTLå­˜æ´»æ—¶é—´</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220228102109187.png" alt="image-20220228102109187"></p><p>DLXæ­»ä¿¡äº¤æ¢æœºï¼ˆDead Letter Exchangesï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220228102131676.png" alt="image-20220228102131676"></p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220228102251153.png" alt="image-20220228102251153"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+ æ¨¡æ‹Ÿå»¶è¿Ÿåœºæ™¯</span><br><span class="line">    + æ¶ˆæ¯è®¾ç½®30mè¿‡æœŸï¼ˆé˜Ÿåˆ—ä¸è¢«ç›‘å¬ï¼‰</span><br><span class="line">    + 30måè¿›å…¥æ­»ä¿¡äº¤æ¢æœº</span><br><span class="line">    + æ¶ˆæ¯è¿›å…¥å¦ä¸€ä¸ªé˜Ÿåˆ—ï¼ˆè¢«ç›‘å¬ï¼‰</span><br></pre></td></tr></table></figure><h3 id="å»¶æ—¶é˜Ÿåˆ—å®ç°"><a href="#å»¶æ—¶é˜Ÿåˆ—å®ç°" class="headerlink" title="å»¶æ—¶é˜Ÿåˆ—å®ç°"></a>å»¶æ—¶é˜Ÿåˆ—å®ç°</h3><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220228102330181.png" alt="image-20220228102330181"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+ ç»™é˜Ÿåˆ—è®¾ç½®æ¶ˆæ¯è¿‡æœŸæ—¶é—´(æ¨è)</span><br><span class="line">+ ç»™æ¶ˆæ¯è®¾ç½®æ¶ˆæ¯è¿‡æœŸæ—¶é—´</span><br><span class="line">+ rabbitmqæ‡’æ£€æŸ¥</span><br><span class="line">    + åªä¼šæ£€æŸ¥ç¬¬ä¸€ä¸ªæ¶ˆæ¯æ˜¯å¦è¿‡æœŸ</span><br><span class="line">    + è‹¥åé¢æ¶ˆæ¯ttlå°ï¼Œä»æ— æ³•å‡ºé˜Ÿåˆ—</span><br><span class="line">    + æ‰€ä»¥ç»™é˜Ÿåˆ—è®¾ç½®è¿‡æœŸæ—¶é—´</span><br></pre></td></tr></table></figure><h2 id="åŸºäºMQå¯é æ¶ˆæ¯çš„ä¸€è‡´æ€§è§£å†³"><a href="#åŸºäºMQå¯é æ¶ˆæ¯çš„ä¸€è‡´æ€§è§£å†³" class="headerlink" title="åŸºäºMQå¯é æ¶ˆæ¯çš„ä¸€è‡´æ€§è§£å†³"></a>åŸºäºMQå¯é æ¶ˆæ¯çš„ä¸€è‡´æ€§è§£å†³</h2><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E6%B5%81%E7%A8%8B.jpg" alt="æ¶ˆæ¯é˜Ÿåˆ—æµç¨‹"></p><p>ç›‘å¬åº“å­˜è§£é”ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+ è§£é”åœºæ™¯</span><br><span class="line">+ æœªæ”¯ä»˜åœºæ™¯ã€æ‰‹åŠ¨å–æ¶ˆè®¢å•</span><br><span class="line">+ é”å®šæˆåŠŸï¼Œå…¶ä»–ä¸šåŠ¡å¤±è´¥ï¼Œè®¢å•å›æ»šï¼Œè‡ªåŠ¨è§£é”åº“å­˜ã€</span><br><span class="line">+ è§£é”ä¹‹å‰ï¼Œä¿å­˜å·¥ä½œå•ï¼ˆè¿½æº¯ï¼‰</span><br><span class="line">+ åº“å­˜é”æˆåŠŸæ—¶</span><br><span class="line">    + ä¿å­˜å·¥ä½œå•è¯¦æƒ…</span><br><span class="line">    + ç»™MQå‘é€æ¶ˆæ¯åˆ°å»¶æ—¶é˜Ÿåˆ—ï¼ˆæ¶ˆæ¯åŒ…å«å·¥ä½œå•è¯¦æƒ…ï¼‰</span><br></pre></td></tr></table></figure><p>åº“å­˜è§£é”é€»è¾‘ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+ ç›‘å¬è§£é”é˜Ÿåˆ—ï¼ˆå»¶æ—¶è¿‡æœŸé˜Ÿåˆ—ï¼‰</span><br><span class="line">+ æ ¹æ®æ¶ˆæ¯æŸ¥æ‰¾åº“å­˜å·¥ä½œå•</span><br><span class="line">+ æ²¡æœ‰ï¼šå¤±è´¥æ­£å¸¸å›æ»š</span><br><span class="line">    + æœ‰ï¼šåº“å­˜é”å®šæˆåŠŸï¼Œè¿œç¨‹è°ƒç”¨æŸ¥è¯¢è®¢å•</span><br><span class="line">        + æ²¡æœ‰è®¢å•ï¼šå¿…é¡»è§£é”</span><br><span class="line">        + æœ‰è®¢å•ï¼ŒæŸ¥çœ‹è®¢å•çŠ¶æ€</span><br><span class="line">            + å·²å–æ¶ˆï¼šè§£é”åº“å­˜</span><br><span class="line">            + æ²¡å–æ¶ˆï¼šä¸è§£é”</span><br><span class="line">    + ack</span><br><span class="line">+ åº“å­˜è§£é”ï¼Œæ›´æ–°å·¥ä½œå•çŠ¶æ€</span><br></pre></td></tr></table></figure><p>å®šæ—¶å…³å•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ ç›‘å¬å™¨â€”â€”å…³é—­è®¢å•</span><br><span class="line">    + æ‰§è¡ŒæˆåŠŸåˆ™ack</span><br><span class="line">    + ä¸æˆåŠŸæ‹’ç»æ¶ˆæ¯ï¼Œé‡å›é˜Ÿåˆ—</span><br><span class="line">+ è®¢å•åˆ›å»ºæˆåŠŸåï¼Œå‘é€æ¶ˆæ¯ï¼ˆè®¢å•ï¼‰åˆ°MQå»¶æ—¶é˜Ÿåˆ—</span><br><span class="line">    + æ¶ˆæ¯è¿‡æœŸåˆ°è¾¾ç›‘å¬å™¨</span><br><span class="line">        + æŸ¥è¯¢è®¢å•çš„æœ€æ–°çŠ¶æ€ï¼ˆå¯èƒ½å·²æ”¯ä»˜ï¼‰</span><br><span class="line">        + ä»åœ¨ä»£ä»˜æ¬¾çŠ¶æ€ï¼Œåˆ™å…³å•</span><br><span class="line">            + æ›´æ–°è®¢å•çŠ¶æ€ä¸ºå·²å–æ¶ˆ</span><br></pre></td></tr></table></figure><p>é—®é¢˜ï¼š</p><p>1ã€è®¢å•æ¶ˆæ¯å¡é¡¿ï¼Œå¯¼è‡´å…³å•æ¯”åº“å­˜è§£é”æ…¢</p><p>2ã€åº“å­˜è§£é”åˆ¤æ–­è®¢å•</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220228103933963.png" alt="image-20220228103933963"></p><p>è§£å†³ï¼šå…³å•åå‘é€æ¶ˆæ¯è§£é”åº“å­˜ï¼ˆä¸»åŠ¨è§£é”åº“å­˜è¡¥å¿ï¼‰</p><p>å…³å•è§£é”åº“å­˜ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">+ æŸ¥è¯¢åº“å­˜å·¥ä½œå•çŠ¶æ€ï¼Œé˜²æ­¢é‡å¤è§£é”åº“å­˜</span><br><span class="line">+ æŒ‰ç…§å·¥ä½œå•æ‰¾åˆ°æ‰€æœ‰æœªè§£é”çš„åº“å­˜ï¼ˆçŠ¶æ€ä¸º1ï¼‰è¿›è¡Œè§£é”</span><br></pre></td></tr></table></figure><p>åº“å­˜è§£é”æ€»ç»“ï¼šä¸¤ç§æ¶ˆæ¯ç›‘å¬ï¼ˆåº“å­˜è§£é”å»¶è¿Ÿæ¶ˆæ¯ã€orderä¸»åŠ¨å…³é—­æ¶ˆæ¯ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ ä¸»åŠ¨è¡¥å¿ï¼šå…³å•è§£é”</span><br><span class="line">+ è¢«åŠ¨è¡¥å¿ï¼šè‡ªåŠ¨è§£é”</span><br><span class="line">+ è‹¥åˆ¤æ–­è§£é”è¿‡åˆ™æ”¾è¿‡æ¶ˆæ¯</span><br><span class="line">+ è§£å†³é«˜å¹¶å‘</span><br><span class="line">+ è§£å†³ç³»ç»Ÿå¼‚æ„</span><br></pre></td></tr></table></figure><h2 id="æ¶ˆæ¯ä¸¢å¤±ã€ç§¯å‹ã€é‡å¤ç­‰è§£å†³æ–¹æ¡ˆ"><a href="#æ¶ˆæ¯ä¸¢å¤±ã€ç§¯å‹ã€é‡å¤ç­‰è§£å†³æ–¹æ¡ˆ" class="headerlink" title="æ¶ˆæ¯ä¸¢å¤±ã€ç§¯å‹ã€é‡å¤ç­‰è§£å†³æ–¹æ¡ˆ"></a>æ¶ˆæ¯ä¸¢å¤±ã€ç§¯å‹ã€é‡å¤ç­‰è§£å†³æ–¹æ¡ˆ</h2><h3 id="æ¶ˆæ¯ä¸¢å¤±ï¼šackï¼Œé˜²é‡è¡¨"><a href="#æ¶ˆæ¯ä¸¢å¤±ï¼šackï¼Œé˜²é‡è¡¨" class="headerlink" title="æ¶ˆæ¯ä¸¢å¤±ï¼šackï¼Œé˜²é‡è¡¨"></a>æ¶ˆæ¯ä¸¢å¤±ï¼šackï¼Œé˜²é‡è¡¨</h3><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220228104351405.png" alt="image-20220228104351405"></p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220228104549154.png" alt="image-20220228104549154"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+ æ¶ˆæ¯ä¸¢å¤±</span><br><span class="line">+ ç½‘ç»œé—®é¢˜ï¼Œå‘é€å¤±è´¥</span><br><span class="line">+ åŠ ä¸Štry-catch</span><br><span class="line">    + æ—¥å¿—è®°å½•</span><br><span class="line">            + æ•°æ®åº“ä¿å­˜å‘é€çš„æ¶ˆæ¯è¯¦ç»†ä¿¡æ¯ï¼Œè®°å½•æ¶ˆæ¯çŠ¶æ€</span><br><span class="line">            + å®šæœŸæ‰«ææ•°æ®åº“ï¼Œå‘é€å¤±è´¥æ¶ˆæ¯</span><br><span class="line">    + æ¶ˆæ¯æŠµè¾¾brokerï¼Œå°šæœªæŒä¹…åŒ–å®Œæˆï¼ˆæœªæŠµè¾¾é˜Ÿåˆ—ï¼‰ï¼Œå®•æœº</span><br><span class="line">    + å‘é€ç«¯åŠ å…¥æ¶ˆæ¯ç¡®è®¤å›è°ƒæœºåˆ¶ï¼ˆe-&gt;qï¼‰</span><br><span class="line">    + è‡ªåŠ¨ackï¼Œæ¶ˆè´¹è€…æ²¡æ¥å¾—åŠæ¶ˆè´¹ï¼Œå®•æœº</span><br><span class="line">    + å¼€å¯æ‰‹åŠ¨ackæ¨¡å¼ï¼Œæ¶ˆè´¹æˆåŠŸæ‰ç§»é™¤æ¶ˆæ¯</span><br><span class="line">    + æ€»ç»“</span><br><span class="line">    + åšå¥½æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼ˆ pulisherï¼Œconsumer æ‰‹åŠ¨ackï¼‰</span><br><span class="line">+ æ¯ä¸€ä¸ªå‘é€çš„æ¶ˆæ¯éƒ½åœ¨æ•°æ®åº“åšå¥½è®°å½•ã€‚å®šæœŸå°†å¤±è´¥çš„æ¶ˆæ¯å†æ¬¡å‘é€ä¸€é.</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `mq_message` (</span><br><span class="line">`message_id` <span class="type">char</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`content` text,</span><br><span class="line">`to_exchane` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`routing_key` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`class_type` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`message_status` <span class="type">int</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;0-æ–°å»º 1-å·²å‘é€ 2-é”™è¯¯æŠµè¾¾ 3-å·²æŠµè¾¾&#x27;</span>,</span><br><span class="line">`create_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`update_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`message_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4</span><br></pre></td></tr></table></figure><h3 id="æ¶ˆæ¯é‡å¤ï¼šå¹‚ç­‰æ€§"><a href="#æ¶ˆæ¯é‡å¤ï¼šå¹‚ç­‰æ€§" class="headerlink" title="æ¶ˆæ¯é‡å¤ï¼šå¹‚ç­‰æ€§"></a>æ¶ˆæ¯é‡å¤ï¼šå¹‚ç­‰æ€§</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+ æ¶ˆæ¯é‡å¤</span><br><span class="line">    + æ¶ˆæ¯æ¶ˆè´¹æˆåŠŸï¼Œackå‰å®•æœºï¼Œå†æ¬¡è¢«æ¶ˆè´¹</span><br><span class="line">    + æ¶ˆè´¹å¤±è´¥ï¼Œé‡è¯•æœºåˆ¶</span><br><span class="line">    + ackå®•æœºï¼Œunackå˜ä¸ºreadyï¼Œbrokeré‡æ–°å‘é€æ¶ˆæ¯ï¼ŒåŒ1</span><br><span class="line">    + è§£å†³</span><br><span class="line">        + ä¸šåŠ¡é€»è¾‘è§£é”åº“å­˜æ–¹æ³•è®¾ä¸ºå¹‚ç­‰æ€§ï¼šåˆ¤æ–­åº“å­˜å·¥å•çŠ¶æ€ï¼Œå·²è§£é”åˆ™æ— éœ€è§£é”</span><br><span class="line">        + ä¿è¯å¹‚ç­‰ï¼šä½¿ç”¨é˜²é‡è¡¨ï¼Œå¤„ç†åä¿å­˜å”¯ä¸€æ ‡è¯†idï¼Œå…å†æ¬¡å¤„ç†</span><br><span class="line">        + æ¶ˆæ¯çš„redeliveredå±æ€§ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºé‡æ–°æŠ•é€’</span><br><span class="line">            + æ— æ³•åˆ¤æ–­ä¸Šæ¬¡æ˜¯å¦å¤„ç†æˆåŠŸ</span><br></pre></td></tr></table></figure><h3 id="æ¶ˆæ¯ç§¯å‹ï¼š"><a href="#æ¶ˆæ¯ç§¯å‹ï¼š" class="headerlink" title="æ¶ˆæ¯ç§¯å‹ï¼š"></a>æ¶ˆæ¯ç§¯å‹ï¼š</h3><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220228104743095.png" alt="image-20220228104743095"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+ æ¶ˆæ¯ç§¯å‹</span><br><span class="line">    + æ¶ˆè´¹è€…å®•æœº</span><br><span class="line">    + æ¶ˆè´¹èƒ½åŠ›ä¸è¶³</span><br><span class="line">    + å‘é€æµé‡å¤ªå¤§</span><br><span class="line">        + é™åˆ¶ä¸šåŠ¡æµé‡</span><br><span class="line">        + ä¸Šçº¿æ›´å¤šæ¶ˆè´¹è€…</span><br><span class="line">        + æ‰¹é‡å–å‡ºæ¶ˆæ¯ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œç¦»çº¿ä¸šåŠ¡æ…¢æ…¢å¤„ç†</span><br></pre></td></tr></table></figure><p>1ã€åˆ†ç¦»æ¶ˆæ¯å¾®æœåŠ¡ï¼Œè€ƒè™‘æ¶ˆæ¯å¯é æ€§</p><p>2ã€è°ƒç”¨å¾®æœåŠ¡å»å‘é€æ¶ˆæ¯</p>]]></content>
    
    
    <summary type="html">äº§å“å¼€å‘</summary>
    
    
    
    <category term="äº§å“" scheme="https://fireonice.github.io/categories/%E4%BA%A7%E5%93%81/"/>
    
    
    <category term="äº§å“å¼€å‘" scheme="https://fireonice.github.io/tags/%E4%BA%A7%E5%93%81%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>è°·ç²’å•†åŸâ€”â€”å¹‚ç­‰æ€§&amp;åˆ†å¸ƒå¼äº‹åŠ¡&amp;RaftåŸç†</title>
    <link href="https://fireonice.github.io/2022/02/27/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-%E5%B9%82%E7%AD%89%E6%80%A7&amp;%E5%88%86%E5%B8%83%E5%BC%8F%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1&amp;%E5%8F%AF%E9%9D%A0%E6%B6%88%E6%81%AF&amp;%E6%9C%80%E7%BB%88%E4%B8%80%E8%87%B4%E6%80%A7/"/>
    <id>https://fireonice.github.io/2022/02/27/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-%E5%B9%82%E7%AD%89%E6%80%A7&amp;%E5%88%86%E5%B8%83%E5%BC%8F%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1&amp;%E5%8F%AF%E9%9D%A0%E6%B6%88%E6%81%AF&amp;%E6%9C%80%E7%BB%88%E4%B8%80%E8%87%B4%E6%80%A7/</id>
    <published>2022-02-27T15:25:07.604Z</published>
    <updated>2022-03-04T15:32:13.522Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1ã€è®¢å•é“¾è·¯"><a href="#1ã€è®¢å•é“¾è·¯" class="headerlink" title="1ã€è®¢å•é“¾è·¯"></a>1ã€è®¢å•é“¾è·¯</h1><h2 id="è®¢å•ä¸­å¿ƒ"><a href="#è®¢å•ä¸­å¿ƒ" class="headerlink" title="è®¢å•ä¸­å¿ƒ"></a>è®¢å•ä¸­å¿ƒ</h2><p>ç”µå•†ç³»ç»Ÿæ¶‰åŠåˆ° 3 æµï¼Œåˆ†åˆ«æ—¶ä¿¡æ¯æµï¼Œèµ„é‡‘æµï¼Œç‰©æµï¼Œè€Œè®¢å•ç³»ç»Ÿä½œä¸ºä¸­æ¢å°†ä¸‰è€…æœ‰æœºçš„é›†åˆèµ·æ¥ã€‚ </p><p>è®¢å•æ¨¡å—æ˜¯ç”µå•†ç³»ç»Ÿçš„æ¢çº½ï¼Œåœ¨è®¢å•è¿™ä¸ªç¯èŠ‚ä¸Šéœ€æ±‚è·å–å¤šä¸ªæ¨¡å—çš„æ•°æ®å’Œä¿¡æ¯ï¼ŒåŒæ—¶å¯¹è¿™äº›ä¿¡æ¯è¿›è¡ŒåŠ å·¥å¤„ç†åæµå‘ä¸‹ä¸ªç¯èŠ‚ï¼Œè¿™ä¸€ç³»åˆ—å°±æ„æˆäº†è®¢å•çš„ä¿¡æ¯æµé€šã€‚ </p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220228080432263.png" alt="image-20220228080432263"></p><h2 id="è®¢å•æµç¨‹"><a href="#è®¢å•æµç¨‹" class="headerlink" title="è®¢å•æµç¨‹"></a>è®¢å•æµç¨‹</h2><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220228081824936.png" alt="image-20220228081824936"></p><h2 id="Feignè¿œç¨‹å¼‚æ­¥è°ƒç”¨ä¸¢å¤±è¯·æ±‚å¤´ã€ä¸Šä¸‹æ–‡é—®é¢˜"><a href="#Feignè¿œç¨‹å¼‚æ­¥è°ƒç”¨ä¸¢å¤±è¯·æ±‚å¤´ã€ä¸Šä¸‹æ–‡é—®é¢˜" class="headerlink" title="Feignè¿œç¨‹å¼‚æ­¥è°ƒç”¨ä¸¢å¤±è¯·æ±‚å¤´ã€ä¸Šä¸‹æ–‡é—®é¢˜"></a>Feignè¿œç¨‹å¼‚æ­¥è°ƒç”¨ä¸¢å¤±è¯·æ±‚å¤´ã€ä¸Šä¸‹æ–‡é—®é¢˜</h2><p>Feignè¿œç¨‹è°ƒç”¨ä¸¢å¤±è¯·æ±‚å¤´é—®é¢˜</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220228091104146.png" alt="image-20220228091104146"></p><p>feignå¼‚æ­¥æƒ…å†µä¸¢å¤±ä¸Šä¸‹æ–‡é—®é¢˜</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220228091118962.png" alt="image-20220228091118962"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">+ Feignè¿œç¨‹è°ƒç”¨ä¸¢å¤±è¯·æ±‚å¤´é—®é¢˜</span><br><span class="line">    + åŸå› </span><br><span class="line">    + feginè°ƒç”¨æ²¡å¸¦session</span><br><span class="line">        + åˆ›å»ºä¸€ä¸ªæ–°requestï¼Œæ²¡æœ‰è¯·æ±‚å¤´</span><br><span class="line">    + è§£å†³ï¼ˆåŒæ­¥è€è¯·æ±‚cookieï¼‰</span><br><span class="line">        + åŠ ä¸ªfeignè¯·æ±‚è°ƒç”¨çš„æ‹¦æˆªå™¨</span><br><span class="line">        + ThreadLocalè·å–è€è¯·æ±‚è¯·æ±‚å±æ€§â€”â€”cookie</span><br><span class="line">        + è®¾ç½®æ–°è¯·æ±‚cookie</span><br><span class="line">+ feignå¼‚æ­¥æƒ…å†µä¸¢å¤±ä¸Šä¸‹æ–‡é—®é¢˜</span><br><span class="line">+ åŸå› </span><br><span class="line">+ requecontexHolderåº•å±‚æ˜¯åŒä¸€çº¿ç¨‹å…±äº«æ•°æ®</span><br><span class="line">+ é€šè¿‡ThreadLocalè·å–è€è¯·æ±‚ï¼Œå¼‚æ­¥ç¼–æ’éåŒä¸€çº¿ç¨‹</span><br><span class="line">+ è§£å†³</span><br><span class="line">+ æ‰§è¡Œå¼‚æ­¥å‰ï¼Œæå‰å…±äº«è¯·æ±‚æ•°æ®</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä¼ ä¼ ç”¨æˆ·idï¼Œä¼ ç”¨æˆ·ä¼šè¯ï¼Œåè€…å®‰å…¨äº›ï¼Œ</p><p>1ã€idä¼ å‚</p><p>2ã€ä¼ é€’cookie</p><h1 id="2ã€æ¥å£å¹‚ç­‰æ€§"><a href="#2ã€æ¥å£å¹‚ç­‰æ€§" class="headerlink" title="2ã€æ¥å£å¹‚ç­‰æ€§"></a>2ã€æ¥å£å¹‚ç­‰æ€§</h1><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/%E8%AE%A2%E5%8D%95%E7%A1%AE%E8%AE%A4%E9%A1%B5%E6%B5%81%E7%A8%8B.png" alt="è®¢å•ç¡®è®¤é¡µæµç¨‹"></p><p>ä¿è¯å¹‚ç­‰æƒ…å†µ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+ ç”¨æˆ·å¤šæ¬¡ç‚¹å‡»æŒ‰é’®</span><br><span class="line">+ ç”¨æˆ·é¡µé¢å›é€€å†æ¬¡æäº¤</span><br><span class="line">+ å¾®æœåŠ¡äº’ç›¸è°ƒç”¨ï¼Œç”±äºç½‘ç»œé—®é¢˜ï¼Œå¯¼è‡´è¯·æ±‚å¤±è´¥ã€‚feign è§¦å‘é‡è¯•æœºåˆ¶</span><br><span class="line">+ å…¶ä»–ä¸šåŠ¡æƒ…å†µ</span><br></pre></td></tr></table></figure><p>å¹‚ç­‰è§£å†³æ–¹æ¡ˆï¼š</p><h2 id="1ã€tokenæœºåˆ¶"><a href="#1ã€tokenæœºåˆ¶" class="headerlink" title="1ã€tokenæœºåˆ¶"></a>1ã€tokenæœºåˆ¶</h2><p>1ã€æœåŠ¡ç«¯æä¾›äº†å‘é€ token çš„æ¥å£ã€‚æˆ‘ä»¬åœ¨åˆ†æä¸šåŠ¡çš„æ—¶å€™ï¼Œå“ªäº›ä¸šåŠ¡æ˜¯å­˜åœ¨å¹‚ç­‰é—®é¢˜çš„ï¼Œå°±å¿…é¡»åœ¨æ‰§è¡Œä¸šåŠ¡å‰ï¼Œå…ˆå»è·å– tokenï¼ŒæœåŠ¡å™¨ä¼šæŠŠ token ä¿å­˜åˆ° redis ä¸­ã€‚<br>2ã€ç„¶åè°ƒç”¨ä¸šåŠ¡æ¥å£è¯·æ±‚æ—¶ï¼ŒæŠŠ token æºå¸¦è¿‡å»ï¼Œä¸€èˆ¬æ”¾åœ¨è¯·æ±‚å¤´éƒ¨ã€‚<br>3ã€æœåŠ¡å™¨åˆ¤æ–­ token æ˜¯å¦å­˜åœ¨ redis ä¸­ï¼Œå­˜åœ¨è¡¨ç¤ºç¬¬ä¸€æ¬¡è¯·æ±‚ï¼Œç„¶ååˆ é™¤ token,ç»§ç»­æ‰§è¡Œä¸šåŠ¡ã€‚<br>4ã€å¦‚æœåˆ¤æ–­ token ä¸å­˜åœ¨ redis ä¸­ï¼Œå°±è¡¨ç¤ºæ˜¯é‡å¤æ“ä½œï¼Œç›´æ¥è¿”å›é‡å¤æ ‡è®°ç»™ clientï¼Œè¿™æ ·å°±ä¿è¯äº†ä¸šåŠ¡ä»£ç ï¼Œä¸è¢«é‡å¤æ‰§è¡Œã€‚</p><p>å±é™©æ€§(éåŸå­æ“ä½œ)ï¼š<br>1ã€å…ˆåˆ é™¤ token è¿˜æ˜¯ååˆ é™¤ tokenï¼›<br>    (1) å…ˆåˆ é™¤å¯èƒ½å¯¼è‡´ï¼Œä¸šåŠ¡ç¡®å®æ²¡æœ‰æ‰§è¡Œï¼Œé‡è¯•è¿˜å¸¦ä¸Šä¹‹å‰ tokenï¼Œç”±äºé˜²é‡è®¾è®¡å¯¼è‡´ï¼Œ è¯·æ±‚è¿˜æ˜¯ä¸èƒ½æ‰§è¡Œã€‚<br>    (2) ååˆ é™¤å¯èƒ½å¯¼è‡´ï¼Œä¸šåŠ¡å¤„ç†æˆåŠŸï¼Œä½†æ˜¯æœåŠ¡é—ªæ–­ï¼Œå‡ºç°è¶…æ—¶ï¼Œæ²¡æœ‰åˆ é™¤ tokenï¼Œåˆ« äººç»§ç»­é‡è¯•ï¼Œå¯¼è‡´ä¸šåŠ¡è¢«æ‰§è¡Œä¸¤è¾¹<br>    (3) æˆ‘ä»¬æœ€å¥½è®¾è®¡ä¸ºå…ˆåˆ é™¤ tokenï¼Œå¦‚æœä¸šåŠ¡è°ƒç”¨å¤±è´¥ï¼Œå°±é‡æ–°è·å– token å†æ¬¡è¯·æ±‚ã€‚<br>2ã€Token è·å–ã€æ¯”è¾ƒå’Œåˆ é™¤å¿…é¡»æ˜¯åŸå­æ€§<br>    (1) redis.get(token) ã€token.equalsã€redis.del(token)å¦‚æœè¿™ä¸¤ä¸ªæ“ä½œä¸æ˜¯åŸå­ï¼Œå¯èƒ½å¯¼ è‡´ï¼Œé«˜å¹¶å‘ä¸‹ï¼Œéƒ½ get åˆ°åŒæ ·çš„æ•°æ®ï¼Œåˆ¤æ–­éƒ½æˆåŠŸï¼Œç»§ç»­ä¸šåŠ¡å¹¶å‘æ‰§è¡Œ<br>    (2) å¯ä»¥åœ¨ redis ä½¿ç”¨ lua è„šæœ¬å®Œæˆè¿™ä¸ªæ“ä½œ if redis.call(â€˜getâ€™, KEYS[1]) == ARGV[1] then return redis.call(â€˜delâ€™, KEYS[1]) else return 0 end</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å¿…é¡»åŸå­æ€§ï¼šluaè„šæœ¬</span><br><span class="line">1ã€è·å–ä»¤ç‰Œ</span><br><span class="line">2ã€å¯¹æ¯”token</span><br><span class="line">3ã€åˆ é™¤ä»¤ç‰Œ</span><br></pre></td></tr></table></figure><h2 id="2ã€å„ç§é”æœºåˆ¶"><a href="#2ã€å„ç§é”æœºåˆ¶" class="headerlink" title="2ã€å„ç§é”æœºåˆ¶"></a>2ã€å„ç§é”æœºåˆ¶</h2><p>æ•°æ®åº“æ‚²è§‚é”</p><p>select * from xxxx where id = 1 for update; æ‚²è§‚é”ä½¿ç”¨æ—¶ä¸€èˆ¬ä¼´éšäº‹åŠ¡ä¸€èµ·ä½¿ç”¨ï¼Œæ•°æ®é”å®šæ—¶é—´å¯èƒ½ä¼šå¾ˆé•¿ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µé€‰ç”¨ã€‚ å¦å¤–è¦æ³¨æ„çš„æ˜¯ï¼Œid å­—æ®µä¸€å®šæ˜¯ä¸»é”®æˆ–è€…å”¯ä¸€ç´¢å¼•ï¼Œä¸ç„¶å¯èƒ½é€ æˆé”è¡¨çš„ç»“æœï¼Œå¤„ç†èµ·æ¥ä¼šéå¸¸éº»çƒ¦ã€‚</p><p>æ•°æ®åº“ä¹è§‚é”</p><p>è¿™ç§æ–¹æ³•é€‚åˆåœ¨æ›´æ–°çš„åœºæ™¯ä¸­ï¼Œ update t_goods set count = count -1 , version = version + 1 where good_id=2 and version = 1 æ ¹æ® version ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯åœ¨æ“ä½œåº“å­˜å‰å…ˆè·å–å½“å‰å•†å“çš„ version ç‰ˆæœ¬å·ï¼Œç„¶åæ“ä½œçš„æ—¶å€™ å¸¦ä¸Šæ­¤ version å·ã€‚æˆ‘ä»¬æ¢³ç†ä¸‹ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡æ“ä½œåº“å­˜æ—¶ï¼Œå¾—åˆ° version ä¸º 1ï¼Œè°ƒç”¨åº“å­˜æœåŠ¡ version å˜æˆäº† 2ï¼›ä½†è¿”å›ç»™è®¢å•æœåŠ¡å‡ºç°äº†é—®é¢˜ï¼Œè®¢å•æœåŠ¡åˆä¸€æ¬¡å‘èµ·è°ƒç”¨åº“å­˜æœåŠ¡ï¼Œå½“è®¢ å•æœåŠ¡ä¼ å¦‚çš„ version è¿˜æ˜¯ 1ï¼Œå†æ‰§è¡Œä¸Šé¢çš„ sql è¯­å¥æ—¶ï¼Œå°±ä¸ä¼šæ‰§è¡Œï¼›å› ä¸º version å·²ç»å˜ ä¸º 2 äº†ï¼Œwhere æ¡ä»¶å°±ä¸æˆç«‹ã€‚è¿™æ ·å°±ä¿è¯äº†ä¸ç®¡è°ƒç”¨å‡ æ¬¡ï¼Œåªä¼šçœŸæ­£çš„å¤„ç†ä¸€æ¬¡ã€‚ä¹è§‚é”ä¸»è¦ä½¿ç”¨äºå¤„ç†è¯»å¤šå†™å°‘çš„é—®é¢˜</p><p>ä¸šåŠ¡å±‚åˆ†å¸ƒå¼é”</p><p>å¦‚æœå¤šä¸ªæœºå™¨å¯èƒ½åœ¨åŒä¸€æ—¶é—´åŒæ—¶å¤„ç†ç›¸åŒçš„æ•°æ®ï¼Œæ¯”å¦‚å¤šå°æœºå™¨å®šæ—¶ä»»åŠ¡éƒ½æ‹¿åˆ°äº†ç›¸åŒæ•° æ®å¤„ç†ï¼Œæˆ‘ä»¬å°±å¯ä»¥åŠ åˆ†å¸ƒå¼é”ï¼Œé”å®šæ­¤æ•°æ®ï¼Œå¤„ç†å®Œæˆåé‡Šæ”¾é”ã€‚è·å–åˆ°é”çš„å¿…é¡»å…ˆåˆ¤æ–­è¿™ä¸ªæ•°æ®æ˜¯å¦è¢«å¤„ç†è¿‡ã€‚</p><h2 id="3ã€å„ç§å”¯ä¸€çº¦æŸ"><a href="#3ã€å„ç§å”¯ä¸€çº¦æŸ" class="headerlink" title="3ã€å„ç§å”¯ä¸€çº¦æŸ"></a>3ã€å„ç§å”¯ä¸€çº¦æŸ</h2><p>æ•°æ®åº“å”¯ä¸€çº¦æŸ</p><p>æ’å…¥æ•°æ®ï¼Œåº”è¯¥æŒ‰ç…§å”¯ä¸€ç´¢å¼•è¿›è¡Œæ’å…¥ï¼Œæ¯”å¦‚è®¢å•å·ï¼Œç›¸åŒçš„è®¢å•å°±ä¸å¯èƒ½æœ‰ä¸¤æ¡è®°å½•æ’å…¥ã€‚æˆ‘ä»¬åœ¨æ•°æ®åº“å±‚é¢é˜²æ­¢é‡å¤ã€‚ è¿™ä¸ªæœºåˆ¶æ˜¯åˆ©ç”¨äº†æ•°æ®åº“çš„ä¸»é”®å”¯ä¸€çº¦æŸçš„ç‰¹æ€§ï¼Œè§£å†³äº†åœ¨ insert åœºæ™¯æ—¶å¹‚ç­‰é—®é¢˜ã€‚ä½†ä¸»é”® çš„è¦æ±‚ä¸æ˜¯è‡ªå¢çš„ä¸»é”®ï¼Œè¿™æ ·å°±éœ€è¦ä¸šåŠ¡ç”Ÿæˆå…¨å±€å”¯ä¸€çš„ä¸»é”®ã€‚ å¦‚æœæ˜¯åˆ†åº“åˆ†è¡¨åœºæ™¯ä¸‹ï¼Œè·¯ç”±è§„åˆ™è¦ä¿è¯ç›¸åŒè¯·æ±‚ä¸‹ï¼Œè½åœ°åœ¨åŒä¸€ä¸ªæ•°æ®åº“å’ŒåŒä¸€è¡¨ä¸­ï¼Œè¦ä¸ç„¶æ•°æ®åº“ä¸»é”®çº¦æŸå°±ä¸èµ·æ•ˆæœäº†ï¼Œå› ä¸ºæ˜¯ä¸åŒçš„æ•°æ®åº“å’Œè¡¨ä¸»é”®ä¸ç›¸å…³ã€‚</p><p>redis seté˜²é‡</p><p>å¾ˆå¤šæ•°æ®éœ€è¦å¤„ç†ï¼Œåªèƒ½è¢«å¤„ç†ä¸€æ¬¡ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥è®¡ç®—æ•°æ®çš„ MD5 å°†å…¶æ”¾å…¥ redis çš„ setï¼Œæ¯æ¬¡å¤„ç†æ•°æ®ï¼Œå…ˆçœ‹è¿™ä¸ª MD5 æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå­˜åœ¨å°±ä¸å¤„ç†ã€‚</p><h2 id="4ã€é˜²é‡è¡¨"><a href="#4ã€é˜²é‡è¡¨" class="headerlink" title="4ã€é˜²é‡è¡¨"></a>4ã€é˜²é‡è¡¨</h2><p>ä½¿ç”¨è®¢å•å· orderNo åšä¸ºå»é‡è¡¨çš„å”¯ä¸€ç´¢å¼•ï¼ŒæŠŠå”¯ä¸€ç´¢å¼•æ’å…¥å»é‡è¡¨ï¼Œå†è¿›è¡Œä¸šåŠ¡æ“ä½œï¼Œä¸” ä»–ä»¬åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ã€‚è¿™ä¸ªä¿è¯äº†é‡å¤è¯·æ±‚æ—¶ï¼Œå› ä¸ºå»é‡è¡¨æœ‰å”¯ä¸€çº¦æŸï¼Œå¯¼è‡´è¯·æ±‚å¤±è´¥ï¼Œé¿å…äº†å¹‚ç­‰é—®é¢˜ã€‚è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œå»é‡è¡¨å’Œä¸šåŠ¡è¡¨åº”è¯¥åœ¨åŒä¸€åº“ä¸­ï¼Œè¿™æ ·å°±ä¿è¯äº†åœ¨åŒä¸€ä¸ªäº‹åŠ¡ï¼Œå³ä½¿ä¸šåŠ¡æ“ä½œå¤±è´¥äº†ï¼Œä¹Ÿä¼šæŠŠå»é‡è¡¨çš„æ•°æ®å›æ»šã€‚è¿™ä¸ªå¾ˆå¥½çš„ä¿è¯äº†æ•°æ®ä¸€è‡´æ€§ã€‚ </p><p>redis é˜²é‡ä¹Ÿç®—</p><h2 id="5ã€å…¨å±€è¯·æ±‚å”¯ä¸€id"><a href="#5ã€å…¨å±€è¯·æ±‚å”¯ä¸€id" class="headerlink" title="5ã€å…¨å±€è¯·æ±‚å”¯ä¸€id"></a>5ã€å…¨å±€è¯·æ±‚å”¯ä¸€id</h2><p>è°ƒç”¨æ¥å£æ—¶ï¼Œç”Ÿæˆä¸€ä¸ªå”¯ä¸€ idï¼Œredis å°†æ•°æ®ä¿å­˜åˆ°é›†åˆä¸­ï¼ˆå»é‡ï¼‰ï¼Œå­˜åœ¨å³å¤„ç†è¿‡ã€‚ </p><p>å¯ä»¥ä½¿ç”¨ nginx è®¾ç½®æ¯ä¸€ä¸ªè¯·æ±‚çš„å”¯ä¸€ idï¼›</p><p>proxy_set_header X-Request-Id $request_id;</p><p>æ€»ç»“ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+ tokenä»¤ç‰Œ</span><br><span class="line">+ åŸå­æ€§è·å–ã€å¯¹æ¯”ã€åˆ é™¤token</span><br><span class="line">+ é”</span><br><span class="line">+ æ•°æ®åº“ä¹è§‚é”ã€æ‚²è§‚é”</span><br><span class="line">+ åˆ†å¸ƒå¼é”</span><br><span class="line">+ å”¯ä¸€çº¦æŸ</span><br><span class="line">+ æ•°æ®åº“ä¸»é”®å”¯ä¸€çº¦æŸ</span><br><span class="line">+ MD5åŠ å¯†redis set</span><br><span class="line">+ é˜²é‡è¡¨</span><br><span class="line">+ æ“ä½œä¹‹åä»¥å”¯ä¸€ç´¢å¼•æ”¾å…¥å»é‡è¡¨ä¸­ï¼Œä¸”ä¸ä¸šåŠ¡è¡¨åŒä¸€æ•°æ®åº“ä¿è¯åŒä¸€äº‹åŠ¡</span><br><span class="line">+ å…¨å±€è¯·æ±‚å”¯ä¸€id</span><br><span class="line">+ è°ƒç”¨æ¥å£ç”Ÿæˆå”¯ä¸€idï¼Œæ”¾åˆ°redisä¸­å»é‡</span><br><span class="line">+ é“¾è·¯è¿½è¸ª</span><br></pre></td></tr></table></figure><h1 id="3ã€åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#3ã€åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="3ã€åˆ†å¸ƒå¼äº‹åŠ¡"></a>3ã€åˆ†å¸ƒå¼äº‹åŠ¡</h1><h2 id="1ã€æœ¬åœ°äº‹åŠ¡"><a href="#1ã€æœ¬åœ°äº‹åŠ¡" class="headerlink" title="1ã€æœ¬åœ°äº‹åŠ¡"></a>1ã€æœ¬åœ°äº‹åŠ¡</h2><h3 id="äº‹åŠ¡çš„åŸºæœ¬æ€§è´¨"><a href="#äº‹åŠ¡çš„åŸºæœ¬æ€§è´¨" class="headerlink" title="äº‹åŠ¡çš„åŸºæœ¬æ€§è´¨"></a>äº‹åŠ¡çš„åŸºæœ¬æ€§è´¨</h3><p>æ•°æ®åº“äº‹åŠ¡çš„å‡ ä¸ªç‰¹æ€§ï¼šåŸå­æ€§ï¼ˆAtomicityï¼‰ã€ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€éš”ç¦»æ€§ï¼ˆIsolationï¼‰å’ŒæŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼Œç®€ç§°å°±æ˜¯ ACIDã€‚</p><ul><li><p>åŸå­æ€§ï¼šä¸€ç³»åˆ—çš„æ“ä½œæ•´ä½“ä¸å¯æ‹†åˆ†ï¼Œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ï¼›</p></li><li><p>ä¸€è‡´æ€§ï¼šæ•°æ®åœ¨äº‹åŠ¡çš„å‰åï¼Œä¸šåŠ¡æ•´ä½“ä¸€è‡´ï¼›</p></li><li><p>éš”ç¦»æ€§ï¼šäº‹åŠ¡ä¹‹é—´äº’ç›¸éš”ç¦»ï¼›</p></li><li><p>æŒä¹…æ€§ï¼šä¸€æ—¦äº‹åŠ¡æˆåŠŸï¼Œæ•°æ®ä¸€å®šä¼šè½ç›˜åœ¨æ•°æ®åº“ã€‚</p></li></ul><h3 id="äº‹åŠ¡çš„éš”ç¦»çº§åˆ«"><a href="#äº‹åŠ¡çš„éš”ç¦»çº§åˆ«" class="headerlink" title="äº‹åŠ¡çš„éš”ç¦»çº§åˆ«"></a>äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</h3><ul><li><p>READ UNCOMMITTEDï¼ˆè¯»æœªæäº¤ï¼‰ï¼šè¯¥éš”ç¦»çº§åˆ«çš„äº‹åŠ¡ä¼šè¯»åˆ°å…¶å®ƒæœªæäº¤äº‹åŠ¡çš„æ•°æ®ï¼Œæ­¤ç°è±¡ä¹Ÿç§°ä¹‹ä¸ºè„è¯»ã€‚</p></li><li><p>READ COMMITTEDï¼ˆè¯»æäº¤ï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡å¯ä»¥è¯»å–å¦ä¸€ä¸ªå·²æäº¤çš„äº‹åŠ¡ï¼Œå¤šæ¬¡è¯»å–ä¼šé€ æˆä¸ä¸€æ ·çš„ç»“æœï¼Œæ­¤ç°è±¡ç§°ä¸ºä¸å¯é‡å¤è¯»é—®é¢˜ï¼ŒOracle å’Œ SQL Server çš„é»˜è®¤éš”ç¦»çº§åˆ«ã€‚</p></li><li><p>REPEATABLE READï¼ˆå¯é‡å¤è¯»ï¼‰ï¼šè¯¥éš”ç¦»çº§åˆ«æ˜¯ MySQL é»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼Œåœ¨åŒä¸€ä¸ªäº‹åŠ¡é‡Œï¼Œselect çš„ç»“æœæ˜¯äº‹åŠ¡å¼€å§‹æ—¶æ—¶é—´ç‚¹çš„çŠ¶æ€ï¼Œå› æ­¤ï¼ŒåŒæ ·çš„ select æ“ä½œè¯»åˆ°çš„ç»“æœä¼šæ˜¯ä¸€è‡´çš„ï¼Œä½†æ˜¯ï¼Œä¼šæœ‰å¹»è¯»ç°è±¡ã€‚MySQLçš„ InnoDB å¼•æ“å¯ä»¥é€šè¿‡ next-key locks æœºåˆ¶ï¼ˆå‚è€ƒä¸‹æ–‡â€è¡Œé”çš„ç®—æ³•â€ä¸€èŠ‚ï¼‰æ¥é¿å…å¹»è¯»ã€‚</p></li><li><p>SERIALIZABLEï¼ˆåºåˆ—åŒ–ï¼‰ï¼šåœ¨è¯¥éš”ç¦»çº§åˆ«ä¸‹äº‹åŠ¡éƒ½æ˜¯ä¸²è¡Œé¡ºåºæ‰§è¡Œçš„ï¼ŒMySQL æ•°æ®åº“çš„ InnoDB å¼•æ“ä¼šç»™è¯»æ“ä½œéšå¼åŠ ä¸€æŠŠè¯»å…±äº«é”ï¼Œä»è€Œé¿å…äº†è„è¯»ã€ä¸å¯é‡è¯»å¤è¯»å’Œå¹»è¯»é—®é¢˜ã€‚</p></li></ul><h3 id="äº‹åŠ¡çš„ä¼ æ’­çº§åˆ«"><a href="#äº‹åŠ¡çš„ä¼ æ’­çº§åˆ«" class="headerlink" title="äº‹åŠ¡çš„ä¼ æ’­çº§åˆ«"></a>äº‹åŠ¡çš„ä¼ æ’­çº§åˆ«</h3><ol><li><p>PROPAGATION_REQUIREDï¼š ï¼šå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åŠ å…¥è¯¥äº‹åŠ¡ï¼Œè¯¥è®¾ç½®æ˜¯æœ€å¸¸ç”¨çš„è®¾ç½®ã€‚</p></li><li><p>PROPAGATION_SUPPORTSï¼š ï¼šæ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åŠ å…¥è¯¥äº‹åŠ¡ï¼Œå¦‚æœå½“å‰ä¸å­˜åœ¨äº‹åŠ¡ï¼Œå°±ä»¥éäº‹åŠ¡æ‰§è¡Œã€‚</p></li><li><p>PROPAGATION_MANDATORYï¼š ï¼šæ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åŠ å…¥è¯¥äº‹åŠ¡ï¼Œå¦‚æœå½“å‰ä¸å­˜åœ¨äº‹åŠ¡ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ã€‚</p></li><li><p>PROPAGATION_REQUIRES_NEWï¼šåˆ›å»ºæ–°äº‹åŠ¡ï¼Œæ— è®ºå½“å‰å­˜ä¸å­˜åœ¨äº‹åŠ¡ï¼Œéƒ½åˆ›å»ºæ–°äº‹åŠ¡ã€‚</p></li><li><p>PROPAGATION_NOT_SUPPORTEDï¼šä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œæ“ä½œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚</p></li><li><p>PROPAGATION_NEVERï¼š ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</p></li><li><p>PROPAGATION_NESTEDï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œã€‚å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æ‰§è¡Œä¸ PROPAGATION_REQUIRED ç±»ä¼¼çš„æ“ä½œã€‚</p></li></ol><p>é—®é¢˜ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ è¿œç¨‹è°ƒç”¨è¶…æ—¶â€”â€”å‡å¼‚å¸¸</span><br><span class="line">    + æŠ›å‡ºå¼‚å¸¸å¯¼è‡´å…¨éƒ¨å›æ»š</span><br><span class="line">+ æ‰£å‡ç§¯åˆ†å¼‚å¸¸</span><br><span class="line">    + æ‰£å‡ç§¯åˆ†å¯ä»¥å›æ»š</span><br><span class="line">    + æœ¬åœ°çš„è®¢å•å¯ä»¥å›æ»š</span><br><span class="line">    + è¿œç¨‹é”åº“å­˜æ— æ³•å›æ»š</span><br><span class="line">        + äº‹åŠ¡æ— æ³•æ§åˆ¶è¿œç¨‹æœåŠ¡</span><br><span class="line">        + è¿˜éœ€æ‰‹åŠ¨é‡Šæ”¾åº“å­˜</span><br></pre></td></tr></table></figure><h2 id="2ã€SpringBootäº‹åŠ¡"><a href="#2ã€SpringBootäº‹åŠ¡" class="headerlink" title="2ã€SpringBootäº‹åŠ¡"></a>2ã€SpringBootäº‹åŠ¡</h2><p>@Transactional</p><p>å†…éƒ¨äº‹åŠ¡äº’è°ƒé—®é¢˜ï¼š</p><p>åœ¨åŒä¸€ä¸ªç±»é‡Œé¢ï¼Œç¼–å†™ä¸¤ä¸ªæ–¹æ³•ï¼Œå†…éƒ¨è°ƒç”¨çš„æ—¶å€™ï¼Œä¼šå¯¼è‡´äº‹åŠ¡è®¾ç½®å¤±æ•ˆã€‚</p><p>åŸå› ï¼šåŒä¸€å¯¹è±¡å†…äº‹åŠ¡äº’è°ƒé»˜è®¤å¤±æ•ˆï¼Œç»•è¿‡äº†ä»£ç†å¯¹è±¡ã€‚</p><p>è§£å†³ï¼š</p><ol><li><p>å¯¼å…¥ spring-boot-starter-aop</p></li><li><p>@EnableTransactionManagement(proxyTargetClass = true)</p></li><li><p>@EnableAspectJAutoProxy(exposeProxy=true)</p></li><li><p>AopContext.currentProxy() è°ƒç”¨æ–¹æ³•</p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ æœ¬åœ°äº‹åŠ¡äº’è°ƒè§£å†³</span><br><span class="line">    + ä½¿ç”¨ä»£ç†å¯¹è±¡è°ƒç”¨äº‹åŠ¡æ–¹æ³•</span><br><span class="line">        + å¼•å…¥aopçš„aspectj</span><br><span class="line">        + å¼€å¯aspectjåŠ¨æ€ä»£ç†åŠŸèƒ½</span><br><span class="line">        + springä¸­beanå¯ä»¥ä»£æ›¿ aspectj</span><br></pre></td></tr></table></figure><h2 id="3ã€åˆ†å¸ƒå¼äº‹åŠ¡-1"><a href="#3ã€åˆ†å¸ƒå¼äº‹åŠ¡-1" class="headerlink" title="3ã€åˆ†å¸ƒå¼äº‹åŠ¡"></a>3ã€åˆ†å¸ƒå¼äº‹åŠ¡</h2><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220228092926460.png" alt="image-20220228092926460"></p><p>1ã€è¿œç¨‹æœåŠ¡å‡å¤±è´¥</p><p>2ã€è¿œç¨‹äº‹åŠ¡å›æ»š</p><h3 id="åˆ†å¸ƒå¼CAPå®šç†"><a href="#åˆ†å¸ƒå¼CAPå®šç†" class="headerlink" title="åˆ†å¸ƒå¼CAPå®šç†"></a>åˆ†å¸ƒå¼CAPå®šç†</h3><p>åˆ†å¸ƒå¼ç³»ç»Ÿç»å¸¸å‡ºç°çš„å¼‚å¸¸æœºå™¨å®•æœºã€ç½‘ç»œå¼‚å¸¸ã€æ¶ˆæ¯ä¸¢å¤±ã€æ¶ˆæ¯ä¹±åºã€æ•°æ®é”™è¯¯ã€ä¸å¯é çš„ TCPã€å­˜å‚¨æ•°æ®ä¸¢å¤±â€¦</p><p>åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯ä¼ä¸šé›†æˆä¸­çš„ä¸€ä¸ªæŠ€æœ¯éš¾ç‚¹ï¼Œä¹Ÿæ˜¯æ¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„ä¸­éƒ½ä¼šæ¶‰åŠåˆ°çš„ä¸€ä¸ªä¸œè¥¿ï¼Œç‰¹åˆ«æ˜¯åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå‡ ä¹å¯ä»¥è¯´æ˜¯æ— æ³•é¿å…ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220228094112202.png" alt="image-20220228094112202"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">+ CAPå®šç†</span><br><span class="line">+ ä¸€è‡´ã€å¯ç”¨äºŒé€‰ä¸€ï¼Œåˆ†åŒºå®¹é”™æ€§æ— æ³•é¿å…</span><br></pre></td></tr></table></figure><h3 id="RaftåŸç†"><a href="#RaftåŸç†" class="headerlink" title="RaftåŸç†"></a>RaftåŸç†</h3><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220228094509282.png" alt="image-20220228094509282"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">+ åˆ†å¸ƒå¼ç³»ç»Ÿå®ç°ä¸€è‡´æ€§çš„Raftç®—æ³•ã€paxosç­‰</span><br><span class="line">    + leaderé€‰ä¸¾</span><br><span class="line">        + éšä»è‡ªæ—‹æ—¶é—´ï¼ˆéšæœºï¼‰ï¼Œç­‰å¾…å‘½ä»¤</span><br><span class="line">        + è‡ªæ—‹ç»“æŸçš„éšä»å˜æˆå€™é€‰äººï¼Œå¼€å¯ä¸€è½®æ–°çš„é€‰ä¸¾</span><br><span class="line">        + éšä»è‹¥å½“å‰æœªæŠ•ç¥¨å¯å‘é€æŠ•ç¥¨</span><br><span class="line">        + éšä»æŠ•è¿‡ç¥¨åé‡æ–°è‡ªæ—‹</span><br><span class="line">        + leaderå‘é€è¿½åŠ æ—¥å¿—ä¿¡æ¯ç»™éšä»</span><br><span class="line">            + æ¶ˆæ¯å‘é€ä»¥é—´éš”ï¼ˆå¿ƒè·³æ—¶é—´ï¼‰å‘é€</span><br><span class="line">            + éšä»æ”¶åˆ°æ¶ˆæ¯åé‡ç½®è‡ªæ—‹æ—¶é—´</span><br><span class="line">        + leaderå®•æœº</span><br><span class="line">            + éšä»è‡ªæ—‹æ—¶é—´ç»“æŸï¼Œå˜ä¸ºå€™é€‰è€…</span><br><span class="line">            + å¼€å¯é€‰ä¸¾ï¼Œæˆä¸ºleader</span><br><span class="line">        + å¦‚æœå‡ºç°ä¸¤ä¸ªå€™é€‰è€…ï¼Œå‡ºç°æŠ•ç¥¨åˆ†ç¦»</span><br><span class="line">            + è°çš„æŠ•ç¥¨è¯·æ±‚å…ˆåˆ°æŠ•è°ï¼Œå…¶ä»–çš„æ‹’æ”¶</span><br><span class="line">            + ç¥¨æ•°ä¸€æ ·</span><br><span class="line">            + é‡å†™æ¥ä¸€è½®è‡ªæ—‹ï¼Œå€™é€‰è€…é€‰ä¸¾</span><br><span class="line">            + ç›´åˆ°å€™é€‰è€…ç¥¨æ•°æœ€å¤šé€‰å‡ºleader</span><br><span class="line">    + æ—¥å¿—å¤åˆ¶</span><br><span class="line">    + leaderå°†æ‰€æœ‰æ”¹å˜å¤åˆ¶ç»™å…¶ä»–node</span><br><span class="line">            + ä½¿ç”¨è¿½åŠ æ—¥å¿—æ–¹å¼å¤åˆ¶ï¼ˆåœ¨æ¯ä¸€ä¸ªå¿ƒè·³æ—¶å‘é€ï¼‰</span><br><span class="line">            + éšä»æ”¶åˆ°åŒæ­¥åå›å¤æ¶ˆæ¯</span><br><span class="line">            + leaderæ”¶åˆ°å¤§å¤šæ•°å›å¤åæäº¤ï¼Œå¹¶å“åº”å®¢æˆ·ç«¯</span><br><span class="line">            + åœ¨ä¸‹ä¸€ä¸ªå¿ƒè·³æ—¶é—´ï¼Œè¯·æ±‚å…¶ä»–nodeæäº¤</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220228094701842.png" alt="image-20220228094701842"></p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220228094710919.png" alt="image-20220228094710919"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+ å‡ºç°åˆ†åŒºé”™è¯¯</span><br><span class="line">    + åˆ†åŒºä¹‹å</span><br><span class="line">        + æ¥æ”¶ä¸åˆ°æ¶ˆæ¯ï¼Œé€‰ä¸¾é¢†å¯¼</span><br><span class="line">        + å¤§å¤šæ•°åŒæ„æ‰èƒ½è¿›è¡Œæ”¹å˜</span><br><span class="line">    + æ¢å¤ç½‘ç»œåˆ†åŒº</span><br><span class="line">        + ä½è½®æ¬¡leaderé€€ä½</span><br><span class="line">        + å¤„äºä½è½®æ¬¡çš„nodeæœªæäº¤æ—¥å¿—å…¨éƒ¨å›æ»š</span><br><span class="line">        + åŒ¹é…æ–°leaderæ—¥å¿—</span><br><span class="line">        + å…¨éƒ¨nodeä¸€è‡´</span><br></pre></td></tr></table></figure><p>Raftç®—æ³•å®˜ç½‘ï¼š<a href="https://raft.github.io/">https://raft.github.io/</a></p><h3 id="Baseç†è®º"><a href="#Baseç†è®º" class="headerlink" title="Baseç†è®º"></a>Baseç†è®º</h3><p>æ˜¯å¯¹ CAP ç†è®ºçš„å»¶ä¼¸ï¼Œæ€æƒ³æ˜¯å³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼ˆCAP çš„ä¸€è‡´æ€§å°±æ˜¯å¼ºä¸€è‡´æ€§ï¼‰ï¼Œä½†å¯ä»¥é‡‡ç”¨é€‚å½“çš„é‡‡å–å¼±ä¸€è‡´æ€§ï¼Œå³<strong>æœ€ç»ˆä¸€è‡´æ€§</strong>ã€‚ </p><p>BASE æ˜¯æŒ‡</p><ul><li><p>åŸºæœ¬å¯ç”¨ï¼ˆBasically Availableï¼‰</p></li><li><ul><li>åŸºæœ¬å¯ç”¨æ˜¯æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°æ•…éšœçš„æ—¶å€™ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ï¼ˆä¾‹å¦‚å“åº”æ—¶é—´ã€åŠŸèƒ½ä¸Šçš„å¯ç”¨æ€§ï¼‰ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒåŸºæœ¬å¯ç”¨ç»ä¸ç­‰ä»·äºç³»ç»Ÿä¸å¯ç”¨ã€‚</li></ul></li><li><ul><li><ul><li>å“åº”æ—¶é—´ä¸Šçš„æŸå¤±ï¼šæ­£å¸¸æƒ…å†µä¸‹æœç´¢å¼•æ“éœ€è¦åœ¨ 0.5 ç§’ä¹‹å†…è¿”å›ç»™ç”¨æˆ·ç›¸åº”çš„æŸ¥è¯¢ç»“æœï¼Œä½†ç”±äºå‡ºç°æ•…éšœï¼ˆæ¯”å¦‚ç³»ç»Ÿéƒ¨åˆ†æœºæˆ¿å‘ç”Ÿæ–­ç”µæˆ–æ–­ç½‘æ•…éšœï¼‰ï¼ŒæŸ¥è¯¢ç»“æœçš„å“åº”æ—¶é—´å¢åŠ åˆ°äº† 1~2 ç§’ã€‚</li><li>åŠŸèƒ½ä¸Šçš„æŸå¤±ï¼šè´­ç‰©ç½‘ç«™åœ¨è´­ç‰©é«˜å³°ï¼ˆå¦‚åŒåä¸€ï¼‰æ—¶ï¼Œä¸ºäº†ä¿æŠ¤ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œéƒ¨åˆ†æ¶ˆè´¹è€…å¯èƒ½ä¼šè¢«å¼•å¯¼åˆ°ä¸€ä¸ªé™çº§é¡µé¢ã€‚</li></ul></li></ul></li><li><p>è½¯çŠ¶æ€ï¼ˆ Soft Stateï¼‰</p></li><li><ul><li>è½¯çŠ¶æ€æ˜¯æŒ‡å…è®¸ç³»ç»Ÿå­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œè€Œè¯¥ä¸­é—´çŠ¶æ€ä¸ä¼šå½±å“ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§ã€‚åˆ†å¸ƒå¼å­˜å‚¨ä¸­ä¸€èˆ¬ä¸€ä»½æ•°æ®ä¼šæœ‰å¤šä¸ªå‰¯æœ¬ï¼Œå…è®¸ä¸åŒå‰¯æœ¬åŒæ­¥çš„å»¶æ—¶å°±æ˜¯è½¯çŠ¶æ€çš„ä½“ç°ã€‚mysql replication çš„å¼‚æ­¥å¤åˆ¶ä¹Ÿæ˜¯ä¸€ç§ä½“ç°ã€‚</li></ul></li><li><p>æœ€ç»ˆä¸€è‡´æ€§ï¼ˆ Eventual Consistencyï¼‰</p></li><li><ul><li>æœ€ç»ˆä¸€è‡´æ€§æ˜¯æŒ‡ç³»ç»Ÿä¸­çš„æ‰€æœ‰æ•°æ®å‰¯æœ¬ç»è¿‡ä¸€å®šæ—¶é—´åï¼Œæœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ã€‚å¼±ä¸€è‡´æ€§å’Œå¼ºä¸€è‡´æ€§ç›¸åï¼Œæœ€ç»ˆä¸€è‡´æ€§æ˜¯å¼±ä¸€è‡´æ€§çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µã€‚</li></ul></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+ base</span><br><span class="line">    + åŸºæœ¬å¯ç”¨</span><br><span class="line">        + å…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§</span><br><span class="line">    + è½¯çŠ¶æ€</span><br><span class="line">        + å…è®¸ç³»ç»Ÿå­˜åœ¨ä¸­é—´çŠ¶æ€</span><br><span class="line">    + æœ€ç»ˆä¸€è‡´æ€§</span><br><span class="line">        + ç»å†ä¸€å®šæ—¶é—´åï¼Œæœ€ç»ˆèƒ½è¾¾åˆ°ä¸€è‡´æ€§çŠ¶æ€</span><br></pre></td></tr></table></figure><h3 id="å¼ºä¸€è‡´æ€§ã€å¼±ä¸€è‡´æ€§ã€æœ€ç»ˆä¸€è‡´æ€§"><a href="#å¼ºä¸€è‡´æ€§ã€å¼±ä¸€è‡´æ€§ã€æœ€ç»ˆä¸€è‡´æ€§" class="headerlink" title="å¼ºä¸€è‡´æ€§ã€å¼±ä¸€è‡´æ€§ã€æœ€ç»ˆä¸€è‡´æ€§"></a>å¼ºä¸€è‡´æ€§ã€å¼±ä¸€è‡´æ€§ã€æœ€ç»ˆä¸€è‡´æ€§</h3><p>â€‹    ä»å®¢æˆ·ç«¯è§’åº¦ï¼Œå¤šè¿›ç¨‹å¹¶å‘è®¿é—®æ—¶ï¼Œæ›´æ–°è¿‡çš„æ•°æ®åœ¨ä¸åŒè¿›ç¨‹å¦‚ä½•è·å–çš„ä¸åŒç­–ç•¥ï¼Œå†³å®šäº†ä¸åŒçš„ä¸€è‡´æ€§ã€‚å¯¹äºå…³ç³»å‹æ•°æ®åº“ï¼Œè¦æ±‚æ›´æ–°è¿‡çš„æ•°æ®èƒ½è¢«åç»­çš„è®¿é—®éƒ½èƒ½çœ‹åˆ°ï¼Œè¿™æ˜¯ <strong>å¼ºä¸€è‡´æ€§</strong>ã€‚å¦‚æœèƒ½å®¹å¿åç»­çš„éƒ¨åˆ†æˆ–è€…å…¨éƒ¨è®¿é—®ä¸åˆ°ï¼Œåˆ™æ˜¯ <strong>å¼±ä¸€è‡´æ€§</strong>ã€‚å¦‚æœç»è¿‡ä¸€æ®µæ—¶é—´åè¦æ±‚èƒ½è®¿é—®åˆ°æ›´æ–°åçš„æ•°æ®ï¼Œåˆ™æ˜¯ <strong>æœ€ç»ˆä¸€è‡´æ€§ã€‚</strong></p><h3 id="åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ"></a>åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ</h3><h4 id="2PCæ¨¡å¼"><a href="#2PCæ¨¡å¼" class="headerlink" title="2PCæ¨¡å¼"></a>2PCæ¨¡å¼</h4><p>æ•°æ®åº“æ”¯æŒçš„ 2PCã€2 phase commit äºŒé˜¶æäº¤ã€‘ï¼Œåˆå«åš XA Transactionsã€‚</p><p>MySQL ä» 5.5 ç‰ˆæœ¬å¼€å§‹æ”¯æŒï¼ŒSQL Server 2005 å¼€å§‹æ”¯æŒï¼ŒOracle 7 å¼€å§‹æ”¯æŒã€‚å…¶ä¸­ï¼ŒXA æ˜¯ä¸€ä¸ªä¸¤é˜¶æ®µæäº¤åè®®ï¼Œè¯¥åè®®åˆ†ä¸ºä»¥ä¸‹ä¸¤ä¸ªé˜¶æ®µï¼š</p><p>ç¬¬ä¸€é˜¶æ®µï¼šäº‹åŠ¡åè°ƒå™¨è¦æ±‚æ¯ä¸ªæ¶‰åŠåˆ°äº‹åŠ¡çš„æ•°æ®åº“é¢„æäº¤(precommit)æ­¤æ“ä½œï¼Œå¹¶åæ˜ æ˜¯å¦å¯ä»¥æäº¤ã€‚</p><p>ç¬¬äºŒé˜¶æ®µï¼šäº‹åŠ¡åè°ƒå™¨è¦æ±‚æ¯ä¸ªæ•°æ®åº“æäº¤æ•°æ®ã€‚</p><p>å…¶ä¸­ï¼Œå¦‚æœæœ‰ä»»ä½•ä¸€ä¸ªæ•°æ®åº“å¦å†³æ­¤æ¬¡æäº¤ï¼Œé‚£ä¹ˆæ‰€æœ‰æ•°æ®åº“éƒ½ä¼šè¢«è¦æ±‚å›æ»šå®ƒä»¬åœ¨æ­¤äº‹åŠ¡ä¸­çš„é‚£éƒ¨åˆ†ä¿¡æ¯ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220228100342688.png" alt="image-20220228100342688"></p><ul><li><p>XA åè®®æ¯”è¾ƒç®€å•ï¼Œè€Œä¸”ä¸€æ—¦å•†ä¸šæ•°æ®åº“å®ç°äº† XA åè®®ï¼Œä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡çš„æˆæœ¬ä¹Ÿæ¯”è¾ƒä½ã€‚</p></li><li><p>XA  æ€§èƒ½ä¸ç†æƒ³ï¼Œç‰¹åˆ«æ˜¯åœ¨äº¤æ˜“ä¸‹å•é“¾è·¯ï¼Œå¾€å¾€å¹¶å‘é‡å¾ˆé«˜ï¼ŒXA æ— æ³•æ»¡è¶³é«˜å¹¶å‘åœºæ™¯</p></li><li><p>XA ç›®å‰åœ¨å•†ä¸šæ•°æ®åº“æ”¯æŒçš„æ¯”è¾ƒç†æƒ³ï¼Œåœ¨ åœ¨ mysql  æ•°æ®åº“ä¸­æ”¯æŒçš„ä¸å¤ªç†æƒ³ï¼Œmysql çš„XA å®ç°ï¼Œæ²¡æœ‰è®°å½• prepare é˜¶æ®µæ—¥å¿—ï¼Œä¸»å¤‡åˆ‡æ¢å›å¯¼è‡´ä¸»åº“ä¸å¤‡åº“æ•°æ®ä¸ä¸€è‡´ã€‚</p></li><li><p>è®¸å¤š nosql ä¹Ÿæ²¡æœ‰æ”¯æŒ XAï¼Œè¿™è®© XA çš„åº”ç”¨åœºæ™¯å˜å¾—éå¸¸ç‹­éš˜ã€‚</p></li><li><p>ä¹Ÿæœ‰ 3PCï¼Œå¼•å…¥äº†è¶…æ—¶æœºåˆ¶ï¼ˆæ— è®ºåè°ƒè€…è¿˜æ˜¯å‚ä¸è€…ï¼Œåœ¨å‘å¯¹æ–¹å‘é€è¯·æ±‚åï¼Œè‹¥é•¿æ—¶é—´æœªæ”¶åˆ°å›åº”åˆ™åšå‡ºç›¸åº”å¤„ç†ï¼‰</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+ 2PCæ¨¡å¼ï¼ˆXAï¼‰ï¼šäºŒé˜¶æ®µæäº¤</span><br><span class="line">    + ä½¿ç”¨åœºæ™¯å°</span><br><span class="line">    + é«˜å¹¶å‘æ€§èƒ½å·®</span><br></pre></td></tr></table></figure><h4 id="æŸ”æ€§äº‹åŠ¡-TCC"><a href="#æŸ”æ€§äº‹åŠ¡-TCC" class="headerlink" title="æŸ”æ€§äº‹åŠ¡-TCC"></a>æŸ”æ€§äº‹åŠ¡-TCC</h4><p>åˆšæ€§äº‹åŠ¡ï¼šéµå¾ª ACID åŸåˆ™ï¼Œå¼ºä¸€è‡´æ€§ã€‚</p><p>æŸ”æ€§äº‹åŠ¡ï¼šéµå¾ª BASE ç†è®ºï¼Œæœ€ç»ˆä¸€è‡´æ€§ï¼›</p><p>ä¸åˆšæ€§äº‹åŠ¡ä¸åŒï¼ŒæŸ”æ€§äº‹åŠ¡å…è®¸ä¸€å®šæ—¶é—´å†…ï¼Œä¸åŒèŠ‚ç‚¹çš„æ•°æ®ä¸ä¸€è‡´ï¼Œä½†è¦æ±‚æœ€ç»ˆä¸€è‡´ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/1629027928516-e4e2272b-2df1-48ec-ac90-dee09d1c96ab.png" alt="image.png"></p><p>ä¸€é˜¶æ®µ prepare è¡Œä¸ºï¼šè°ƒç”¨ è‡ªå®šä¹‰ çš„ prepare é€»è¾‘ã€‚</p><p>äºŒé˜¶æ®µ commit è¡Œä¸ºï¼šè°ƒç”¨ è‡ªå®šä¹‰ çš„ commit é€»è¾‘ã€‚</p><p>äºŒé˜¶æ®µ rollback è¡Œä¸ºï¼šè°ƒç”¨ è‡ªå®šä¹‰ çš„ rollback é€»è¾‘ã€‚</p><p>æ‰€è°“ TCC æ¨¡å¼ï¼Œæ˜¯æŒ‡æ”¯æŒæŠŠ è‡ªå®šä¹‰ çš„åˆ†æ”¯äº‹åŠ¡çº³å…¥åˆ°å…¨å±€äº‹åŠ¡çš„ç®¡ç†ä¸­ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220228100848491.png" alt="image-20220228100848491"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+ æŸ”æ€§äº‹åŠ¡-TCCäº‹åŠ¡è¡¥å¿å‹æ–¹æ¡ˆ</span><br><span class="line">    + ä¸€é˜¶æ®µprepareâ€”â€”try</span><br><span class="line">    + äºŒé˜¶æ®µcommitâ€”â€”confirm</span><br><span class="line">    + äºŒé˜¶æ®µrollbackâ€”â€”cancel</span><br></pre></td></tr></table></figure><h4 id="æŸ”æ€§äº‹åŠ¡-æœ€å¤§åŠªåŠ›é€šçŸ¥å‹æ–¹æ¡ˆï¼ˆç»“åˆMQï¼‰"><a href="#æŸ”æ€§äº‹åŠ¡-æœ€å¤§åŠªåŠ›é€šçŸ¥å‹æ–¹æ¡ˆï¼ˆç»“åˆMQï¼‰" class="headerlink" title="æŸ”æ€§äº‹åŠ¡-æœ€å¤§åŠªåŠ›é€šçŸ¥å‹æ–¹æ¡ˆï¼ˆç»“åˆMQï¼‰"></a>æŸ”æ€§äº‹åŠ¡-æœ€å¤§åŠªåŠ›é€šçŸ¥å‹æ–¹æ¡ˆï¼ˆç»“åˆMQï¼‰</h4><p>æŒ‰è§„å¾‹è¿›è¡Œé€šçŸ¥ï¼Œ <strong>ä¸ä¿è¯æ•°æ®ä¸€å®šèƒ½é€šçŸ¥æˆåŠŸï¼Œä½†ä¼šæä¾›å¯æŸ¥è¯¢æ“ä½œæ¥å£è¿›è¡Œæ ¸å¯¹</strong>ã€‚è¿™ç§æ–¹æ¡ˆä¸»è¦ç”¨åœ¨ä¸ç¬¬ä¸‰æ–¹ç³»ç»Ÿé€šè®¯æ—¶ï¼Œæ¯”å¦‚ï¼šè°ƒç”¨å¾®ä¿¡æˆ–æ”¯ä»˜å®æ”¯ä»˜åçš„æ”¯ä»˜ç»“æœé€šçŸ¥ã€‚è¿™ç§æ–¹æ¡ˆä¹Ÿæ˜¯ç»“åˆ MQ è¿›è¡Œå®ç°ï¼Œä¾‹å¦‚ï¼šé€šè¿‡ MQ å‘é€ http è¯·æ±‚ï¼Œè®¾ç½®æœ€å¤§é€šçŸ¥æ¬¡æ•°ã€‚è¾¾åˆ°é€šçŸ¥æ¬¡æ•°åå³ä¸å†é€šçŸ¥ã€‚</p><p>æ¡ˆä¾‹ï¼šé“¶è¡Œé€šçŸ¥ã€å•†æˆ·é€šçŸ¥ç­‰ï¼ˆå„å¤§äº¤æ˜“ä¸šåŠ¡å¹³å°é—´çš„å•†æˆ·é€šçŸ¥ï¼šå¤šæ¬¡é€šçŸ¥ã€æŸ¥è¯¢æ ¡å¯¹ã€å¯¹è´¦æ–‡ä»¶ï¼‰ï¼Œæ”¯ä»˜å®çš„æ”¯ä»˜æˆåŠŸå¼‚æ­¥å›è°ƒã€‚</p><h4 id="æŸ”æ€§äº‹åŠ¡-å¯é æ¶ˆæ¯-æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆï¼ˆå¼‚æ­¥ç¡®ä¿å‹ï¼‰"><a href="#æŸ”æ€§äº‹åŠ¡-å¯é æ¶ˆæ¯-æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆï¼ˆå¼‚æ­¥ç¡®ä¿å‹ï¼‰" class="headerlink" title="æŸ”æ€§äº‹åŠ¡-å¯é æ¶ˆæ¯ + æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆï¼ˆå¼‚æ­¥ç¡®ä¿å‹ï¼‰"></a>æŸ”æ€§äº‹åŠ¡-å¯é æ¶ˆæ¯ + æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆï¼ˆå¼‚æ­¥ç¡®ä¿å‹ï¼‰</h4><p>å®ç°ï¼šä¸šåŠ¡å¤„ç†æœåŠ¡åœ¨ä¸šåŠ¡äº‹åŠ¡æäº¤ä¹‹å‰ï¼Œå‘å®æ—¶æ¶ˆæ¯æœåŠ¡è¯·æ±‚å‘é€æ¶ˆæ¯ï¼Œå®æ—¶æ¶ˆæ¯æœåŠ¡åªè®°å½•æ¶ˆæ¯æ•°æ®ï¼Œè€Œä¸æ˜¯çœŸæ­£çš„å‘é€ã€‚ä¸šåŠ¡å¤„ç†æœåŠ¡åœ¨ä¸šåŠ¡äº‹åŠ¡æäº¤ä¹‹åï¼Œå‘å®æ—¶æ¶ˆæ¯æœåŠ¡ç¡®è®¤å‘é€ã€‚åªæœ‰åœ¨å¾—åˆ°ç¡®è®¤å‘é€æŒ‡ä»¤åï¼Œå®æ—¶æ¶ˆæ¯æœåŠ¡æ‰ä¼šçœŸæ­£å‘é€ã€‚</p><p>é˜²æ­¢æ¶ˆæ¯ä¸¢å¤±ï¼š</p><ol><li>åšå¥½æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼ˆ pulisher ï¼Œ consumer ã€æ‰‹åŠ¨ ack ã€‘ï¼‰</li><li>æ¯ä¸€ä¸ªå‘é€çš„æ¶ˆæ¯éƒ½åœ¨æ•°æ®åº“åšå¥½è®°å½•ã€‚å®šæœŸå°†å¤±è´¥çš„æ¶ˆæ¯å†æ¬¡å‘é€ä¸€é.</li></ol><h3 id="Seataåˆ†å¸ƒå¼äº‹åŠ¡"><a href="#Seataåˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="Seataåˆ†å¸ƒå¼äº‹åŠ¡"></a>Seataåˆ†å¸ƒå¼äº‹åŠ¡</h3><p>Seata æ˜¯ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œè‡´åŠ›äºæä¾›é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ã€‚Seata å°†ä¸ºç”¨æˆ·æä¾›äº† ATã€TCCã€SAGA å’Œ XA äº‹åŠ¡æ¨¡å¼ï¼Œä¸ºç”¨æˆ·æ‰“é€ ä¸€ç«™å¼çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/145942191-7a2d469f-94c8-4cd2-8c7e-46ad75683636.png" alt="image"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+ åˆ›å»ºUNDO_LOGè¡¨ï¼ˆæ¯ä¸€ä¸ªæ•°æ®åº“ï¼‰ï¼ˆATæ¨¡å¼ï¼šè‡ªåŠ¨æ¨¡å¼ï¼‰</span><br><span class="line">    + å›æ»šè¡¨</span><br><span class="line">    + è‡ªåŠ¨è¡¥å¿</span><br><span class="line">+ å®‰è£…äº‹åŠ¡åè°ƒå™¨ï¼šseata-server</span><br><span class="line">+ ä½¿ç”¨seata DataSourceProxyä»£ç†è‡ªå·±çš„æ•°æ®æº</span><br><span class="line">+ å…¨å±€äº‹åŠ¡æ³¨è§£</span><br><span class="line">    + GlobalTransactional</span><br></pre></td></tr></table></figure><p>é—®é¢˜ï¼šATæ¨¡å¼ååé‡ä½ï¼Œä¸æ”¯æŒé«˜å¹¶å‘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+ seataé»˜è®¤ATæ¨¡å¼</span><br><span class="line">    + ä¸ç”¨åšé«˜å¹¶å‘åœºæ™¯</span><br><span class="line">    + åå°ç®€å•åœºæ™¯ï¼Œä¸è¦æ±‚é«˜å¹¶å‘</span><br><span class="line">    + åŒ…å«å„ç§é”æœºåˆ¶</span><br></pre></td></tr></table></figure><p>é«˜å¹¶å‘åœºæ™¯ï¼šè€ƒè™‘åŸºäºæ¶ˆæ¯æœåŠ¡çš„æŸ”æ€§äº‹åŠ¡æ–¹æ¡ˆ</p><p>1ã€é”åº“å­˜æˆåŠŸæ•°æ®åº“ä¿å­˜é”åº“å­˜å·¥ä½œå•</p><p>2ã€å¼•å…¥å»¶è¿Ÿé˜Ÿåˆ—â€”â€”å®Œæˆåº“å­˜è‡ªåŠ¨è§£é”</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220228101557537.png" alt="image-20220228101557537"></p>]]></content>
    
    
    <summary type="html">äº§å“å¼€å‘</summary>
    
    
    
    <category term="äº§å“" scheme="https://fireonice.github.io/categories/%E4%BA%A7%E5%93%81/"/>
    
    
    <category term="äº§å“å¼€å‘" scheme="https://fireonice.github.io/tags/%E4%BA%A7%E5%93%81%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>è°·ç²’å•†åŸâ€”â€”sessionå…±äº«&amp;sso&amp;ThreadLocal</title>
    <link href="https://fireonice.github.io/2022/02/17/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-session%E5%85%B1%E4%BA%AB&amp;sso&amp;ThreadLocal/"/>
    <id>https://fireonice.github.io/2022/02/17/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-session%E5%85%B1%E4%BA%AB&amp;sso&amp;ThreadLocal/</id>
    <published>2022-02-17T15:58:23.470Z</published>
    <updated>2022-02-17T16:52:39.536Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1ã€MD5-amp-ç›å€¼-amp-BCrypt"><a href="#1ã€MD5-amp-ç›å€¼-amp-BCrypt" class="headerlink" title="1ã€MD5&amp;ç›å€¼&amp;BCrypt"></a>1ã€MD5&amp;ç›å€¼&amp;BCrypt</h1><p>MD5 ï¼ˆMessage Digest algorithm 5ï¼Œä¿¡æ¯æ‘˜è¦ç®—æ³•ï¼‰ </p><p>1ã€å‹ç¼©æ€§ï¼šä»»æ„é•¿åº¦çš„æ•°æ®ï¼Œç®—å‡ºçš„MD5å€¼é•¿åº¦éƒ½æ˜¯å›ºå®šçš„ã€‚ </p><p>2ã€å®¹æ˜“è®¡ç®—ï¼šä»åŸæ•°æ®è®¡ç®—å‡ºMD5å€¼å¾ˆå®¹æ˜“ã€‚ </p><p>3ã€æŠ—ä¿®æ”¹æ€§ï¼šå¯¹åŸæ•°æ®è¿›è¡Œä»»ä½•æ”¹åŠ¨ï¼Œå“ªæ€•åªä¿®æ”¹1ä¸ªå­—èŠ‚ï¼Œæ‰€å¾—åˆ°çš„MD5å€¼éƒ½æœ‰å¾ˆå¤§åŒºåˆ«ã€‚ </p><p>4ã€å¼ºæŠ—ç¢°æ’ï¼šæƒ³æ‰¾åˆ°ä¸¤ä¸ªä¸åŒçš„æ•°æ®ï¼Œä½¿å®ƒä»¬å…·æœ‰ç›¸åŒçš„MD5å€¼ï¼Œæ˜¯éå¸¸å›°éš¾çš„ã€‚ </p><p>5ã€ä¸å¯é€† </p><p>åŠ ç›ï¼š </p><p>1ã€é€šè¿‡ç”Ÿæˆéšæœºæ•°ä¸MD5ç”Ÿæˆå­—ç¬¦ä¸²è¿›è¡Œç»„åˆ </p><p>2ã€æ•°æ®åº“åŒæ—¶å­˜å‚¨MD5å€¼ä¸saltå€¼ã€‚éªŒè¯æ­£ç¡®æ€§æ—¶ä½¿ç”¨saltè¿›è¡ŒMD5</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+ Springçš„åŠ å¯†</span><br><span class="line">+ è‡ªåŠ¨åŠ ç›</span><br><span class="line">+ matchåŒ¹é…ï¼ˆä¸encodeåŒ¹é…ï¼‰</span><br></pre></td></tr></table></figure><h1 id="2ã€åˆ†å¸ƒå¼sessionå…±äº«"><a href="#2ã€åˆ†å¸ƒå¼sessionå…±äº«" class="headerlink" title="2ã€åˆ†å¸ƒå¼sessionå…±äº«"></a>2ã€åˆ†å¸ƒå¼sessionå…±äº«</h1><p>é—®é¢˜ï¼š</p><p>ä¸åŒæœåŠ¡sessionä¸å…±äº«</p><p>åŒä¸€æœåŠ¡sessionä¸åŒæ­¥</p><h2 id="sessionåŸç†"><a href="#sessionåŸç†" class="headerlink" title="sessionåŸç†"></a>sessionåŸç†</h2><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220218001900202.png" alt="image-20220218001900202"></p><h2 id="åˆ†å¸ƒå¼sessionè§£å†³æ–¹æ¡ˆ"><a href="#åˆ†å¸ƒå¼sessionè§£å†³æ–¹æ¡ˆ" class="headerlink" title="åˆ†å¸ƒå¼sessionè§£å†³æ–¹æ¡ˆ"></a>åˆ†å¸ƒå¼sessionè§£å†³æ–¹æ¡ˆ</h2><h3 id="1ã€sessionå¤åˆ¶"><a href="#1ã€sessionå¤åˆ¶" class="headerlink" title="1ã€sessionå¤åˆ¶"></a>1ã€sessionå¤åˆ¶</h3><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220218002213539.png" alt="image-20220218002213539"></p><p>Sessionå¤åˆ¶ï¼ˆtomcatä¹‹é—´åŒæ­¥ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+ ä¼˜ç‚¹ï¼š</span><br><span class="line">    + web-serverï¼ˆTomcatï¼‰åŸç”Ÿæ”¯æŒï¼Œåªéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ </span><br><span class="line">+ ç¼ºç‚¹ï¼š</span><br><span class="line">+ sessionåŒæ­¥éœ€è¦æ•°æ®ä¼ è¾“ï¼Œå ç”¨å¤§é‡ç½‘ç»œå¸¦å®½ï¼Œé™ä½äº†æœåŠ¡å™¨ç¾¤çš„ä¸šåŠ¡å¤„ç†èƒ½åŠ› </span><br><span class="line">    + ä»»æ„ä¸€å°web-serverä¿å­˜çš„æ•°æ®éƒ½æ˜¯æ‰€æœ‰web-serverçš„sessionæ€»å’Œï¼Œå—åˆ°å†…å­˜é™åˆ¶æ— æ³•æ°´å¹³æ‰©å±•æ›´å¤šçš„web-server </span><br><span class="line">    + å¤§å‹åˆ†å¸ƒå¼é›†ç¾¤æƒ…å†µä¸‹ï¼Œç”±äºæ‰€æœ‰web-serveréƒ½å…¨é‡ä¿å­˜æ•°æ®ï¼Œæ‰€ä»¥æ­¤æ–¹æ¡ˆä¸å¯å–ã€‚</span><br></pre></td></tr></table></figure><h3 id="2ã€å®¢æˆ·ç«¯å­˜å‚¨"><a href="#2ã€å®¢æˆ·ç«¯å­˜å‚¨" class="headerlink" title="2ã€å®¢æˆ·ç«¯å­˜å‚¨"></a>2ã€å®¢æˆ·ç«¯å­˜å‚¨</h3><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220218002226115.png" alt="image-20220218002226115"></p><p>æ”¾åˆ°cookieä¸­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ ä¼˜ç‚¹</span><br><span class="line">+ æœåŠ¡å™¨ä¸éœ€å­˜å‚¨sessionï¼Œç”¨æˆ·ä¿å­˜è‡ªå·±çš„sessionä¿¡æ¯åˆ°cookieä¸­ã€‚</span><br><span class="line">+ èŠ‚çœæœåŠ¡ç«¯èµ„æº</span><br><span class="line">+ ç¼ºç‚¹</span><br><span class="line">    + éƒ½æ˜¯ç¼ºç‚¹ï¼Œè¿™åªæ˜¯ä¸€ç§æ€è·¯ã€‚</span><br><span class="line">    + æ¯æ¬¡httpè¯·æ±‚ï¼Œæºå¸¦ç”¨æˆ·åœ¨cookieä¸­çš„å®Œæ•´ä¿¡æ¯ï¼Œæµªè´¹ç½‘ç»œå¸¦å®½</span><br><span class="line">    + sessionæ•°æ®æ”¾åœ¨cookieä¸­ï¼Œcookieæœ‰é•¿åº¦é™åˆ¶4Kï¼Œä¸èƒ½ä¿å­˜å¤§é‡ä¿¡æ¯</span><br><span class="line">    + sessionæ•°æ®æ”¾åœ¨cookieä¸­ï¼Œå­˜åœ¨æ³„æ¼ã€ç¯¡æ”¹ã€çªƒå–ç­‰å®‰å…¨éšæ‚£</span><br></pre></td></tr></table></figure><h3 id="3ã€hashä¸€è‡´æ€§"><a href="#3ã€hashä¸€è‡´æ€§" class="headerlink" title="3ã€hashä¸€è‡´æ€§"></a>3ã€hashä¸€è‡´æ€§</h3><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220218002507539.png" alt="image-20220218002507539"></p><p>Hashä¸€è‡´æ€§ï¼ˆä¿®æ”¹è´Ÿè½½å‡è¡¡ï¼‰</p><p>+ æœåŠ¡å™¨é—ªæ–­ä¼šä¸¢å¤±</p><p>+ æœåŠ¡å™¨æ•°é‡å˜åŒ–é‡æ–°hashï¼Œéƒ¨åˆ†ä¼šä¸¢å¤±</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+ ä¼˜ç‚¹ï¼š</span><br><span class="line">    + åªéœ€è¦æ”¹nginxé…ç½®ï¼Œä¸éœ€è¦ä¿®æ”¹åº”ç”¨ä»£ç  è´Ÿè½½å‡è¡¡ï¼Œåªè¦hashå±æ€§çš„å€¼åˆ†å¸ƒæ˜¯å‡åŒ€çš„ï¼Œå¤šå°web-serverçš„è´Ÿè½½æ˜¯å‡è¡¡çš„ </span><br><span class="line">    + å¯ä»¥æ”¯æŒweb-serveræ°´å¹³æ‰©å±•ï¼ˆsessionåŒæ­¥æ³•æ˜¯ä¸è¡Œçš„ï¼Œå—å†…å­˜é™åˆ¶ï¼‰ </span><br><span class="line">ç¼ºç‚¹</span><br><span class="line">    + sessionè¿˜æ˜¯å­˜åœ¨web-serverä¸­çš„ï¼Œæ‰€ä»¥web-serveré‡ </span><br><span class="line">    å¯å¯èƒ½å¯¼è‡´éƒ¨åˆ†sessionä¸¢å¤±ï¼Œå½±å“ä¸šåŠ¡ï¼Œå¦‚éƒ¨åˆ†ç”¨æˆ· </span><br><span class="line">    éœ€è¦é‡æ–°ç™»å½• </span><br><span class="line">    + å¦‚æœweb-serveræ°´å¹³æ‰©å±•ï¼Œrehashåsessioné‡æ–°åˆ†å¸ƒï¼Œ </span><br><span class="line">    ä¹Ÿä¼šæœ‰ä¸€éƒ¨åˆ†ç”¨æˆ·è·¯ç”±ä¸åˆ°æ­£ç¡®çš„session </span><br><span class="line">+ ä½†æ˜¯ä»¥ä¸Šç¼ºç‚¹é—®é¢˜ä¹Ÿä¸æ˜¯å¾ˆå¤§ï¼Œå› ä¸ºsessionæœ¬æ¥éƒ½æ˜¯æœ‰æœ‰ </span><br></pre></td></tr></table></figure><h3 id="4ã€ç»Ÿä¸€å­˜å‚¨"><a href="#4ã€ç»Ÿä¸€å­˜å‚¨" class="headerlink" title="4ã€ç»Ÿä¸€å­˜å‚¨"></a>4ã€ç»Ÿä¸€å­˜å‚¨</h3><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220218002612719.png" alt="image-20220218002612719"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+ ä¼˜ç‚¹ï¼š</span><br><span class="line">    + æ²¡æœ‰å®‰å…¨éšæ‚£</span><br><span class="line">    + å¯ä»¥æ°´å¹³æ‰©å±•ï¼Œæ•°æ®åº“/ç¼“å­˜æ°´å¹³åˆ‡åˆ†å³å¯</span><br><span class="line">    + web-serveré‡å¯æˆ–è€…æ‰©å®¹éƒ½ä¸ä¼šæœ‰ sessionä¸¢å¤±</span><br><span class="line">+ ä¸è¶³</span><br><span class="line">    + å¢åŠ äº†ä¸€æ¬¡ç½‘ç»œè°ƒç”¨ï¼Œå¹¶ä¸”éœ€è¦ä¿®æ”¹åº” ç”¨ä»£ç ï¼›å¦‚å°†æ‰€æœ‰çš„getSessionæ–¹æ³•æ›¿æ¢ä¸ºä»RedisæŸ¥æ•°æ®çš„æ–¹å¼ã€‚redisè·å–æ•° æ®æ¯”å†…å­˜æ…¢å¾ˆå¤š</span><br><span class="line">    + ä¸Šé¢ç¼ºç‚¹å¯ä»¥ç”¨SpringSessionå®Œç¾è§£å†³</span><br></pre></td></tr></table></figure><h3 id="5ã€æ‰©å¤§cookieä½œç”¨åŸŸ"><a href="#5ã€æ‰©å¤§cookieä½œç”¨åŸŸ" class="headerlink" title="5ã€æ‰©å¤§cookieä½œç”¨åŸŸ"></a>5ã€æ‰©å¤§cookieä½œç”¨åŸŸ</h3><p>è§£å†³å­åŸŸå…±äº«é—®é¢˜</p><p>é—®é¢˜ï¼šå¤šåŸŸå</p><h2 id="SpringSession"><a href="#SpringSession" class="headerlink" title="SpringSession"></a>SpringSession</h2><p>é…ç½®ç±»ï¼šjsonç¼–ç ã€cookiå­åŸŸé—®é¢˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GulimallSessionConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CookieSerializer <span class="title">cookieSerializer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DefaultCookieSerializer cookieSerializer = <span class="keyword">new</span> DefaultCookieSerializer();</span><br><span class="line">        <span class="comment">//æ”¾å¤§ä½œç”¨åŸŸ</span></span><br><span class="line">        cookieSerializer.setDomainName(<span class="string">&quot;gulimall.com&quot;</span>);</span><br><span class="line">        cookieSerializer.setCookieName(<span class="string">&quot;GULISESSION&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> cookieSerializer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisSerializer&lt;Object&gt; <span class="title">springSessionDefaultRedisSerializer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> GenericJackson2JsonRedisSerializer();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŸç†ï¼šè£…é¥°è€…æ¨¡å¼"><a href="#åŸç†ï¼šè£…é¥°è€…æ¨¡å¼" class="headerlink" title="åŸç†ï¼šè£…é¥°è€…æ¨¡å¼"></a>åŸç†ï¼šè£…é¥°è€…æ¨¡å¼</h3><p>ç‹¸çŒ«æ¢å¤ªå­</p><p>@EnableRedisHttpSession å¯¼å…¥ RedisHttpSessionConfiguration é…ç½®</p><p>1ã€ç»™å®¹å™¨ä¸­æ·»åŠ äº†ä¸€ä¸ªç»„ä»¶ RedisOperationsSessionRepositoryï¼šRedisæ“ä½œsessionï¼Œsessionçš„å¢åˆ æ”¹æŸ¥å°è£…ç±»ï¼›</p><p>2ã€ç»§æ‰¿ SpringHttpSessionConfiguration åˆå§‹åŒ–äº†ä¸€ä¸ª SessionRepositoryFilterï¼šsession å­˜å‚¨è¿‡æ»¤å™¨ï¼›æ¯ä¸ªè¯·æ±‚è¿‡æ¥éƒ½å¿…é¡»ç»è¿‡ Filter ç»„ä»¶ï¼›åˆ›å»ºçš„æ—¶å€™ï¼Œè‡ªåŠ¨ä»å®¹å™¨ä¸­è·å–åˆ°äº† SessionRepositoryï¼›</p><p> SessionRepositoryFilterï¼š</p><ul><li>å°†åŸç”Ÿçš„ HttpServletRequest Response åŒ…è£…æˆ SessionRepositoryRequestWrapper ResponseWrapperï¼›åŒ…è£…åçš„å¯¹è±¡åº”ç”¨åˆ°äº†åé¢æ•´ä¸ªæ‰§è¡Œé“¾ï¼›</li><li>ä»¥åè·å– request.getSession(); éƒ½ä¼šè°ƒç”¨ wrappedRequesr.getSession(); ä»SessionRepositoryè·å–ï¼›</li></ul><p>3ã€è£…é¥°è€…æ¨¡å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    request.setAttribute(SESSION_REPOSITORY_ATTR, <span class="keyword">this</span>.sessionRepository);</span><br><span class="line">    SessionRepositoryFilter&lt;S&gt;.SessionRepositoryRequestWrapper wrappedRequest = <span class="keyword">new</span> SessionRepositoryFilter.SessionRepositoryRequestWrapper(request, response);</span><br><span class="line">    SessionRepositoryFilter.SessionRepositoryResponseWrapper wrappedResponse = <span class="keyword">new</span> SessionRepositoryFilter.SessionRepositoryResponseWrapper(wrappedRequest, response);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        filterChain.doFilter(wrappedRequest, wrappedResponse);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        wrappedRequest.commitSession();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="3ã€ssoå•ç‚¹ç™»å½•"><a href="#3ã€ssoå•ç‚¹ç™»å½•" class="headerlink" title="3ã€ssoå•ç‚¹ç™»å½•"></a>3ã€ssoå•ç‚¹ç™»å½•</h1><p>è·¨åŸŸåå•ç‚¹ç™»å½•ç®€å•å®ç°ï¼š</p><p>1ã€æœåŠ¡ç«¯ï¼šæœªç™»å½•è·³è½¬è®¤è¯ä¸­å¿ƒï¼ˆé™„å¸¦å‚æ•°ä¿å­˜åŸåœ°å€ï¼‰</p><p>2ã€è®¤è¯ä¸­å¿ƒï¼šç™»å½•æˆåŠŸæœ¬åœ°ä¿å­˜cookieï¼ˆsso_tokenï¼‰</p><p>3ã€è®¤è¯ä¸­å¿ƒï¼šä¿å­˜ç™»å½•ç”¨æˆ·ç™»å½•çŠ¶æ€åˆ°redisä¸­</p><p>4ã€è®¤è¯ä¸­å¿ƒï¼šé‡å®šå‘urlä¸­é™„å¸¦tokenè·³è½¬å›åŸé¡µé¢</p><p>5ã€æœåŠ¡ç«¯ï¼šæ ¹æ®tokenæŸ¥è¯¢redisè·å–ç”¨æˆ·ä¿¡æ¯ä¿å­˜session</p><p>6ã€å…¶ä»–æœåŠ¡ç«¯ï¼šæœªç™»å½•è·³è½¬åˆ°è®¤è¯ä¸­å¿ƒï¼Œç›´æ¥ç™»å½•æˆåŠŸè¿”å›</p><p>æœåŠ¡ç«¯ï¼šæ ¹æ®æœ‰æ— sessionåˆ¤æ–­æ˜¯å¦ç™»å½•</p><p>è®¤è¯ä¸­å¿ƒï¼šæ ¹æ®æœ‰æ— sso_tokenåˆ¤æ–­æ˜¯å¦ç™»å½•</p><p>å¯å®ç°ï¼šfilterã€jwtã€springsecurity</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E6%B5%81%E7%A8%8B.png" alt="å•ç‚¹ç™»å½•æµç¨‹"></p><h1 id="4ã€ThreadLocalåŒä¸€ä¸ªçº¿ç¨‹å…±äº«æ•°æ®"><a href="#4ã€ThreadLocalåŒä¸€ä¸ªçº¿ç¨‹å…±äº«æ•°æ®" class="headerlink" title="4ã€ThreadLocalåŒä¸€ä¸ªçº¿ç¨‹å…±äº«æ•°æ®"></a>4ã€ThreadLocalåŒä¸€ä¸ªçº¿ç¨‹å…±äº«æ•°æ®</h1><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220218004911488.png" alt="image-20220218004911488"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ThreadLocal&lt;UserInfoTo&gt; toThreadLocal = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// èµ‹å€¼</span></span><br><span class="line">toThreadLocal.set(userInfoTo);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å–å€¼</span></span><br><span class="line">UserInfoTo userInfoTo = CartInterceptor.toThreadLocal.get();</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">äº§å“å¼€å‘</summary>
    
    
    
    <category term="äº§å“" scheme="https://fireonice.github.io/categories/%E4%BA%A7%E5%93%81/"/>
    
    
    <category term="äº§å“å¼€å‘" scheme="https://fireonice.github.io/tags/%E4%BA%A7%E5%93%81%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>è°·ç²’å•†åŸâ€”â€”ç¼“å­˜&amp;åˆ†å¸ƒå¼é”&amp;æ£€ç´¢&amp;å¼‚æ­¥&amp;çº¿ç¨‹æ± </title>
    <link href="https://fireonice.github.io/2022/02/16/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-%E7%BC%93%E5%AD%98&amp;%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81&amp;%E6%A3%80%E7%B4%A2&amp;%E5%BC%82%E6%AD%A5/"/>
    <id>https://fireonice.github.io/2022/02/16/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-%E7%BC%93%E5%AD%98&amp;%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81&amp;%E6%A3%80%E7%B4%A2&amp;%E5%BC%82%E6%AD%A5/</id>
    <published>2022-02-16T15:38:58.639Z</published>
    <updated>2022-02-16T17:12:51.040Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1ã€ç¼“å­˜"><a href="#1ã€ç¼“å­˜" class="headerlink" title="1ã€ç¼“å­˜"></a>1ã€ç¼“å­˜</h1><h2 id=""><a href="#" class="headerlink" title=""></a><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220216234206407.png" alt="image-20220216234206407"></h2><h2 id="ç¼“å­˜å¤±æ•ˆé—®é¢˜"><a href="#ç¼“å­˜å¤±æ•ˆé—®é¢˜" class="headerlink" title="ç¼“å­˜å¤±æ•ˆé—®é¢˜"></a>ç¼“å­˜å¤±æ•ˆé—®é¢˜</h2><p>1ã€ç¼“å­˜ç©¿é€ï¼š</p><p>ä¸å­˜åœ¨æ•°æ®</p><p>ç¼“å­˜nullã€è®¾ç½®çŸ­çš„è¿‡æœŸæ—¶é—´</p><p>2ã€ç¼“å­˜é›ªå´©ï¼š</p><p>å¤§é¢ç§¯åŒæ—¶å¤±æ•ˆ</p><p>å¤±æ•ˆåŠ éšæœºå€¼</p><p>3ã€ç¼“å­˜å‡»ç©¿</p><p>çƒ­ç‚¹keyå¤±æ•ˆ</p><p>åŠ é”</p><h2 id="ç¼“å­˜æ•°æ®ä¸€è‡´æ€§è§£å†³"><a href="#ç¼“å­˜æ•°æ®ä¸€è‡´æ€§è§£å†³" class="headerlink" title="ç¼“å­˜æ•°æ®ä¸€è‡´æ€§è§£å†³"></a>ç¼“å­˜æ•°æ®ä¸€è‡´æ€§è§£å†³</h2><p>åŒå†™æ¨¡å¼ï¼š</p><p>+ æ”¹å®Œæ•°æ®åº“åŒæ—¶æ”¹ç¼“å­˜</p><p>+ è„æ•°æ®</p><p>â€‹    + åŠ é”</p><p>â€‹    + æ˜¯å¦å…è®¸æš‚æ—¶ä¸ä¸€è‡´æ€§â€”â€”ç¼“å­˜è¿‡æœŸåå¯è¯»æ­£ç¡®æ•°æ®</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220216234700247.png" alt="image-20220216234700247"></p><p>å¤±æ•ˆæ¨¡å¼</p><p>+ åˆ é™¤ç¼“å­˜æ•°æ®</p><p>+ ç­‰å¾…ä¸‹æ¬¡æŸ¥è¯¢ä¸»åŠ¨æ›´æ–°</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220217003139062.png" alt="image-20220217003139062"></p><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220217003318428.png" alt="image-20220217003318428"></p><p>+ å¹¶å‘é‡å°ä¸è€ƒè™‘</p><p>+ èœå•ç­‰ï¼Œç”¨canal</p><p>â€‹    + è‡ªåŠ¨æ›´æ–°ç¼“å­˜ï¼ˆdbä»åº“ï¼‰</p><p>â€‹    + æ•°æ®å¼‚æ„ï¼ˆè®¿é—®è®°å½•è¡¨ å’Œ å•†å“ è¿›è¡Œåˆ†æè®¡ç®—â€”â€”ç”¨æˆ·æ¨èï¼‰</p><p>+ è¿‡æœŸæ—¶é—´ä¿è¯ æœ€ç»ˆä¸€è‡´æ€§</p><p>+ åŠ è¯»å†™é”</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220217003503499.png" alt="image-20220217003503499"></p><p>æˆ‘ä»¬ç³»ç»Ÿçš„ä¸€è‡´æ€§<strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š </p><p>1ã€ç¼“å­˜çš„æ‰€æœ‰æ•°æ®éƒ½æœ‰è¿‡æœŸæ—¶é—´ï¼Œæ•°æ®è¿‡æœŸä¸‹ä¸€æ¬¡æŸ¥è¯¢è§¦å‘ä¸»åŠ¨æ›´æ–° </p><p>2ã€è¯»å†™æ•°æ®çš„æ—¶å€™ï¼ŒåŠ ä¸Šåˆ†å¸ƒå¼çš„<strong>è¯»å†™é”</strong>ã€‚ ï¼ˆç»å¸¸å†™ï¼Œç»å¸¸è¯»ï¼‰</p><h2 id="Spring-Cache"><a href="#Spring-Cache" class="headerlink" title="Spring Cache"></a>Spring Cache</h2><p>ä½¿ç”¨å¤§é‡aopåˆ‡é¢ç¼–ç¨‹ï¼Œæœ€ç»ˆéƒ½æ˜¯åŠ¨æ€ä»£ç†æœºåˆ¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+ @Cacheableï¼šç»“æœç¼“å­˜</span><br><span class="line">+ keyã€value</span><br><span class="line">+ ttl</span><br><span class="line">+ åºåˆ—åŒ–ï¼šjson</span><br><span class="line">+ @CacheEvictï¼šåˆ é™¤ç¼“å­˜</span><br><span class="line">+ @CachePutï¼šè°ƒç”¨æ–¹æ³•ä¸”ç¼“å­˜</span><br><span class="line">+ åŒå†™æ¨¡å¼</span><br><span class="line">+ @Cachingï¼šå¤šä¸ªæ“ä½œ</span><br><span class="line">+ å¼€å¯ç¼“å­˜ç©ºå€¼</span><br><span class="line">+ é˜²æ­¢ç¼“å­˜ç©¿é€</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ è¯»æ¨¡å¼</span><br><span class="line">+ ç¼“å­˜ç©¿é€ï¼šç¼“å­˜null</span><br><span class="line">+ ç¼“å­˜å‡»ç©¿ï¼šåŠ é”</span><br><span class="line">+ ç¼“å­˜é›ªå´©ï¼šè¿‡æœŸæ—¶é—´åŠ éšæœº</span><br><span class="line">+ å†™æ¨¡å¼ï¼ˆç¼“å­˜ä¸æ•°æ®åº“ä¸€è‡´ï¼‰</span><br><span class="line">+ è¯»å†™åŠ é”</span><br><span class="line">+ canalæ„ŸçŸ¥æ•°æ®åº“</span><br><span class="line">+ è¯»å¤šå†™å¤šï¼Œç›´æ¥å»æ•°æ®åº“</span><br></pre></td></tr></table></figure><h1 id="2ã€åˆ†å¸ƒå¼é”"><a href="#2ã€åˆ†å¸ƒå¼é”" class="headerlink" title="2ã€åˆ†å¸ƒå¼é”"></a>2ã€åˆ†å¸ƒå¼é”</h1><h3 id="é˜¶æ®µä¸€"><a href="#é˜¶æ®µä¸€" class="headerlink" title="é˜¶æ®µä¸€"></a>é˜¶æ®µä¸€</h3><p>redis setnx</p><p>é—®é¢˜ï¼šå¼‚å¸¸é€€å‡ºæ­»é”</p><h3 id="é˜¶æ®µäºŒ"><a href="#é˜¶æ®µäºŒ" class="headerlink" title="é˜¶æ®µäºŒ"></a>é˜¶æ®µäºŒ</h3><p>åŒæ—¶åŸå­è®¾ç½®è¿‡æœŸæ—¶é—´</p><p>é—®é¢˜ï¼šé”è¿‡æœŸï¼Œåˆ é”™é”</p><h3 id="é˜¶æ®µä¸‰"><a href="#é˜¶æ®µä¸‰" class="headerlink" title="é˜¶æ®µä¸‰"></a>é˜¶æ®µä¸‰</h3><p>å”¯ä¸€æ ‡è¯†valueéªŒè¯</p><p>é—®é¢˜ï¼šè·å–valueå’Œåˆ é™¤keyéåŸå­ï¼Œä»å­˜åœ¨åˆ é”™é”</p><h3 id="é˜¶æ®µå››"><a href="#é˜¶æ®µå››" class="headerlink" title="é˜¶æ®µå››"></a>é˜¶æ®µå››</h3><p>luaè„šæœ¬ï¼Œè§£é”ä¿è¯åŸå­æ€§</p><p>é—®é¢˜ï¼šæœªæ‰§è¡Œå®Œé”è¿‡æœŸï¼Œç»­æœŸé—®é¢˜</p><h3 id="é˜¶æ®µäº”"><a href="#é˜¶æ®µäº”" class="headerlink" title="é˜¶æ®µäº”"></a>é˜¶æ®µäº”</h3><p>é”æ—¶é—´æ”¾é•¿ï¼Œfinallyè§£é”</p><h2 id="Redisson"><a href="#Redisson" class="headerlink" title="Redisson"></a>Redisson</h2><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220217001540526.png" alt="image-20220217001540526"></p><p>ä½¿å¾—åŸæœ¬ä½œä¸ºåè°ƒå•æœºå¤šçº¿ç¨‹å¹¶å‘ç¨‹åºçš„å·¥å…·åŒ…è·å¾—äº†åè°ƒåˆ†å¸ƒå¼å¤šæœºå¤šçº¿ç¨‹å¹¶å‘ç³»ç»Ÿçš„èƒ½åŠ›ï¼Œæ›´è¿›ä¸€æ­¥ç®€åŒ–äº†åˆ†å¸ƒå¼ç¯å¢ƒä¸­ç¨‹åºç›¸äº’ä¹‹é—´çš„åä½œã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+locké”</span><br><span class="line">+è‡ªåŠ¨ç»­æœŸ</span><br><span class="line">+çœ‹é—¨ç‹—ï¼šåˆ¤æ–­çº¿ç¨‹ + å®šæ—¶ä»»åŠ¡ï¼ˆé‡è®¾è¿‡æœŸæ—¶é—´ï¼‰</span><br><span class="line">+ trylockï¼ˆè·å–ä¸€æ¬¡ï¼‰</span><br><span class="line">+ fair lockå…¬å¹³é”ï¼ˆé˜Ÿåˆ—ï¼‰</span><br><span class="line">+ readwritelockè¯»å†™é”</span><br><span class="line">    + å†™é”é™åˆ¶è¯»å’Œå†™æ“ä½œï¼ˆä¿è¯è¯»æ•°æ®ä¸€è‡´æ€§ï¼‰</span><br><span class="line">    + è¯»é”å•ç‹¬æ— é™åˆ¶ï¼ˆæ— é”ï¼‰</span><br><span class="line">    + åªè¦æœ‰å†™æ“ä½œï¼Œå°±éœ€è¦ç­‰å¾…ï¼ˆè¯»å†™ï¼Œå†™è¯»ï¼‰</span><br><span class="line">+ ä¿¡å·é‡ï¼ˆå›ºå®šè½¦ä½ï¼‰</span><br><span class="line">+ åˆ†å¸ƒå¼é™æµ</span><br><span class="line">+ acquireï¼ˆé˜»å¡ï¼‰ã€Tryacquire</span><br><span class="line">+ é—­é”ï¼ˆèµ°å®Œå…³é—¨ï¼‰</span><br></pre></td></tr></table></figure><p>çœ‹é—¨ç‹—åŸç†</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/816762-20210425105548419-1714180337.jpg" alt="img"></p><h1 id="3ã€æ£€ç´¢"><a href="#3ã€æ£€ç´¢" class="headerlink" title="3ã€æ£€ç´¢"></a>3ã€æ£€ç´¢</h1><p>voå°è£…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SearchResult</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢åˆ°çš„æ‰€æœ‰å•†å“ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;SkuEsModel&gt; product;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½“å‰é¡µç </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer pageNum;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ€»è®°å½•æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long total;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ€»é¡µç </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer totalPages;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Integer&gt; pageNavs;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½“å‰æŸ¥è¯¢åˆ°çš„ç»“æœï¼Œæ‰€æœ‰æ¶‰åŠåˆ°çš„å“ç‰Œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;BrandVo&gt; brands;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½“å‰æŸ¥è¯¢åˆ°çš„ç»“æœï¼Œæ‰€æœ‰æ¶‰åŠåˆ°çš„æ‰€æœ‰å±æ€§</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;AttrVo&gt; attrs;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½“å‰æŸ¥è¯¢åˆ°çš„ç»“æœï¼Œæ‰€æœ‰æ¶‰åŠåˆ°çš„æ‰€æœ‰åˆ†ç±»</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;CatalogVo&gt; catalogs;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//===========================ä»¥ä¸Šæ˜¯è¿”å›ç»™é¡µé¢çš„æ‰€æœ‰ä¿¡æ¯============================//</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* é¢åŒ…å±‘å¯¼èˆªæ•°æ® */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;NavVo&gt; navs;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">NavVo</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String navName;</span><br><span class="line">        <span class="keyword">private</span> String navValue;</span><br><span class="line">        <span class="keyword">private</span> String link;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">BrandVo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Long brandId;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> String brandName;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> String brandImg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrVo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Long attrId;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> String attrName;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> List&lt;String&gt; attrValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CatalogVo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Long catalogId;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> String catalogName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>DSL</p><p>æ¨¡ç³ŠåŒ¹é…ã€è¿‡æ»¤ï¼ˆå±æ€§ã€åˆ†ç±»ã€å“ç‰Œã€ä»·æ ¼åŒºé—´ã€åº“å­˜ï¼‰</p><p>æ’åºã€åˆ†é¡µã€é«˜äº®ã€èšåˆåˆ†æ</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">GET mall_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;bool&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;must&quot;</span>: [ &#123;<span class="attr">&quot;match&quot;</span>: &#123;  <span class="attr">&quot;skuTitle&quot;</span>: <span class="string">&quot;åä¸º&quot;</span> &#125;&#125; ], # æ£€ç´¢å‡ºåä¸º</span><br><span class="line">      <span class="attr">&quot;filter&quot;</span>: [ # è¿‡æ»¤</span><br><span class="line">        &#123; <span class="attr">&quot;term&quot;</span>: &#123; <span class="attr">&quot;catalogId&quot;</span>: <span class="string">&quot;225&quot;</span> &#125; &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;terms&quot;</span>: &#123;<span class="attr">&quot;brandId&quot;</span>: [ <span class="string">&quot;2&quot;</span>] &#125; &#125;, </span><br><span class="line">        &#123; <span class="attr">&quot;term&quot;</span>: &#123; <span class="attr">&quot;hasStock&quot;</span>: <span class="string">&quot;false&quot;</span>&#125; &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;range&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;skuPrice&quot;</span>: &#123; # ä»·æ ¼1K~7K</span><br><span class="line">              <span class="attr">&quot;gte&quot;</span>: <span class="number">1000</span>,</span><br><span class="line">              <span class="attr">&quot;lte&quot;</span>: <span class="number">7000</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;nested&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;attrs&quot;</span>, # èšåˆåå­—</span><br><span class="line">            <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">              <span class="attr">&quot;bool&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;must&quot;</span>: [</span><br><span class="line">                  &#123;</span><br><span class="line">                    <span class="attr">&quot;term&quot;</span>: &#123; <span class="attr">&quot;attrs.attrId&quot;</span>: &#123; <span class="attr">&quot;value&quot;</span>: <span class="string">&quot;6&quot;</span>&#125; &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">                ]</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;sort&quot;</span>: [ &#123;<span class="attr">&quot;skuPrice&quot;</span>: &#123;<span class="attr">&quot;order&quot;</span>: <span class="string">&quot;desc&quot;</span> &#125; &#125; ],</span><br><span class="line">  <span class="attr">&quot;from&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;size&quot;</span>: <span class="number">5</span>,</span><br><span class="line">  <span class="attr">&quot;highlight&quot;</span>: &#123;  </span><br><span class="line">    <span class="attr">&quot;fields&quot;</span>: &#123;<span class="attr">&quot;skuTitle&quot;</span>: &#123;&#125;&#125;, # é«˜äº®çš„å­—æ®µ</span><br><span class="line">    <span class="attr">&quot;pre_tags&quot;</span>: <span class="string">&quot;&lt;b style=&#x27;color:red&#x27;&gt;&quot;</span>,  # å‰ç¼€</span><br><span class="line">    <span class="attr">&quot;post_tags&quot;</span>: <span class="string">&quot;&lt;/b&gt;&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span>: &#123; # æŸ¥å®Œåèšåˆ</span><br><span class="line">    <span class="attr">&quot;brandAgg&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;terms&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;brandId&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;size&quot;</span>: <span class="number">10</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;aggs&quot;</span>: &#123; # å­èšåˆ</span><br><span class="line">        <span class="attr">&quot;brandNameAgg&quot;</span>: &#123;  # æ¯ä¸ªå•†å“idçš„å“ç‰Œ</span><br><span class="line">          <span class="attr">&quot;terms&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;brandName&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;size&quot;</span>: <span class="number">10</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      </span><br><span class="line">        <span class="attr">&quot;brandImgAgg&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;terms&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;brandImg&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;size&quot;</span>: <span class="number">10</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;catalogAgg&quot;</span>:&#123;</span><br><span class="line">      <span class="attr">&quot;terms&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;catalogId&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;size&quot;</span>: <span class="number">10</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;catalogNameAgg&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;terms&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;catalogName&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;size&quot;</span>: <span class="number">10</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;attrs&quot;</span>:&#123;</span><br><span class="line">      <span class="attr">&quot;nested&quot;</span>: &#123;<span class="attr">&quot;path&quot;</span>: <span class="string">&quot;attrs&quot;</span> &#125;,</span><br><span class="line">      <span class="attr">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;attrIdAgg&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;terms&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;attrs.attrId&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;size&quot;</span>: <span class="number">10</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;attrNameAgg&quot;</span>: &#123;</span><br><span class="line">              <span class="attr">&quot;terms&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;attrs.attrName&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;size&quot;</span>: <span class="number">10</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="4ã€å¼‚æ­¥-amp-çº¿ç¨‹æ± "><a href="#4ã€å¼‚æ­¥-amp-çº¿ç¨‹æ± " class="headerlink" title="4ã€å¼‚æ­¥&amp;çº¿ç¨‹æ± "></a>4ã€å¼‚æ­¥&amp;çº¿ç¨‹æ± </h1><p>1ï¼‰ã€ç»§æ‰¿ Thread </p><p>2ï¼‰ã€å®ç° Runnable æ¥å£ </p><p>3ï¼‰ã€å®ç° Callable æ¥å£ + FutureTask ï¼ˆå¯ä»¥æ‹¿åˆ°è¿”å›ç»“æœï¼Œå¯ä»¥å¤„ç†å¼‚å¸¸ï¼‰ </p><p>4ï¼‰ã€çº¿ç¨‹æ± ï¼šè°ƒåº¦ã€èµ„æºæ§åˆ¶</p><p>çº¿ç¨‹æ± ä¸ƒå¤§å‚æ•°ï¼š</p><p>æ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°ã€è¶…æ—¶æ—¶é—´ã€è¶…æ—¶æ—¶é—´å•ä½ã€é˜»å¡é˜Ÿåˆ—ï¼Œçº¿ç¨‹å·¥å‚ã€æ‹’ç»ç­–ç•¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">è¿è¡Œæµç¨‹ï¼š </span><br><span class="line">1ã€çº¿ç¨‹æ± åˆ›å»ºï¼Œå‡†å¤‡å¥½ core æ•°é‡çš„æ ¸å¿ƒçº¿ç¨‹ï¼Œå‡†å¤‡æ¥å—ä»»åŠ¡ </span><br><span class="line">2ã€æ–°çš„ä»»åŠ¡è¿›æ¥ï¼Œç”¨ core å‡†å¤‡å¥½çš„ç©ºé—²çº¿ç¨‹æ‰§è¡Œã€‚ </span><br><span class="line">  (1) ã€core æ»¡äº†ï¼Œå°±å°†å†è¿›æ¥çš„ä»»åŠ¡æ”¾å…¥é˜»å¡é˜Ÿåˆ—ä¸­ã€‚ç©ºé—²çš„ core å°±ä¼šè‡ªå·±å»é˜»å¡é˜Ÿ åˆ—è·å–ä»»åŠ¡æ‰§è¡Œ </span><br><span class="line">  (2) ã€é˜»å¡é˜Ÿåˆ—æ»¡äº†ï¼Œå°±ç›´æ¥å¼€æ–°çº¿ç¨‹æ‰§è¡Œï¼Œæœ€å¤§åªèƒ½å¼€åˆ° max æŒ‡å®šçš„æ•°é‡</span><br><span class="line">  (3) ã€max éƒ½æ‰§è¡Œå¥½äº†ã€‚Max-core æ•°é‡ç©ºé—²çš„çº¿ç¨‹ä¼šåœ¨ keepAliveTime æŒ‡å®šçš„æ—¶é—´åè‡ª åŠ¨é”€æ¯ã€‚æœ€ç»ˆä¿æŒåˆ° core å¤§å° </span><br><span class="line">  (4) ã€å¦‚æœçº¿ç¨‹æ•°å¼€åˆ°äº† max çš„æ•°é‡ï¼Œè¿˜æœ‰æ–°ä»»åŠ¡è¿›æ¥ï¼Œå°±ä¼šä½¿ç”¨ reject æŒ‡å®šçš„æ‹’ç»ç­– ç•¥è¿›è¡Œå¤„ç† </span><br><span class="line">3ã€æ‰€æœ‰çš„çº¿ç¨‹åˆ›å»ºéƒ½æ˜¯ç”±æŒ‡å®šçš„ factory åˆ›å»ºçš„ã€‚</span><br></pre></td></tr></table></figure><h2 id="CompletableFutureå¼‚æ­¥ç¼–æ’"><a href="#CompletableFutureå¼‚æ­¥ç¼–æ’" class="headerlink" title="CompletableFutureå¼‚æ­¥ç¼–æ’"></a>CompletableFutureå¼‚æ­¥ç¼–æ’</h2><p>  å¾ˆå¤šè¯­è¨€ï¼Œæ¯”å¦‚ Node.jsï¼Œé‡‡ç”¨å›è°ƒçš„æ–¹å¼å®ç°å¼‚æ­¥ç¼–ç¨‹ã€‚Java çš„ä¸€äº›æ¡†æ¶ï¼Œæ¯”å¦‚ Nettyï¼Œè‡ª å·±æ‰©å±•äº† Java çš„ <code>Future</code>æ¥å£ï¼Œæä¾›äº†<code>addListener</code>ç­‰å¤šä¸ªæ‰©å±•æ–¹æ³•ï¼›Google guava ä¹Ÿæä¾›äº† é€šç”¨çš„æ‰©å±• Futureï¼›Scala ä¹Ÿæä¾›äº†ç®€å•æ˜“ç”¨ä¸”åŠŸèƒ½å¼ºå¤§çš„ Future/Promise å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼ã€‚</p><p>  åœ¨ Java 8 ä¸­, æ–°å¢åŠ äº†ä¸€ä¸ªåŒ…å« 50 ä¸ªæ–¹æ³•å·¦å³çš„ç±»: CompletableFutureï¼Œæä¾›äº†éå¸¸å¼ºå¤§çš„ Future çš„æ‰©å±•åŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç®€åŒ–å¼‚æ­¥ç¼–ç¨‹çš„å¤æ‚æ€§ï¼Œæä¾›äº†å‡½æ•°å¼ç¼–ç¨‹çš„èƒ½åŠ›ï¼Œå¯ä»¥ é€šè¿‡å›è°ƒçš„æ–¹å¼å¤„ç†è®¡ç®—ç»“æœï¼Œå¹¶ä¸”æä¾›äº†è½¬æ¢å’Œç»„åˆ CompletableFuture çš„æ–¹æ³•ã€‚ CompletableFuture ç±»å®ç°äº† Future æ¥å£ï¼Œæ‰€ä»¥ä½ è¿˜æ˜¯å¯ä»¥åƒä»¥å‰ä¸€æ ·é€šè¿‡<code>get</code>æ–¹æ³•é˜»å¡æˆ– è€…è½®è¯¢çš„æ–¹å¼è·å¾—ç»“æœï¼Œä½†æ˜¯è¿™ç§æ–¹å¼ä¸æ¨èä½¿ç”¨ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">+ å¯åŠ¨å¼‚æ­¥ä»»åŠ¡</span><br><span class="line">+ runAsync</span><br><span class="line">+ supplyAsync</span><br><span class="line">+ å®Œæˆå›è°ƒä¸å¼‚å¸¸æ„ŸçŸ¥</span><br><span class="line">+ whenComplete</span><br><span class="line">+ exceptionally</span><br><span class="line">+ whenCompleteAsync</span><br><span class="line">+ handleæœ€ç»ˆå¤„ç†</span><br><span class="line">+ å’Œ complete ä¸€æ ·</span><br><span class="line">+ å¯å¯¹ç»“æœåšæœ€åçš„å¤„ç†ï¼ˆå¯å¤„ç†å¼‚å¸¸ï¼‰ï¼Œå¯æ”¹å˜è¿”å›å€¼</span><br><span class="line">+ çº¿ç¨‹ä¸²è¡ŒåŒ–æ–¹æ³•</span><br><span class="line">+ thenApply</span><br><span class="line">+ thenAccept</span><br><span class="line">+ thenRun</span><br><span class="line">+ ä¸¤ä»»åŠ¡ç»„åˆ</span><br><span class="line">    + éƒ½è¦å®Œæˆ</span><br><span class="line">    + ä¸€ä¸ªå®Œæˆ</span><br><span class="line">+ å¤šä»»åŠ¡ç»„åˆ</span><br><span class="line">+ allOf</span><br><span class="line">+ anyOf</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">äº§å“å¼€å‘</summary>
    
    
    
    <category term="äº§å“" scheme="https://fireonice.github.io/categories/%E4%BA%A7%E5%93%81/"/>
    
    
    <category term="äº§å“å¼€å‘" scheme="https://fireonice.github.io/tags/%E4%BA%A7%E5%93%81%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>è°·ç²’å•†åŸâ€”â€”æ€§èƒ½å‹æµ‹</title>
    <link href="https://fireonice.github.io/2022/02/14/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-%E5%8E%8B%E6%B5%8B/"/>
    <id>https://fireonice.github.io/2022/02/14/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-%E5%8E%8B%E6%B5%8B/</id>
    <published>2022-02-14T06:47:15.765Z</published>
    <updated>2022-02-16T15:38:45.817Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1ã€jvm-å†…å­˜æ¨¡å‹"><a href="#1ã€jvm-å†…å­˜æ¨¡å‹" class="headerlink" title="1ã€jvm å†…å­˜æ¨¡å‹"></a>1ã€jvm å†…å­˜æ¨¡å‹</h1><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220214153035740.png" alt="image-20220214153035740"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+ ç¨‹åºè®¡æ•°å™¨ Program Counter Registerï¼š </span><br><span class="line"> + è®°å½•çš„æ˜¯æ­£åœ¨æ‰§è¡Œçš„è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼Œ </span><br><span class="line"> + æ­¤å†…å­˜åŒºåŸŸæ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨JAVAè™šæ‹Ÿæœºè§„èŒƒä¸­æ²¡æœ‰è§„å®šä»»ä½•OutOfMemoryErrorçš„åŒºåŸŸ </span><br><span class="line">+ è™šæ‹Ÿæœºï¼šVM Stack </span><br><span class="line"> + æè¿°çš„æ˜¯ JAVA æ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ï¼Œæ¯ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œçš„æ—¶å€™éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ï¼Œæ“ä½œæ•°æ ˆï¼ŒåŠ¨æ€é“¾æ¥ï¼Œæ–¹æ³•æ¥å£ç­‰ä¿¡æ¯</span><br><span class="line"> + å±€éƒ¨å˜é‡è¡¨å­˜å‚¨äº†ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§åŸºæœ¬æ•°æ®ç±»å‹ã€å¯¹è±¡å¼•ç”¨  </span><br><span class="line"> + çº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦ä¸å¤Ÿä¼šæŠ¥ StackOverflowError å¼‚å¸¸  </span><br><span class="line"> + æ ˆåŠ¨æ€æ‰©å±•çš„å®¹é‡ä¸å¤Ÿä¼šæŠ¥ OutOfMemoryError å¼‚å¸¸  </span><br><span class="line"> + è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹éš”ç¦»çš„ï¼Œå³æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„è™šæ‹Ÿæœºæ ˆ  </span><br><span class="line">+ æœ¬åœ°æ–¹æ³•ï¼šNative Stack  </span><br><span class="line"> + æœ¬åœ°æ–¹æ³•æ ˆç±»ä¼¼äºè™šæ‹Ÿæœºæ ˆï¼Œåªä¸è¿‡æœ¬åœ°æ–¹æ³•æ ˆä½¿ç”¨çš„æ˜¯æœ¬åœ°æ–¹æ³•  </span><br><span class="line">+ å †ï¼šHeap </span><br><span class="line"> + å‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨å †ä¸Šåˆ†é…å†…å­˜</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220214145444465.png" alt="image-20220214145444465"></p><h1 id="2ã€å †"><a href="#2ã€å †" class="headerlink" title="2ã€å †"></a>2ã€å †</h1><p>æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½è¦åœ¨å †ä¸Šåˆ†é…ã€‚å †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œä¹Ÿè¢«ç§°ä¸ºâ€œGCå †â€ï¼›ä¹Ÿæ˜¯æˆ‘ä»¬ä¼˜åŒ–æœ€å¤šè€ƒè™‘çš„åœ°æ–¹ã€‚ å †å¯ä»¥ç»†åˆ†ä¸ºï¼š </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+ æ–°ç”Ÿä»£ </span><br><span class="line"> + Eden ç©ºé—´ </span><br><span class="line"> + From Survivor ç©ºé—´ </span><br><span class="line"> + To Survivor ç©ºé—´ </span><br><span class="line">+ è€å¹´ä»£</span><br><span class="line">+ æ°¸ä¹…ä»£/å…ƒç©ºé—´ </span><br><span class="line"> + Java8 ä»¥å‰æ°¸ä¹…ä»£ï¼Œå— jvm ç®¡ç†ï¼Œjava8 ä»¥åå…ƒç©ºé—´ï¼Œç›´æ¥ä½¿ç”¨ç‰©ç†å†…å­˜ã€‚å› æ­¤ï¼Œ é»˜è®¤æƒ…å†µä¸‹ï¼Œå…ƒç©ºé—´çš„å¤§å°ä»…å—æœ¬åœ°å†…å­˜é™åˆ¶ã€‚</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220214145921888.png" alt="image-20220214145921888"></p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220214145742455.png" alt="image-20220214145742455"></p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220214145909109.png" alt="image-20220214145909109"></p><h1 id="3ã€JVM-åˆ†æ-amp-è°ƒä¼˜"><a href="#3ã€JVM-åˆ†æ-amp-è°ƒä¼˜" class="headerlink" title="3ã€JVM åˆ†æ&amp;è°ƒä¼˜"></a>3ã€JVM åˆ†æ&amp;è°ƒä¼˜</h1><p>Full gc æœ€ä¼šå½±å“æ€§èƒ½ï¼Œæ ¹æ®ä»£ç é—®é¢˜ï¼Œé¿å… full gc é¢‘ç‡ã€‚å¯ä»¥é€‚å½“è°ƒå¤§å¹´è½»ä»£å®¹é‡ï¼Œè®©å¤§å¯¹è±¡å¯ä»¥åœ¨å¹´è½»ä»£è§¦å‘ yong gcï¼Œè°ƒæ•´å¤§å¯¹è±¡åœ¨å¹´è½»ä»£çš„å›æ”¶é¢‘æ¬¡ï¼Œå°½å¯èƒ½ä¿è¯å¤§å¯¹è±¡åœ¨å¹´è½»ä»£å›æ”¶ï¼Œå‡å°è€å¹´ä»£ç¼©çŸ­å›æ”¶æ—¶é—´ã€‚</p><h1 id="4ã€å‹æµ‹"><a href="#4ã€å‹æµ‹" class="headerlink" title="4ã€å‹æµ‹"></a>4ã€å‹æµ‹</h1><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220214152417181.png" alt="image-20220214152417181"></p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220214152548781.png" alt="image-20220214152548781"></p><p>ç°é˜¶æ®µä¼˜åŒ–ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+ ä¸­é—´ä»¶</span><br><span class="line"> + nginx åŠ¨é™åˆ†ç¦»</span><br><span class="line"> + gateway</span><br><span class="line">+ db</span><br><span class="line"> + ç´¢å¼•</span><br><span class="line"> + æ“ä½œ</span><br><span class="line">+ log</span><br><span class="line">+ redis</span><br><span class="line">+ page cache</span><br><span class="line">+ jvmå†…å­˜</span><br><span class="line">+ ä¸šåŠ¡æµç¨‹</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">äº§å“å¼€å‘</summary>
    
    
    
    <category term="äº§å“" scheme="https://fireonice.github.io/categories/%E4%BA%A7%E5%93%81/"/>
    
    
    <category term="äº§å“å¼€å‘" scheme="https://fireonice.github.io/tags/%E4%BA%A7%E5%93%81%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>è°·ç²’å•†åŸâ€”â€”åˆ†å¸ƒå¼åŸºç¡€-å…¨æ ˆå¼€å‘ç¯‡</title>
    <link href="https://fireonice.github.io/2022/02/12/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-%E5%88%86%E5%B8%83%E5%BC%8F%E5%9F%BA%E7%A1%80/"/>
    <id>https://fireonice.github.io/2022/02/12/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-%E5%88%86%E5%B8%83%E5%BC%8F%E5%9F%BA%E7%A1%80/</id>
    <published>2022-02-12T11:15:39.860Z</published>
    <updated>2022-02-12T13:31:40.770Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1ã€å†™åœ¨å‰é¢"><a href="#1ã€å†™åœ¨å‰é¢" class="headerlink" title="1ã€å†™åœ¨å‰é¢"></a>1ã€å†™åœ¨å‰é¢</h1><p>ä»¿äº¬ä¸œå•†åŸå¤§å‹åˆ†å¸ƒå¼æ¶æ„ç”µå•†å¹³å°ï¼šå¾®æœåŠ¡æ¶æ„+åˆ†å¸ƒå¼+å…¨æ ˆ+é›†ç¾¤+éƒ¨ç½²+è‡ªåŠ¨åŒ–è¿ç»´+å¯è§†åŒ–CICD</p><p>Giteeä»“åº“ï¼š<a href="https://gitee.com/namdev/gulimall">https://gitee.com/namdev/gulimall</a></p><p>åå°æ¥å£æ–‡æ¡£ï¼š<a href="https://easydoc.net/s/78237135/ZUqEdvA4/hKJTcbfd">https://easydoc.net/s/78237135/ZUqEdvA4/hKJTcbfd</a></p><p>bç«™è§†é¢‘åœ°å€ï¼š<a href="https://www.bilibili.com/video/BV1np4y1C7Yf">å…¨ç½‘æœ€å¼ºç”µå•†æ•™ç¨‹ã€Šè°·ç²’å•†åŸã€‹å¯¹æ ‡é˜¿é‡ŒP6/P7ï¼Œ40-60ä¸‡å¹´è–ª</a></p><h1 id="2ã€æ¶æ„"><a href="#2ã€æ¶æ„" class="headerlink" title="2ã€æ¶æ„"></a>2ã€æ¶æ„</h1><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220212201439633.png" alt="image-20220212201439633"></p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220212201228064.png" alt="image-20220212201228064"></p><h1 id="3ã€åŸºç¡€ç¯å¢ƒ"><a href="#3ã€åŸºç¡€ç¯å¢ƒ" class="headerlink" title="3ã€åŸºç¡€ç¯å¢ƒ"></a>3ã€åŸºç¡€ç¯å¢ƒ</h1><p>linuxã€docker</p><p>æ•°æ®åº“</p><p>äººäººåå°</p><p>åˆ†å¸ƒå¼ç»„ä»¶</p><h1 id="4ã€å•†å“ã€è®¢å•ã€ä»“åº“æœåŠ¡åå°"><a href="#4ã€å•†å“ã€è®¢å•ã€ä»“åº“æœåŠ¡åå°" class="headerlink" title="4ã€å•†å“ã€è®¢å•ã€ä»“åº“æœåŠ¡åå°"></a>4ã€å•†å“ã€è®¢å•ã€ä»“åº“æœåŠ¡åå°</h1><h2 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h2><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220212211040144.png" alt="image-20220212211040144"></p><h2 id="pmsåº“"><a href="#pmsåº“" class="headerlink" title="pmsåº“"></a>pmsåº“</h2><p>Attrï¼šå±æ€§è¡¨</p><p>Attr_groupï¼šå±æ€§åˆ†ç»„è¡¨</p><p>Attr_attrgroup_relationï¼šå±æ€§åˆ†ç»„å…³è”è¡¨</p><p>Product_attr_valueï¼šå•†å“idå±æ€§å€¼è¡¨</p><p>Spu_infoï¼šå•†å“spu</p><p>Sku_infoï¼šå•†å“sku</p><p>Sku_imagesï¼šå•†å“skuå›¾ç‰‡</p><p>Sku_sale_attr_valuesï¼šå•†å“skué”€å”®å±æ€§å€¼</p><p>ä¸‰çº§åˆ†ç±»â€”â€”å±æ€§åˆ†ç»„â€”â€”å±æ€§</p><p>å±æ€§â€”â€”å•†å“ï¼ˆspuï¼‰å±æ€§é›†â€”â€”å•†å“å‹å·ï¼ˆskuï¼‰å±æ€§</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220212211136464.png" alt="image-20220212211136464"></p><h2 id="ä¿å­˜å•†å“"><a href="#ä¿å­˜å•†å“" class="headerlink" title="ä¿å­˜å•†å“"></a>ä¿å­˜å•†å“</h2><p>Spu_infoï¼šåŸºæœ¬ä¿¡æ¯</p><p>Spu_info_descï¼šid + æè¿°å›¾ç‰‡</p><p>Spu_imagesï¼šid + å›¾ç‰‡é›†</p><p>Product_attr_valueï¼šspuè§„æ ¼å‚æ•° spuid + å±æ€§å€¼</p><p>Spu_boundsï¼šå•†å“ç§¯åˆ† ï¼ˆsmsåº“ï¼‰</p><p>Sku_infoï¼šskuåŸºæœ¬ä¿¡æ¯ + spuid</p><p>Sku_imagesï¼šskuid + skuå›¾ç‰‡ä¿¡æ¯</p><p>Sku_sale_attr_valueï¼šskué”€å”®å±æ€§ skuid + å±æ€§å€¼</p><p>Skuä¼˜æƒ æ»¡å‡ä¿¡æ¯ï¼ˆsmsåº“ï¼‰ï¼šskuid</p><p>Sku_ladderï¼šæ‰“æŠ˜è¡¨</p><p>Sku_full_reductionï¼šæ»¡å‡è¡¨</p><p>Member_priceï¼šä¼šå‘˜ä»·æ ¼è¡¨</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220212211157512.png" alt="image-20220212211157512"></p><h2 id="ä¸šåŠ¡æ¥å£"><a href="#ä¸šåŠ¡æ¥å£" class="headerlink" title="ä¸šåŠ¡æ¥å£"></a>ä¸šåŠ¡æ¥å£</h2><p>å•è¡¨ã€å¤šè¡¨ã€å¤šåº“ã€è¿œç¨‹è°ƒç”¨ã€å±æ€§æ‹·è´ç­‰æš‚æ—¶çœç•¥</p><h1 id="5ã€jsr303æ ¡éªŒ"><a href="#5ã€jsr303æ ¡éªŒ" class="headerlink" title="5ã€jsr303æ ¡éªŒ"></a>5ã€jsr303æ ¡éªŒ</h1><p>å¼€å¯æ ¡éªŒï¼ˆé”™è¯¯è¿”å›ï¼‰ + beanæ ¡éªŒæ³¨è§£</p><p>ç»Ÿä¸€å¼‚å¸¸å¤„ç†</p><p>æšä¸¾ç±»</p><p>jsr303åˆ†ç»„æ ¡éªŒ</p><p>jsr303è‡ªå®šä¹‰æ ¡éªŒæ³¨è§£</p><h1 id="5ã€object"><a href="#5ã€object" class="headerlink" title="5ã€object"></a>5ã€object</h1><p>1.PO(persistant object) æŒä¹…å¯¹è±¡ </p><p>PO å°±æ˜¯å¯¹åº”æ•°æ®åº“ä¸­æŸä¸ªè¡¨ä¸­çš„ä¸€æ¡è®°å½•ï¼Œå¤šä¸ªè®°å½•å¯ä»¥ç”¨ PO çš„é›†åˆã€‚ PO ä¸­åº”è¯¥ä¸åŒ…å«ä»»ä½•å¯¹æ•°æ®åº“çš„æ“ä½œã€‚ </p><p>2.DOï¼ˆDomain Objectï¼‰é¢†åŸŸå¯¹è±¡å°±æ˜¯ä»ç°å®ä¸–ç•Œä¸­æŠ½è±¡å‡ºæ¥çš„æœ‰å½¢æˆ–æ— å½¢çš„ä¸šåŠ¡å®ä½“ã€‚ </p><p>3.TO(Transfer Object) æ•°æ®ä¼ è¾“å¯¹è±¡</p><p>ä¸åŒçš„åº”ç”¨ç¨‹åºä¹‹é—´ä¼ è¾“çš„å¯¹è±¡ </p><p>4.DTOï¼ˆData Transfer Objectï¼‰æ•°æ®ä¼ è¾“å¯¹è±¡</p><p>è¿™ä¸ªæ¦‚å¿µæ¥æºäº J2EE çš„è®¾è®¡æ¨¡å¼ï¼ŒåŸæ¥çš„ç›®çš„æ˜¯ä¸ºäº† EJB çš„åˆ†å¸ƒå¼åº”ç”¨æä¾›ç²—ç²’åº¦çš„ æ•°æ®å®ä½“ï¼Œä»¥å‡å°‘åˆ†å¸ƒå¼è°ƒç”¨çš„æ¬¡æ•°ï¼Œä»è€Œæé«˜åˆ†å¸ƒå¼è°ƒç”¨çš„æ€§èƒ½å’Œé™ä½ç½‘ç»œè´Ÿè½½ï¼Œä½†åœ¨è¿™é‡Œï¼Œæ³›æŒ‡ç”¨äºå±•ç¤ºå±‚ä¸æœåŠ¡å±‚ä¹‹é—´çš„æ•°æ®ä¼ è¾“å¯¹è±¡ã€‚ </p><p>5.VO(value object) å€¼å¯¹è±¡ </p><p>é€šå¸¸ç”¨äºä¸šåŠ¡å±‚ä¹‹é—´çš„æ•°æ®ä¼ é€’ï¼Œå’Œ PO ä¸€æ ·ä¹Ÿæ˜¯ä»…ä»…åŒ…å«æ•°æ®è€Œå·²ã€‚ä½†åº”æ˜¯æŠ½è±¡å‡º çš„ä¸šåŠ¡å¯¹è±¡ , å¯ä»¥å’Œè¡¨å¯¹åº” , ä¹Ÿå¯ä»¥ä¸ , è¿™æ ¹æ®ä¸šåŠ¡çš„éœ€è¦ ã€‚ç”¨ new å…³é”®å­—åˆ›å»ºï¼Œç”± GC å›æ”¶çš„ã€‚ View objectï¼šè§†å›¾å¯¹è±¡ï¼› æ¥å—é¡µé¢ä¼ é€’æ¥çš„æ•°æ®ï¼Œå°è£…å¯¹è±¡å°†ä¸šåŠ¡å¤„ç†å®Œæˆçš„å¯¹è±¡ï¼Œå°è£…æˆé¡µé¢è¦ç”¨çš„æ•°æ® </p><p><strong>6.BO(business object)</strong> <strong>ä¸šåŠ¡å¯¹è±¡</strong> </p><p>ä»ä¸šåŠ¡æ¨¡å‹çš„è§’åº¦çœ‹ , è§ UML å…ƒä»¶é¢†åŸŸæ¨¡å‹ä¸­çš„é¢†åŸŸå¯¹è±¡ã€‚å°è£…ä¸šåŠ¡é€»è¾‘çš„ </p><p>java å¯¹ è±¡ , é€šè¿‡è°ƒç”¨ DAO æ–¹æ³• , ç»“åˆ PO,VO è¿›è¡Œä¸šåŠ¡æ“ä½œã€‚business object: ä¸šåŠ¡å¯¹è±¡ä¸»è¦ä½œ ç”¨æ˜¯æŠŠä¸šåŠ¡é€»è¾‘å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡å¯ä»¥åŒ…æ‹¬ä¸€ä¸ªæˆ–å¤šä¸ªå…¶å®ƒçš„å¯¹è±¡ã€‚ æ¯”å¦‚ä¸€ä¸ªç®€ å†ï¼Œæœ‰æ•™è‚²ç»å†ã€å·¥ä½œç»å†ã€ç¤¾ä¼šå…³ç³»ç­‰ç­‰ã€‚ æˆ‘ä»¬å¯ä»¥æŠŠæ•™è‚²ç»å†å¯¹åº”ä¸€ä¸ª PO ï¼Œå·¥ä½œç» å†å¯¹åº”ä¸€ä¸ª PO ï¼Œç¤¾ä¼šå…³ç³»å¯¹åº”ä¸€ä¸ª PO ã€‚ å»ºç«‹ä¸€ä¸ªå¯¹åº”ç®€å†çš„ BO å¯¹è±¡å¤„ç†ç®€å†ï¼Œæ¯ä¸ª BO åŒ…å«è¿™äº› PO ã€‚ è¿™æ ·å¤„ç†ä¸šåŠ¡é€»è¾‘æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥é’ˆå¯¹ BO å»å¤„ç†ã€‚</p><p>7.POJO(plain ordinary java object) ç®€å•æ— è§„åˆ™ java å¯¹è±¡ </p><p>ä¼ ç»Ÿæ„ä¹‰çš„ java å¯¹è±¡ã€‚å°±æ˜¯è¯´åœ¨ä¸€äº› Object/Relation Mapping å·¥å…·ä¸­ï¼Œèƒ½å¤Ÿåšåˆ°ç»´æŠ¤ æ•°æ®åº“è¡¨è®°å½•çš„ persisent object å®Œå…¨æ˜¯ä¸€ä¸ªç¬¦åˆ Java Bean è§„èŒƒçš„çº¯ Java å¯¹è±¡ï¼Œæ²¡æœ‰å¢ åŠ åˆ«çš„å±æ€§å’Œæ–¹æ³•ã€‚æˆ‘çš„ç†è§£å°±æ˜¯æœ€åŸºæœ¬çš„ java Bean ï¼Œåªæœ‰å±æ€§å­—æ®µåŠ setter å’Œ getter æ–¹æ³•ï¼ã€‚POJO æ˜¯ DO/DTO/BO/VO çš„ç»Ÿç§°ã€‚ </p><p>8.DAO(data access object) æ•°æ®è®¿é—®å¯¹è±¡ </p><p>æ˜¯ä¸€ä¸ª sun çš„ä¸€ä¸ªæ ‡å‡† j2ee è®¾è®¡æ¨¡å¼ï¼Œ è¿™ä¸ªæ¨¡å¼ä¸­æœ‰ä¸ªæ¥å£å°±æ˜¯ DAO ï¼Œå®ƒè´ŸæŒä¹… å±‚çš„æ“ä½œã€‚ä¸ºä¸šåŠ¡å±‚æä¾›æ¥å£ã€‚æ­¤å¯¹è±¡ç”¨äºè®¿é—®æ•°æ®åº“ã€‚é€šå¸¸å’Œ PO ç»“åˆä½¿ç”¨ï¼Œ DAO ä¸­åŒ…å«äº†å„ç§æ•°æ®åº“çš„æ“ä½œæ–¹æ³•ã€‚é€šè¿‡å®ƒçš„æ–¹æ³• , ç»“åˆ PO å¯¹æ•°æ®åº“è¿›è¡Œç›¸å…³çš„æ“ä½œã€‚å¤¹åœ¨ä¸šåŠ¡é€»è¾‘ä¸æ•°æ®åº“èµ„æºä¸­é—´ã€‚é…åˆ VO, æä¾›æ•°æ®åº“çš„ CRUD æ“ä½œ.</p>]]></content>
    
    
    <summary type="html">äº§å“å¼€å‘</summary>
    
    
    
    <category term="äº§å“" scheme="https://fireonice.github.io/categories/%E4%BA%A7%E5%93%81/"/>
    
    
    <category term="äº§å“å¼€å‘" scheme="https://fireonice.github.io/tags/%E4%BA%A7%E5%93%81%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>å¼€å‘æ€»ç»“â€”â€”é‡‘èä¸šåŠ¡å¹³å°</title>
    <link href="https://fireonice.github.io/2022/02/07/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%933/"/>
    <id>https://fireonice.github.io/2022/02/07/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%933/</id>
    <published>2022-02-07T11:19:32.659Z</published>
    <updated>2022-02-07T12:10:50.478Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1ã€äº§å“æ¶æ„"><a href="#1ã€äº§å“æ¶æ„" class="headerlink" title="1ã€äº§å“æ¶æ„"></a>1ã€äº§å“æ¶æ„</h1><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220207192011048.png" alt="image-20220207192011048"></p><h1 id="2ã€ä¸šåŠ¡æµç¨‹"><a href="#2ã€ä¸šåŠ¡æµç¨‹" class="headerlink" title="2ã€ä¸šåŠ¡æµç¨‹"></a>2ã€ä¸šåŠ¡æµç¨‹</h1><p>1ã€è´¦æˆ·ç»‘å®š</p><p>ï¼ˆç”¨æˆ·è¡¨ã€ç”¨æˆ·ç»‘å®šè¡¨ï¼‰</p><p>ç”¨æˆ·â€”â€”ç»‘å®šä¿¡æ¯æäº¤ï¼ˆå€Ÿæ¬¾ã€å‡ºå€Ÿï¼‰â€”â€”è°ƒç”¨ç¬¬ä¸‰æ–¹æ‰˜ç®¡å¹³å°è´¦æˆ·åˆ›å»ºï¼ˆé˜¿é‡Œäº‘çŸ­ä¿¡ï¼‰â€”â€”ç»‘å®šå®Œæˆï¼ˆå¼‚æ­¥æ›´æ–°ï¼‰</p><p>2ã€ç”³è¯·å€Ÿæ¬¾é¢åº¦</p><p>ï¼ˆç”¨æˆ·è¡¨ã€ç§¯åˆ†è¡¨ã€å€Ÿæ¬¾äººè¡¨ã€å€Ÿæ¬¾äººå›¾ç‰‡è¡¨ï¼‰å‚ç›´åˆ†è¡¨</p><p>æäº¤å€Ÿæ¬¾äººä¸ªäººä¿¡æ¯ï¼ˆèº«ä»½è¯ç­‰è¯ä»¶èµ„æºï¼šå¯¹è±¡å­˜å‚¨ï¼‰â€”â€”åå°ç³»ç»Ÿè¯„ä¼°â€”â€”å®¡æ ¸é€šè¿‡â€”â€”è·å–é¢åº¦</p><p>3ã€å€Ÿæ¬¾é¢åº¦å®¡æ ¸</p><p>åå°å€Ÿæ¬¾é¢åº¦ç”³è¯·åˆ—è¡¨â€”â€”å€Ÿæ¬¾äººä¿¡æ¯â€”â€”å€Ÿæ¬¾é¢åº¦å®¡æ ¸</p><p>4ã€å€Ÿæ¬¾ç”³è¯·</p><p>ï¼ˆå€Ÿæ¬¾ä¿¡æ¯è¡¨ã€ç§¯åˆ†ç­‰çº§é…ç½®è¡¨ã€æ ‡çš„å‡†å¤‡è¡¨ï¼‰</p><p>è·å–å€Ÿæ¬¾é¢åº¦ï¼ˆç”¨æˆ·ç§¯åˆ†ï¼‰â€”â€”æäº¤å€Ÿæ¬¾ç”³è¯·â€”â€”è·å–å€Ÿæ¬¾ç”³è¯·çŠ¶æ€</p><p>5ã€å€Ÿæ¬¾å®¡æ ¸</p><p>åå°å€Ÿæ¬¾ä¿¡æ¯åˆ—è¡¨â€”â€”å€Ÿæ¬¾è¯¦æƒ…â€”â€”å€Ÿæ¬¾å®¡æ‰¹</p><p>6ã€æ ‡çš„ç®¡ç†</p><p>ï¼ˆæ ‡çš„è¡¨ï¼‰</p><p>å®¡æ ¸å®Œæˆâ€”â€”æ–°æ ‡çš„ã€æ ‡çš„è¯¦æƒ…ã€æ ‡çš„åˆ—è¡¨</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/image-20220207194625467.png" alt="image-20220207194625467"></p><p>7ã€æˆ‘è¦æŠ•èµ„</p><p>å‰ç«¯æ ‡çš„åˆ—è¡¨</p><p>8ã€å……å€¼</p><p>ï¼ˆç”¨æˆ·è´¦å·è¡¨[ä½™é¢ç­‰]ã€äº¤æ˜“æµæ°´è¡¨ï¼‰</p><p>æ³¨å†Œ + è´¦æˆ·ç»‘å®šâ€”â€”å……å€¼â€”â€”ç¬¬ä¸‰æ–¹æ‰˜ç®¡æ”¯ä»˜â€”â€”å®Œæˆï¼ˆå¼‚æ­¥ä¿®æ”¹ï¼‰</p><p>å¹‚ç­‰æ€§ä¿è¯ï¼ˆé‡å¤è¯·æ±‚ï¼‰ï¼šåˆ¤æ–­æµæ°´æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™é€€å‡º</p><p>9ã€æŠ•æ ‡</p><p>æ”¶ç›Šæ ¹æ®è¿˜æ¬¾æ–¹å¼ï¼šç­‰é¢æœ¬æ¯ã€ç­‰é¢æœ¬é‡‘ã€æŒ‰æœŸä»˜æ¯åˆ°æœŸè¿˜æœ¬ã€ä¸€æ¬¡è¿˜æœ¬ä»˜æ¯</p><p>ï¼ˆæ ‡çš„è¡¨ã€æ ‡çš„å‡ºå€Ÿè®°å½•è¡¨ã€è¿˜æ¬¾è®°å½•è¡¨ã€æ ‡çš„å‡ºå€Ÿå›æ¬¾è®°å½•è¡¨ï¼‰æ ‡çš„id</p><p>æ ‡çš„è¯¦æƒ…â€”â€”è¾“å…¥é‡‘é¢è®¡ç®—æ”¶ç›Šâ€”â€”æŠ•æ ‡æ”¯ä»˜â€”â€”å®Œæˆï¼ˆå¼‚æ­¥å›è°ƒï¼šæ ‡çš„çŠ¶æ€ã€æŠ•èµ„æµæ°´ã€é‡‘é¢ã€æ ‡çš„ä¿¡æ¯ï¼‰</p><p>10ã€æ”¾æ¬¾</p><p>ï¼ˆè¿˜æ¬¾äººè¿˜æ¬¾è®°å½•è¡¨ã€æŠ•èµ„äººå›æ¬¾è®°å½•è¡¨ï¼‰</p><p>ç®¡ç†å¹³å°æ”¾æ¬¾â€”â€”ï¼ˆ1ï¼‰æ ‡çš„çŠ¶æ€å’Œæ ‡çš„å¹³å°æ”¶ç›Šï¼ˆ2ï¼‰<strong>ç»™å€Ÿæ¬¾è´¦å·è½¬å…¥é‡‘é¢</strong>ï¼ˆ3ï¼‰å¢åŠ å€Ÿæ¬¾äº¤æ˜“æµæ°´ï¼ˆ4ï¼‰<strong>è§£å†»å¹¶æ‰£é™¤æŠ•èµ„äººèµ„é‡‘</strong>ï¼ˆ5ï¼‰å¢åŠ æŠ•èµ„äººäº¤æ˜“æµæ°´ï¼ˆ6ï¼‰ç”Ÿæˆå€Ÿæ¬¾äººè¿˜æ¬¾è®¡åˆ’å’Œå‡ºå€Ÿäººå›æ¬¾è®¡åˆ’</p><p>11ã€æŠ•èµ„åˆ—è¡¨å±•ç¤º</p><p>åå°åˆ—è¡¨â€”â€”å‰å°åˆ—è¡¨â€”â€”åå°è¿˜æ¬¾è®¡åˆ’â€”â€”å‰å°è¿˜æ¬¾è®¡åˆ’â€”â€”å‰å°å›æ¬¾è®¡åˆ’</p><p>12ã€æç°å’Œè¿˜æ¬¾</p><p>ç¬¬ä¸‰æ–¹æ‰˜ç®¡æç°</p><p>è¿˜æ¬¾â€”â€”è½¬å‡ºé‡‘é¢â€”â€”åˆ†é…è½¬å…¥æŠ•èµ„æ–¹â€”â€”æµæ°´æ˜ç»†ã€å›æ¬¾æ˜ç»†</p><p>13ã€ä¸ªäººä¸­å¿ƒ</p><p>æµæ°´æ˜ç»†ã€ç”¨æˆ·è´¦å·æ˜ç»†</p><p>14ã€æ¶ˆæ¯é˜Ÿåˆ—</p><p>ç›‘å¬æ¶ˆæ¯é˜Ÿåˆ—å‘é€çŸ­ä¿¡ï¼ˆå……å€¼ã€ç»‘å®šã€è½¬å‡ºç­‰ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/fireonice/picgo/img/27528777bac0634fd778ca60094057b4.png" alt="27528777bac0634fd778ca60094057b4"></p>]]></content>
    
    
    <summary type="html">äº§å“å¼€å‘</summary>
    
    
    
    <category term="äº§å“" scheme="https://fireonice.github.io/categories/%E4%BA%A7%E5%93%81/"/>
    
    
    <category term="äº§å“å¼€å‘" scheme="https://fireonice.github.io/tags/%E4%BA%A7%E5%93%81%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
</feed>
